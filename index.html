<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Phaser Manager</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect fill='%231a1510' width='32' height='32' rx='6'/><text x='16' y='22' font-size='18' font-weight='bold' fill='%23fbbf24' text-anchor='middle'>P</text></svg>"/>
  <script>
    window.onerror = function(msg, url, line, col, err) {
      var r = document.getElementById('root');
      if (r && r.querySelector && r.querySelector('.loading')) {
        var txt = (err && err.message) ? String(err.message) : String(msg);
        r.innerHTML = '<div style="padding:24px;max-width:480px;margin:40px auto;font-family:system-ui;background:#1a1a1a;color:#fff;border-radius:12px"><h2 style="color:#ef4444">Eroare</h2><pre style="margin:12px 0;font-size:12px;white-space:pre-wrap;color:#fca5a5">' + txt.replace(/</g,'&lt;') + '</pre><p style="margin-top:12px;color:#a1a1aa;font-size:12px">Deschide Consola (F12) pentru detalii.</p></div>';
      }
      return false;
    };
  </script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script>
    if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
      var r = document.getElementById('root');
      if (r) r.innerHTML = '<div style="padding:24px;max-width:480px;margin:40px auto;font-family:system-ui;background:#1a1a1a;color:#fff;border-radius:12px"><h2 style="color:#ef4444">Scripturile nu s-au încărcat</h2><p style="margin:12px 0;line-height:1.6">Deschizi fișierul direct (file://). Unele browsere blochează încărcarea de pe CDN.</p><p style="margin:12px 0"><strong>Rezolvare:</strong> Rulează un server local în folderul proiectului:</p><pre style="background:#222;padding:12px;border-radius:6px;font-size:12px;overflow:auto">cd "/Users/raczradu/Downloads/Phaser Manager"\npython3 -m http.server 8080</pre><p style="margin:12px 0">Apoi deschide <a href="http://localhost:8080" style="color:#60a5fa">http://localhost:8080</a></p></div>';
    }
  </script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', system-ui, sans-serif; }
    #root { height: 100vh; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel" data-presets="env,react">
const { useState, useEffect, useMemo, useRef } = React;

const LOGO_B64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABBMAAAGiCAYAAAC1aI4qAACCaklEQVR42uzdd7ykZXk38N91Xc/MKdt3gV2W3kEEqQIC0kF6UWKJmqiviZqoiUneGE0hxpK8icYWS2JMorEXLCBFpAoogqCAgoj0XrbvOWfmua/r/WPmrGfPnl1OmZnnmTm/7+ezH2CXPTNz3ffc5XruAhARERER0awU9frREbEvI0FEU6UMARERERHRbJ0N6CEppT0YCCKaqowhICIiIiKapSLudfcnGAgiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiKiqRKGgIhGRcS2APoxMiLo63tcRNYzKkRERD3d988FsDWAmPB/GBlR9PWtEJEVjBYREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREREVThgCIiIiIipCPPro4MjixTuM/b2+vj4HcJ+I5IwQEREREREREW0k6vVjUp67p+Rj/rkuIpYxOkRE5ZYxBERERERUIHmO/yYqnXq9fpKqHgH3HABUVVCvf1X6++9hdGi2YDKBiIiIiIhoClTkbFX9I6iOmVlltwNgMoFmz/eAISAiIiIiIpqCiBwAPCV4SqO/O4+BodmEyQQiIiIiIqIZcpGtGAWaTZhMICIiIiIimrlgCGg2YTKBiIiIiIiIiKaEBzASERERERFNTX2C35vWyoSI2CrV62eaapbcGdkJmCoSsNbMViMlhdmKer0+VKlUVgJYAWCViCRGqrOyMZV4AYBd6/U6a/CmpJLSs0hpBHPmCICVIjLMsLRPRCwHsJT1cfIqlYoAeFxEHm9DeWwPYGuWx6TLArVaLVWr1V+JSI0R6co2qK9Wq+1VrValXq+Pfr/WArhXRLiMlWgWWb169ZLBwcFTDMg4U6Ex/cT+EZt0B33T/HG7WZZ9FiIwMwZ3cwkFAOEOUYWnVDPVuqc0AmBYRNZ7nj8UwCMqcl+K+LVFPIYsewjAAyIyxAi2MZkA4DgAn8/MOFnYtLEQV12PSiVHSgKRoVSv5yLyBIA1IfKIAk8DeChFPBERT2ZZ9hiAR5l0mCb3P4Lq21gfp0Tc/Z8AvK/lxZHSX6rZ77M8Jt9mZFm2AsCxAO5jRLpPSun0SpZ91lPSzCwiQhDxpKgeDeAxRog6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";

function useIsMobile() {
  const [mob, setMob] = useState(typeof window !== "undefined" ? window.innerWidth < 768 : false);
  useEffect(() => {
    const h = () => setMob(window.innerWidth < 768);
    window.addEventListener("resize", h);
    return () => window.removeEventListener("resize", h);
  }, []);
  return mob;
}



const gTheme = () => {
  if (typeof window !== "undefined" && window.matchMedia)
    return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
  return "dark";
};

const TH = {
  light: { bg:"#f5f5f5",c:"#ffffff",h:"#f0f0f0",i:"#ffffff",b:"#e0e0e0",bl:"#ebebeb",t:"#111111",ts:"#444444",tm:"#888888",sb:"#111111",sbb:"#222222",sbt:"#888888",sba:"#ffffff",a:"#111111",ab:"rgba(0,0,0,.07)",ov:"rgba(0,0,0,.55)" },
  dark:  { bg:"#09090b",c:"#141414",h:"#1c1c1c",i:"#1a1a1a",b:"#27272a",bl:"#1f1f1f",t:"#fafafa",ts:"#a1a1aa",tm:"#52525b",sb:"#0a0a0c",sbb:"#1a1a1a",sbt:"#a1a1aa",sba:"#fafafa",a:"#fafafa",ab:"rgba(255,255,255,.06)",ov:"rgba(0,0,0,.75)" }
};

const ST = {
  oferta:      { l:"Ofertă",        c:"#f59e0b", bg:"#fef9c3", bd:"#422006" },
  asteptare:   { l:"Așt. contract", c:"#a78bfa", bg:"#ede9fe", bd:"#2e1065" },
  plata_avans: { l:"Plată avans",   c:"#3b82f6", bg:"#dbeafe", bd:"#1e3a8a" },
  confirmat:   { l:"Confirmat",     c:"#22c55e", bg:"#dcfce7", bd:"#052e16" },
  respins:     { l:"Respins",       c:"#ef4444", bg:"#fee2e2", bd:"#450a0a" }
};

const PRIVATE_TYPES = ["Nuntă","Botez","Private Party","Corporate","Altele"];
const PUBLIC_TYPES  = ["Festival","Concert","Club","Altele"];

const uid = () => Math.random().toString(36).substr(2,9);
const f$  = n => new Intl.NumberFormat("ro",{maximumFractionDigits:0}).format(n||0)+" €";
const fD  = d => { if(!d) return "—"; return new Date(d+"T00:00:00").toLocaleDateString("ro",{day:"numeric",month:"short",year:"numeric"}); };
const dU  = d => { if(!d) return 999; return Math.ceil((new Date(d+"T00:00:00")-new Date())/864e5); };

const MEMBERS = [
  {id:"m1",n:"Carina Dumitru",r:"Vocal"},
  {id:"m2",n:"Radu Racz",r:"Bass"},
  {id:"m3",n:"Lucian Oprișan",r:"Clape"},
  {id:"m4",n:"Arnold Birta",r:"Tobe"},
  {id:"m5",n:"Sebastian Bârzeianu",r:"Chitară"}
];

const USERS = [
  {id:"u1",n:"Admin",rl:"admin"},
  {id:"u2",n:"Manager",rl:"manager"},
  {id:"u3",n:"Membru",rl:"membru"},
  {id:"u4",n:"Furnizor",rl:"furnizor"}
];

const PM = {
  admin:    {c:1,e:1,d:1,f:1,co:1,pk:1},
  manager:  {c:1,e:1,d:0,f:1,co:1,pk:1},
  membru:   {c:0,e:0,d:0,f:0,co:0,pk:1},
  furnizor: {c:0,e:0,d:0,f:0,co:0,pk:0}
};

const PX = { r:{3:4100,2:3100,1:2350}, sunet:350, lumini:500, ecran:600, scena:300, dj:600, pub:2000 };

const DEFAULT_VIDEOS = [
  { id:"v1", title:"PHASER — Show Reel (Live)", url:"https://www.youtube.com/embed/dQw4w9WgXcQ", checked:true, caption:"PHASER Live — energie și emoție pe scenă" },
  { id:"v2", title:"PHASER — Live la nuntă", url:"https://www.youtube.com/embed/dQw4w9WgXcQ", checked:true, caption:"Good vibes are here — atmosferă de nuntă" },
  { id:"v3", title:"PHASER — Carina Dumitru la X Factor", url:"https://www.youtube.com/embed/dQw4w9WgXcQ", checked:true, caption:"Vocea PHASER — Carina la X Factor" },
  { id:"v4", title:"PHASER — Live DJ set", url:"https://www.youtube.com/embed/dQw4w9WgXcQ", checked:false, caption:"DJ set — de la live la party" },
];

// Playlist complet — 56 cover-uri din oferta oficială
const DEFAULT_COVERS = [
  {id:"p1",  title:"APT.",                                  artist:"ROSÉ & Bruno Mars",              checked:true},
  {id:"p2",  title:"Angels",                                artist:"Robbie Williams",                 checked:true},
  {id:"p3",  title:"Basul si cu toba mare",                 artist:"Vita de Vie",                    checked:true},
  {id:"p4",  title:"California Love",                       artist:"Tupac",                          checked:true},
  {id:"p5",  title:"Could you be loved",                    artist:"Bob Marley",                     checked:true},
  {id:"p6",  title:"Constantine, Constantine",              artist:"Liviu Vasilica",                 checked:true},
  {id:"p7",  title:"Crazy little thing called love",        artist:"Queen",                          checked:true},
  {id:"p8",  title:"Feel so close",                         artist:"Calvin Harris",                  checked:true},
  {id:"p9",  title:"Follow rivers",                         artist:"Lickke Li (The Magician Remix)", checked:true},
  {id:"p10", title:"Four, five seconds",                    artist:"Rihanna",                        checked:true},
  {id:"p11", title:"Flowers",                               artist:"Miley Cyrus",                    checked:true},
  {id:"p12", title:"Happy",                                 artist:"Pharell",                        checked:true},
  {id:"p13", title:"Hey Ya!",                               artist:"OutKast",                        checked:true},
  {id:"p14", title:"Hotstepper",                            artist:"Imi Kamoze",                     checked:true},
  {id:"p15", title:"I gotta feelin\'",                     artist:"Black Eyed Peas",                checked:true},
  {id:"p16", title:"I feel good",                           artist:"James Brown",                    checked:true},
  {id:"p17", title:"I will survive",                        artist:"Aretha Franklin",                checked:true},
  {id:"p18", title:"I wanna dance with somebody",           artist:"Whitney Houston",                checked:true},
  {id:"p19", title:"It\'s my life",                        artist:"Jon Bon Jovi",                   checked:true},
  {id:"p20", title:"Jailhouse rock",                        artist:"Elvis Presley",                  checked:true},
  {id:"p21", title:"Jump around",                           artist:"House of Pain",                  checked:true},
  {id:"p22", title:"Je Veux",                               artist:"Zaz",                            checked:true},
  {id:"p23", title:"Like a virgin",                         artist:"Madonna",                        checked:true},
  {id:"p24", title:"La carciuma de la drum",                artist:"Electric Fence",                 checked:true},
  {id:"p25", title:"Ne place",                              artist:"ROA",                            checked:true},
  {id:"p26", title:"Robot Armasar Attack",                  artist:"Gojira VS Liviu Vasilica",       checked:true},
  {id:"p27", title:"Rock this party",                       artist:"Bob Sinclar",                    checked:true},
  {id:"p28", title:"Mercy",                                 artist:"Duffy",                         checked:true},
  {id:"p29", title:"Moves like jagger",                     artist:"Maroon 5",                       checked:true},
  {id:"p30", title:"Mundian to Bach Ke",                    artist:"Panjabi MC",                     checked:true},
  {id:"p31", title:"Niggas In Paris",                       artist:"JAY-Z, Kanye West",              checked:true},
  {id:"p32", title:"Nah neh nah",                           artist:"Vaya con dios",                  checked:true},
  {id:"p33", title:"No woman, no cry",                      artist:"Bob Marley",                     checked:true},
  {id:"p34", title:"Pentru inimi",                          artist:"Suie Paparude",                  checked:true},
  {id:"p35", title:"Purple rain",                           artist:"Prince",                         checked:true},
  {id:"p36", title:"Sex on fire",                           artist:"Kings of Leon",                  checked:true},
  {id:"p37", title:"Shake It Off",                          artist:"Taylor Swift",                   checked:true},
  {id:"p38", title:"Shook me all night long",               artist:"AC/DC",                          checked:true},
  {id:"p39", title:"Sweet child o\'mine",                  artist:"Guns \'n\' roses",             checked:true},
  {id:"p40", title:"Simply the best",                       artist:"Tina Turner",                    checked:true},
  {id:"p41", title:"Soulstorm",                             artist:"Patrice",                        checked:true},
  {id:"p42", title:"Smells like teen spirit",               artist:"Nirvana",                        checked:true},
  {id:"p43", title:"Still D.R.E.",                          artist:"Dr. Dre",                        checked:true},
  {id:"p44", title:"That\'s Not My Name",                  artist:"The Ting Tings",                 checked:true},
  {id:"p45", title:"That\'s the way (I like it)",          artist:"KC & The Sunshine Band",         checked:true},
  {id:"p46", title:"Time of my life",                       artist:"Dirty Dancing Soundtrack",       checked:true},
  {id:"p47", title:"Ti-am dat un inel",                     artist:"Holograf",                       checked:true},
  {id:"p48", title:"Uptown funk",                           artist:"Mark Ronson feat. Bruno Mars",   checked:true},
  {id:"p49", title:"Valerie",                               artist:"Amy Whinehouse",                 checked:true},
  {id:"p50", title:"Vino la mine",                          artist:"N&D",                            checked:true},
  {id:"p51", title:"Waiting all night",                     artist:"Rudimental",                     checked:true},
  {id:"p52", title:"Wake me up",                            artist:"Avicii feat. Aloe Blacc",        checked:true},
  {id:"p53", title:"Walk this way",                         artist:"Run DMC VS Aerosmith",           checked:true},
  {id:"p54", title:"What\'s up",                           artist:"4 Non Blondes",                  checked:true},
  {id:"p55", title:"We will rock you",                      artist:"Queen",                          checked:true},
  {id:"p56", title:"You\'re the one that I want",          artist:"Olivia Newton John & J. Travolta",checked:true},
];

// Rider tehnic complet — din documentul oficial Phaser
const RIDER_TEHNIC = {
  sunet:       { titlu:"Sistem de Sunet",    text:"Sistemul de sunet trebuie să fie configurat și dimensionat corespunzător pentru a acoperi nevoile spațiului. Mărci agreate: Meyer Sound, D&B, L-Acoustics.", req:"Inginer de sistem obligatoriu." },
  scena:       { titlu:"Scenă",              text:"Podium cu dimensiunea minimă de 8m în deschidere și 6m adâncime. Aer liber: acoperiș + laturi acoperite + scări acces.", req:"Temperaturi extreme: încălzitoare mobile / ventilatoare." },
  probe:       { titlu:"Probe de Sunet",     text:"60 minute amplasare echipamente pe scenă + 60 minute probe de sunet." },
  lumini:      { titlu:"Sistem de Lumini",   text:"Sistem profesional de bună calitate, potrivit pentru spațiu. Tehnician de lumini obligatoriu." },
  video:       { titlu:"Video",              text:"Dacă există ecran LED / videoproiector la scenă, avem nevoie de un cablu HDMI conectat la sistemul video, ajungând în dreptul riser-ului de tobe." },
  risere:      ["Riser Tobe — 2 × 3 × 0,4m", "Riser Clape — 2 × 2 × 0,4m"],
  monitoare:   ["4 monitoare conform plan de amplasament"],
  stative:     ["2 stative de microfon tip girafa"],
  cabluri:     ["1 cablu CAT5 de la scenă la FOH", "20 cabluri XLR", "Surse 220V cu minim 4 prize (conform plan)"],
  conectica:   ["Left/Right mix (AES/EBU sau Analog - XLR)", "Mon 1 Mono mix (Analog - XLR)"],
  instalare:   "Necesare 2 persoane ajutor pentru descărcat/încărcat echipamente.",
  parcare:     "2 locuri de parcare lângă scenă, de la soundcheck până după concert.",
  securitate:  "Organizatorul asigură securitatea artiștilor și echipamentelor pe toată durata evenimentului. Spațiu depozitare case-uri și huse lângă scenă.",
  backstage:   [
    "Iluminare puternică",
    "Aer condiționat / încălzire controlabile independent",
    "Minimum 4 prize electrice 220V AC",
    "O masă + coș de gunoi curat",
    "8 scaune sau 3 canapele",
    "Acces facil la toaletă",
    "24 sticle apă plată (temperatura camerei)",
    "12 sticle bere 0,5L",
    "8 doze Cola Zero",
    "2 × 1L suc portocale (fără concentrat)",
    "2 sticle vin alb/rosé sec (gama Fautor sau echivalent)",
    "8 meniuri de mâncare"
  ],
  onStage:    ["15 sticle apă plată la temperatura camerei"],
  contact:    "Racz Radu — +40 744 771 488"
};

const INIT_EV    = [];
const INIT_GE    = [];
const INIT_TASKS = [];
const loadCreative = () => { try { const s=localStorage.getItem("phaser_creative"); if(s) return JSON.parse(s); } catch(e){} return {ideas:[],songs:[],setlists:[]}; };
// Templates — stocate în localStorage, folosite ca bază pentru oferte
const loadTemplates = () => {
  try {
    const s = localStorage.getItem("phaser_templates");
    if (s) return JSON.parse(s);
  } catch(e) {}
  return {
    playlist: JSON.parse(JSON.stringify(DEFAULT_COVERS)),
    riderContent: {},
    riderCustom: [],
    riderStagePlot: { image: null, notes: "" },
    pressKitPrivat: "",
    pressKitPublic: "",
    poveste: "Phaser înseamnă atitudine, dinamică și multă energie. Un show Phaser este un tour de force încărcat cu intensitate dar și cu momente de sensibilitate simplă. Printre cuvinte, imagini și muzică spunem povestea tuturor — a celor ce iubesc sau a celor îndrăgostiți de viață."
  };
};
// Versiuni rider — phaser_rider_versions: [{ id, ts, label, data }]
const loadRiderVersions = () => {
  try {
    const s = localStorage.getItem("phaser_rider_versions");
    if (s) return JSON.parse(s);
  } catch(e) {}
  return [];
};

// ─── ICONS ───
const sp = {fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"};
const Ic = (d,extra={}) => ({s=18})=><svg width={s} height={s} viewBox="0 0 24 24" {...sp} {...extra}>{d}</svg>;
const IcMenu  = Ic(<><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></>);
const IcX     = Ic(<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>);
const IcDash  = Ic(<><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></>);
const IcCal   = Ic(<><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></>);
const IcMusic = Ic(<><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></>);
const IcMoney = Ic(<><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></>);
const IcPlus  = Ic(<><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>);
const IcFile  = Ic(<><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></>);
const IcEdit  = Ic(<><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.12 2.12 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></>);
const IcTrash = Ic(<><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></>);
const IcSearch= Ic(<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></>);
const IcChevL = Ic(<polyline points="15 18 9 12 15 6"/>);
const IcChevR = Ic(<polyline points="9 18 15 12 9 6"/>);
const IcOut   = Ic(<><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></>);
const IcCheck = Ic(<polyline points="20 6 9 17 4 12"/>);
const IcSend  = Ic(<><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></>);
const IcPlay  = Ic(<polygon points="5 3 19 12 5 21 5 3"/>);
const IcDisc  = Ic(<><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></>);
const IcTask  = Ic(<><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></>);
const IcImg   = Ic(<><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></>);
const IcDoc   = Ic(<><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></>);
const IcClock = Ic(<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>);

// ─── LOGO ─── 
// Logo alb pe fundal întunecat (sidebar), negru pe fundal alb (oferte, modals)
function Logo({ height=28, dark=false }) {
  // Logo-ul original e alb => pe fundal întunecat merge direct
  // Pe fundal alb, îl facem negru cu invert
  return (
    <img
      src={LOGO_B64}
      alt="PHASER"
      style={{
        height,
        objectFit:"contain",
        display:"block",
        filter: dark ? "invert(1) brightness(0)" : "none",
      }}
    />
  );
}

function Badge({s, th}) {
  const c = ST[s]; if(!c) return null;
  const dk = th.bg==="#09090b";
  return <span style={{display:"inline-block",padding:"2px 10px",borderRadius:20,fontSize:10,fontWeight:700,background:dk?c.bd:c.bg,color:c.c,whiteSpace:"nowrap"}}>{c.l}</span>;
}
function BadgeStatusSelect({s, th, evId, onStatusChange}) {
  const [open, setOpen] = useState(false);
  const c = ST[s]; if(!c) return null;
  const dk = th.bg==="#09090b";
  if(!onStatusChange) return <Badge s={s} th={th}/>;
  const opts = Object.entries(ST).map(([k,v])=><div key={k} onClick={()=>{onStatusChange(evId,k);setOpen(false);}} style={{padding:"6px 12px",fontSize:11,cursor:"pointer",borderRadius:6,background:k===s?th.ab:"transparent",color:th.t}} onMouseOver={e=>{e.currentTarget.style.background=th.ab;}} onMouseOut={e=>{e.currentTarget.style.background=k===s?th.ab:"transparent";}}>{v.l}</div>);
  const dropdown = open ? <div style={{position:"absolute",top:"100%",left:0,marginTop:4,zIndex:999,background:th.c,border:`1px solid ${th.b}`,borderRadius:8,boxShadow:"0 8px 24px rgba(0,0,0,.2)",minWidth:140,padding:4}} onClick={e=>e.stopPropagation()}>{opts}</div> : null;
  const overlay = open ? <div style={{position:"fixed",inset:0,zIndex:998}} onClick={()=>setOpen(false)}/> : null;
  return <div style={{position:"relative",display:"inline-block"}}>
    <span onClick={e=>{e.stopPropagation();setOpen(o=>!o);}} style={{display:"inline-block",padding:"2px 10px",borderRadius:20,fontSize:10,fontWeight:700,background:dk?c.bd:c.bg,color:c.c,whiteSpace:"nowrap",cursor:"pointer",border:"1px solid transparent"}}>{c.l}</span>
    {dropdown}
    {overlay}
  </div>;
}

function Toast({message, visible}) {
  if(!visible) return null;
  return <div style={{position:"fixed",bottom:24,left:"50%",transform:"translateX(-50%)",padding:"12px 24px",borderRadius:10,background:"#111",border:"1px solid #22c55e",boxShadow:"0 8px 32px rgba(0,0,0,.4)",zIndex:9999,display:"flex",alignItems:"center",gap:10,fontSize:13,fontWeight:600,color:"#22c55e"}}><IcCheck s={16}/> {message}</div>;
}

// ─── TASKS (Notion-style, recursive: orice task poate avea subtask-uri la nesfârșit) ───
const fullTask = (text, prio="medium") => ({id:uid(),text,done:false,taskStatus:"in_proces",priority:prio,cr:new Date().toISOString().split("T")[0],due:"",subtasks:[],notes:"",tags:[],chats:[],uploads:[]});
const toggleInTree = (tasks, id) => tasks.map(t=>t.id===id?{...t,done:!t.done,taskStatus:!t.done?"done":"in_proces"}:{...t,subtasks:toggleInTree(t.subtasks||[],id)});
const delInTree = (tasks, id) => tasks.filter(t=>t.id!==id).map(t=>({...t,subtasks:delInTree(t.subtasks||[],id)}));
const addSubInTree = (tasks, parentId, sub) => tasks.map(t=>t.id===parentId?{...t,subtasks:[...(t.subtasks||[]),sub]}:{...t,subtasks:addSubInTree(t.subtasks||[],parentId,sub)});
const updInTree = (tasks, id, upd) => tasks.map(t=>t.id===id?(typeof upd==="function"?upd(t):{...t,...upd}):{...t,subtasks:updInTree(t.subtasks||[],id,upd)});

function TasksView({ tasks, setTasks, th, sty, mob, compact=false }) {
  const [newText, setNewText] = useState("");
  const [newPrio, setNewPrio] = useState("medium");
  const [expandedIds, setExpandedIds] = useState(new Set());
  const [viewMode, setViewMode] = useState("list"); // list | calendar | kanban
  const [kanbanDragCol, setKanbanDragCol] = useState(null);
  const PC = {high:"#ef4444", medium:"#f59e0b", low:"#22c55e"};
  const PL = {high:"Urgent", medium:"Normal", low:"Low"};
  const TSL = {in_proces:"În proces",in_lucru:"În lucru",done:"Done"};
  const TSC = {in_proces:"#6366f1",in_lucru:"#f59e0b",done:"#22c55e"};

  const add = () => {
    if(!newText.trim()) return;
    setTasks(p=>[...p,fullTask(newText.trim(),newPrio)]);
    setNewText("");
  };
  const toggle = id => setTasks(p=>toggleInTree(p,id));
  const del = id => setTasks(p=>delInTree(p,id));
  const addSub = (parentId, txt) => { if(!txt.trim()) return; setTasks(p=>addSubInTree(p,parentId,fullTask(txt.trim(),"medium"))); };
  const updTask = (id, upd) => setTasks(p=>updInTree(p,id,upd));
  const addTag = (tid, tag) => { if(!tag.trim()) return; updTask(tid,t=>({...t,tags:[...(t.tags||[]),tag.trim()]})); };
  const remTag = (tid, tag) => updTask(tid,t=>({...t,tags:(t.tags||[]).filter(x=>x!==tag)}));
  const addChat = (tid, txt, replyToId) => { if(!txt.trim()) return; updTask(tid,t=>{const nc={id:uid(),text:txt.trim(),date:new Date().toISOString(),author:"Eu",replyTo:replyToId,replies:[]}; return {...t,chats:[...(t.chats||[]),nc]};}); setReplyingTo(null); };
  const addReply = (tid, chatId, txt) => { if(!txt.trim()) return; updTask(tid,t=>({...t,chats:(t.chats||[]).map(c=>c.id===chatId?{...c,replies:[...(c.replies||[]),{id:uid(),text:txt.trim(),date:new Date().toISOString(),author:"Eu"}]}:c)})); setReplyingTo(null); };
  const toggleExpanded = (id) => setExpandedIds(s=>{const n=new Set(s);if(n.has(id))n.delete(id);else n.add(id);return n;});

  const [replyingTo, setReplyingTo] = useState(null); // {tid, chatId}

  const taskStatus = t => (t.taskStatus==="done"||t.done)?"done":(t.taskStatus||"in_proces");
  const active = tasks.filter(t=>taskStatus(t)!=="done").sort((a,b)=>({high:0,medium:1,low:2})[a.priority||"medium"]-({high:0,medium:1,low:2})[b.priority||"medium"]);
  const done = tasks.filter(t=>taskStatus(t)==="done");

  const TaskCard = ({ t, isDone, depth=0 }) => {
    const ex = expandedIds.has(t.id);
    const subs = t.subtasks||[];
    const doneSubs = subs.filter(s=>s.done).length;
    const isReplying = replyingTo&&replyingTo.tid===t.id;
    return (
      <div key={t.id} style={{borderRadius:10,background:th.c,border:`1px solid ${th.b}`,borderLeft:`4px solid ${PC[t.priority||"medium"]}`,overflow:"hidden",marginBottom:8,boxShadow:"0 2px 6px rgba(0,0,0,.04)",marginLeft:depth*12}}>
        <div onClick={()=>toggleExpanded(t.id)} style={{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",cursor:"pointer"}}>
          <div onClick={e=>{e.stopPropagation();toggle(t.id);}} style={{width:20,height:20,borderRadius:5,border:`2px solid ${PC[t.priority||"medium"]}`,cursor:"pointer",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",background:isDone?th.b:"transparent"}}>{isDone&&<IcCheck s={12}/>}</div>
          <div style={{flex:1,fontSize:14,fontWeight:500,textDecoration:isDone?"line-through":undefined,color:isDone?th.tm:th.t}}>{t.text}</div>
          {!compact&&<span style={{fontSize:9,padding:"1px 6px",borderRadius:8,background:PC[t.priority||"medium"]+"22",color:PC[t.priority||"medium"],fontWeight:700}}>{PL[t.priority||"medium"]}</span>}
          {!compact&&t.due&&<span style={{fontSize:9,color:th.tm}}><IcClock s={10}/> {fD(t.due)}</span>}
          {!compact&&(t.tags||[]).length>0&&<span style={{fontSize:9,color:th.tm}}>{(t.tags||[]).slice(0,2).map(tg=><span key={tg}>#{tg} </span>)}</span>}
          {!compact&&subs.length>0&&<span style={{fontSize:9,color:th.tm}}>{doneSubs}/{subs.length}</span>}
          <span style={{fontSize:14,color:th.tm,fontWeight:400,transition:"transform .2s",transform:ex?"rotate(90deg)":"rotate(0)"}}>▶</span>
          <button onClick={e=>{e.stopPropagation();del(t.id);}} style={{padding:4,border:"none",background:"transparent",color:th.tm,cursor:"pointer",opacity:.7}}><IcTrash s={12}/></button>
        </div>
        {ex&&<div style={{padding:"16px 20px 20px 56px",borderTop:`1px solid ${th.bl}`,background:th.bg==="#09090b"?"rgba(255,255,255,.02)":"rgba(0,0,0,.02)"}}>
          <div style={{display:"flex",gap:6,marginTop:8,marginBottom:6,flexWrap:"wrap"}}>
            <div style={{display:"flex",alignItems:"center",gap:4}}>
              <input type="date" value={t.due||""} onChange={e=>updTask(t.id,{due:e.target.value})} style={{...sty.i,padding:"4px 8px",fontSize:11}}/>
              <span style={{fontSize:10,color:th.tm}}>📅 Deadline</span>
            </div>
            <div style={{display:"flex",gap:4,flexWrap:"wrap"}}>
              {(t.tags||[]).map(tag=><span key={tag} style={{fontSize:10,padding:"2px 8px",borderRadius:10,background:th.ab,color:th.t,display:"flex",alignItems:"center",gap:4}}>{tag}<button onClick={()=>remTag(t.id,tag)} style={{padding:0,border:"none",background:"transparent",cursor:"pointer",fontSize:10,color:th.tm}}>×</button></span>)}
              <input placeholder="+ Tag" onKeyDown={e=>{if(e.key==="Enter"){addTag(t.id,e.target.value);e.target.value="";}}} style={{...sty.i,width:70,padding:"4px 6px",fontSize:10}}/>
            </div>
          </div>
          <div style={{marginBottom:8}}>
            <div style={{fontSize:10,color:th.tm,fontWeight:600,marginBottom:4}}>Subtasks (fiecare poate avea la rândul ei subtask-uri)</div>
            {subs.map(s=><TaskCard key={s.id} t={{...s,subtasks:s.subtasks||[],tags:s.tags||[],chats:s.chats||[],uploads:s.uploads||[]}} isDone={s.done} depth={depth+1}/>)}
            <input placeholder="+ Subtask (Enter) — același format ca task-ul" onKeyDown={e=>{if(e.key==="Enter"){addSub(t.id,e.target.value);e.target.value="";}}} style={{...sty.i,width:"100%",padding:"4px 8px",fontSize:11,marginTop:4}}/>
          </div>
          <div style={{marginBottom:8}}>
            <div style={{fontSize:10,color:th.tm,fontWeight:600,marginBottom:4}}>Conversații</div>
            {(t.chats||[]).map(c=><div key={c.id} style={{padding:"8px 10px",background:th.c,borderRadius:6,marginBottom:4,fontSize:11,borderLeft:`3px solid ${th.b}`}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <span style={{fontSize:9,color:th.tm}}>{c.author} · {new Date(c.date).toLocaleString("ro")}</span>
                <button onClick={()=>setReplyingTo({tid:t.id,chatId:c.id})} style={{padding:"2px 6px",border:"none",background:"transparent",color:th.tm,cursor:"pointer",fontSize:10}}>Răspunde</button>
              </div>
              <div style={{marginTop:2}}>{c.text}</div>
              {(c.replies||[]).map(r=><div key={r.id} style={{marginTop:6,marginLeft:12,padding:"6px 8px",background:th.h,borderRadius:4,borderLeft:`2px solid ${th.b}`}}><span style={{fontSize:9,color:th.tm}}>↳ {r.author} · {new Date(r.date).toLocaleString("ro")}</span><div style={{marginTop:2,fontSize:11}}>{r.text}</div></div>)}
              {isReplying&&replyingTo.chatId===c.id&&<div style={{marginTop:6,marginLeft:12}}><input placeholder="Răspunde... (Enter)" autoFocus onKeyDown={e=>{if(e.key==="Enter"){addReply(t.id,c.id,e.target.value);e.target.value="";}if(e.key==="Escape")setReplyingTo(null);}} style={{...sty.i,width:"100%",padding:"6px 8px",fontSize:11}}/><button onClick={()=>setReplyingTo(null)} style={{fontSize:10,marginTop:4,color:th.tm,cursor:"pointer",background:"transparent",border:"none"}}>Anulează</button></div>}
            </div>)}
            <input placeholder="+ Mesaj (Enter)" onKeyDown={e=>{if(e.key==="Enter"){addChat(t.id,e.target.value);e.target.value="";}}} style={{...sty.i,width:"100%",padding:"4px 8px",fontSize:11,marginTop:4}}/>
          </div>
          <div style={{marginBottom:6}}>
            <div style={{fontSize:10,color:th.tm,fontWeight:600,marginBottom:4}}>Upload / Link</div>
            <input placeholder="Link sau nume fișier (Enter)" onKeyDown={e=>{if(e.key==="Enter"){const v=e.target.value.trim();if(v){updTask(t.id,{uploads:[...(t.uploads||[]),{id:uid(),name:v,url:v}]});e.target.value="";}}}} style={{...sty.i,width:"100%",padding:"4px 8px",fontSize:11}}/>
            {(t.uploads||[]).map(u=>u&&<div key={u.id} style={{fontSize:10,padding:"4px 8px",marginTop:4,background:th.h,borderRadius:4}}>📎 {u.name}</div>)}
          </div>
          <div>
            <div style={{fontSize:10,color:th.tm,fontWeight:600,marginBottom:4}}>Note</div>
            <textarea value={t.notes||""} onChange={e=>updTask(t.id,{notes:e.target.value})} placeholder="Note..." style={{...sty.i,minHeight:50,fontSize:11,resize:"vertical",width:"100%"}}/>
          </div>
        </div>}
      </div>
    );
  };

  return (
    <div>
      {compact && <div style={{fontSize:13,fontWeight:700,marginBottom:10,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
        <span>📋 Tasks</span><span style={{fontSize:11,color:th.tm,fontWeight:400}}>{active.length} active</span>
      </div>}

      {!compact&&<div style={{display:"flex",gap:4,padding:5,background:th.bg==="#09090b"?th.h:"#f8f7f5",borderRadius:10,border:`1px solid ${th.bl}`,marginBottom:16}}>
        <button onClick={()=>setViewMode("list")} style={{padding:"8px 16px",borderRadius:8,border:"none",fontSize:13,fontWeight:viewMode==="list"?600:500,cursor:"pointer",background:viewMode==="list"?th.c:"transparent",color:viewMode==="list"?th.t:th.tm,boxShadow:viewMode==="list"?"0 1px 3px rgba(0,0,0,.06)":"none",transition:"all .15s"}}>Listă</button>
        <button onClick={()=>setViewMode("kanban")} style={{padding:"8px 16px",borderRadius:8,border:"none",fontSize:13,fontWeight:viewMode==="kanban"?600:500,cursor:"pointer",background:viewMode==="kanban"?th.c:"transparent",color:viewMode==="kanban"?th.t:th.tm,boxShadow:viewMode==="kanban"?"0 1px 3px rgba(0,0,0,.06)":"none",transition:"all .15s"}}>Kanban</button>
        <button onClick={()=>setViewMode("calendar")} style={{padding:"8px 16px",borderRadius:8,border:"none",fontSize:13,fontWeight:viewMode==="calendar"?600:500,cursor:"pointer",background:viewMode==="calendar"?th.c:"transparent",color:viewMode==="calendar"?th.t:th.tm,boxShadow:viewMode==="calendar"?"0 1px 3px rgba(0,0,0,.06)":"none",transition:"all .15s"}}>Calendar</button>
      </div>}

      <div style={{display:"flex",gap:10,marginBottom:20}}>
        <input value={newText} onChange={e=>setNewText(e.target.value)} onKeyDown={e=>e.key==="Enter"&&add()}
          style={{...sty.i,flex:1,padding:"14px 18px",fontSize:15,borderRadius:10,border:`1px solid ${th.bl}`}} placeholder="Adaugă task... (Enter)"/>
        {!compact && <select value={newPrio} onChange={e=>setNewPrio(e.target.value)} className="modernSel" style={{...sty.i,width:130,padding:"14px 32px 14px 16px",fontSize:13,borderRadius:10,border:`1px solid ${th.bl}`}}>
          <option value="high">Urgent</option><option value="medium">Normal</option><option value="low">Low</option>
        </select>}
        <button onClick={add} style={{...sty.b,padding:"14px 20px",flexShrink:0,borderRadius:10,fontWeight:600}}><IcPlus s={16}/></button>
      </div>

      <div style={{display:"flex",flexDirection:"column",gap:0}}>
        {active.length===0 && <div style={{padding:40,textAlign:"center",color:th.tm,fontSize:15,background:th.bg==="#09090b"?th.h:"#faf9f7",borderRadius:12,border:`1px dashed ${th.bl}`}}>Niciun task activ — adaugă unul mai sus 🎉</div>}
        {viewMode==="kanban"&&!compact ? (
          <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"repeat(3,1fr)",gap:16,minHeight:400}}>
            {(["in_proces","in_lucru","done"]).map(col=>{
              const colTasks = col==="done" ? done : active.filter(t=>taskStatus(t)===col);
              return <div key={col} onDragOver={e=>{e.preventDefault();setKanbanDragCol(col);}} onDragLeave={()=>setKanbanDragCol(null)} onDrop={e=>{e.preventDefault();setKanbanDragCol(null);const id=e.dataTransfer.getData("taskId");if(id){updTask(id,{taskStatus:col,done:col==="done"});}}}
                style={{background:th.bg==="#09090b"?th.h:"#faf9f7",borderRadius:14,padding:18,border:`2px dashed ${kanbanDragCol===col?TSC[col]:th.bl}`,minHeight:220,transition:"all .2s"}}>
                <div style={{fontSize:12,fontWeight:700,color:TSC[col],marginBottom:12,display:"flex",alignItems:"center",gap:8}}><span style={{width:10,height:10,borderRadius:"50%",background:TSC[col]}}/> {TSL[col]} ({colTasks.length})</div>
                <div style={{display:"flex",flexDirection:"column",gap:10}}>
                  {colTasks.map(t=>(
                    <div key={t.id} draggable onDragStart={e=>e.dataTransfer.setData("taskId",t.id)} onClick={()=>toggleExpanded(t.id)}
                      style={{background:th.c,borderRadius:12,padding:16,cursor:"grab",border:`1px solid ${th.bl}`,boxShadow:"0 1px 4px rgba(0,0,0,.05)",transition:"all .15s"}}
                      onMouseOver={e=>{e.currentTarget.style.transform="translateY(-1px)";e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,.08)";}}
                      onMouseOut={e=>{e.currentTarget.style.transform="translateY(0)";e.currentTarget.style.boxShadow="0 1px 4px rgba(0,0,0,.05)";}}>
                      <div style={{display:"flex",alignItems:"flex-start",gap:10}}>
                        <div onClick={e=>{e.stopPropagation();toggle(t.id);}} style={{width:20,height:20,borderRadius:5,border:`2px solid ${TSC[taskStatus(t)]}`,cursor:"pointer",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",background:taskStatus(t)==="done"?th.b:"transparent",marginTop:2}}>{taskStatus(t)==="done"&&<IcCheck s={12}/>}</div>
                        <div style={{flex:1,minWidth:0}}>
                          <div style={{fontSize:14,fontWeight:600,textDecoration:taskStatus(t)==="done"?"line-through":undefined,color:taskStatus(t)==="done"?th.tm:th.t,lineHeight:1.3}}>{t.text}</div>
                          <div style={{display:"flex",alignItems:"center",gap:6,marginTop:6,flexWrap:"wrap"}}>
                            <select value={t.priority||"medium"} onChange={e=>{e.stopPropagation();updTask(t.id,{priority:e.target.value});}} onClick={e=>e.stopPropagation()} className="modernSel" style={{...sty.i,padding:"4px 24px 4px 8px",fontSize:10,borderRadius:6,border:`1px solid ${th.b}`}}>
                              <option value="high">Urgent</option><option value="medium">Normal</option><option value="low">Low</option>
                            </select>
                            {t.due&&<span style={{fontSize:10,color:th.tm}}><IcClock s={10}/> {fD(t.due)}</span>}
                            {(t.subtasks||[]).length>0&&<span style={{fontSize:10,color:th.tm}}>{(t.subtasks||[]).filter(s=>s.done).length}/{(t.subtasks||[]).length}</span>}
                          </div>
                        </div>
                        <button onClick={e=>{e.stopPropagation();del(t.id);}} style={{padding:4,border:"none",background:"transparent",color:th.tm,cursor:"pointer",opacity:.6}}><IcTrash s={14}/></button>
                      </div>
                      {expandedIds.has(t.id)&&<div style={{marginTop:12,paddingTop:12,borderTop:`1px solid ${th.b}`}}>
                        <div style={{fontSize:11,color:th.tm,fontWeight:600,marginBottom:6}}>Subtasks</div>
                        {(t.subtasks||[]).map(s=><TaskCard key={s.id} t={{...s,subtasks:s.subtasks||[],tags:s.tags||[],chats:s.chats||[],uploads:s.uploads||[]}} isDone={s.done} depth={1}/>)}
                        <input placeholder="+ Subtask (Enter)" onKeyDown={e=>{if(e.key==="Enter"){addSub(t.id,e.target.value);e.target.value="";}}} style={{...sty.i,padding:"8px 10px",fontSize:12,marginTop:6,borderRadius:8}}/>
                      </div>}
                    </div>
                  ))}
                </div>
              </div>;
            })}
          </div>
        ) : viewMode==="calendar"&&!compact ? (
          <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:6}}>
            {["Lu","Ma","Mi","Jo","Vi","Sâ","Du"].map(d=><div key={d} style={{fontSize:11,color:th.tm,textAlign:"center",fontWeight:600,padding:"8px 0"}}>{d}</div>)}
            {Array.from({length:35}).map((_,i)=>{
              const d=new Date(); d.setDate(d.getDate()-d.getDay()+1+i);
              const ds=d.toISOString().split("T")[0];
              const dayTasks=active.filter(t=>t.due===ds);
              return <div key={i} style={{minHeight:80,padding:8,borderRadius:8,border:`1px solid ${th.bl}`,background:dayTasks.length>0?th.ab:"transparent"}}>
                <div style={{fontSize:12,color:th.tm,marginBottom:4,fontWeight:600}}>{d.getDate()}</div>
                {dayTasks.map(t=><div key={t.id} onClick={()=>toggleExpanded(t.id)} style={{fontSize:10,padding:"4px 6px",borderRadius:6,background:PC[t.priority||"medium"]+"33",marginBottom:4,cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",borderLeft:`3px solid ${PC[t.priority||"medium"]}`}}>{t.text}</div>)}
              </div>;
            })}
          </div>
        ) : (
          active.map(t=><TaskCard key={t.id} t={t} isDone={false}/>)
        )}
      </div>

      {done.length>0 && <>
        <div style={{fontSize:11,color:th.tm,fontWeight:600,textTransform:"uppercase",letterSpacing:1.2,marginTop:24,marginBottom:10}}>Finalizate ({done.length})</div>
        {(compact?done.slice(0,2):done).map(t=><TaskCard key={t.id} t={t} isDone={true}/>)}
      </>}
    </div>
  );
}

// ─── OFFERS BOARD ───
function OffersBoard({ evs, th, sty, mob, onSelect, onAddOffer, onStatusChange }) {
  const [sortBy, setSortBy] = useState("date");
  const [filterSt, setFilterSt] = useState("");
  const [filterCat, setFilterCat] = useState("");
  const [viewMode, setViewMode] = useState("list"); // list | grid | kanban
  const [dragOverCol, setDragOverCol] = useState(null);
  let base = evs.filter(e=>{
    if(filterSt) { if(e.st!==filterSt) return false; }
    else { if(!["oferta","asteptare","plata_avans","confirmat"].includes(e.st)) return false; }
    if(filterCat&&e.cat!==filterCat) return false;
    return true;
  });
  const active = [...base].sort((a,b)=>{
    if(sortBy==="date") return new Date(a.date||0)-new Date(b.date||0);
    if(sortBy==="dateDesc") return new Date(b.date||0)-new Date(a.date||0);
    if(sortBy==="fee") return (b.fee||0)-(a.fee||0);
    if(sortBy==="feeAsc") return (a.fee||0)-(b.fee||0);
    if(sortBy==="client") return (a.cn||"").localeCompare(b.cn||"");
    if(sortBy==="status") return (a.st||"").localeCompare(b.st||"");
    return 0;
  });
  return (
    <div style={{animation:"su .3s ease"}}>
      <div style={{marginBottom:20,display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12}}>
        <div>
          <h1 style={{fontSize:22,fontWeight:700,letterSpacing:"-0.5px"}}>Oferte</h1>
          <p style={{color:th.tm,fontSize:12,marginTop:2}}>{active.length} oferte</p>
        </div>
        <div style={{display:"flex",gap:6,alignItems:"center"}}>
          <div style={{display:"flex",gap:2,padding:4,background:th.h,borderRadius:8,border:`1px solid ${th.b}`}}>
            <button onClick={()=>setViewMode("list")} style={{padding:"6px 12px",borderRadius:6,border:"none",fontSize:11,fontWeight:600,cursor:"pointer",background:viewMode==="list"?th.ab:"transparent",color:viewMode==="list"?th.t:th.tm}}>Listă</button>
            <button onClick={()=>setViewMode("grid")} style={{padding:"6px 12px",borderRadius:6,border:"none",fontSize:11,fontWeight:600,cursor:"pointer",background:viewMode==="grid"?th.ab:"transparent",color:viewMode==="grid"?th.t:th.tm}}>Grid</button>
            <button onClick={()=>setViewMode("kanban")} style={{padding:"6px 12px",borderRadius:6,border:"none",fontSize:11,fontWeight:600,cursor:"pointer",background:viewMode==="kanban"?th.ab:"transparent",color:viewMode==="kanban"?th.t:th.tm}}>Kanban</button>
          </div>
          {onAddOffer&&<button onClick={onAddOffer} style={sty.b}><IcPlus s={14}/> Ofertă nouă</button>}
        </div>
      </div>
      <div style={{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap",alignItems:"center"}}>
        <select value={filterSt} onChange={e=>setFilterSt(e.target.value)} className="modernSel" style={{padding:"8px 32px 8px 12px",minWidth:160,borderRadius:8,border:`1px solid ${th.b}`,background:th.i,color:th.t,fontSize:13,cursor:"pointer"}}>
          <option value="">Oferte active (ofertă + așt. + confirmate)</option>
          {Object.entries(ST).map(([k,v])=><option key={k} value={k}>{v.l}</option>)}
        </select>
        <select value={filterCat} onChange={e=>setFilterCat(e.target.value)} className="modernSel" style={{padding:"8px 32px 8px 12px",minWidth:100,borderRadius:8,border:`1px solid ${th.b}`,background:th.i,color:th.t,fontSize:13,cursor:"pointer"}}>
          <option value="">Toate</option>
          <option value="private">Privat</option>
          <option value="public">Public</option>
        </select>
        <select value={sortBy} onChange={e=>setSortBy(e.target.value)} className="modernSel" style={{padding:"8px 32px 8px 12px",minWidth:140,borderRadius:8,border:`1px solid ${th.b}`,background:th.i,color:th.t,fontSize:13,cursor:"pointer"}}>
          <option value="date">Sort: Data ↑</option>
          <option value="dateDesc">Sort: Data ↓</option>
          <option value="fee">Sort: Onorariu ↓</option>
          <option value="feeAsc">Sort: Onorariu ↑</option>
          <option value="client">Sort: Client</option>
          <option value="status">Sort: Status</option>
        </select>
      </div>
      {viewMode==="kanban" ? (
        <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"repeat(4,1fr)",gap:12,minHeight:400}}>
          {["oferta","asteptare","plata_avans","confirmat","respins"].map(col=>{
            const colEvs = evs.filter(e=>e.st===col&&(!filterCat||e.cat===filterCat));
            return <div key={col} onDragOver={e=>{e.preventDefault();setDragOverCol(col);}} onDragLeave={()=>setDragOverCol(null)} onDrop={e=>{e.preventDefault();setDragOverCol(null);const id=e.dataTransfer.getData("evId");if(id&&onStatusChange){const ev=evs.find(x=>x.id===id);if(ev)onStatusChange(ev.id,col);}}}
              style={{background:th.h,borderRadius:12,padding:12,border:`2px dashed ${dragOverCol===col?ST[col]?.c:th.b}`,minHeight:200,transition:"border-color .2s"}}>
              <div style={{fontSize:11,fontWeight:700,color:ST[col]?.c,marginBottom:10,display:"flex",alignItems:"center",gap:6}}><span style={{width:8,height:8,borderRadius:"50%",background:ST[col]?.c}}/> {ST[col]?.l||col} ({colEvs.length})</div>
              <div style={{display:"flex",flexDirection:"column",gap:8}}>
                {colEvs.map(ev=>{
                  const d=dU(ev.date); const urgent=d<=14;
                  return <div key={ev.id} draggable onDragStart={e=>e.dataTransfer.setData("evId",ev.id)} onClick={()=>onSelect(ev)}
                    style={{background:th.c,borderRadius:8,padding:12,cursor:"grab",border:`1px solid ${th.b}`,boxShadow:"0 1px 3px rgba(0,0,0,.1)",transition:"transform .15s"}}
                    onMouseOver={e=>{e.currentTarget.style.transform="translateY(-1px)";e.currentTarget.style.cursor="grab";}}
                    onMouseOut={e=>{e.currentTarget.style.transform="translateY(0)";}}>
                    <div style={{fontSize:10,color:th.tm,marginBottom:2}}>{ev.type} {ev.cat==="private"?"· ZGV":"· PHASER"}</div>
                    <div style={{fontSize:13,fontWeight:700,marginBottom:4}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div>
                    <div style={{fontSize:10,color:th.tm}}>{fD(ev.date)} · {f$(ev.fee)}</div>
                  </div>;
                })}
              </div>
            </div>;
          })}
        </div>
      ) : viewMode==="list" ? (
        <>
      {active.length===0 && <div style={{...sty.cd,padding:40,textAlign:"center",color:th.tm}}><div style={{fontSize:32,marginBottom:8}}>📭</div><div style={{fontSize:13}}>Nicio ofertă</div></div>}
      <div style={{...sty.cd,padding:0,overflow:"hidden"}}>
        <table style={{width:"100%",borderCollapse:"collapse"}}>
          <thead><tr style={{borderBottom:`2px solid ${th.b}`}}>
            {["Nr","Ofertă","Tip","Locație","Data","Onorariu","Status"].map(h=><th key={h} style={{padding:"10px 12px",textAlign:"left",fontSize:10,color:th.tm,textTransform:"uppercase",letterSpacing:1,fontWeight:600}}>{h}</th>)}
          </tr></thead>
          <tbody>{active.map((ev,i)=>(
            <tr key={ev.id} onClick={()=>onSelect(ev)} style={{borderBottom:`1px solid ${th.bl}`,cursor:"pointer"}} onMouseOver={e=>e.currentTarget.style.background=th.ab} onMouseOut={e=>e.currentTarget.style.background="transparent"}>
              <td style={{padding:"10px 12px",fontSize:11,color:th.tm}}>{(ev.offerNr?"O"+ev.offerNr:"—")}</td>
              <td style={{padding:"10px 12px",fontSize:13,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</td>
              <td style={{padding:"10px 12px",fontSize:11}}>{ev.type} · {ev.cat==="private"?"Privat":"Public"}</td>
              <td style={{padding:"10px 12px",fontSize:11,color:th.tm}}>{ev.venue}{ev.city?", "+ev.city:""}</td>
              <td style={{padding:"10px 12px",fontSize:11}}>{fD(ev.date)}</td>
              <td style={{padding:"10px 12px",fontSize:13,fontWeight:700}}>{f$(ev.fee)}</td>
              <td style={{padding:"10px 12px"}} onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={onStatusChange}/></td>
            </tr>
          ))}</tbody>
        </table>
      </div>
        </>
      ) : (
        <>
      {active.length===0 && <div style={{...sty.cd,padding:40,textAlign:"center",color:th.tm}}><div style={{fontSize:32,marginBottom:8}}>📭</div><div style={{fontSize:13}}>Nicio ofertă</div></div>}
      <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"repeat(auto-fill,minmax(280px,1fr))",gap:10}}>
        {active.map(ev=>{
          const d=dU(ev.date); const urgent=d<=14;
          return <div key={ev.id} onClick={()=>onSelect(ev)}
            style={{...sty.cd,cursor:"pointer",borderColor:urgent?ST[ev.st].c:th.b,padding:16,transition:"all .15s"}}
            onMouseOver={e=>e.currentTarget.style.transform="translateY(-2px)"}
            onMouseOut={e=>e.currentTarget.style.transform="translateY(0)"}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8}}>
              <div>
                <span style={{fontSize:10,fontWeight:600,color:th.tm,textTransform:"uppercase",display:"block",marginBottom:2}}>{ev.cat==="private"?"Privat":"Public"} · {ev.type}</span>
                <span style={{fontSize:14,fontWeight:700}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</span>
              </div>
              <div onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={onStatusChange}/></div>
            </div>
            <div style={{fontSize:11,color:th.tm,marginBottom:2}}>{ev.venue}{ev.city?", "+ev.city:""}</div>
            <div style={{fontSize:11,color:th.tm,marginBottom:10}}>{fD(ev.date)}</div>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
              <span style={{fontSize:17,fontWeight:800}}>{f$(ev.fee)}</span>
              <span style={{fontSize:10,color:urgent?"#ef4444":th.tm,fontWeight:urgent?700:400}}>{d>0?`în ${d} zile`:d===0?"Azi!":"Trecut"}</span>
            </div>
          </div>;
        })}
      </div>
        </>
      )}
    </div>
  );
}

// ─── CONTRACT ───
function ContractView({ ev, th, contractFields, onContractChange }) {
  const isP = ev.cat==="private";
  const svcTot = isP ? Object.entries(ev.svcp||{}).reduce((s,[k,v])=>s+(ev.svc?.[k]?v:0),0) : 0;
  const tot = (ev.fee||0)+svcTot;
  const avans = ev.dep||0;
  const rest = tot - avans;
  const cf = contractFields||{};
  const setF = (k,v) => onContractChange && onContractChange({...cf,[k]:v});
  const today = new Date().toLocaleDateString("ro",{day:"numeric",month:"long",year:"numeric"});
  const nrSeturi = cf.nrSeturi || (ev.rep||1);
  const durataSeturi = cf.durataSeturi || 45;
  const zileRest = cf.zileRest ?? 5;
  
  // Inline editable input styled like contract blanks
  const iS = {border:"none",borderBottom:"1.5px solid #999",borderRadius:0,padding:"1px 4px",fontSize:13,fontFamily:"Georgia,serif",background:"rgba(255,249,196,.6)",outline:"none",color:"#111",minWidth:40,textAlign:"center"};
  const Fi = ({k,placeholder,w=100,type="text",align="center"})=>(
    <input type={type} value={cf[k]||""} onChange={e=>setF(k,e.target.value)} placeholder={placeholder||"___"} style={{...iS,width:w,textAlign:align}}/>
  );

  return (
    <div style={{background:"#fff",color:"#111",padding:"32px 40px",fontFamily:"Georgia,serif",fontSize:13,lineHeight:1.85,maxWidth:720,margin:"0 auto"}}>
      {/* Header */}
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24,paddingBottom:12,borderBottom:"1px solid #ccc"}}>
        <div style={{background:"#111",borderRadius:8,padding:"10px 24px"}}><Logo height={36}/></div>
        <div style={{textAlign:"right",fontSize:11,color:"#666"}}>
          <div>T: 0744 771 488</div>
          <div style={{color:"#333",textDecoration:"underline"}}>contact@phaser.ro</div>
          <div style={{color:"#333",textDecoration:"underline"}}>www.phaser.ro</div>
        </div>
      </div>

      {/* Titlu */}
      <div style={{textAlign:"center",marginBottom:28}}>
        <div style={{fontSize:17,fontWeight:700,textTransform:"uppercase",letterSpacing:2,marginBottom:4}}>CONTRACT DE PRESTĂRI SERVICII</div>
        <div style={{fontSize:13,color:"#555"}}>
          NR. <Fi k="nr" w={50} placeholder="____"/> / <Fi k="dataSemnare" w={120} placeholder={today} type="text"/>
        </div>
      </div>

      {/* CAP 1 */}
      <div style={{marginBottom:20}}>
        <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:10}}>CAP. 1. PĂRȚILE CONTRACTANTE</div>
        <p style={{marginBottom:8,fontStyle:"italic"}}>Art.1.1 Prestatorul</p>
        <p><strong>Societatea comercială:</strong> PHASER MUSIC SRL</p>
        <p><strong>Sediul:</strong> Timișoara, Str. Răsăritului 17, Bl. 24, Sc. A, Et. 4, Ap. 9</p>
        <p><strong>Oficiul Național al Registrului Comerțului:</strong> Nr: J35/750/14.03.2017</p>
        <p><strong>Cod unic de înregistrare:</strong> 37199434</p>
        <p><strong>Contul bancar numărul:</strong> RO79INGB00009999906674059</p>
        <p><strong>Banca:</strong> ING Bank N.V.</p>
        <p><strong>Adresă mail:</strong> contact@phaser.ro &nbsp;|&nbsp; <strong>Telefon:</strong> 0744 771 488</p>
        <p style={{marginTop:6}}>reprezentată legal de <strong>RACZ ANDREI RADU</strong>, în calitate de asociat, denumită în continuare în prezentul contract <strong>Prestator</strong>.</p>

        <p style={{margin:"14px 0 8px",fontStyle:"italic"}}>Art.1.2 Beneficiarul</p>
        <p><strong>Persoană fizică:</strong> <Fi k="clientNume" w={200} placeholder={ev.cn||"Numele beneficiarului"} align="left"/></p>
        <p style={{marginTop:4}}>cu următoarele date de identificare:</p>
        <p><strong>Locul de domiciliu:</strong> Jud. <Fi k="jud" w={100} placeholder="Județ"/> , Mun./Or. <Fi k="mun" w={120} placeholder="Municipiu"/> , Str. <Fi k="str" w={150} placeholder="Strada" align="left"/> , nr. <Fi k="nr2" w={50} placeholder="nr"/> , ap. <Fi k="ap" w={50} placeholder="ap"/></p>
        <p><strong>Cartea de identitate:</strong> seria <Fi k="ciSeria" w={50} placeholder="XX"/> , nr. <Fi k="ciNr" w={80} placeholder="000000"/> , CNP: <Fi k="cnp" w={140} placeholder="0000000000000"/></p>
        <p><strong>Adresă mail:</strong> <Fi k="clientEmail" w={200} placeholder={ev.ce||"email@..."} align="left"/></p>
        <p><strong>Telefon:</strong> <Fi k="clientTel" w={150} placeholder={ev.cp||"+40..."} align="left"/></p>
        <p style={{marginTop:6}}>în calitate de BENEFICIAR, denumit în continuare în prezentul contract <strong>Beneficiar</strong>.</p>
      </div>

      {/* CAP 2 */}
      <div style={{marginBottom:20}}>
        <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:10}}>CAP. 2. OBIECTUL CONTRACTULUI</div>
        <p style={{marginBottom:6,fontStyle:"italic"}}>Art.2.1 Obiectul prezentului contract constă în îndeplinirea activității de interpretare artistică de către Prestator prin actul artistic „PHASER" în cadrul unui eveniment {isP?"privat":"public"} organizat de Beneficiar.</p>
        <p style={{marginBottom:6,fontStyle:"italic"}}>
          Art.2.2 Evenimentul care face obiectul prezentului contract se desfășoară în data de{" "}
          <Fi k="dataEv" w={120} placeholder={ev.date||"____-__-__"}/>, în locația <Fi k="locatie" w={160} placeholder={ev.venue||"locația"} align="left"/> cu adresa: <Fi k="adresaEv" w={180} placeholder={ev.city||"adresa"} align="left"/>.
        </p>
        <p style={{fontStyle:"italic"}}>
          Art.2.3 Durata recitalului artistic este de aproximativ{" "}
          <Fi k="durataTotal" w={60} placeholder={String(nrSeturi*durataSeturi)}/> minute, împărțit în{" "}
          <Fi k="nrSeturiInput" w={40} placeholder={String(nrSeturi)}/> seturi de aproximativ{" "}
          <Fi k="durataSeturiInput" w={50} placeholder={String(durataSeturi)}/> minute. Intervalul orar în care va avea loc prestația nu va fi mai mare de 5 ore și nu se va desfășura mai târziu de ora 02:00.
        </p>
      </div>

      {/* CAP 3 */}
      <div style={{marginBottom:20}}>
        <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:10}}>CAP. 3. DURATA CONTRACTULUI</div>
        <p style={{fontStyle:"italic"}}>Art.3.1 Prezentul contract este valabil începând cu data semnării lui și încetează la data la care toate obligațiile ce decurg în prezentul contract vor fi onorate.</p>
      </div>

      {/* CAP 4 */}
      <div style={{marginBottom:20}}>
        <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:10}}>CAP. 4. VALOAREA CONTRACTULUI, MODALITĂȚI DE PLATĂ</div>
        <p style={{fontStyle:"italic",marginBottom:6}}>Art.4.1 Valoarea prezentului contract este de <strong><Fi k="valoare" w={80} placeholder={String(tot)}/> Euro</strong>.</p>
        <p style={{fontStyle:"italic",marginBottom:6}}>Art.4.2 Suma prevăzută la art.4.1 va fi plătită în contul Prestatorului în RON, la cursul BNR valabil la data facturării, prin virament bancar astfel:</p>
        <div style={{paddingLeft:24,marginBottom:6}}>
          <p>a) <strong><Fi k="avansContract" w={80} placeholder={String(avans)}/> Euro</strong> în termen de 10 zile de la semnarea contractului.</p>
          <p>b) <strong><Fi k="restContract" w={80} placeholder={String(rest)}/> Euro</strong> în termen de <Fi k="zileRest" w={40} placeholder="5"/> zile de la data încheierii evenimentului.</p>
        </div>
        <p style={{fontStyle:"italic",marginBottom:4}}>Art.4.3 Plata de către Beneficiar a facturii emise de Prestator este condiționată de emiterea facturii într-una din cele 2 variante:</p>
        <div style={{paddingLeft:24,marginBottom:6}}>
          <p>a) în format electronic la adresa mail menționată în art. 1.2.</p>
          <p>b) în format fizic, factura în original cu semnătura și ștampila.</p>
        </div>
        <p style={{fontStyle:"italic"}}>Art.4.4 Eventualele întârzieri de plată din partea Beneficiarului vor atrage după sine o penalizare de 1% pentru fiecare zi de întârziere, fără a fi necesară o notificare din partea Prestatorului și fără a fi necesară îndeplinirea vreunei proceduri prealabile, penalitățile devenind scadente de drept din prima zi de întârziere.</p>
      </div>

      {/* CAP 5 */}
      <div style={{marginBottom:20}}>
        <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:10}}>CAP. 5. DREPTURILE ȘI OBLIGAȚIILE PĂRȚILOR</div>
        <p style={{fontStyle:"italic",marginBottom:4}}>Art.5.1 Drepturile și obligațiile Prestatorului:</p>
        <div style={{paddingLeft:24,marginBottom:8}}>
          <p>a) se obligă să respecte obiectul contractului de la Cap.1.</p>
          <p>b) se obligă să respecte necesarul tehnic din anexa 1 a contractului.</p>
          <p>c) se obligă să păstreze confidențialitatea acestui contract.</p>
          <p>d) Prestatorul are dreptul exclusiv de a alege repertoriul artistic ce va fi interpretat în cadrul evenimentului.</p>
          <p>e) Prestatorul are dreptul să întrerupă în orice moment recitalul artistic, dacă îi este perturbată interpretarea artistică de către oricare participant la eveniment. Prestatorul va notifica Beneficiarul în cel mai scurt timp posibil pentru remedierea situației.</p>
        </div>
        <p style={{fontStyle:"italic",marginBottom:4}}>Art.5.2 Drepturile și obligațiile Beneficiarului:</p>
        <div style={{paddingLeft:24}}>
          <p>a) se obligă să păstreze confidențialitatea acestui contract.</p>
          <p>b) se obligă să respecte termenele de plată menționate la art. 4.2.</p>
          <p>c) se obligă să respecte necesarul tehnic și de ospitalitate din anexa 1 a contractului.</p>
          <p>d) se obligă să organizeze evenimentul în condiții de legalitate, siguranță, protecție și securitate, la data, locația și ora menționată în art.1.2.</p>
          <p>e) se obligă să se consulte cu Prestatorul în vederea disponibilității locației pentru efectuarea probelor de sunet necesare bunei desfășurări a serviciilor susținute de Prestator (indicat ~6 ore înainte de eveniment).</p>
          <p>f) se obligă să se consulte cu Prestatorul cu cel puțin 14 zile înainte de eveniment în vederea stabilirii programului pe ore, urmând a fi stabilită ora exactă de începere a fiecărui set de interpretare artistică și să trimită pe adresa de mail a Prestatorului programul pe ore cu cel puțin 7 zile înainte.</p>
          <p>g) să asigure spațiul necesar, acoperit, asigurat în cazul vremii nefavorabile, cu suprafața de minim 6×4 metri.</p>
          <p>h) Beneficiarul va acționa cu diligență în asigurarea bunei desfășurări a evenimentului și soluționarea eventualelor diferențe dintre participanți la eveniment.</p>
          <p>i) În situația în care echipamentul Prestatorului va suferi daune în cadrul evenimentului din vina exclusivă a Beneficiarului sau a participanților, Beneficiarul va intermedia recuperarea/înlocuirea echipamentului deteriorat.</p>
        </div>
      </div>

      {/* CAP 6-12 — condensate */}
      {[
        { nr:6, titlu:"ALTE MENȚIUNI", text:"Înregistrarea audio sau video a recitalului artistic de către furnizorii foto/video ai Beneficiarului nu va fi folosită în scop public, comercial sau politic. Prestatorul înțelege că Beneficiarul nu poate controla acțiunile participanților la eveniment și este de acord cu situațiile în care invitații ar putea publica în scop personal imagini/înregistrări ale Prestatorului în spațiu media." },
        { nr:7, titlu:"NOTIFICĂRI, COMUNICARE", text:"Orice adresă, notificare făcută de una dintre părți celeilalte va fi valabil îndeplinită doar dacă va fi transmisă prin e-mail, whatsapp sau mesaj text la adresele specificate în Capitolul 1. Notificările verbale nu se iau în considerare dacă nu au fost confirmate prin modalitatea indicată la art.7.1." },
        { nr:8, titlu:"CLAUZE SPECIALE", text:"Prestatorul își rezervă dreptul de a anula prestația artistică dacă Beneficiarul nu achită avansul în cel mult 30 de zile de la data scadentă. În cazul în care evenimentul se anulează din orice motiv care nu ține de voința Prestatorului, obligațiile de plată ale Beneficiarului rămân neschimbate, exceptând situațiile speciale: imposibilitatea medicală de participare a Beneficiarului respectiv a soției acestuia." },
        { nr:9, titlu:"FORȚĂ MAJORĂ", text:"Părțile semnatare ale prezentului contract sunt exonerate de răspundere în caz de forță majoră. Sunt considerate cazuri de forță majoră acele evenimente imprevizibile, insurmontabile care nu pot fi controlate de niciuna din părți (urgențe medicale, accidente, incendii, inundații, revolte, intervenții guvernamentale, conflicte militare și embargouri, calamități naturale)." },
        { nr:10, titlu:"RĂSPUNDERE CONTRACTUALĂ", text:"Rezilierea contractului poate fi cerută de oricare parte, atunci când cealaltă nu și-a îndeplinit parțial sau total obligațiile la care s-a angajat. Încetarea contractului nu are efect asupra obligațiilor deja scadente între părți la data încetării." },
        { nr:11, titlu:"CONFIDENȚIALITATE", text:"Părțile convin că toate prevederile prezentului contract, precum și toate negocierile anterioare purtate în vederea încheierii acestuia, sunt confidențiale și se angajează să nu le divulge, cu excepțiile legale. Încălcarea clauzei de confidențialitate dă dreptul celeilalte la solicitarea unei penalități în valoare de 10.000 RON." },
        { nr:12, titlu:"CLAUZE FINALE", text:"Eventualele divergențe între părți se vor soluționa pe cale amiabilă, în caz contrar, părțile se vor adresa instanțelor judecătorești competente. Prezentul contract a fost semnat în 2 (două) exemplare, câte unul pentru fiecare parte." }
      ].map(cap=>(
        <div key={cap.nr} style={{marginBottom:16}}>
          <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:8}}>CAP. {cap.nr}. {cap.titlu}</div>
          <p style={{fontStyle:"italic",color:"#333"}}>{cap.text}</p>
        </div>
      ))}

      {/* Data și semnături */}
      <div style={{marginTop:20,paddingTop:12,borderTop:"1px solid #ccc",marginBottom:28,textAlign:"center",fontStyle:"italic"}}>
        Prezentul contract a fost semnat în 2 (două) exemplare, câte unul pentru fiecare parte, la data de <Fi k="dataFinal" w={150} placeholder={today}/>.
      </div>

      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:48,marginTop:20}}>
        <div>
          <div style={{fontWeight:700,marginBottom:10}}>PRESTATOR</div>
          <div style={{fontSize:12,color:"#555"}}>PHASER MUSIC SRL</div>
          <div style={{fontSize:12,color:"#555",marginBottom:36}}>Racz Andrei Radu</div>
          <div style={{borderBottom:"1.5px solid #111",width:"80%",marginBottom:4}}/>
          <div style={{fontSize:11,color:"#888"}}>Semnătură și ștampilă</div>
        </div>
        <div>
          <div style={{fontWeight:700,marginBottom:10}}>BENEFICIAR</div>
          <div style={{fontSize:12,color:"#555"}}>{cf.clientNume||ev.cn||"_______________"}</div>
          <div style={{fontSize:12,color:"#555",marginBottom:36}}>{cf.clientTel||ev.cp||""}</div>
          <div style={{borderBottom:"1.5px solid #111",width:"80%",marginBottom:4}}/>
          <div style={{fontSize:11,color:"#888"}}>Semnătură</div>
        </div>
      </div>

      {/* Footer */}
      <div style={{marginTop:24,paddingTop:12,borderTop:"1px solid #eee",textAlign:"center",fontSize:10,color:"#aaa",letterSpacing:1}}>
        PHASER MUSIC SRL · CUI 37199434 · Timișoara, Str. Răsăritului 17 · contact@phaser.ro · www.phaser.ro
      </div>
    </div>
  );
}
// ─── OFFER PREVIEW ───
function OfferPreview({ ev, evStatus, onStatusChange, onOfferUpdate, th, mob, onClose, onEdit, sty, templates }) {
  const [copied, setCopied] = useState(false);
  const [mediaTitle, setMediaTitle] = useState(ev.mediaTitle||"PHASER Live");
  const [videos, setVideos] = useState(ev.videos||DEFAULT_VIDEOS);
  const syncOffer = (up)=>{ onOfferUpdate&&onOfferUpdate(ev.id,up); };
  const [covers, setCovers] = useState(ev.covers||DEFAULT_COVERS);
  const [showPlaylist, setShowPlaylist] = useState(true);
  const [configVisible, setConfigVisible] = useState(false);
  const [tab, setTab] = useState("oferta");
  const [localSt, setLocalSt] = useState(evStatus);
  const [playlistSearch, setPlaylistSearch] = useState("");
  const [contractFields, setContractFields] = useState({
    nr:"", dataSemnare:"", clientNume:ev.cn||"", clientEmail:ev.ce||"", clientTel:ev.cp||"",
    jud:"", mun:"", str:"", nr2:"", ap:"", ciSeria:"", ciNr:"", cnp:"",
    dataEv:ev.date||"", locatie:ev.venue||"", adresaEv:ev.city||"",
    durataTotal:String((ev.rep||1)*45), nrSeturiInput:String(ev.rep||1), durataSeturiInput:"45",
    valoare:String((ev.fee||0)+Object.entries(ev.svcp||{}).reduce((s,[k,v])=>s+(ev.svc?.[k]?v:0),0)),
    avansContract:String(ev.dep||0),
    restContract:String(((ev.fee||0)+Object.entries(ev.svcp||{}).reduce((s,[k,v])=>s+(ev.svc?.[k]?v:0),0))-(ev.dep||0)),
    zileRest:String(ev.zileRest??5),
    dataFinal:""
  });
  const isPriv = ev.cat==="private";
  const svcTot = isPriv ? Object.entries(ev.svcp||{}).reduce((s,[k,v])=>s+(ev.svc?.[k]?v:0),0) : 0;
  const tot = (ev.fee||0)+svcTot;
  const dk = th.bg==="#09090b";

  const handleStatus = (k) => {
    setLocalSt(k);
    onStatusChange(ev.id, k);
  };

  const copyOffer = async () => {
    const lines = ["PHASER MUSIC SRL","═══════════════════════════════","","OFERTĂ",""];
    if(ev.desc) lines.push(ev.desc,"");
    lines.push("Tip: "+(isPriv?"Privat":"Public"));
    lines.push("Locație: "+(ev.venue||"—")+(ev.city?", "+ev.city:""));
    lines.push("Data: "+fD(ev.date),"");
    const repStr = ev.repDurs&&ev.repDurs.length>0 ? ev.repDurs.map((d,i)=>`R${i+1}:${d}min`).join(" ") : `${ev.rep||1} reprize × ${ev.repDur||45} min`;
    lines.push("PHASER — "+repStr+" → "+f$(ev.fee),"");
    lines.push("TOTAL: "+f$(tot),"");
    lines.push("Avans "+f$(ev.dep||0)+" în 10 zile de la semnare");
    lines.push("Rest "+f$(tot-(ev.dep||0))+" în "+(ev.zileRest??5)+" zile de la eveniment — virament bancar");
    lines.push("Oferta valabilă 30 de zile.");
    try { await navigator.clipboard.writeText(lines.join("\n")); } catch(e) {
      const ta=document.createElement("textarea"); ta.value=lines.join("\n"); ta.style.cssText="position:fixed;opacity:0";
      document.body.appendChild(ta); ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
    }
    setCopied(true); setTimeout(()=>setCopied(false),2000);
  };

  const showRiderTab = !isPriv || ["Corporate","Private Party","Altele"].includes(ev.type);
  const baseTabs = isPriv
    ? (showRiderTab ? [{id:"oferta",l:"📄 Ofertă"},{id:"rider",l:"📋 Rider"}]
                    : [{id:"oferta",l:"📄 Ofertă"}])
    : [{id:"oferta",l:"📄 Ofertă"},{id:"rider",l:"📋 Rider"}];
  const allTabs = ["asteptare","plata_avans","confirmat"].includes(localSt)
    ? [...baseTabs,{id:"contract",l:"📝 Contract"}]
    : baseTabs;

  return (
    <div style={{position:"fixed",inset:0,background:"rgba(0,0,0,.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1200}} onClick={onClose}>
      <div style={{background:"#fff",borderRadius:mob?0:16,width:mob?"100%":720,maxHeight:mob?"100vh":"93vh",height:mob?"100vh":"auto",display:"flex",flexDirection:"column",color:"#111",boxShadow:"0 32px 80px rgba(0,0,0,.5)"}} onClick={e=>e.stopPropagation()}>
        
        {/* Header cu logo și status live — culori calde */}
        <div style={{padding:"14px 20px",borderBottom:"1px solid rgba(251,191,36,.2)",display:"flex",justifyContent:"space-between",alignItems:"center",background:"linear-gradient(135deg,#1a1510 0%,#2d2419 100%)",borderRadius:mob?"0":"16px 16px 0 0",flexShrink:0}}>
          <Logo height={42}/>
          <div style={{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}}>
            {/* STATUS LIVE — se schimbă imediat vizibil */}
            <div style={{display:"flex",gap:3,background:"rgba(255,255,255,.1)",borderRadius:8,padding:3}}>
              {Object.entries(ST).map(([k,v])=>(
                <button key={k} onClick={()=>handleStatus(k)} style={{
                  padding:"3px 8px",borderRadius:6,border:"none",fontSize:10,fontWeight:700,cursor:"pointer",
                  background:localSt===k?v.c:"transparent",
                  color:localSt===k?"#fff":v.c,
                  transition:"all .15s"
                }}>{v.l}</button>
              ))}
            </div>
            {onEdit&&<button onClick={()=>{onClose();setTimeout(()=>onEdit(ev),80);}} style={{padding:"6px 12px",borderRadius:6,border:"none",background:"rgba(255,255,255,.15)",color:"#fff",fontWeight:600,fontSize:11,cursor:"pointer",display:"flex",alignItems:"center",gap:4}}>✏️ Editează</button>}
            <button onClick={copyOffer} style={{padding:"6px 12px",borderRadius:6,border:"none",background:copied?"#22c55e":"rgba(255,255,255,.15)",color:"#fff",fontWeight:600,fontSize:11,cursor:"pointer"}}>{copied?"✓ Copiat!":"Copiază"}</button>
            <button onClick={()=>{
              // Open print dialog — browser saves as PDF
              const printWin = window.open("","_blank","width=800,height=900");
              const offerEl = document.getElementById("offer-print-content");
              if(offerEl && printWin) {
                printWin.document.write(`<!DOCTYPE html><html><head><meta charset="utf-8"><title>Oferta PHASER</title><style>*{box-sizing:border-box;margin:0;padding:0;font-family:'Helvetica Neue',Arial,sans-serif}body{background:#f4f4f4;padding:20px}@media print{body{padding:0;background:#fff}.no-print{display:none!important}}</style></head><body>${offerEl.innerHTML}</body></html>`);
                printWin.document.close();
                setTimeout(()=>printWin.print(), 500);
              }
            }} style={{padding:"6px 12px",borderRadius:6,border:"none",background:"rgba(255,255,255,.15)",color:"#fff",fontWeight:600,fontSize:11,cursor:"pointer",display:"flex",alignItems:"center",gap:4}}>
              <IcFile s={12}/> PDF
            </button>
            <button onClick={onClose} style={{padding:4,border:"none",background:"transparent",color:"rgba(255,255,255,.6)",cursor:"pointer"}}><IcX s={16}/></button>
          </div>
        </div>

        {/* Tabs */}
        <div style={{display:"flex",gap:1,padding:"8px 16px",borderBottom:"1px solid #e5e5e5",background:"#fafafa",flexShrink:0,overflowX:"auto"}}>
          {allTabs.map(t=><button key={t.id} onClick={()=>setTab(t.id)} style={{padding:"6px 14px",borderRadius:7,border:"none",fontSize:12,fontWeight:tab===t.id?700:400,cursor:"pointer",background:tab===t.id?"#111":"transparent",color:tab===t.id?"#fff":"#555",whiteSpace:"nowrap"}}>{t.l}</button>)}
        </div>

        {/* OFERTĂ */}
                {tab==="oferta"&&<div style={{flex:1,overflow:"auto",background:"#f4f4f4"}}>
          {/* Configurare — collapsibilă, ascunsă implicit după creare */}
          {isPriv&&<div style={{maxWidth:560,margin:"0 auto",padding:mob?"16px":"24px 16px",marginBottom:20}}>
            {!configVisible?<button onClick={()=>setConfigVisible(true)} style={{padding:"8px 14px",borderRadius:8,border:"1px dashed #ccc",background:"#fff",fontSize:11,color:"#888",cursor:"pointer",display:"flex",alignItems:"center",gap:6}}>+ Afișează configurare (media, playlist)</button>:<>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
              <div style={{fontSize:11,fontWeight:700,color:"#666",textTransform:"uppercase",letterSpacing:1}}>Configurare ofertă</div>
              <button onClick={()=>setConfigVisible(false)} style={{fontSize:10,color:"#888",background:"transparent",border:"none",cursor:"pointer"}}>Ascunde</button>
            </div>
            <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:12}}>
              <div style={{background:"#fff",borderRadius:12,padding:"16px 20px",border:"1px solid #e5e5e5"}}>
                <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:12}}>Media — video-uri în ofertă</div>
                <input value={mediaTitle} onChange={e=>{setMediaTitle(e.target.value);syncOffer({mediaTitle:e.target.value});}} placeholder="Titlu secțiune (ex: PHASER Live)" style={{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid #e5e5e5",fontSize:12,marginBottom:12}}/>
                {videos.map(v=>(
                  <div key={v.id} style={{display:"flex",alignItems:"center",gap:10,padding:"8px 0",borderBottom:"1px solid #eee"}}>
                    <input type="checkbox" checked={v.checked} onChange={()=>{const nv=videos.map(x=>x.id===v.id?{...x,checked:!x.checked}:x);setVideos(nv);syncOffer({videos:nv});}} style={{accentColor:"#111",width:14,height:14,cursor:"pointer"}}/>
                    <span style={{fontSize:11,flex:1,color:"#333"}}>{v.title||"Video"}</span>
                    <input value={v.caption||""} onChange={e=>{const nv=videos.map(x=>x.id===v.id?{...x,caption:e.target.value}:x);setVideos(nv);syncOffer({videos:nv});}} placeholder="Caption" style={{flex:1,padding:"4px 8px",fontSize:11,borderRadius:6,border:"1px solid #e5e5e5"}}/>
                  </div>
                ))}
              </div>
              <div style={{background:"#fff",borderRadius:12,padding:"16px 20px",border:"1px solid #e5e5e5"}}>
                <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:12}}>Playlist — selectează piese</div>
                <div style={{position:"relative",marginBottom:10}}>
                  <IcSearch s={13} style={{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:"#aaa",pointerEvents:"none"}}/>
                  <input value={playlistSearch} onChange={e=>setPlaylistSearch(e.target.value)} placeholder="Caută cântec sau artist..." style={{width:"100%",padding:"7px 12px 7px 32px",borderRadius:8,border:"1px solid #e5e5e5",fontSize:12}}/>
                </div>
                <div style={{display:"flex",gap:6,marginBottom:10}}>
                  <button onClick={()=>{const nv=covers.map(c=>({...c,checked:true}));setCovers(nv);syncOffer({covers:nv});}} style={{padding:"3px 10px",borderRadius:6,border:"1px solid #e5e5e5",background:"#fff",fontSize:11,cursor:"pointer",color:"#333"}}>Selectează tot</button>
                  <button onClick={()=>{const nv=covers.map(c=>({...c,checked:false}));setCovers(nv);syncOffer({covers:nv});}} style={{padding:"3px 10px",borderRadius:6,border:"1px solid #e5e5e5",background:"#fff",fontSize:11,cursor:"pointer",color:"#333"}}>Deselectează tot</button>
                </div>
                <div style={{maxHeight:180,overflow:"auto",display:"flex",flexDirection:"column",gap:2}}>
                  {covers.filter(c=>!playlistSearch||c.title.toLowerCase().includes(playlistSearch.toLowerCase())||(c.artist||'').toLowerCase().includes(playlistSearch.toLowerCase())).map((c)=>(
                    <div key={c.id} onClick={()=>{const nv=covers.map(x=>x.id===c.id?{...x,checked:!x.checked}:x);setCovers(nv);syncOffer({covers:nv});}}
                      style={{display:"flex",alignItems:"center",gap:10,padding:"6px 10px",borderRadius:7,border:`1px solid ${c.checked?"#111":"#ebebeb"}`,background:c.checked?"#f0f0f0":"#fff",cursor:"pointer",fontSize:12}}>
                      <div style={{width:14,height:14,borderRadius:4,border:`2px solid ${c.checked?"#111":"#ccc"}`,background:c.checked?"#111":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>{c.checked&&<IcCheck s={8} style={{color:"#fff"}}/>}</div>
                      <span style={{flex:1,fontWeight:600,color:"#222"}}>{c.title}</span>
                      <span style={{fontSize:11,color:"#888"}}>— {c.artist}</span>
                    </div>
                  ))}
                </div>
              </div>
            </div>
            </>}
          </div>}
          {/* Ofertă stilizată — de trimis la client / PDF */}
          <div id="offer-print-content" style={{maxWidth:560,margin:"0 auto",padding:mob?"16px":"24px 16px"}}>

            {/* Header card — culori calde, logo mare */}
            <div style={{background:"linear-gradient(135deg,#1a1510 0%,#2d2419 50%,#1a1510 100%)",borderRadius:16,padding:"28px 28px 24px",marginBottom:12,position:"relative",overflow:"hidden",border:"1px solid rgba(245,158,11,.15)"}}>
              <div style={{position:"absolute",top:0,right:0,width:240,height:240,background:"radial-gradient(circle,rgba(245,158,11,.08) 0%,transparent 70%)",pointerEvents:"none"}}/>
              <img src={LOGO_B64} alt="PHASER" style={{height:64,display:"block",marginBottom:24,objectFit:"contain",objectPosition:"left",filter:"brightness(1.1)"}}/>
              <div style={{fontSize:10,color:"rgba(251,191,36,.6)",letterSpacing:3,textTransform:"uppercase",marginBottom:8}}>Ofertă de colaborare</div>
              <div style={{fontSize:22,fontWeight:700,color:"#fff",marginBottom:4}}>{ev.offerNr?"O"+ev.offerNr+" · ":""}{ev.type}</div>
              <div style={{fontSize:13,color:"rgba(251,191,36,.5)"}}>{ev.venue||""}{ev.city?", "+ev.city:""}</div>
              <div style={{marginTop:16,paddingTop:16,borderTop:"1px solid rgba(251,191,36,.12)",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div>
                  <div style={{fontSize:10,color:"rgba(251,191,36,.5)",letterSpacing:1,textTransform:"uppercase"}}>Data</div>
                  <div style={{fontSize:14,fontWeight:600,color:"#fff",marginTop:2}}>{fD(ev.date)}</div>
                </div>
                <div style={{textAlign:"right"}}>
                  <div style={{fontSize:10,color:"rgba(251,191,36,.5)",letterSpacing:1,textTransform:"uppercase"}}>Total</div>
                  <div style={{fontSize:22,fontWeight:800,color:"#fbbf24",marginTop:2}}>{f$(tot)}</div>
                </div>
              </div>
            </div>

            {/* Despre noi + Video — la început, înainte de ofertă */}
            {isPriv&&(ev.poveste||templates?.poveste)&&<div style={{background:"#fff",borderRadius:12,padding:"20px 24px",marginBottom:8,borderLeft:"4px solid #111"}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:12}}>Despre noi</div>
              <div style={{fontSize:14,color:"#333",lineHeight:1.8,fontStyle:"italic"}}>{ev.poveste||templates?.poveste}</div>
            </div>}
            {/* Prestație */}
            <div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:14}}>Prestație artistică</div>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div>
                  <div style={{fontWeight:700,fontSize:15,color:"#111"}}>PHASER — live</div>
                  <div style={{fontSize:12,color:"#888",marginTop:3}}>
                    {isPriv
                      ? ((ev.repDurs&&ev.repDurs.length>0)
                          ? ev.repDurs.map((d,i)=>`R${i+1}: ${d}min`).join(" · ")
                          : `${ev.rep||1} ${(ev.rep||1)===1?"repriză":"reprize"} × ${ev.repDur||45} min`)
                      : (ev.durataRecital||`${ev.rep||1}×45 min`)
                    } · muzică live
                  </div>
                </div>
                <div style={{fontSize:18,fontWeight:800,color:"#111"}}>{f$(ev.fee)}</div>
              </div>
            </div>

            {/* Servicii extra */}
            {isPriv&&Object.values(ev.svc||{}).some(v=>v)&&<div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:14}}>Echipamente & Extra</div>
              {ev.svc?.sunet&&<div style={{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:"1px solid #f5f5f5"}}><span style={{fontSize:13,color:"#444"}}>Sistem sunet</span><span style={{fontWeight:600,fontSize:13}}>{f$(ev.svcp?.sunet)}</span></div>}
              {ev.svc?.lumini&&<div style={{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:"1px solid #f5f5f5"}}><span style={{fontSize:13,color:"#444"}}>Sistem lumini</span><span style={{fontWeight:600,fontSize:13}}>{f$(ev.svcp?.lumini)}</span></div>}
              {ev.svc?.ecran&&<div style={{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:"1px solid #f5f5f5"}}><span style={{fontSize:13,color:"#444"}}>Ecran LED (3×2)</span><span style={{fontWeight:600,fontSize:13}}>{f$(ev.svcp?.ecran)} + 1 meniu + 1 cameră twin</span></div>}
              {ev.svc?.scena&&<div style={{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:"1px solid #f5f5f5"}}><span style={{fontSize:13,color:"#444"}}>Scenă / Podium</span><span style={{fontWeight:600,fontSize:13}}>{f$(ev.svcp?.scena)}</span></div>}
              {ev.svc?.dj&&<div style={{display:"flex",justifyContent:"space-between",padding:"5px 0"}}><span style={{fontSize:13,color:"#444"}}>DJ</span><span style={{fontWeight:600,fontSize:13}}>{f$(ev.svcp?.dj)} + 1 meniu</span></div>}
              {(ev.svc?.sunet||ev.svc?.lumini||ev.svc?.ecran||ev.svc?.scena)&&<div style={{fontSize:11,color:"#888",marginTop:10,paddingTop:10,borderTop:"1px solid #f5f5f5"}}>Echipamentele tehnice vin cu operatori tehnici disponibili pe tot parcursul evenimentului.</div>}
            </div>}

            {/* Cazare, Transport, Protocol — conform model PDF */}
            {isPriv&&ev.hosp&&<div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:14}}>Cazare și Transport</div>
              {[
                `Cazare — ${ev.hosp.camere??4} camere twin la locație sau în apropierea ei`,
                `Transport — 3 RON/KM (din Timișoara)`,
              ].map((item,i)=>(
                <div key={i} style={{display:"flex",alignItems:"center",gap:10,padding:"6px 0",borderBottom:"1px solid #f5f5f5"}}>
                  <div style={{width:6,height:6,borderRadius:"50%",background:"#22c55e",flexShrink:0}}/>
                  <span style={{fontSize:13,color:"#444"}}>{item}</span>
                </div>
              ))}
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginTop:14,marginBottom:10}}>Protocol</div>
              {(ev.hosp.protocolOverride||"").trim() ? (
                <div style={{fontSize:13,color:"#444",lineHeight:1.7,whiteSpace:"pre-line"}}>{(ev.hosp.protocolOverride||"").trim()}</div>
              ) : [
                `${ev.hosp.meniuri??6} meniuri de mâncare și băutură identice cu cele ale invitaților pentru seara evenimentului`,
                ...(ev.hosp.pranz?[`O masă de prânz pentru ${ev.hosp.meniuri??6} persoane după instalare`]:[]),
                ...(ev.hosp.micDejun?[`Mic dejun pentru ${ev.hosp.meniuri??6} persoane a doua zi după eveniment`]:[]),
                ...(ev.hosp.extra||[]).filter(e=>e.l).map(e=>e.l),
              ].map((item,i,arr)=>(
                <div key={"p-"+i} style={{display:"flex",alignItems:"center",gap:10,padding:"6px 0",borderBottom:i<arr.length-1?"1px solid #f5f5f5":"none"}}>
                  <div style={{width:6,height:6,borderRadius:"50%",background:"#22c55e",flexShrink:0}}/>
                  <span style={{fontSize:13,color:"#444"}}>{item}</span>
                </div>
              ))}
            </div>}
            {isPriv&&ev.includeTehnicAnnex&&ev.tehnic&&ev.tehnic.filter(t=>t.checked).length>0&&<div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:14}}>Necesar tehnic</div>
              {ev.tehnic.filter(t=>t.checked).map((t,i,arr)=>(
                <div key={t.id} style={{display:"flex",alignItems:"center",gap:10,padding:"6px 0",borderBottom:i<arr.length-1?"1px solid #f5f5f5":"none"}}>
                  <div style={{width:6,height:6,borderRadius:"50%",background:"#f59e0b",flexShrink:0}}/>
                  <span style={{fontSize:13,color:"#444"}}>{t.l}</span>
                </div>
              ))}
            </div>}

            {/* Plată */}
            <div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:14}}>Modalitate plată</div>
              <div style={{textAlign:"center",padding:"12px 0",marginBottom:12,borderBottom:"1px solid #f0f0f0"}}>
                <div style={{fontSize:10,color:"#999",textTransform:"uppercase",letterSpacing:1}}>Total</div>
                <div style={{fontSize:24,fontWeight:800,color:"#111",marginTop:4}}>{f$(tot)}</div>
              </div>
              <div style={{display:"flex",gap:10,marginBottom:10}}>
                <div style={{flex:1,background:"#f9f9f9",borderRadius:8,padding:"12px 14px",border:"1px solid #f0f0f0"}}>
                  <div style={{fontSize:10,color:"#999",textTransform:"uppercase",letterSpacing:1}}>Avans</div>
                  <div style={{fontSize:18,fontWeight:800,color:"#111",marginTop:4}}>{f$(ev.dep||0)}</div>
                  <div style={{fontSize:10,color:"#bbb",marginTop:2}}>în 10 zile de la încheierea contractului</div>
                </div>
                <div style={{flex:1,background:"#f9f9f9",borderRadius:8,padding:"12px 14px",border:"1px solid #f0f0f0"}}>
                  <div style={{fontSize:10,color:"#999",textTransform:"uppercase",letterSpacing:1}}>Rest</div>
                  <div style={{fontSize:18,fontWeight:800,color:"#111",marginTop:4}}>{f$(tot-(ev.dep||0))}</div>
                  <div style={{fontSize:10,color:"#bbb",marginTop:2}}>în {(ev.zileRest??5)} zile de la eveniment</div>
                </div>
              </div>
              <div style={{fontSize:11,color:"#bbb",textAlign:"center"}}>Oferta este valabilă 30 de zile · Prețurile vor fi calculate în RON la data facturării și includ toate taxele aferente</div>
            </div>

            {/* Media / PHASER Live — după plată, cu video-uri selectate (doar afișare, fără input în PDF) */}
            {isPriv&&videos.filter(v=>v.checked).length>0&&<div style={{background:"#fff",borderRadius:12,padding:"20px 24px",marginBottom:8,borderLeft:"4px solid #111"}}>
              <div style={{fontSize:14,fontWeight:700,color:"#111",marginBottom:16}}>{mediaTitle||"PHASER Live"}</div>
              {videos.filter(v=>v.checked).map((v,i)=>(
                <div key={v.id} style={{marginBottom:i<videos.filter(x=>x.checked).length-1?20:0}}>
                  <div style={{position:"relative",paddingBottom:"56.25%",height:0,marginBottom:8}}>
                    <iframe src={v.url} title={v.title} style={{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}} allowFullScreen/>
                  </div>
                  {(v.caption||"").trim()&&<div style={{fontSize:12,color:"#555",fontStyle:"italic",padding:"4px 0"}}>{v.caption}</div>}
                </div>
              ))}
            </div>}

            {/* Descriere */}
            {ev.desc&&<div style={{background:"#fff",borderRadius:12,padding:"16px 20px",marginBottom:8,borderLeft:"3px solid #111"}}>
              <div style={{fontSize:13,color:"#555",lineHeight:1.7,fontStyle:"italic"}}>{ev.desc}</div>
            </div>}

            {/* Playlist — la final */}
            {isPriv&&covers.filter(c=>c.checked).length>0&&showPlaylist&&<div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
                <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999"}}>Playlist</div>
                <button onClick={()=>setShowPlaylist(false)} style={{fontSize:10,color:"#bbb",background:"transparent",border:"none",cursor:"pointer"}}>Ascunde</button>
              </div>
              <div style={{columns:mob?1:2,columnGap:24}}>
                {covers.filter(c=>c.checked).map((c,i)=>(
                  <div key={c.id} style={{display:"flex",alignItems:"baseline",gap:6,padding:"3px 0",breakInside:"avoid",borderBottom:"1px solid #f5f5f5"}}>
                    <span style={{fontSize:10,color:"#bbb",minWidth:20,textAlign:"right",flexShrink:0}}>{i+1}.</span>
                    <span style={{fontSize:11,fontWeight:600,color:"#333",flex:1}}>{c.title}</span>
                    <span style={{fontSize:10,color:"#999",flexShrink:0}}>— {c.artist}</span>
                  </div>
                ))}
              </div>
            </div>}
            {isPriv&&!showPlaylist&&<button onClick={()=>setShowPlaylist(true)} style={{width:"100%",padding:"10px",borderRadius:12,border:"1px dashed #ddd",background:"transparent",fontSize:11,color:"#bbb",cursor:"pointer",marginBottom:8}}>+ Afișează playlist</button>}

            {/* Footer */}
            <div style={{textAlign:"center",padding:"16px 0 8px",fontSize:10,color:"#bbb",letterSpacing:1}}>
              PHASER MUSIC SRL · CUI 37199434 · contact@phaser.ro · 0744 771 488
            </div>
          </div>
        </div>}

{/* RIDER */}
        {tab==="rider"&&!isPriv&&<div style={{flex:1,overflow:"auto",background:"#fff"}}>
          {/* Header Rider */}
          <div style={{padding:"20px 28px",background:"#111",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0}}>
            <Logo height={40}/>
            <div style={{textAlign:"right"}}>
              <div style={{fontSize:9,color:"rgba(255,255,255,.3)",letterSpacing:2,textTransform:"uppercase"}}>Document oficial</div>
              <div style={{fontSize:13,fontWeight:700,color:"#fff",letterSpacing:1}}>RIDER TEHNIC ȘI DE OSPITALITATE</div>
            </div>
          </div>

          <div style={{padding:mob?"16px":"24px 32px",fontFamily:"Georgia,serif",color:"#222"}}>
            {/* Trupa / FOH */}
            <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:12,marginBottom:24,padding:16,background:"#f8f8f8",borderRadius:10,border:"1px solid #e5e5e5"}}>
              <div>
                <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1,color:"#666",marginBottom:8}}>TRUPA</div>
                {["Radu Racz  +40 744 771 488","Carina Dumitru","Arnold Birta","Sebastian Bârzeianu","Lucian Oprișan","contact@phaser.ro"].map((m,i)=>
                  <div key={i} style={{fontSize:12,color:i===5?"#0066cc":"#333",marginBottom:2}}>{m}</div>
                )}
              </div>
              <div>
                <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1,color:"#666",marginBottom:8}}>FOH</div>
                <div style={{fontSize:12,color:"#333"}}>Bogdan Racz  +40 745 602 161</div>
                <div style={{fontSize:12,color:"#0066cc"}}>contact@aiciprezent.ro</div>
              </div>
            </div>

            {/* RIDER TEHNIC */}
            <div style={{textAlign:"center",fontSize:16,fontWeight:700,textTransform:"uppercase",letterSpacing:2,marginBottom:20,borderBottom:"2px solid #111",paddingBottom:12}}>RIDER TEHNIC</div>

            {/* Sectiuni principale */}
            {[RIDER_TEHNIC.sunet, RIDER_TEHNIC.scena, RIDER_TEHNIC.probe, RIDER_TEHNIC.lumini, RIDER_TEHNIC.video].map((sec,i)=>(
              <div key={i} style={{marginBottom:16}}>
                <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5,marginBottom:6}}>{sec.titlu}</div>
                <p style={{fontSize:12,color:"#444",lineHeight:1.7,marginBottom:4}}>{sec.text}</p>
                {sec.req&&<p style={{fontSize:12,color:"#333",fontWeight:600}}>{sec.req}</p>}
              </div>
            ))}

            {/* Necesar scenă */}
            <div style={{marginBottom:20}}>
              <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5,marginBottom:10}}>NECESAR SCENĂ / ECHIPAMENTE / CONECTICĂ</div>
              <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:10}}>
                {[
                  {titlu:"Risere", items:RIDER_TEHNIC.risere},
                  {titlu:"Monitoare", items:RIDER_TEHNIC.monitoare},
                  {titlu:"Stative", items:RIDER_TEHNIC.stative},
                  {titlu:"Cabluri / Curent", items:RIDER_TEHNIC.cabluri},
                  {titlu:"Conectică", items:RIDER_TEHNIC.conectica},
                ].map((gr,i)=>(
                  <div key={i} style={{padding:12,borderRadius:8,border:"1px solid #e8e8e8",background:"#fafafa"}}>
                    <div style={{fontWeight:700,fontSize:11,marginBottom:6}}>{gr.titlu}</div>
                    {gr.items.map((item,j)=><div key={j} style={{fontSize:11,color:"#555",paddingLeft:8,marginBottom:2}}>– {item}</div>)}
                  </div>
                ))}
              </div>
            </div>

            {/* Plan amplasament / Stage plot — imagine din document */}
            <div style={{marginBottom:20,padding:14,borderRadius:10,border:"1px solid #e5e5e5",background:"#fafafa"}}>
              <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5,marginBottom:12}}>PLAN AMPLASAMENT / STAGE PLOT</div>
              <img src="StagePlot.png" alt="Stage plot PHASER" style={{width:"100%",maxWidth:600,height:"auto",borderRadius:8,display:"block"}} />
            </div>

            {/* Instalare, Parcare, Securitate */}
            <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr 1fr",gap:10,marginBottom:24}}>
              {[
                {titlu:"INSTALARE", text:RIDER_TEHNIC.instalare},
                {titlu:"PARCARE", text:RIDER_TEHNIC.parcare},
                {titlu:"SECURITATE", text:RIDER_TEHNIC.securitate},
              ].map((x,i)=>(
                <div key={i} style={{padding:12,borderRadius:8,border:"1px solid #e8e8e8",background:"#fafafa"}}>
                  <div style={{fontWeight:700,fontSize:11,textTransform:"uppercase",letterSpacing:.5,marginBottom:6}}>{x.titlu}</div>
                  <div style={{fontSize:11,color:"#555",lineHeight:1.6}}>{x.text}</div>
                </div>
              ))}
            </div>

            {/* Contact tehnic */}
            <div style={{textAlign:"center",marginBottom:20,fontSize:12,color:"#555",fontStyle:"italic"}}>
              Pentru a confirma aspectele tehnice necesare vă rugăm să ne contactați:<br/>
              <strong style={{color:"#111"}}>{RIDER_TEHNIC.contact}</strong>
            </div>

            {/* RIDER OSPITALITATE */}
            <div style={{textAlign:"center",fontSize:16,fontWeight:700,textTransform:"uppercase",letterSpacing:2,marginBottom:20,borderBottom:"2px solid #111",paddingBottom:12}}>RIDER DE OSPITALITATE</div>

            <div style={{marginBottom:16}}>
              <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5,marginBottom:10}}>BACKSTAGE ROOM</div>
              <div style={{display:"grid",gridTemplateColumns:mob?"1fr 1fr":"1fr 1fr 1fr",gap:6}}>
                {RIDER_TEHNIC.backstage.map((item,i)=>(
                  <div key={i} style={{display:"flex",alignItems:"flex-start",gap:6,padding:"6px 10px",borderRadius:6,background:"#f5f5f5",border:"1px solid #ebebeb"}}>
                    <span style={{color:"#22c55e",flexShrink:0,marginTop:1}}>●</span>
                    <span style={{fontSize:11,color:"#444",lineHeight:1.4}}>{item}</span>
                  </div>
                ))}
              </div>
              <div style={{marginTop:10,padding:10,borderRadius:6,background:"#fffef0",border:"1px solid #f0e68c",fontSize:11,color:"#555",fontStyle:"italic"}}>
                *În cazul evenimentelor corporate unde servirea se face pe baza unor cartele sau bonuri, dorim servirea directă în backstage pentru a evita eventualele întârzieri care pot afecta programul.
              </div>
            </div>

            <div style={{marginBottom:20}}>
              <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5,marginBottom:10}}>ON STAGE</div>
              {RIDER_TEHNIC.onStage.map((item,i)=>(
                <div key={i} style={{display:"flex",alignItems:"center",gap:6,padding:"6px 10px",borderRadius:6,background:"#f5f5f5",border:"1px solid #ebebeb",marginBottom:4}}>
                  <span style={{color:"#22c55e"}}>●</span>
                  <span style={{fontSize:11,color:"#444"}}>{item}</span>
                </div>
              ))}
            </div>

            <div style={{textAlign:"center",fontWeight:700,fontSize:14,letterSpacing:1,marginBottom:16}}>VĂ MULȚUMIM!</div>
            <div style={{textAlign:"center",fontSize:11,color:"#aaa"}}>www.phaser.ro</div>
          </div>
        </div>}

        {/* CONTRACT */}
        {tab==="contract"&&<div style={{flex:1,overflow:"auto"}}>
          <ContractView ev={ev} th={th} contractFields={contractFields} onContractChange={setContractFields}/>
        </div>}
      </div>
    </div>
  );
}

function SectO({ title, children }) {
  return <div style={{marginBottom:20}}>
    <div style={{fontSize:11,fontWeight:800,textTransform:"uppercase",letterSpacing:2,borderBottom:"2px solid #111",paddingBottom:5,marginBottom:10,color:"#111"}}>{title}</div>
    {children}
  </div>;
}
function Row({ l, v }) {
  return <div style={{display:"grid",gridTemplateColumns:"130px 1fr",gap:"4px 10px",padding:"3px 0"}}>
    <span style={{color:"#666",fontSize:12}}>{l}:</span><span style={{fontWeight:700,fontSize:13}}>{v}</span>
  </div>;
}


// ─── LOCATION SEARCH (offline — orașe România cu distanțe față de TM) ───
const RO_CITIES = [
  {n:"Timișoara",km:0},{n:"Arad",km:54},{n:"Lugoj",km:60},{n:"Reșița",km:80},
  {n:"Deva",km:120},{n:"Orăștie",km:150},{n:"Cluj-Napoca",km:140},{n:"Oradea",km:160},
  {n:"Alba Iulia",km:180},{n:"Sibiu",km:210},{n:"Hunedoara",km:130},{n:"Caransebeș",km:85},
  {n:"Lipova",km:65},{n:"Ineu",km:80},{n:"Sânnicolau Mare",km:45},{n:"Jimbolia",km:50},
  {n:"Buziaș",km:35},{n:"Recaș",km:20},{n:"Dumbrăvița",km:8},{n:"Giroc",km:5},
  {n:"Ghiroda",km:6},{n:"Moșnița",km:12},{n:"Bucovăț",km:15},{n:"Săcălaz",km:15},
  {n:"Bucharest",km:550},{n:"București",km:550},{n:"Brașov",km:350},{n:"Constanța",km:680},
  {n:"Iași",km:600},{n:"Craiova",km:350},{n:"Galați",km:620},{n:"Ploiești",km:500},
  {n:"Brăila",km:600},{n:"Bacău",km:520},{n:"Pitești",km:450},{n:"Râmnicu Vâlcea",km:380},
  {n:"Suceava",km:650},{n:"Baia Mare",km:280},{n:"Satu Mare",km:220},{n:"Bistrița",km:310},
  {n:"Sfântu Gheorghe",km:400},{n:"Miercurea Ciuc",km:440},{n:"Târgu Mureș",km:290},
  {n:"Focșani",km:560},{n:"Tulcea",km:710},{n:"Alexandria",km:520},{n:"Giurgiu",km:570},
  {n:"Drobeta-Turnu Severin",km:260},{n:"Slobozia",km:600},{n:"Zalău",km:190},
  {n:"Bihor",km:160},{n:"Târgoviște",km:480},{n:"Buzău",km:530},{n:"Slatina",km:400},
  {n:"Turda",km:160},{n:"Câmpia Turzii",km:155},{n:"Mediaș",km:240},{n:"Sebeș",km:190},
];

function LocationSearch({ venue, city, dist, onUpdate, sty, th, mob }) {
  const [venueVal, setVenueVal] = useState(venue||"");
  const [cityQuery, setCityQuery] = useState(city||"");
  const [showDropdown, setShowDropdown] = useState(false);
  const iStyle = {...sty.i, fontSize: mob?"16px":"14px"};

  const filtered = cityQuery.length>0
    ? RO_CITIES.filter(c=>c.n.toLowerCase().includes(cityQuery.toLowerCase())).slice(0,6)
    : [];

  const pickCity = (c) => {
    setCityQuery(c.n);
    setShowDropdown(false);
    onUpdate({ venue: venueVal, city: c.n, dist: c.km });
  };

  const handleVenueChange = (v) => {
    setVenueVal(v);
    onUpdate({ venue: v, city: cityQuery, dist: dist||0 });
  };

  return (
    <div style={{gridColumn:"1/-1",display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:10}}>
      {/* Venue */}
      <div>
        <label style={sty.l}>Locație / Venue</label>
        <input value={venueVal} onChange={e=>handleVenueChange(e.target.value)}
          style={iStyle} placeholder="Numele sălii / venue-ului"/>
      </div>

      {/* City cu autocomplete offline */}
      <div style={{position:"relative"}}>
        <label style={sty.l}>Oraș {dist>0&&<span style={{color:"#22c55e",fontWeight:700,marginLeft:6}}>🚗 {dist} km de TM</span>}</label>
        <input value={cityQuery}
          onChange={e=>{setCityQuery(e.target.value);setShowDropdown(true);onUpdate({venue:venueVal,city:e.target.value,dist:0});}}
          onFocus={()=>setShowDropdown(true)}
          onBlur={()=>setTimeout(()=>setShowDropdown(false),150)}
          style={iStyle} placeholder="Caută oraș..."/>
        {showDropdown && filtered.length>0 && (
          <div style={{position:"absolute",top:"100%",left:0,right:0,zIndex:999,background:th.c,border:`1px solid ${th.b}`,borderRadius:8,boxShadow:"0 8px 24px rgba(0,0,0,.2)",marginTop:2,overflow:"hidden"}}>
            {filtered.map((c,i)=>(
              <div key={c.n} onClick={()=>pickCity(c)}
                style={{padding:"9px 14px",cursor:"pointer",borderBottom:i<filtered.length-1?`1px solid ${th.bl}`:"none",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:13}}
                onMouseOver={e=>e.currentTarget.style.background=th.h}
                onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                <span style={{fontWeight:500,color:th.t}}>{c.n}</span>
                <span style={{fontSize:10,color:c.km===0?"#22c55e":th.tm,fontWeight:c.km<50?600:400}}>{c.km===0?"local":c.km+" km"}</span>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}


// ═══ EVENT FORM ═══
function EventForm({ th, sty, isE, isP, mData, onSave, onClose, mob, templates }) {
  const tplCovers = (templates?.playlist&&templates.playlist.length>0) ? templates.playlist : DEFAULT_COVERS;
  const [fm, setFm] = useState({
    cat: mData?.cat||"private",
    type: mData?.type||(isP?"Nuntă":"Festival"),
    st: mData?.st||"oferta",
    date: mData?.date||"",
    li: mData?.li||"", sc: mData?.sc||"", ss: mData?.ss||"", lo: mData?.lo||"",
    venue: mData?.venue||"", city: mData?.city||"", dist: mData?.dist||0,
    cn: mData?.cn||"", cp: mData?.cp||"", ce: mData?.ce||"",
    rep: mData?.rep||(isP?1:1),
    repDurs: mData?.repDurs||[],
    durataRecital: mData?.durataRecital||"",
    responsabilPrincipal: mData?.responsabilPrincipal||"",
    responsabili: mData?.responsabili||[],
    fee: mData?.fee||(isP?PX.r[1]:PX.pub),
    dep: mData?.dep||Math.round((mData?.fee||PX.r[1])*0.1/10)*10, dp: mData?.dp||false, zileRest: mData?.zileRest??5,
    sp: mData?.sp||{}, svc: mData?.svc||{}, svcp: mData?.svcp||{sunet:350,lumini:500,ecran:600,scena:300,dj:600},
    ex: mData?.ex||[], ven: mData?.ven||[], notes: mData?.notes||"",
    videos: mData?.videos||DEFAULT_VIDEOS, covers: mData?.covers||tplCovers,
    desc: mData?.desc||"",
    poveste: mData?.poveste||"",
    customSvc: mData?.customSvc||[],
    hosp: (mData?.hosp && !Array.isArray(mData.hosp)) ? {camere:4,meniuri:6,micDejun:true,pranz:true,extra:[],protocolOverride:"",...mData.hosp,extra:mData.hosp.extra||[],protocolOverride:mData.hosp.protocolOverride||""} : {
      camere: 4, meniuri: 6, micDejun: true, pranz: true, extra: [], protocolOverride: "",
    },
    includeTehnicAnnex: mData?.includeTehnicAnnex||false,
    tehnic: mData?.tehnic||[
      {id:"t1",l:"Sistem de sunet profesional dimensionat corespunzător spațiului",checked:true},
      {id:"t2",l:"Inginer de sistem (sound engineer) la FOH",checked:true},
      {id:"t3",l:"5 monitoare pe scenă (conform plan amplasament)",checked:true},
      {id:"t4",l:"Sistem de lumini profesional + luminist",checked:true},
      {id:"t5",l:"1 cablu UTP (CAT5/CAT6) de la scenă la FOH",checked:true},
      {id:"t6",l:"1 riser mobil 3×2×0.40m (pentru tobe)",checked:true},
      {id:"t7",l:"2 stative microfon tip boom",checked:true},
      {id:"t8",l:"Probe de sunet: 60 min amplasare + 60 min soundcheck",checked:true},
      {id:"t9",l:"2 persoane ajutor la descărcat/încărcat echipamente",checked:true},
      {id:"t10",l:"Loc parcare microbuz în apropierea scenei (de la soundcheck până după concert)",checked:true},
      {id:"t11",l:"Securitate echipamente pe toată durata evenimentului",checked:true},
      {id:"t12",l:"Spațiu depozitare case-uri și huse lângă scenă",checked:true},
      {id:"t13",l:"Sistem video (ecran LED / videoproiector) — logo disponibil pe phaser.ro",checked:false},
    ],
  });
  const [secTab, setSecTab] = useState("detalii");
  const [playlistSearch, setPlaylistSearch] = useState("");
  const u = (k,v) => setFm(p=>({...p,[k]:v}));
  const svcT = isP ? Object.entries(fm.svcp).reduce((s,[k,v])=>s+(fm.svc[k]?v:0),0) : 0;
  const iStyle = {...sty.i, fontSize: mob?"16px":"14px"};

  const showTehnicTab = !isP || ["Corporate","Private Party","Altele"].includes(fm.type);
  const baseTabs = isP ? (showTehnicTab ? ["detalii","client","servicii","ospitalitate","tehnic","media","playlist","note"] : ["detalii","client","servicii","ospitalitate","media","playlist","note"]) : ["detalii","client","tehnic","media","note"];
  const editTabs = isP ? ["detalii","client","servicii","ospitalitate","tehnic","timing","cheltuieli","membri","furnizori","media","playlist","note"]
                       : ["detalii","client","tehnic","timing","cheltuieli","membri","furnizori","media","note"];
  const tabs = isE ? editTabs : baseTabs;

  return (
    <div style={{position:"fixed",inset:0,background:th.ov,zIndex:1000}} onClick={onClose}>
      <div style={{position:"absolute",inset:0,display:"flex",flexDirection:"column",background:mob?th.c:"transparent",alignItems:mob?"stretch":"center",justifyContent:mob?"stretch":"center"}} onClick={e=>e.stopPropagation()}>
        <div style={{background:th.c,border:mob?"none":`1px solid ${th.b}`,borderRadius:mob?0:14,width:mob?"100%":660,maxHeight:mob?"none":"88vh",flex:mob?1:"none",display:"flex",flexDirection:"column",margin:mob?0:"auto",overflow:"hidden"}}>
          
          {/* Header */}
          <div style={{padding:"14px 20px",borderBottom:`1px solid ${th.b}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0,background:th.sb}}>
            <div style={{display:"flex",alignItems:"center",gap:12}}>
              <Logo height={22}/>
              <span style={{fontSize:12,color:"rgba(255,255,255,.5)",fontWeight:500}}>— {isE?"Editează":"Ofertă nouă"} {isP?"(Privat / ZGV)":"(Public / PHASER)"}</span>
            </div>
            <button onClick={onClose} style={{padding:3,border:"none",background:"transparent",color:"rgba(255,255,255,.5)",cursor:"pointer"}}><IcX s={16}/></button>
          </div>

          {/* Tab bar */}
          <div style={{display:"flex",gap:1,padding:"8px 20px",borderBottom:`1px solid ${th.b}`,overflowX:"auto",flexShrink:0}}>
            {tabs.map(t=><button key={t} onClick={()=>setSecTab(t)} style={{padding:"4px 10px",borderRadius:5,border:"none",fontSize:11,fontWeight:secTab===t?700:400,cursor:"pointer",background:secTab===t?th.ab:"transparent",color:secTab===t?th.t:th.tm,textTransform:"capitalize",whiteSpace:"nowrap"}}>{t}</button>)}
          </div>

          <div style={{flex:1,overflowY:"auto",padding:"16px 20px"}}>

            {secTab==="detalii"&&<div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:12}}>
              <div style={{gridColumn:"1/-1"}}><label style={sty.l}>Persoana care a preluat oferta</label><input value={fm.responsabilPrincipal||""} onChange={e=>u("responsabilPrincipal",e.target.value)} style={iStyle} placeholder="Numele persoanei care gestionează oferta"/></div>
              <div style={{gridColumn:"1/-1"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                  <label style={sty.l}>Echipă / Persoane implicate (nume + rol)</label>
                  <button onClick={()=>u("responsabili",[...(fm.responsabili||[]),{id:uid(),nume:"",rol:""}])} style={{...sty.bg,fontSize:10,padding:"3px 8px"}}><IcPlus s={11}/> Adaugă</button>
                </div>
                {(fm.responsabili||[]).map((r,i)=>(
                  <div key={r.id} style={{display:"flex",gap:6,marginBottom:5,alignItems:"center"}}>
                    <input value={r.nume} onChange={e=>{const arr=[...(fm.responsabili||[])];arr[i]={...arr[i],nume:e.target.value};u("responsabili",arr);}} style={{...iStyle,flex:1}} placeholder="Nume"/>
                    <input value={r.rol} onChange={e=>{const arr=[...(fm.responsabili||[])];arr[i]={...arr[i],rol:e.target.value};u("responsabili",arr);}} style={{...iStyle,width:120}} placeholder="Rol"/>
                    <button onClick={()=>u("responsabili",(fm.responsabili||[]).filter((_,j)=>j!==i))} style={{padding:3,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>✕</button>
                  </div>
                ))}
              </div>
              <div><label style={sty.l}>Tip eveniment</label>
                <select value={fm.type} onChange={e=>u("type",e.target.value)} className="modernSel" style={iStyle}>
                  {(isP?PRIVATE_TYPES:PUBLIC_TYPES).map(t=><option key={t}>{t}</option>)}
                </select>
              </div>
              {isE&&<div><label style={sty.l}>Status</label>
                <select value={fm.st} onChange={e=>u("st",e.target.value)} className="modernSel" style={iStyle}>
                  {Object.entries(ST).map(([k,v])=><option key={k} value={k}>{v.l}</option>)}
                </select>
              </div>}
              <div><label style={sty.l}>Data eveniment *</label><input type="date" value={fm.date} onChange={e=>u("date",e.target.value)} style={iStyle}/></div>
              <div><label style={sty.l}>Onorariu trupă (€)</label><input type="number" value={fm.fee} onChange={e=>{const f=Number(e.target.value);u("fee",f);if(!mData?.dep)u("dep",Math.round(f*0.1/10)*10);}} style={iStyle}/></div>
              <div>
                <label style={sty.l}>Avans</label>
                <div style={{display:"flex",gap:6}}>
                  <input type="number" value={fm.dep} onChange={e=>u("dep",Number(e.target.value))} style={{...iStyle,flex:2}}/>
                  <div style={{display:"flex",alignItems:"center",gap:4,flex:1,background:th.h,borderRadius:7,border:`1px solid ${th.b}`,padding:"0 8px"}}>
                    <input type="number" value={fm.fee>0?Math.round(fm.dep/fm.fee*100):10}
                      onChange={e=>{const pct=Number(e.target.value);u("dep",Math.round(fm.fee*pct/100/10)*10);}}
                      style={{background:"transparent",border:"none",color:th.t,width:30,fontSize:13,fontWeight:600,textAlign:"center",fontFamily:"inherit"}}
                      min={0} max={100}
                    />
                    <span style={{fontSize:12,color:th.tm}}>%</span>
                  </div>
                </div>
              </div>
              <div>
                <label style={sty.l}>Rest — zile după eveniment</label>
                <input type="number" value={fm.zileRest} onChange={e=>u("zileRest",Number(e.target.value)||5)} style={iStyle} placeholder="5" min={1} max={90}/>
                <div style={{fontSize:10,color:th.tm,marginTop:2}}>Restul sumei se plătește prin virament bancar</div>
              </div>
              {isP&&<div style={{gridColumn:"1/-1"}}>
                <label style={sty.l}>Reprize</label>
                <div style={{display:"flex",gap:6,margin:"4px 0",flexWrap:"wrap"}}>
                  {[1,2,3].map(r=><button key={r} onClick={()=>{u("rep",r);u("repCustom",false);const durs=Array(r).fill(fm.repDur||45);u("repDurs",durs);u("fee",PX.r[r]);u("dep",Math.round(PX.r[r]*0.1/10)*10);}} style={{flex:1,minWidth:70,padding:10,borderRadius:7,border:`2px solid ${!fm.repCustom&&fm.rep===r?th.t:th.b}`,background:!fm.repCustom&&fm.rep===r?th.ab:"transparent",cursor:"pointer",textAlign:"center",color:th.t}}>
                    <div style={{fontWeight:700,fontSize:14}}>{r}</div>
                    <div style={{fontSize:10,color:th.tm}}>{r===1?"repriză":"reprize"}</div>
                  </button>)}
                  <button onClick={()=>{u("repCustom",true);u("rep",1);u("repDurs",[45]);}} style={{flex:1,minWidth:70,padding:10,borderRadius:7,border:`2px solid ${fm.repCustom?th.t:th.b}`,background:fm.repCustom?th.ab:"transparent",cursor:"pointer",textAlign:"center",color:th.t}}>
                    <div style={{fontWeight:700,fontSize:14}}>Custom</div>
                  </button>
                </div>
                {fm.repCustom&&<div style={{display:"flex",gap:8,marginTop:8}}>
                  <div><label style={{...sty.l,fontSize:10}}>Nr. reprize</label><input type="number" value={fm.rep} onChange={e=>{const r=Number(e.target.value)||1;u("rep",r);u("repDurs",(fm.repDurs||[45]).slice(0,r).concat(Array(Math.max(0,r-(fm.repDurs||[]).length)).fill(45)));}} style={iStyle} min={1} max={10}/></div>
                </div>}
                <div style={{display:"flex",gap:6,marginTop:8,flexWrap:"wrap",alignItems:"center"}}>
                  <span style={{fontSize:11,color:th.tm}}>Durată per repriză:</span>
                  {(fm.repDurs||Array(fm.rep||1).fill(45)).slice(0,fm.rep||1).map((d,i)=>(
                    <div key={i} style={{display:"flex",alignItems:"center",gap:4}}>
                      {(fm.rep||1)>1&&<span style={{fontSize:11,color:th.tm}}>R{i+1}:</span>}
                      <input type="number" value={d} onChange={e=>{const arr=[...(fm.repDurs||Array(fm.rep||1).fill(45))];arr[i]=Number(e.target.value)||45;u("repDurs",arr);}} style={{...iStyle,width:60}} min={5} max={120}/>
                      <span style={{fontSize:11,color:th.tm}}>min</span>
                    </div>
                  ))}
                </div>
              </div>}
              <LocationSearch
                venue={fm.venue} city={fm.city} dist={fm.dist}
                onUpdate={({venue,city,dist})=>{u("venue",venue);u("city",city);u("dist",dist);}}
                sty={sty} th={th} mob={mob}
              />
              {!isP&&<div><label style={sty.l}>Durată recital / prestație</label>
                <input value={fm.durataRecital} onChange={e=>u("durataRecital",e.target.value)} style={iStyle} placeholder="ex: 90 min, 2×45 min"/>
              </div>}
              <div style={{gridColumn:"1/-1"}}><label style={sty.l}>Descriere ofertă (opțional)</label>
                <textarea value={fm.desc} onChange={e=>u("desc",e.target.value)} style={{...iStyle,minHeight:60,resize:"vertical"}} placeholder="Text introductiv în ofertă..."/>
              </div>
              {isP&&<div style={{gridColumn:"1/-1"}}><label style={sty.l}>Poveste / Media (override pentru acest eveniment)</label>
                <textarea value={fm.poveste||""} onChange={e=>u("poveste",e.target.value)} style={{...iStyle,minHeight:80,resize:"vertical"}} placeholder="Lasă gol pentru a folosi template-ul din Secțiuni"/>
                <div style={{fontSize:10,color:th.tm,marginTop:2}}>Text care apare în ofertă ca „Despre noi”. Dacă e gol, se folosește template-ul.</div>
              </div>}
            </div>}

            {secTab==="client"&&<div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:12}}>
              <div style={{gridColumn:"1/-1"}}><label style={sty.l}>Nume client</label><input value={fm.cn} onChange={e=>u("cn",e.target.value)} style={iStyle} placeholder="Numele clientului"/></div>
              <div><label style={sty.l}>Telefon</label><input value={fm.cp} onChange={e=>u("cp",e.target.value)} style={iStyle} placeholder="+40..."/></div>
              <div><label style={sty.l}>Email</label><input value={fm.ce} onChange={e=>u("ce",e.target.value)} style={iStyle} placeholder="email@..."/></div>
              <div><label style={sty.l}>Platformă contact</label>
                <select value={fm.platform||""} onChange={e=>u("platform",e.target.value)} className="modernSel" style={iStyle}>
                  <option value="">— niciuna —</option>
                  <option value="Instagram">Instagram</option>
                  <option value="Facebook">Facebook</option>
                  <option value="WhatsApp">WhatsApp</option>
                  <option value="TikTok">TikTok</option>
                  <option value="Telefon">Telefon</option>
                  <option value="Email">Email</option>
                  <option value="Altele">Altele</option>
                </select>
              </div>
              <div><label style={sty.l}>ID / Handle / Username</label><input value={fm.platformId||""} onChange={e=>u("platformId",e.target.value)} style={iStyle} placeholder="@username sau link..."/></div>
              <div style={{gridColumn:"1/-1",padding:10,borderRadius:7,background:th.h,fontSize:11,color:th.tm}}>
                ℹ️ Datele clientului sunt <strong style={{color:th.t}}>interne</strong> — nu apar în oferta trimisă.
              </div>
            </div>}

            {secTab==="servicii"&&isP&&<div>
              <label style={sty.l}>Număr reprize</label>
              <div style={{display:"flex",gap:6,margin:"4px 0 12px",flexWrap:"wrap"}}>
                {[1,2,3].map(r=><button key={r} onClick={()=>{u("rep",r);u("repCustom",false);const durs=Array(r).fill(fm.repDur||45);u("repDurs",durs);u("fee",PX.r[r]);u("dep",Math.round(PX.r[r]*0.1/10)*10);}} style={{flex:1,minWidth:70,padding:12,borderRadius:7,border:`2px solid ${!fm.repCustom&&fm.rep===r?th.t:th.b}`,background:!fm.repCustom&&fm.rep===r?th.ab:"transparent",cursor:"pointer",textAlign:"center",color:th.t}}>
                  <div style={{fontWeight:700,fontSize:16}}>{r}</div>
                  <div style={{fontSize:10,color:th.tm}}>{r===1?"repriză":"reprize"}</div>
                  <div style={{fontSize:12,fontWeight:600,marginTop:2}}>{f$(PX.r[r])}</div>
                </button>)}
                <button onClick={()=>{u("repCustom",true);u("rep",1);u("repDurs",[45]);}} style={{flex:1,minWidth:70,padding:12,borderRadius:7,border:`2px solid ${fm.repCustom?th.t:th.b}`,background:fm.repCustom?th.ab:"transparent",cursor:"pointer",textAlign:"center",color:th.t}}>
                  <div style={{fontWeight:700,fontSize:16}}>Custom</div>
                  <div style={{fontSize:10,color:th.tm}}>introduci tu</div>
                </button>
              </div>
              {fm.repCustom&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:12}}>
                <div><label style={sty.l}>Reprize</label><input type="number" value={fm.rep} onChange={e=>{const r=Number(e.target.value)||1;u("rep",r);u("repDurs",(fm.repDurs||[45]).slice(0,r).concat(Array(Math.max(0,r-(fm.repDurs||[]).length)).fill(45)));}} style={iStyle} min={1} max={10}/></div>
                <div><label style={sty.l}>Onorariu (€)</label><input type="number" value={fm.fee} onChange={e=>{const f=Number(e.target.value);u("fee",f);u("dep",Math.round(f*0.1/10)*10);}} style={iStyle}/></div>
              </div>}
              <label style={sty.l}>Durată per repriză (min)</label>
              <div style={{display:"flex",gap:6,marginBottom:12,flexWrap:"wrap"}}>
                {(fm.repDurs||Array(fm.rep||1).fill(45)).slice(0,fm.rep||1).map((d,i)=>(
                  <div key={i} style={{display:"flex",alignItems:"center",gap:4}}>
                    <span style={{fontSize:11,color:th.tm}}>R{i+1}:</span>
                    <input type="number" value={d} onChange={e=>{const arr=[...(fm.repDurs||Array(fm.rep||1).fill(45))];arr[i]=Number(e.target.value);u("repDurs",arr);}} style={{...iStyle,width:60,padding:"6px 8px"}} min={15} max={120}/>
                  </div>
                ))}
              </div>
              {!fm.repCustom&&<div style={{marginBottom:16}}><label style={sty.l}>Onorariu (€)</label><input type="number" value={fm.fee} onChange={e=>{const f=Number(e.target.value);u("fee",f);u("dep",Math.round(f*0.1/10)*10);}} style={iStyle}/></div>}
              <label style={sty.l}>Servicii extra</label>
              {[{k:"sunet",l:"Sistem sunet"},{k:"lumini",l:"Sistem lumini"},{k:"ecran",l:"Ecran LED"},{k:"scena",l:"Scenă/Podium"},{k:"dj",l:"DJ"}].map(sv=>
                <div key={sv.k} onClick={()=>u("svc",{...fm.svc,[sv.k]:fm.svc[sv.k]?0:1})}
                  style={{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",borderRadius:6,background:fm.svc[sv.k]?th.ab:th.h,marginBottom:4,cursor:"pointer",border:`1px solid ${fm.svc[sv.k]?th.a:th.b}`}}>
                  <div style={{width:18,height:18,borderRadius:4,border:`2px solid ${fm.svc[sv.k]?th.a:th.b}`,background:fm.svc[sv.k]?th.a:"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                    {fm.svc[sv.k]?<IcCheck s={10}/>:null}
                  </div>
                  <span style={{flex:1,fontSize:12,fontWeight:500}}>{sv.l}</span>
                  <input type="number" value={fm.svcp[sv.k]||0} onChange={e=>{e.stopPropagation();u("svcp",{...fm.svcp,[sv.k]:Number(e.target.value)})}} style={{...iStyle,width:80,textAlign:"right"}} onClick={e=>e.stopPropagation()}/>
                  <span style={{fontSize:11,color:th.tm}}>€</span>
                </div>
              )}
              <div style={{marginTop:12}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                  <label style={sty.l}>Extra personalizat</label>
                  <button onClick={()=>u("customSvc",[...fm.customSvc,{id:uid(),l:"",v:0,checked:true}])} style={{...sty.bg,fontSize:10,padding:"3px 8px",gap:3}}><IcPlus s={11}/> Adaugă</button>
                </div>
                {fm.customSvc.map((cs,i)=>(
                  <div key={cs.id} style={{display:"flex",gap:6,marginBottom:5,alignItems:"center"}}>
                    <input type="checkbox" checked={cs.checked} onChange={e=>{const c=[...fm.customSvc];c[i]={...c[i],checked:e.target.checked};u("customSvc",c);}} style={{accentColor:th.t,width:15,height:15,flexShrink:0}}/>
                    <input value={cs.l} onChange={e=>{const c=[...fm.customSvc];c[i]={...c[i],l:e.target.value};u("customSvc",c);}} style={{...iStyle,flex:1}} placeholder="Serviciu..."/>
                    <input type="number" value={cs.v} onChange={e=>{const c=[...fm.customSvc];c[i]={...c[i],v:Number(e.target.value)};u("customSvc",c);}} style={{...iStyle,width:70,textAlign:"right"}} placeholder="€"/>
                    <button onClick={()=>u("customSvc",fm.customSvc.filter((_,j)=>j!==i))} style={{padding:3,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>✕</button>
                  </div>
                ))}
              </div>
              <div style={{marginTop:10,padding:10,borderRadius:6,background:th.h,display:"flex",justifyContent:"space-between",fontSize:12,fontWeight:600}}><span>Total servicii:</span><span>{f$(svcT)}</span></div>

            </div>}

            {secTab==="timing"&&<div>
              <div style={{padding:10,borderRadius:6,background:th.h,marginBottom:14,fontSize:11,color:th.ts}}>📍 Intern — program pe ore al evenimentului.</div>
              <div style={{display:"grid",gridTemplateColumns:mob?"1fr 1fr":"1fr 1fr 1fr 1fr",gap:10}}>
                <div><label style={sty.l}>Load In</label><input type="time" value={fm.li} onChange={e=>u("li",e.target.value)} style={iStyle}/></div>
                <div><label style={sty.l}>Soundcheck</label><input type="time" value={fm.sc} onChange={e=>u("sc",e.target.value)} style={iStyle}/></div>
                <div><label style={sty.l}>Show Start</label><input type="time" value={fm.ss} onChange={e=>u("ss",e.target.value)} style={iStyle}/></div>
                <div><label style={sty.l}>Load Out</label><input type="time" value={fm.lo} onChange={e=>u("lo",e.target.value)} style={iStyle}/></div>
              </div>
            </div>}

            {secTab==="cheltuieli"&&<div>
              <button onClick={()=>u("ex",[...fm.ex,{id:uid(),n:"",a:0,v:""}])} style={{...sty.bg,fontSize:11,padding:"5px 10px",marginBottom:10}}>+ Adaugă cheltuială</button>
              {fm.ex.map((x,i)=><div key={x.id} style={{display:"grid",gridTemplateColumns:mob?"1fr 1fr":"2fr 1fr 2fr auto",gap:6,marginBottom:6}}>
                <input value={x.n} onChange={e=>{const ex=[...fm.ex];ex[i]={...ex[i],n:e.target.value};u("ex",ex);}} style={iStyle} placeholder="Serviciu"/>
                <input type="number" value={x.a} onChange={e=>{const ex=[...fm.ex];ex[i]={...ex[i],a:Number(e.target.value)};u("ex",ex);}} style={iStyle} placeholder="€"/>
                {!mob&&<input value={x.v||""} onChange={e=>{const ex=[...fm.ex];ex[i]={...ex[i],v:e.target.value};u("ex",ex);}} style={iStyle} placeholder="Furnizor"/>}
                <button onClick={()=>u("ex",fm.ex.filter((_,j)=>j!==i))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>✕</button>
              </div>)}
              {fm.ex.length>0&&<div style={{padding:10,borderRadius:6,background:th.h,fontSize:12,fontWeight:600,textAlign:"right"}}>Total: {f$(fm.ex.reduce((s,x)=>s+x.a,0))}</div>}
            </div>}

            {secTab==="membri"&&<div>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:10}}>
                <span style={{fontSize:12,color:th.ts}}>Disponibil: {f$(fm.fee-fm.ex.reduce((s,x)=>s+x.a,0))}</span>
                <button onClick={()=>{const av=fm.fee-fm.ex.reduce((s,x)=>s+x.a,0);const per=Math.floor(av/MEMBERS.length);const nsp={};MEMBERS.forEach(m=>{nsp[m.id]=per});u("sp",nsp);}} style={{...sty.bg,fontSize:11,padding:"4px 10px"}}>Split egal</button>
              </div>
              {MEMBERS.map(m=><div key={m.id} style={{display:"flex",alignItems:"center",gap:10,padding:"7px 10px",borderRadius:6,marginBottom:4,background:th.h}}>
                <div style={{width:28,height:28,borderRadius:"50%",background:th.a,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:11,color:th.bg,flexShrink:0}}>{m.n[0]}</div>
                <div style={{flex:1,fontSize:12}}>{m.n} <span style={{color:th.tm}}>— {m.r}</span></div>
                <input type="number" value={fm.sp[m.id]||""} onChange={e=>u("sp",{...fm.sp,[m.id]:Number(e.target.value)})} style={{...iStyle,width:80,textAlign:"right"}} placeholder="0"/>
                <span style={{fontSize:10,color:th.tm}}>€</span>
              </div>)}
            </div>}

            {secTab==="furnizori"&&<div>
              <button onClick={()=>u("ven",[...fm.ven,{id:uid(),n:"",role:"",fee:0}])} style={{...sty.bg,fontSize:11,padding:"5px 10px",marginBottom:10}}>+ Furnizor</button>
              {fm.ven.map((v,i)=><div key={v.id} style={{padding:10,borderRadius:6,background:th.h,marginBottom:6}}>
                <div style={{display:"grid",gridTemplateColumns:mob?"1fr 1fr":"1fr 1fr 1fr auto",gap:6}}>
                  <input value={v.n} onChange={e=>{const ve=[...fm.ven];ve[i]={...ve[i],n:e.target.value};u("ven",ve);}} style={iStyle} placeholder="Nume"/>
                  <input value={v.role} onChange={e=>{const ve=[...fm.ven];ve[i]={...ve[i],role:e.target.value};u("ven",ve);}} style={iStyle} placeholder="Rol"/>
                  {!mob&&<input type="number" value={v.fee} onChange={e=>{const ve=[...fm.ven];ve[i]={...ve[i],fee:Number(e.target.value)};u("ven",ve);}} style={iStyle} placeholder="€"/>}
                  <button onClick={()=>u("ven",fm.ven.filter((_,j)=>j!==i))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>✕</button>
                </div>
              </div>)}
            </div>}

            {secTab==="ospitalitate"&&isP&&<div>
              <div style={{fontSize:11,color:th.tm,marginBottom:16,padding:"8px 12px",background:th.h,borderRadius:7}}>🏨 Ce solicităm organizatorului pentru membrii trupei</div>
              
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:16}}>
                <div>
                  <label style={sty.l}>Camere twin / cazare</label>
                  <div style={{display:"flex",alignItems:"center",gap:8}}>
                    <button onClick={()=>u("hosp",{...fm.hosp,camere:Math.max(0,(fm.hosp.camere||0)-1)})} style={{...sty.bg,padding:"8px 12px",fontSize:16,fontWeight:700}}>−</button>
                    <span style={{fontSize:20,fontWeight:700,minWidth:30,textAlign:"center"}}>{fm.hosp.camere??0}</span>
                    <button onClick={()=>u("hosp",{...fm.hosp,camere:(fm.hosp.camere||0)+1})} style={{...sty.bg,padding:"8px 12px",fontSize:16,fontWeight:700}}>+</button>
                  </div>
                </div>
                <div>
                  <label style={sty.l}>Meniuri complete pentru seara evenimentului</label>
                  <div style={{display:"flex",alignItems:"center",gap:8}}>
                    <button onClick={()=>u("hosp",{...fm.hosp,meniuri:Math.max(0,(fm.hosp.meniuri||0)-1)})} style={{...sty.bg,padding:"8px 12px",fontSize:16,fontWeight:700}}>−</button>
                    <span style={{fontSize:20,fontWeight:700,minWidth:30,textAlign:"center"}}>{fm.hosp.meniuri??0}</span>
                    <button onClick={()=>u("hosp",{...fm.hosp,meniuri:(fm.hosp.meniuri||0)+1})} style={{...sty.bg,padding:"8px 12px",fontSize:16,fontWeight:700}}>+</button>
                  </div>
                </div>
              </div>

              <div style={{marginBottom:16}}>
                <label style={sty.l}>Protocol custom (opțional — înlocuiește textul standard)</label>
                <textarea value={fm.hosp.protocolOverride||""} onChange={e=>u("hosp",{...fm.hosp,protocolOverride:e.target.value})} style={{...iStyle,minHeight:80,resize:"vertical",fontSize:12}} placeholder="Lasă gol pentru formatul standard din model. Dacă completezi, acest text înlocuiește meniurile, prânzul și micul dejun."/>
              </div>
              <div style={{display:"flex",flexDirection:"column",gap:6,marginBottom:16}}>
                {[
                  {k:"micDejun",l:"Mic dejun inclus"},
                  {k:"pranz",l:"Masă de prânz după instalare"},
                ].map(item=>(
                  <div key={item.k} onClick={()=>u("hosp",{...fm.hosp,[item.k]:!fm.hosp[item.k]})}
                    style={{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",borderRadius:8,background:fm.hosp[item.k]?th.ab:th.h,cursor:"pointer",border:`1px solid ${fm.hosp[item.k]?th.a:th.b}`}}>
                    <div style={{width:18,height:18,borderRadius:4,border:`2px solid ${fm.hosp[item.k]?th.a:th.b}`,background:fm.hosp[item.k]?th.a:"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                      {fm.hosp[item.k]&&<IcCheck s={10}/>}
                    </div>
                    <span style={{fontSize:13,fontWeight:500}}>{item.l}</span>
                  </div>
                ))}
              </div>

              <div>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                  <label style={sty.l}>Extra ospitalitate</label>
                  <button onClick={()=>u("hosp",{...fm.hosp,extra:[...fm.hosp.extra,{id:uid(),l:""}]})} style={{...sty.bg,fontSize:10,padding:"3px 8px"}}><IcPlus s={11}/> Adaugă</button>
                </div>
                {fm.hosp.extra.map((e,i)=>(
                  <div key={e.id} style={{display:"flex",gap:6,marginBottom:6,alignItems:"center"}}>
                    <input value={e.l} onChange={ev=>{const ex=[...(fm.hosp.extra||[])];ex[i]={...ex[i],l:ev.target.value};u("hosp",{...fm.hosp,extra:ex});}} style={{...iStyle,flex:1,fontSize:12}} placeholder="Ex: Apă minerală pe scenă..."/>
                    <button onClick={()=>u("hosp",{...fm.hosp,extra:(fm.hosp.extra||[]).filter((_,j)=>j!==i)})} style={{padding:3,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>✕</button>
                  </div>
                ))}
              </div>
            </div>}

            {secTab==="tehnic"&&<div style={{background:"#fff",borderRadius:12,padding:"20px",fontSize:13,lineHeight:1.8,color:"#222"}}>
              {isP&&["Corporate","Private Party","Altele"].includes(fm.type)&&<div onClick={()=>u("includeTehnicAnnex",!fm.includeTehnicAnnex)} style={{display:"flex",alignItems:"center",gap:10,padding:"12px 14px",marginBottom:16,background:fm.includeTehnicAnnex?"#fef9c3":"#f5f5f5",borderRadius:8,border:`2px solid ${fm.includeTehnicAnnex?"#f59e0b":"#e0e0e0"}`,cursor:"pointer"}}>
                <div style={{width:18,height:18,borderRadius:4,border:"2px solid #f59e0b",background:fm.includeTehnicAnnex?"#f59e0b":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,color:"#fff",fontSize:12,fontWeight:700}}>{fm.includeTehnicAnnex?"✓":""}</div>
                <span style={{fontWeight:600,fontSize:12}}>Include necesar tehnic ca anexă în ofertă</span>
              </div>}
              <div style={{textAlign:"center",marginBottom:24}}>
                <img src={LOGO_B64} alt="PHASER" style={{height:32,display:"block",margin:"0 auto 12px",filter:"invert(1)"}}/>
                <div style={{fontWeight:700,fontSize:15,letterSpacing:2,textTransform:"uppercase"}}>Rider Tehnic</div>
                <div style={{fontSize:11,color:"#888",marginTop:6}}>
                  Radu Racz +40 744 771 488 · Carina Dumitru · Arnold Birta · Sebastian Bârzeianu · Lucian Oprișan<br/>
                  FOH: Bogdan Racz +40 745 602 161
                </div>
              </div>

              {[
                {title:"SISTEM DE SUNET", content:`Sistemul de sunet trebuie să fie dimensionat corespunzător pentru a acoperi necesitățile spațiului în care se desfășoară concertul astfel încât calitatea sunetului să nu fie compromisă.

Organizatorul are obligația de a furniza un sistem de sunet de înaltă calitate și un inginer de sistem care să cunoască detaliile tehnice și de operare ale acestuia.`},
                {title:"MONITORIZARE", content:"5 monitoare conform planului de amplasament specificat."},
                {title:"PROBE DE SUNET", content:"Trupa are nevoie de 60 de minute pentru amplasarea echipamentelor pe scenă și de 60 de minute pentru probele de sunet."},
                {title:"SISTEM DE LUMINI", content:"Sistemul de lumini trebuie să fie unul profesional, de bună calitate, potrivit pentru spațiul în care se desfășoară evenimentul. Trupa nu are propriul luminist, astfel încât este necesară prezența unui luminist care să cunoască detaliile tehnice și de operare ale sistemului."},
                {title:"VIDEO", content:`În cazul în care există un sistem video la scenă (ecran LED, videoproiector, etc.), pentru partea de visuals vă rugăm să descărcați logo-ul trupei de pe:
https://www.phaser.ro/wp-content/uploads/2022/07/LOGO-Phaser-white.png`},
                {title:"BACKLINE / FOH", content:`Trupa are propriul backline și propriul mixer. Toate echipamentele trupei vor fi folosite exclusiv de membrii trupei.

Necesar:
• 1 cablu UTP (CAT5/CAT6) de la scenă la FOH
• 1 riser mobil cu dimensiunea 3×2×0.40m (pentru setul de tobe)
• 2 stative de microfon tip boom

Vom furniza 3 mix-uri separate din Stage Box-ul poziționat pe scenă:
– Left/Right mix (AES/EBU sau Analog - XLR)
– Sub mix (AES/EBU sau Analog - XLR)
– Monitor mix (Analog - XLR)`},
                {title:"ECHIPAMENTE", content:"Pentru descărcarea echipamentelor la sosirea trupei, respectiv eliberarea scenei și încărcarea echipamentelor după concert, este necesară prezența a două persoane care să ajute membrii trupei pentru o desfășurare eficientă și rapidă a acestor acțiuni."},
                {title:"PARCARE", content:"Vă rugăm să oferiți un loc de parcare pentru microbuzul trupei în imediată apropiere a scenei. Locul de parcare ar trebui să fie disponibil de la sosirea pentru probele de sunet și până după încheierea concertului."},
                {title:"SECURITATE", content:"Organizatorul are obligația de a asigura securitatea artiștilor și a echipamentelor pe toată durata evenimentului. Vă rugăm să oferiți un spațiu în imediată apropiere a scenei destinat depozitării în siguranță a case-urilor și huselor."},
              ].map((s,i)=>(
                <div key={i} style={{marginBottom:20,paddingBottom:20,borderBottom:i<8?"1px solid #eee":"none"}}>
                  <div style={{fontWeight:700,fontSize:11,letterSpacing:2,textTransform:"uppercase",marginBottom:8,color:"#111"}}>{s.title}</div>
                  <div style={{whiteSpace:"pre-line",color:"#444",fontSize:13}}>{s.content}</div>
                </div>
              ))}

              <div style={{textAlign:"center",paddingTop:8,fontSize:11,color:"#bbb",letterSpacing:1}}>
                www.phaser.ro · contact@phaser.ro
              </div>
            </div>}

{secTab==="media"&&<div>
              <div style={{fontSize:11,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:th.tm,marginBottom:12}}>Videoclipuri ({fm.videos.filter(v=>v.checked).length} active)</div>
              <button onClick={()=>u("videos",[...fm.videos,{id:uid(),title:"",url:"",checked:true}])} style={{...sty.bg,fontSize:11,padding:"5px 10px",marginBottom:10}}><IcPlus s={11}/> Adaugă videoclip</button>
              {fm.videos.map(v=>(
                <div key={v.id} style={{borderRadius:10,overflow:"hidden",border:`1px solid ${th.b}`,opacity:v.checked?1:0.5,marginBottom:8}}>
                  <div style={{display:"flex",alignItems:"center",gap:8,padding:"8px 12px",background:th.h,flexWrap:"wrap"}}>
                    <input type="checkbox" checked={v.checked} onChange={()=>u("videos",fm.videos.map(x=>x.id===v.id?{...x,checked:!x.checked}:x))} style={{accentColor:th.t,width:14,height:14,cursor:"pointer",flexShrink:0}}/>
                    <input value={v.title} onChange={e=>u("videos",fm.videos.map(x=>x.id===v.id?{...x,title:e.target.value}:x))} style={{...iStyle,flex:1,minWidth:0,padding:"4px 8px",fontSize:12}} placeholder="Titlu"/>
                    <input value={v.url} onChange={e=>u("videos",fm.videos.map(x=>x.id===v.id?{...x,url:e.target.value}:x))} style={{...iStyle,flex:1,minWidth:0,padding:"4px 8px",fontSize:11}} placeholder="URL YouTube embed"/>
                    <button onClick={()=>u("videos",fm.videos.filter(x=>x.id!==v.id))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>✕</button>
                  </div>
                  {v.checked&&v.url&&<div style={{position:"relative",paddingBottom:"56.25%",height:0}}>
                    <iframe src={v.url} title={v.title} style={{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}} allowFullScreen/>
                  </div>}
                </div>
              ))}
            </div>}

{secTab==="playlist"&&<div>
              <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}>
                <IcDisc s={14}/>
                <span style={{fontSize:11,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:th.tm}}>Playlist</span>
                <span style={{fontSize:11,color:th.tm}}>{fm.covers.filter(c=>c.checked).length} / {fm.covers.length} piese</span>
              </div>
              <div style={{position:"relative",marginBottom:8}}>
                <input value={playlistSearch} onChange={e=>setPlaylistSearch(e.target.value)} placeholder="Caută piesă sau artist..." style={{width:"100%",padding:"8px 10px 8px 32px",borderRadius:7,border:`1px solid ${th.b}`,background:th.h,color:th.t,fontSize:12,outline:"none",boxSizing:"border-box"}}/>
                <span style={{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:th.tm,pointerEvents:"none"}}><IcSearch s={12}/></span>
              </div>
              <div style={{display:"flex",gap:5,marginBottom:10}}>
                <button onClick={()=>u("covers",fm.covers.map(c=>({...c,checked:true})))} style={{...sty.bg,fontSize:10,padding:"4px 10px"}}>Tot</button>
                <button onClick={()=>u("covers",fm.covers.map(c=>({...c,checked:false})))} style={{...sty.bg,fontSize:10,padding:"4px 10px"}}>Nimic</button>
                <button onClick={()=>u("covers",[...fm.covers,{id:uid(),title:"",artist:"",checked:true}])} style={{...sty.bg,fontSize:10,padding:"4px 10px"}}><IcPlus s={10}/> Adaugă</button>
              </div>
              <div style={{display:"flex",flexDirection:"column",gap:2,maxHeight:320,overflow:"auto"}}>
                {fm.covers.filter(c=>!playlistSearch||c.title.toLowerCase().includes(playlistSearch.toLowerCase())||(c.artist||"").toLowerCase().includes(playlistSearch.toLowerCase())).map(c=>(
                  <div key={c.id} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:6,border:`1px solid ${c.checked?th.a:th.b}`,background:c.checked?th.ab:th.h}}>
                    <input type="checkbox" checked={c.checked} onChange={()=>u("covers",fm.covers.map(x=>x.id===c.id?{...x,checked:!x.checked}:x))} style={{accentColor:th.t,width:14,height:14,cursor:"pointer",flexShrink:0}}/>
                    <input value={c.title} onChange={e=>u("covers",fm.covers.map(x=>x.id===c.id?{...x,title:e.target.value}:x))} style={{...iStyle,flex:1,minWidth:0,padding:"4px 8px",fontSize:11}} placeholder="Piesă"/>
                    <input value={c.artist||""} onChange={e=>u("covers",fm.covers.map(x=>x.id===c.id?{...x,artist:e.target.value}:x))} style={{...iStyle,width:120,padding:"4px 8px",fontSize:11}} placeholder="Artist"/>
                    <button onClick={()=>u("covers",fm.covers.filter(x=>x.id!==c.id))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer",flexShrink:0}}>✕</button>
                  </div>
                ))}
              </div>
            </div>}

{secTab==="note"&&<div>
              <label style={sty.l}>Note interne / Cerințe speciale</label>
              <textarea value={fm.notes} onChange={e=>u("notes",e.target.value)} style={{...iStyle,minHeight:120,resize:"vertical"}} placeholder="Obs. interne, repertoriu, cerințe speciale..."/>
            </div>}

          </div>

          <div style={{padding:"12px 20px",borderTop:`1px solid ${th.b}`,display:"flex",justifyContent:"space-between",alignItems:"center",gap:6,flexShrink:0,flexWrap:"wrap"}}>
            <button onClick={onClose} style={sty.bg}>Anulează</button>
            <button onClick={()=>{
              const title = fm.cn ? (isP?`${fm.type} ${fm.cn}`:`${fm.type} - ${fm.cn}`) : "Eveniment nou";
              onSave({...fm, title, date: fm.date||"2026-06-15"});
            }} style={sty.b}>{isE?"Salvează":"Creează ofertă"}</button>
          </div>
        </div>
      </div>
    </div>
  );
}

// ═══ MAIN APP ═══
function App() {
  const [theme, setTheme] = useState(gTheme());
  const [user, setUser]   = useState(null);
  const [sbMode, setSbMode] = useState("full");
  const [tab, setTab]     = useState("acasa");
  const [evs, setEvs]     = useState(INIT_EV);
  const [genExp, setGE]   = useState(INIT_GE);
  const [tasks, setTasks] = useState(INIT_TASKS);
  const [templates, setTemplates] = useState(loadTemplates);
  const [modal, setMod]   = useState(null);
  const [mData, setMD]    = useState(null);
  const [search, setSearch] = useState("");
  const [calM, setCalM]   = useState(new Date());
  const [calSidebarDate, setCalSidebarDate] = useState(null);
  const [calDragEvId, setCalDragEvId] = useState(null);
  const [calDropDate, setCalDropDate] = useState(null);
  const [dashboardDateSearch, setDashboardDateSearch] = useState("");
  const [globalSearch, setGlobalSearch] = useState("");
  const [sectTab, setSectTab] = useState("playlist");
  const [riderVersions, setRiderVersions] = useState(loadRiderVersions);
  const [toast, setToast] = useState({visible:false,message:""});
  const mob = useIsMobile();
  const th  = TH[theme];
  const p   = user ? PM[user.rl] : {};

  const showToast = msg => { setToast({visible:true,message:msg}); setTimeout(()=>setToast({visible:false,message:""}),2500); };

  useEffect(()=>{ if(mob && sbMode==="full") setSbMode("mini"); },[mob]);
  useEffect(()=>{
    const mq=window.matchMedia("(prefers-color-scheme: dark)");
    const h=e=>setTheme(e.matches?"dark":"light");
    mq.addEventListener("change",h); return ()=>mq.removeEventListener("change",h);
  },[]);

  const stats = useMemo(()=>{
    const sg = evs.filter(e=>e.st==="confirmat");
    const rev = sg.reduce((s,e)=>s+(e.fee||0)+Object.entries(e.svcp||{}).reduce((a,[k,v])=>a+(e.svc?.[k]?v:0),0),0);
    const exp = sg.reduce((s,e)=>s+(e.ex||[]).reduce((a,x)=>a+x.a,0),0);
    const ge  = genExp.reduce((s,e)=>s+e.a,0);
    const pipe= evs.filter(e=>["oferta","asteptare"].includes(e.st)).reduce((s,e)=>s+(e.fee||0),0);
    const pd  = sg.filter(e=>!e.dp).reduce((s,e)=>s+(e.dep||0),0);
    return {rev,exp,ge,net:rev-exp-ge,pipe,pd,sc:sg.length,tc:evs.length};
  },[evs,genExp]);

  const repStr = (d) => {
    if (!d) return "";
    const rd = d.repDurs&&d.repDurs.length>0 ? d.repDurs : Array(d.rep||1).fill(d.repDur||45);
    const n = rd.length;
    const same = rd.every(x=>x===rd[0]);
    return same ? `${n} ${n===1?"repriză":"reprize"} × ${rd[0]} min` : rd.map((x,i)=>`R${i+1}: ${x}min`).join(" · ");
  };
  const saveEv = data => {
    const isEdit = !!(mData&&mData.id);
    const tplPlaylist = (templates.playlist&&templates.playlist.length>0) ? templates.playlist : DEFAULT_COVERS;
    const merged = {...(isEdit?mData:{}),...data};
    const rs = repStr(merged);
    if(isEdit) {
      setEvs(p=>p.map(e=>e.id===mData.id?{...mData,...data,offerNr:e.offerNr??mData.offerNr}:e));
      setMod(null); setMD(null); showToast(rs ? `Actualizat! ${rs}` : "Eveniment actualizat!");
    } else {
      const nextNr = Math.max(0, ...evs.map(e=>e.offerNr||0)) + 1;
      const nev = {...data, id:uid(), cr:new Date().toISOString().split("T")[0], videos:data.videos||DEFAULT_VIDEOS, covers:data.covers||tplPlaylist, offerNr:nextNr};
      setEvs(p=>[...p,nev]); setMD(nev); setMod("oferta");
      showToast(rs ? `Ofertă creată! ${rs}` : "Ofertă creată!");
    }
  };

  const delEv = id => { setEvs(p=>p.filter(e=>e.id!==id)); setMod(null); setMD(null); };
  const moveEvToDate = (evId, newDate) => { setEvs(p=>p.map(e=>e.id===evId?{...e,date:newDate}:e)); if(mData?.id===evId) setMD(prev=>prev?{...prev,date:newDate}:prev); showToast("Data actualizată"); };
  
  // updSt: actualizează în state + dacă suntem în modal "oferta" actualizează și mData
  const updSt = (id, st) => {
    setEvs(p=>p.map(e=>e.id===id?{...e,st}:e));
    if(mData&&mData.id===id) setMD(prev=>({...prev,st}));
    showToast(`Status: ${ST[st]?.l}`);
  };
  
  const om = (t,d) => { setMod(t); setMD(d); };
  const cm = () => { setMod(null); setMD(null); };

  const saveTemplates = (upd) => {
    const next = typeof upd==="function" ? upd(templates) : {...templates,...upd};
    setTemplates(next);
    try { localStorage.setItem("phaser_templates", JSON.stringify(next)); } catch(e) {}
  };
  const addRiderCustomField = () => {
    const t = prompt("Titlu câmp nou:");
    if (t) {
      saveTemplates(tpl=>({...tpl,riderCustom:[...(tpl.riderCustom||[]),{id:uid(),titlu:t,text:""}]}));
      showToast("Câmp adăugat și salvat");
    }
  };
  const saveRiderToStorage = (asNewVersion) => {
    try {
      const label = asNewVersion ? (prompt("Nume versiune (ex: Festival 2025):") || "Versiune " + new Date().toLocaleDateString("ro")) : null;
      const riderData = { riderContent: templates.riderContent, riderCustom: templates.riderCustom, riderStagePlot: templates.riderStagePlot || { image: null, notes: "" } };
      if (asNewVersion) {
        const versions = loadRiderVersions();
        const newVer = { id: uid(), ts: Date.now(), label, data: riderData };
        const updated = [newVer, ...versions].slice(0, 20);
        localStorage.setItem("phaser_rider_versions", JSON.stringify(updated));
        setRiderVersions(updated);
      }
      localStorage.setItem("phaser_templates", JSON.stringify(templates));
      showToast(asNewVersion ? `Versiune "${label}" salvată` : "Rider salvat");
    } catch(e) {}
  };
  const restoreRiderVersion = (ver) => {
    if (!ver?.data) return;
    setTemplates(t => ({ ...t, riderContent: ver.data.riderContent || {}, riderCustom: ver.data.riderCustom || [], riderStagePlot: ver.data.riderStagePlot || { image: null, notes: "" } }));
    showToast(`Restaurat: ${ver.label}`);
  };

  const sty = {
    i:  {width:"100%",padding:"10px 12px",borderRadius:7,border:`1px solid ${th.b}`,background:th.i,color:th.t,fontSize:14,fontFamily:"inherit"},
    l:  {fontSize:10,color:th.tm,marginBottom:3,display:"block",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px"},
    b:  {padding:"8px 16px",borderRadius:7,border:"none",background:th.a,color:th.bg,fontWeight:600,fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",gap:6},
    bg: {padding:"8px 16px",borderRadius:7,border:`1px solid ${th.b}`,background:"transparent",color:th.ts,fontWeight:500,fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",gap:6},
    cd: {background:th.c,border:`1px solid ${th.b}`,borderRadius:10,padding:16}
  };

  const getSvcTotal = ev => Object.entries(ev.svcp||{}).reduce((s,[k,v])=>s+(ev.svc?.[k]?v:0),0);
  const getExpTotal = ev => (ev.ex||[]).reduce((s,x)=>s+x.a,0);
  const pendingCount = evs.filter(e=>["oferta","asteptare"].includes(e.st)).length;
  const activeTaskCount = tasks.filter(t=>!t.done).length;

  const MONTHS_RO = {ianuarie:1,februarie:2,martie:3,aprilie:4,mai:5,iunie:6,iulie:7,august:8,septembrie:9,octombrie:10,noiembrie:11,decembrie:12};
  const globalSearchResults = useMemo(()=>{
    const q = (globalSearch||"").trim().toLowerCase();
    if(!q) return {evs:[],tasks:[]};
    let qDate = q.replace(/\./g,"-").replace(/(\d{1,2})-(\d{1,2})-(\d{4})/,(_,d,m,y)=>`${y}-${m.padStart(2,"0")}-${d.padStart(2,"0")}`);
    const now = new Date();
    const y = now.getFullYear();
    for (const [name, num] of Object.entries(MONTHS_RO)) {
      if (q.includes(name)) {
        const dMatch = q.match(/\b(\d{1,2})\b/);
        const day = dMatch ? parseInt(dMatch[1],10) : null;
        if (day!=null&&day>=1&&day<=31) qDate = `${y}-${String(num).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
        else qDate = `${y}-${String(num).padStart(2,"0")}`;
        break;
      }
    }
    const evMatches = evs.filter(e=>{
      if([e.cn,e.type,e.venue,e.city,e.notes,e.desc,e.title].some(f=>String(f||"").toLowerCase().includes(q))) return true;
      if(e.date&&(e.date.includes(q)||e.date.includes(qDate)||fD(e.date).toLowerCase().includes(q))) return true;
      if(e.date) for (const [name, num] of Object.entries(MONTHS_RO)) if (q.includes(name) && e.date.startsWith(`${y}-${String(num).padStart(2,"0")}`)) return true;
      return false;
    });
    const taskMatchesSearch = t=>{ if((t.text||"").toLowerCase().includes(q)) return true; if((t.notes||"").toLowerCase().includes(q)) return true; if((t.tags||[]).some(tag=>tag.toLowerCase().includes(q))) return true; if((t.subtasks||[]).some(s=>taskMatchesSearch(s))) return true; return false; };
    const taskMatches = tasks.filter(taskMatchesSearch);
    return {evs:evMatches.slice(0,8),tasks:taskMatches.slice(0,6)};
  },[globalSearch,evs,tasks]);

  const navItems = [
    {id:"acasa",    Ic:IcDash,  l:"Acasă"},
    {id:"events",   Ic:IcMusic, l:"Evenimente"},
    {id:"offers",   Ic:IcSend,  l:"Oferte",  badge:pendingCount},
    {id:"docs", Ic:IcFile, l:"Docs"},
    {id:"tasks",    Ic:IcTask,  l:"Tasks",    badge:activeTaskCount},
    {id:"calendar", Ic:IcCal,   l:"Calendar"},
    ...(p.f?[{id:"finances", Ic:IcMoney, l:"Finanțe"}]:[]),
  ];

  const sbW = sbMode==="full"?220:56;

  // Swipe refs — must be before any early return
  const appTouchStart = useRef(null);
  const appTouchStartY = useRef(null);

  const handleAppTouchStart = (e) => {
    appTouchStart.current = e.touches[0].clientX;
    appTouchStartY.current = e.touches[0].clientY;
  };

  const handleAppTouchEnd = (e) => {
    if(appTouchStart.current === null) return;
    const startX = appTouchStart.current;
    const dx = e.changedTouches[0].clientX - startX;
    const dy = Math.abs(e.changedTouches[0].clientY - appTouchStartY.current);
    appTouchStart.current = null;
    if(Math.abs(dx) < 50 || Math.abs(dx) < dy * 1.5) return;
    if(dx > 0 && startX < 80 && sbMode === "mini") { setSbMode("full"); return; }
    if(dx < 0 && sbMode === "full") { setSbMode("mini"); return; }
    if(modal || sbMode === "full") return;
    const allNav = ["acasa","events","offers","docs","tasks","calendar",
      ...(p.f?["finances"]:[])
    ];
    const i = allNav.indexOf(tab);
    if(dx < 0 && i < allNav.length - 1) setTab(allNav[i + 1]);
    if(dx > 0 && i > 0) setTab(allNav[i - 1]);
  };

  if(!user) return (
    <div style={{minHeight:"100vh",fontFamily:"'Inter',system-ui,sans-serif",background:"#0c0c0c",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 28px",gap:24}}>
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0;padding:0}@keyframes up{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}`}</style>

      {/* Logo — direct, fara card */}
      <div style={{animation:"up .5s ease",textAlign:"center"}}>
        <img src={LOGO_B64} alt="PHASER" style={{width:220,display:"block",margin:"0 auto"}}/>
        <div style={{fontSize:9,color:"#3a3a3a",letterSpacing:4,textTransform:"uppercase",marginTop:16,fontWeight:400}}>Band Manager</div>
      </div>

      {/* Separator */}
      <div style={{width:40,height:1,background:"#222"}}/>

      {/* Selector profil */}
      <div style={{animation:"up .5s ease .1s both",width:"100%",maxWidth:320}}>
        <div style={{fontSize:9,color:"#3a3a3a",letterSpacing:3,textTransform:"uppercase",textAlign:"center",marginBottom:16}}>Alege profilul</div>
        <div style={{display:"flex",flexDirection:"column",gap:8}}>
          {USERS.map(u=>(
            <button key={u.id} onClick={()=>setUser(u)} style={{
              width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",
              padding:"14px 20px",
              background:"#161616",
              color:"#fff",cursor:"pointer",fontFamily:"inherit",
              border:"1px solid #222",
              borderRadius:12,
              transition:"background .15s, border-color .15s"
            }}
            onMouseOver={e=>{e.currentTarget.style.background="#1e1e1e";e.currentTarget.style.borderColor="#333"}}
            onMouseOut={e=>{e.currentTarget.style.background="#161616";e.currentTarget.style.borderColor="#222"}}
            >
              <span style={{fontWeight:600,fontSize:15}}>{u.n}</span>
              <span style={{fontSize:9,color:"#404040",textTransform:"uppercase",letterSpacing:2}}>{u.rl}</span>
            </button>
          ))}
        </div>
      </div>
    </div>
  );

  // Evenimentele împărțite pt. tab "events" — Viitoare / Trecute
  const now = new Date();
  const viitoare = evs.filter(e=>e.st==="confirmat"&&new Date(e.date+"T00:00:00")>=now).sort((a,b)=>new Date(a.date)-new Date(b.date));
  const trecute  = evs.filter(e=>e.st==="confirmat"&&new Date(e.date+"T00:00:00")<now).sort((a,b)=>new Date(b.date)-new Date(a.date));
  // Toate evenimentele (inclusiv oferte) pentru search
  const allEvsSorted = [...evs].sort((a,b)=>new Date(a.date)-new Date(b.date));
  const fEvs = search ? allEvsSorted.filter(e=>[e.title,e.cn,e.venue,e.city].some(f=>f?.toLowerCase().includes(search.toLowerCase()))) : allEvsSorted;

  return (
    <div
      style={{display:"flex",height:"100vh",fontFamily:"'Inter',system-ui,sans-serif",background:th.bg,color:th.t,overflow:"hidden"}}
      onTouchStart={handleAppTouchStart}
      onTouchEnd={handleAppTouchEnd}
    >
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0;padding:0}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:${th.b};border-radius:3px}input,select,textarea{font-family:inherit}input:focus,select:focus,textarea:focus{outline:none;border-color:${th.tm}!important}select.modernSel{appearance:none;-webkit-appearance:none;-moz-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23888' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px;cursor:pointer;border-radius:8px;border:1px solid ${th.b};background-color:${th.i};color:${th.t};font-size:13px;transition:border-color .15s,box-shadow .15s}select.modernSel:hover{border-color:${th.tm}}select.modernSel:focus{box-shadow:0 0 0 2px ${th.ab}}@keyframes su{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}button:hover{opacity:.85}table{border-collapse:collapse}`}</style>

      {/* SIDEBAR — fundal întunecat mereu, logo alb */}
      <div style={{width:sbW,background:"#0a0a0c",borderRight:"1px solid #1a1a1a",display:"flex",flexDirection:"column",flexShrink:0,transition:"width .25s ease",overflow:"hidden"}}>
        <div style={{padding:sbMode==="full"?"16px 16px":"16px 10px",borderBottom:"1px solid #1a1a1a",display:"flex",alignItems:"center",justifyContent:"space-between",minHeight:62}}>
          {sbMode==="full"&&<Logo height={28}/>}
          {sbMode==="mini"&&<div style={{margin:"0 auto"}}><Logo height={22}/></div>}
          <button onClick={()=>setSbMode(sbMode==="full"?"mini":"full")} style={{padding:3,border:"none",background:"transparent",color:"#555",cursor:"pointer",flexShrink:0}}>
            {sbMode==="full"?<IcChevL s={14}/>:<IcChevR s={14}/>}
          </button>
        </div>



        <nav style={{flex:1,padding:"8px 6px",display:"flex",flexDirection:"column",gap:1}}>
          {navItems.map(it=><button key={it.id} onClick={()=>{ setTab(it.id); if(mob) setSbMode("mini"); }} title={sbMode==="mini"?it.l:undefined}
            style={{display:"flex",alignItems:"center",gap:9,padding:sbMode==="full"?"8px 10px":"8px 0",justifyContent:sbMode==="mini"?"center":"flex-start",borderRadius:7,border:"none",cursor:"pointer",fontSize:12,fontWeight:tab===it.id?700:400,background:tab===it.id?"rgba(255,255,255,.1)":"transparent",color:tab===it.id?"#fff":"#888",transition:"all .15s",whiteSpace:"nowrap",position:"relative"}}>
            <it.Ic s={16}/>
            {sbMode==="full"&&<><span style={{flex:1,textAlign:"left"}}>{it.l}</span>{it.badge>0&&<span style={{background:"#f59e0b",color:"#000",borderRadius:10,fontSize:9,fontWeight:700,padding:"1px 6px"}}>{it.badge}</span>}</>}
            {sbMode==="mini"&&it.badge>0&&<span style={{position:"absolute",top:4,right:4,width:7,height:7,borderRadius:"50%",background:"#f59e0b"}}/>}
          </button>)}
        </nav>

        <div style={{padding:"10px 6px",borderTop:"1px solid #1a1a1a"}}>
          <button onClick={()=>setUser(null)} style={{display:"flex",alignItems:"center",gap:6,padding:sbMode==="full"?"6px 10px":"6px 0",justifyContent:sbMode==="mini"?"center":"flex-start",borderRadius:6,border:"none",background:"transparent",color:"#555",fontSize:11,cursor:"pointer",width:"100%"}}>
            <IcOut s={14}/>{sbMode==="full"&&<span>{user.n} · <span style={{textTransform:"uppercase",fontSize:9,letterSpacing:1}}>{user.rl}</span></span>}
          </button>
        </div>
      </div>

      {/* MAIN */}
      <div style={{flex:1,overflow:"auto",display:"flex",flexDirection:"column"}}>


        <div style={{flex:1,minHeight:0,overflow:"auto",padding:mob?"14px 12px":"22px 26px"}}>

          {/* GLOBAL SEARCH — mereu vizibil */}
          <div style={{position:"relative",marginBottom:16,maxWidth:400}}>
            <span style={{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:th.tm,pointerEvents:"none"}}><IcSearch s={16}/></span>
            <input value={globalSearch} onChange={e=>setGlobalSearch(e.target.value)} placeholder="Caută în toată aplicația..." style={{...sty.i,width:"100%",paddingLeft:38,paddingRight:12,paddingTop:10,paddingBottom:10,fontSize:14,borderRadius:10}}/>
            {globalSearch.trim()&&<button onClick={()=>setGlobalSearch("")} style={{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",padding:4,border:"none",background:"transparent",color:th.tm,cursor:"pointer",fontSize:18}}>×</button>}
            {globalSearch.trim()&&(globalSearchResults.evs.length>0||globalSearchResults.tasks.length>0)&&<div style={{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:th.c,borderRadius:10,border:`1px solid ${th.b}`,boxShadow:"0 8px 24px rgba(0,0,0,.15)",zIndex:200,maxHeight:360,overflow:"auto"}}>
              {globalSearchResults.evs.length>0&&<div style={{padding:"8px 12px",fontSize:10,color:th.tm,fontWeight:700,textTransform:"uppercase",letterSpacing:1}}>Oferte / Evenimente</div>}
              {globalSearchResults.evs.map(ev=><div key={ev.id} onClick={()=>{setGlobalSearch("");om("detail",ev);}} style={{padding:"10px 14px",cursor:"pointer",borderBottom:`1px solid ${th.bl}`,display:"flex",justifyContent:"space-between",alignItems:"center"}} onMouseOver={e=>e.currentTarget.style.background=th.h} onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                <div><div style={{fontSize:13,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div><div style={{fontSize:11,color:th.tm}}>{fD(ev.date)} · {ev.venue}</div></div>
                <div onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={updSt}/></div>
              </div>)}
              {globalSearchResults.tasks.length>0&&<div style={{padding:"8px 12px",fontSize:10,color:th.tm,fontWeight:700,textTransform:"uppercase",letterSpacing:1}}>Tasks</div>}
              {globalSearchResults.tasks.map(t=><div key={t.id} onClick={()=>{setGlobalSearch("");setTab("tasks");}} style={{padding:"10px 14px",cursor:"pointer",borderBottom:`1px solid ${th.bl}`}} onMouseOver={e=>e.currentTarget.style.background=th.h} onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                <div style={{fontSize:13,fontWeight:600}}>{t.text}</div>
                <div style={{fontSize:11,color:th.tm}}>{(t.tags||[]).slice(0,3).map(tg=>"#"+tg).join(" ")}{t.due?" · "+fD(t.due):""}</div>
              </div>)}
            </div>}
            {globalSearch.trim()&&globalSearchResults.evs.length===0&&globalSearchResults.tasks.length===0&&<div style={{position:"absolute",top:"100%",left:0,right:0,marginTop:4,padding:16,background:th.c,borderRadius:10,border:`1px solid ${th.b}`,boxShadow:"0 8px 24px rgba(0,0,0,.15)",zIndex:200,fontSize:13,color:th.tm}}>Niciun rezultat</div>}
          </div>

          {/* ACASĂ */}
          {tab==="acasa"&&<div style={{animation:"su .3s ease"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:20,flexWrap:"wrap",gap:12}}>
              <div>
                <h1 style={{fontSize:22,fontWeight:700,letterSpacing:"-0.5px"}}>Acasă</h1>
                <p style={{color:th.tm,fontSize:12,marginTop:2}}>Bun venit, {user.n}!</p>
              </div>
              <div style={{display:"flex",alignItems:"center",gap:8}}>
                <div style={{display:"flex",alignItems:"center",gap:6}}>
                  <IcCal s={16} style={{color:th.tm}}/>
                  <input type="date" value={dashboardDateSearch} onChange={e=>setDashboardDateSearch(e.target.value)} style={{...sty.i,padding:"6px 10px",fontSize:12,maxWidth:150}} placeholder="Caută după dată"/>
                </div>
                {p.c&&<button onClick={()=>om("pick",null)} style={sty.b}><IcPlus s={14}/> Ofertă nouă</button>}
              </div>
            </div>

            {dashboardDateSearch&&<div style={{...sty.cd,marginBottom:16}}>
              <div style={{fontSize:13,fontWeight:700,marginBottom:10,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <span>📅 În data {fD(dashboardDateSearch)}</span>
                <button onClick={()=>setDashboardDateSearch("")} style={{fontSize:10,color:th.tm,background:"transparent",border:"none",cursor:"pointer"}}>șterge</button>
              </div>
              {evs.filter(e=>e.date===dashboardDateSearch).length===0&&<div style={{padding:16,textAlign:"center",color:th.tm,fontSize:12}}>Nicio ofertă sau eveniment în această zi</div>}
              {evs.filter(e=>e.date===dashboardDateSearch).map(ev=><div key={ev.id} onClick={()=>om("detail",ev)} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:7,marginBottom:4,cursor:"pointer",borderLeft:"3px solid "+(ST[ev.st]?.c||th.a)}} onMouseOver={e=>e.currentTarget.style.background=th.h} onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                <div><div style={{fontSize:13,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div><div style={{fontSize:11,color:th.tm}}>{ev.venue}{ev.city?", "+ev.city:""}</div></div>
                <Badge s={ev.st} th={th}/>
              </div>)}
              {evs.filter(e=>e.date===dashboardDateSearch).length>0&&<button onClick={()=>{setTab("calendar");setCalM(new Date(dashboardDateSearch));}} style={{...sty.bg,fontSize:11,marginTop:8,width:"100%"}}>Deschide în calendar</button>}
            </div>}

            <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:12,marginBottom:14}}>
              {/* Evenimente viitoare */}
              <div style={sty.cd}>
                <div style={{fontSize:13,fontWeight:700,marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                  <span>🗓 Urmează</span>
                  <button onClick={()=>setTab("events")} style={{fontSize:10,color:th.tm,background:"transparent",border:"none",cursor:"pointer"}}>toate →</button>
                </div>
                {viitoare.slice(0,5).map(ev=>
                  <div key={ev.id} onClick={()=>om("detail",ev)} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:7,marginBottom:3,cursor:"pointer",borderLeft:"3px solid #22c55e"}}
                    onMouseOver={e=>e.currentTarget.style.background=th.h}
                    onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                    <div><div style={{fontSize:12,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div><div style={{fontSize:10,color:th.tm}}>{ev.venue}{ev.city?", "+ev.city:""}</div></div>
                    <div style={{textAlign:"right",flexShrink:0,marginLeft:8}}><div style={{fontSize:11,fontWeight:600}}>{fD(ev.date)}</div><div style={{fontSize:10,color:th.tm}}>în {dU(ev.date)}z</div></div>
                  </div>
                )}
                {viitoare.length===0&&<div style={{padding:20,textAlign:"center",color:th.tm,fontSize:11}}>Niciun eveniment confirmat viitor</div>}
              </div>

              {/* Oferte active */}
              <div style={sty.cd}>
                <div style={{fontSize:13,fontWeight:700,marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                  <span>📤 Oferte active</span>
                  <button onClick={()=>setTab("offers")} style={{fontSize:10,color:th.tm,background:"transparent",border:"none",cursor:"pointer"}}>toate ({pendingCount}) →</button>
                </div>
                {evs.filter(e=>["oferta","asteptare"].includes(e.st)).sort((a,b)=>new Date(a.date)-new Date(b.date)).slice(0,5).map(ev=>
                  <div key={ev.id} onClick={()=>om("detail",ev)} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:7,marginBottom:3,cursor:"pointer"}}
                    onMouseOver={e=>e.currentTarget.style.background=th.h}
                    onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                    <div><div style={{fontSize:12,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div><div style={{fontSize:10,color:th.tm}}>{fD(ev.date)}</div></div>
                    <div onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={(id,st)=>{updSt(id,st);}}/></div>
                  </div>
                )}
                {pendingCount===0&&<div style={{padding:20,textAlign:"center",color:th.tm,fontSize:11}}>Nicio ofertă activă</div>}
              </div>
            </div>

            <div style={sty.cd}>
              <TasksView tasks={tasks} setTasks={setTasks} th={th} sty={sty} mob={mob} compact={true}/>
            </div>
          </div>}

          {/* EVENIMENTE — Viitoare + Trecute, fără filtre status */}
          {tab==="events"&&<div style={{animation:"su .3s ease"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
              <h1 style={{fontSize:22,fontWeight:700,letterSpacing:"-0.5px"}}>Evenimente</h1>
              {p.c&&<button onClick={()=>om("pick",null)} style={sty.b}><IcPlus s={14}/> Ofertă nouă</button>}
            </div>
            {/* Search */}
            <div style={{position:"relative",maxWidth:320,marginBottom:16}}>
              <span style={{position:"absolute",left:9,top:"50%",transform:"translateY(-50%)",color:th.tm}}><IcSearch s={14}/></span>
              <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Caută eveniment..." style={{...sty.i,paddingLeft:30,fontSize:mob?"16px":"14px"}}/>
            </div>
            {search ? (
              <div style={{...sty.cd,padding:0,overflow:"hidden"}}>
                <table style={{width:"100%"}}>
                  <thead><tr style={{borderBottom:`1px solid ${th.b}`}}>
                    {["Client","Dată","Locație","Sumă","Status"].map(h=><th key={h} style={{padding:"9px 12px",textAlign:"left",fontSize:9,color:th.tm,textTransform:"uppercase",letterSpacing:1,fontWeight:600}}>{h}</th>)}
                  </tr></thead>
                  <tbody>{fEvs.map(ev=>
                    <tr key={ev.id} onClick={()=>om("detail",ev)} style={{borderBottom:`1px solid ${th.bl}`,cursor:"pointer"}}
                      onMouseOver={e=>e.currentTarget.style.background=th.h}
                      onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                      <td style={{padding:"9px 12px"}}><div style={{fontSize:12,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div></td>
                      <td style={{padding:"9px 12px",fontSize:11}}>{fD(ev.date)}</td>
                      <td style={{padding:"9px 12px",fontSize:11}}>{ev.venue}{ev.city?", "+ev.city:""}</td>
                      <td style={{padding:"9px 12px",fontSize:12,fontWeight:600}}>{ev.fee?f$(ev.fee):"—"}</td>
                      <td style={{padding:"9px 12px"}} onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={(id,st)=>{updSt(id,st);}}/></td>
                    </tr>
                  )}</tbody>
                </table>
                {fEvs.length===0&&<div style={{padding:30,textAlign:"center",color:th.tm,fontSize:12}}>Niciun rezultat</div>}
              </div>
            ) : <>
              {/* Viitoare */}
              <div style={{fontSize:11,fontWeight:700,color:th.tm,textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Viitoare confirmate ({viitoare.length})</div>
              <div style={{...sty.cd,padding:0,overflow:"hidden",marginBottom:20}}>
                {viitoare.length===0&&<div style={{padding:30,textAlign:"center",color:th.tm,fontSize:12}}>Niciun eveniment confirmat viitor</div>}
                {viitoare.length>0&&<table style={{width:"100%"}}>
                  <tbody>{viitoare.map((ev,i)=>
                    <tr key={ev.id} onClick={()=>om("detail",ev)} style={{borderBottom:i<viitoare.length-1?`1px solid ${th.bl}`:"none",cursor:"pointer"}}
                      onMouseOver={e=>e.currentTarget.style.background=th.h}
                      onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                      <td style={{padding:"10px 14px"}}><div style={{fontSize:13,fontWeight:700}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div><div style={{fontSize:10,color:th.tm}}>{ev.cat==="private"?"ZGV":"PHASER"}</div></td>
                      <td style={{padding:"10px 14px",fontSize:11}}>{fD(ev.date)}<div style={{fontSize:10,color:"#22c55e",fontWeight:600}}>în {dU(ev.date)} zile</div></td>
                      <td style={{padding:"10px 14px",fontSize:11,color:th.tm}}>{ev.venue}{ev.city?", "+ev.city:""}</td>
                      <td style={{padding:"10px 14px",fontSize:13,fontWeight:700}}>{f$(ev.fee)}</td>
                      <td style={{padding:"10px 14px"}} onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={(id,st)=>{updSt(id,st);}}/></td>
                      {p.e&&<td style={{padding:"10px 14px"}} onClick={e=>e.stopPropagation()}><button onClick={()=>om("form",ev)} style={{padding:4,borderRadius:4,border:`1px solid ${th.b}`,background:"transparent",color:th.tm,cursor:"pointer"}}><IcEdit s={13}/></button></td>}
                    </tr>
                  )}</tbody>
                </table>}
              </div>
              {/* Trecute */}
              <div style={{fontSize:11,fontWeight:700,color:th.tm,textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Trecute ({trecute.length})</div>
              <div style={{...sty.cd,padding:0,overflow:"hidden"}}>
                {trecute.length===0&&<div style={{padding:30,textAlign:"center",color:th.tm,fontSize:12}}>Niciun eveniment trecut</div>}
                {trecute.length>0&&<table style={{width:"100%"}}>
                  <tbody>{trecute.map((ev,i)=>
                    <tr key={ev.id} onClick={()=>om("detail",ev)} style={{borderBottom:i<trecute.length-1?`1px solid ${th.bl}`:"none",cursor:"pointer",opacity:.7}}
                      onMouseOver={e=>{e.currentTarget.style.background=th.h;e.currentTarget.style.opacity="1"}}
                      onMouseOut={e=>{e.currentTarget.style.background="transparent";e.currentTarget.style.opacity=".7"}}>
                      <td style={{padding:"10px 14px"}}><div style={{fontSize:13,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div></td>
                      <td style={{padding:"10px 14px",fontSize:11}}>{fD(ev.date)}</td>
                      <td style={{padding:"10px 14px",fontSize:11,color:th.tm}}>{ev.venue}{ev.city?", "+ev.city:""}</td>
                      <td style={{padding:"10px 14px",fontSize:13,fontWeight:700}}>{f$(ev.fee)}</td>
                      <td style={{padding:"10px 14px"}} onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={(id,st)=>{updSt(id,st);}}/></td>
                    </tr>
                  )}</tbody>
                </table>}
              </div>
            </>}
          </div>}

          {/* OFERTE */}
          {tab==="offers"&&<OffersBoard evs={evs} th={th} sty={sty} mob={mob} onSelect={ev=>om("detail",ev)} onAddOffer={p.c?()=>om("pick",null):undefined} onStatusChange={updSt}/>}

          {/* DOCS — Documente, rider, playlist, press kit — template pentru oferte */}
          {tab==="docs"&&<div style={{animation:"su .3s ease"}}>
            <div style={{marginBottom:20}}>
              <h1 style={{fontSize:22,fontWeight:700,letterSpacing:"-0.5px"}}>Docs</h1>
              <p style={{color:th.tm,fontSize:12,marginTop:2}}>Documente, rider, playlist și press kit — template-uri editabile pentru oferte.</p>
            </div>
            <div style={{display:"flex",gap:6,marginBottom:16,flexWrap:"wrap"}}>
              {["rider","playlist","pressKitPrivat","pressKitPublic","poveste"].map(s=>(
                <button key={s} onClick={()=>setSectTab(s)} style={{padding:"6px 14px",borderRadius:7,border:"none",fontSize:12,fontWeight:sectTab===s?700:400,cursor:"pointer",background:sectTab===s?th.ab:"transparent",color:sectTab===s?th.t:th.tm}}>
                  {{rider:"Rider",playlist:"Playlist",pressKitPrivat:"Press Kit Privat",pressKitPublic:"Press Kit Public",poveste:"Poveste"}[s]}
                </button>
              ))}
            </div>
            <div style={sty.cd}>
              {sectTab==="rider"&&<div>
                <label style={sty.l}>Rider Tehnic și Ospitalitate — conținut editabil</label>
                <p style={{fontSize:11,color:th.tm,marginBottom:10}}>Acest conținut este preluat în oferte când rider-ul e inclus.</p>
                {/* Subsecțiune Stage Plot */}
                <div style={{marginBottom:20,padding:16,borderRadius:10,border:`1px solid ${th.b}`,background:th.h}}>
                  <div style={{fontSize:12,fontWeight:700,color:th.t,marginBottom:10,display:"flex",alignItems:"center",gap:8}}>
                    <IcImg s={16}/> Stage Plot
                  </div>
                  <p style={{fontSize:11,color:th.tm,marginBottom:10}}>Plan de amplasament pe scenă — imagine și note. În ofertă se afișează StagePlot.png sau imaginea încărcată.</p>
                  <div style={{marginBottom:12}}>
                    <label style={{...sty.l,fontSize:10}}>Imagine Stage Plot (opțional)</label>
                    <input type="file" accept="image/*" onChange={e=>{const f=e.target.files?.[0];if(f){const r=new FileReader();r.onload=()=>saveTemplates(tpl=>({...tpl,riderStagePlot:{...tpl.riderStagePlot,image:r.result}}));r.readAsDataURL(f);}}} style={{fontSize:11}}/>
                    {(templates.riderStagePlot?.image||"StagePlot.png")&&<div style={{marginTop:8}}>
                      <img src={templates.riderStagePlot?.image||"StagePlot.png"} alt="Stage Plot" style={{maxWidth:"100%",maxHeight:200,objectFit:"contain",borderRadius:8,border:`1px solid ${th.b}`}} onError={e=>{e.target.style.display="none";}}/>
                    </div>}
                  </div>
                  <div>
                    <label style={{...sty.l,fontSize:10}}>Note Stage Plot</label>
                    <textarea value={templates.riderStagePlot?.notes||""} onChange={e=>saveTemplates(tpl=>({...tpl,riderStagePlot:{...tpl.riderStagePlot,notes:e.target.value}}))} placeholder="Ex: Riser tobe 2×3m, monitoare conform plan..." style={{...sty.i,minHeight:60,resize:"vertical",fontSize:12}}/>
                  </div>
                </div>
                <div style={{display:"flex",flexDirection:"column",gap:12}}>
                  {["sunet","scena","probe","lumini","video","instalare","parcare","securitate","backstage","onStage","contact"].map(k=>{
                    const r=RIDER_TEHNIC[k];
                    const val=!r?"":(typeof r==="string"?r:(Array.isArray(r)?r.join("\n"):((r?.text||"")+(r?.req?"\n"+r.req:""))));
                    const cur=templates.riderContent?.[k]??val;
                    return <div key={k}>
                      <label style={{...sty.l,textTransform:"capitalize"}}>{k}</label>
                      <textarea value={cur} onChange={e=>saveTemplates(tpl=>({...tpl,riderContent:{...tpl.riderContent,[k]:e.target.value}}))} style={{...sty.i,minHeight:["backstage","sunet","scena"].includes(k)?100:50,resize:"vertical",fontSize:12}}/>
                    </div>;
                  })}
                  {(templates.riderCustom||[]).map(cf=>(
                    <div key={cf.id} style={{marginTop:12,paddingTop:12,borderTop:`1px solid ${th.b}`}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,marginBottom:4}}>
                        <input value={cf.titlu||""} onChange={e=>saveTemplates(tpl=>({...tpl,riderCustom:(tpl.riderCustom||[]).map(x=>x.id===cf.id?{...x,titlu:e.target.value}:x)}))} placeholder="Titlu câmp" style={{...sty.i,flex:1,padding:"6px 10px",fontSize:12}}/>
                        <button onClick={()=>saveTemplates(tpl=>({...tpl,riderCustom:(tpl.riderCustom||[]).filter(x=>x.id!==cf.id)}))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}><IcTrash s={12}/></button>
                      </div>
                      <textarea value={cf.text||""} onChange={e=>saveTemplates(tpl=>({...tpl,riderCustom:(tpl.riderCustom||[]).map(x=>x.id===cf.id?{...x,text:e.target.value}:x)}))} placeholder="Conținut..." style={{...sty.i,minHeight:50,resize:"vertical",fontSize:12}}/>
                    </div>
                  ))}
                  <div style={{marginTop:12}}>
                    <div style={{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"}}>
                      <button onClick={addRiderCustomField} style={sty.bg}><IcPlus s={12}/> Adaugă câmp custom</button>
                      <button onClick={()=>saveRiderToStorage(false)} style={{...sty.b,padding:"6px 12px",fontSize:12}}>Salvează rider</button>
                      <button onClick={()=>saveRiderToStorage(true)} style={{...sty.bg,padding:"6px 12px",fontSize:12}}>Salvează ca versiune nouă</button>
                      {riderVersions.length>0&&<select onChange={e=>{const v=riderVersions.find(x=>x.id===e.target.value);if(v)restoreRiderVersion(v);e.target.value="";}} style={{...sty.i,padding:"6px 12px",fontSize:12,maxWidth:200}} className="modernSel">
                        <option value="">Versiuni anterioare...</option>
                        {riderVersions.map(v=><option key={v.id} value={v.id}>{v.label} — {new Date(v.ts).toLocaleDateString("ro")}</option>)}
                      </select>}
                    </div>
                  </div>
                </div>
              </div>}
              {sectTab==="playlist"&&<div>
                <label style={sty.l}>Playlist — {((templates.playlist&&templates.playlist.length>0)?templates.playlist:DEFAULT_COVERS).length} piese</label>
                <p style={{fontSize:11,color:th.tm,marginBottom:10}}>Lista pentru oferte private. Download / Share.</p>
                <div style={{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"}}>
                  <button onClick={()=>{const t=prompt("Titlu piesă:");const a=prompt("Artist:");if(t)saveTemplates(tpl=>({...tpl,playlist:[...(tpl.playlist||DEFAULT_COVERS),{id:uid(),title:t,artist:a||"",checked:true}]}));}} style={sty.bg}><IcPlus s={12}/> Adaugă</button>
                  <button onClick={()=>{const pl=(templates.playlist&&templates.playlist.length>0)?templates.playlist:DEFAULT_COVERS; const txt=pl.map((c,i)=>`${i+1}. ${c.title} — ${c.artist}`).join("\n"); const blob=new Blob([txt],{type:"text/plain"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="phaser-playlist.txt"; a.click(); URL.revokeObjectURL(a.href);}} style={sty.bg}>⬇ Download</button>
                  <button onClick={async ()=>{const pl=(templates.playlist&&templates.playlist.length>0)?templates.playlist:DEFAULT_COVERS; const txt=pl.map((c,i)=>`${i+1}. ${c.title} — ${c.artist}`).join("\n"); try{await navigator.clipboard.writeText(txt); if(navigator.share){await navigator.share({title:"PHASER Playlist",text:txt});}}catch(e){try{const ta=document.createElement("textarea");ta.value=txt;ta.style.cssText="position:fixed;opacity:0";document.body.appendChild(ta);ta.select();document.execCommand("copy");document.body.removeChild(ta);}catch(x){}} alert("Playlist copiat! Poți lipi unde vrei.");}} style={sty.bg}>📤 Share / Copiază</button>
                </div>
                <div style={{maxHeight:320,overflow:"auto",display:"flex",flexDirection:"column",gap:2}}>
                  {((templates.playlist&&templates.playlist.length>0)?templates.playlist:DEFAULT_COVERS).map((c,i)=>(
                    <div key={c.id} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:6,border:`1px solid ${th.b}`,background:th.h}}>
                      <span style={{fontSize:10,color:th.tm,minWidth:20}}>{i+1}.</span>
                      <input value={c.title} onChange={e=>saveTemplates(tpl=>({...tpl,playlist:(tpl.playlist||DEFAULT_COVERS).map(x=>x.id===c.id?{...x,title:e.target.value}:x)}))} style={{...sty.i,flex:1,padding:"4px 8px",fontSize:12}}/>
                      <input value={c.artist||""} onChange={e=>saveTemplates(tpl=>({...tpl,playlist:(tpl.playlist||DEFAULT_COVERS).map(x=>x.id===c.id?{...x,artist:e.target.value}:x)}))} style={{...sty.i,width:140,padding:"4px 8px",fontSize:11}} placeholder="Artist"/>
                      <button onClick={()=>saveTemplates(tpl=>({...tpl,playlist:(tpl.playlist||DEFAULT_COVERS).filter(x=>x.id!==c.id)}))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}><IcTrash s={12}/></button>
                    </div>
                  ))}
                </div>
              </div>}
              {sectTab==="pressKitPrivat"&&<div>
                <label style={sty.l}>Press Kit Privat — conținut pentru nunți, botezuri</label>
                <textarea value={templates.pressKitPrivat||""} onChange={e=>saveTemplates({pressKitPrivat:e.target.value})} style={{...sty.i,minHeight:150,resize:"vertical"}} placeholder="Text, link-uri, descriere..."/>
              </div>}
              {sectTab==="pressKitPublic"&&<div>
                <label style={sty.l}>Press Kit Public — conținut pentru festivaluri, concerte</label>
                <textarea value={templates.pressKitPublic||""} onChange={e=>saveTemplates({pressKitPublic:e.target.value})} style={{...sty.i,minHeight:150,resize:"vertical"}} placeholder="Text, link-uri, descriere..."/>
              </div>}
              {sectTab==="poveste"&&<div>
                <label style={sty.l}>Poveste — text în oferta privată</label>
                <textarea value={templates.poveste||""} onChange={e=>saveTemplates({poveste:e.target.value})} style={{...sty.i,minHeight:120,resize:"vertical"}} placeholder="Povestea PHASER..."/>
              </div>}
            </div>
          </div>}

          {/* TASKS */}
          {tab==="tasks"&&<div style={{animation:"su .3s ease"}}>
            <div style={{marginBottom:24}}>
              <h1 style={{fontSize:24,fontWeight:700,letterSpacing:"-0.5px",color:th.t}}>Tasks</h1>
              <p style={{color:th.tm,fontSize:13,marginTop:4}}>{tasks.filter(t=>!t.done).length} active · {tasks.filter(t=>t.done).length} finalizate</p>
            </div>
            <div style={{...sty.cd,maxWidth:680,padding:24,borderRadius:14,border:`1px solid ${th.bl}`}}>
              <TasksView tasks={tasks} setTasks={setTasks} th={th} sty={sty} mob={mob} compact={false}/>
            </div>
          </div>}

          {/* CALENDAR */}
          {tab==="calendar"&&<div style={{animation:"su .3s ease",display:"flex",flexDirection:"column",gap:0,position:"relative",flex:1,minHeight:0,overflow:"hidden"}}>
            <div style={{flex:1,minWidth:0,minHeight:0,display:"flex",flexDirection:"column",overflow:"hidden"}}>
            <h1 style={{fontSize:22,fontWeight:700,marginBottom:16,flexShrink:0}}>Calendar</h1>
            <div style={{fontSize:11,color:th.tm,marginBottom:8,flexShrink:0}}>Toate ofertele și evenimentele — click pe eveniment pentru rezumat</div>
            {(()=>{
              const y=calM.getFullYear(),m=calM.getMonth();
              const f=new Date(y,m,1).getDay(); const dn=new Date(y,m+1,0).getDate();
              const off=f===0?6:f-1;
              const mn=["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"];
              const dk=th.bg==="#09090b";
              return <div style={{...sty.cd,flex:1,minHeight:0,display:"flex",flexDirection:"column",overflow:"hidden"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexShrink:0}}>
                  <button onClick={()=>setCalM(new Date(y,m-1))} style={{...sty.bg,padding:"6px 12px"}}><IcChevL s={14}/> Înapoi</button>
                  <h2 style={{fontSize:18,fontWeight:700}}>{mn[m]} {y}</h2>
                  <button onClick={()=>setCalM(new Date(y,m+1))} style={{...sty.bg,padding:"6px 12px"}}>Înainte <IcChevR s={14}/></button>
                </div>
                <div style={{flex:1,minHeight:0,overflowY:"auto",overflowX:"auto",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"}}>
                <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:3,minWidth:400}}>
                  {["Lu","Ma","Mi","Jo","Vi","Sâ","Du"].map(d=><div key={d} style={{padding:"6px 4px",textAlign:"center",fontSize:11,color:th.tm,fontWeight:600,borderBottom:`1px solid ${th.b}`}}>{d}</div>)}
                  {Array.from({length:off}).map((_,i)=><div key={`e${i}`} style={{minHeight:70}}/>)}
                  {Array.from({length:dn}).map((_,i)=>{
                    const d=i+1;
                    const ds=`${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
                    const de=evs.filter(e=>e.date===ds);
                    const td=new Date().getDate()===d&&new Date().getMonth()===m&&new Date().getFullYear()===y;
                    const resp=(e)=>e.responsabilPrincipal||(e.responsabili&&e.responsabili[0]?.nume)||e.cn||"—";
                    return <div key={d} onClick={()=>setCalSidebarDate(ds)} onDragOver={e=>{e.preventDefault();setCalDropDate(ds);}} onDragLeave={()=>setCalDropDate(null)} onDrop={e=>{e.preventDefault();setCalDropDate(null);if(calDragEvId){moveEvToDate(calDragEvId,ds);setCalDragEvId(null);}}}
                      style={{minHeight:80,padding:4,borderRadius:6,border:td?`2px solid ${th.a}`:calDropDate===ds?`2px solid ${th.a}`:de.length>0?`1px solid ${th.b}`:`1px solid ${th.bl}`,background:calDropDate===ds?th.ab:td?th.ab:"transparent",display:"flex",flexDirection:"column",cursor:"pointer"}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2}}>
                        <span style={{fontSize:12,fontWeight:td?800:de.length>0?600:400,color:td?th.t:de.length>0?th.t:th.tm}}>{d}</span>
                        {p.c&&<button onClick={e=>{e.stopPropagation();om("pick",{date:ds});}} style={{width:20,height:20,padding:0,borderRadius:6,border:"none",background:th.a,color:th.bg,fontSize:14,fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:1}} title="Adaugă ofertă">+</button>}
                      </div>
                      <div style={{flex:1,overflow:"auto",maxHeight:120}}>
                        {de.map(ev=><div key={ev.id} draggable onDragStart={e=>{e.stopPropagation();setCalDragEvId(ev.id);}} onDragEnd={()=>setCalDragEvId(null)} onClick={e=>{e.stopPropagation();setCalSidebarDate(ds);}} style={{padding:"3px 5px",borderRadius:4,marginBottom:2,fontSize:9,fontWeight:600,cursor:"grab",background:dk?ST[ev.st]?.bd:ST[ev.st]?.bg,color:ST[ev.st]?.c,lineHeight:1.25,borderLeft:`3px solid ${ST[ev.st]?.c}`}} title={`${ev.type} — ${resp(ev)} · ${ST[ev.st]?.l||ev.st} (trage pentru a muta)`}>{ev.type} ({resp(ev)}) · {ST[ev.st]?.l||ev.st}</div>)}
                      </div>
                    </div>;
                  })}
                </div>
                </div>
              </div>;
            })()}
            </div>
            {calSidebarDate&&(()=>{
              const dayEvs=evs.filter(e=>e.date===calSidebarDate);
              return <div style={{position:mob?"fixed":"sticky",top:0,right:0,width:mob?"100%":360,maxWidth:"100%",height:mob?"70vh":"auto",maxHeight:"85vh",background:th.c,borderLeft:`1px solid ${th.b}`,boxShadow:"-4px 0 20px rgba(0,0,0,.15)",zIndex:100,overflow:"auto",padding:16}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12}}>
                  <h3 style={{fontSize:14,fontWeight:700}}>{fD(calSidebarDate)} — {dayEvs.length} eveniment{dayEvs.length!==1?"e":""}</h3>
                  <button onClick={()=>setCalSidebarDate(null)} style={{padding:4,border:"none",background:"transparent",color:th.tm,cursor:"pointer"}}><IcX s={14}/></button>
                </div>
                {dayEvs.length===0?<div style={{fontSize:12,color:th.tm}}>Niciun eveniment în această zi</div>:dayEvs.map(ev=>(
                  <div key={ev.id} style={{padding:14,borderRadius:10,border:`1px solid ${th.b}`,background:th.h,marginBottom:10}}>
                    <Badge s={ev.st} th={th}/>
                    <div style={{fontSize:14,fontWeight:700,marginTop:8}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div>
                    <div style={{fontSize:11,color:th.tm,marginTop:2}}>{ev.cat==="private"?"Privat":"Public"} · {ev.type}</div>
                    <div style={{fontSize:12,marginTop:6}}>{ev.venue}{ev.city?", "+ev.city:""}</div>
                    <div style={{fontSize:15,fontWeight:700,marginTop:6}}>{f$(ev.fee)}</div>
                    {(ev.responsabilPrincipal||(ev.responsabili||[]).length>0)&&<div style={{fontSize:11,color:th.tm,marginTop:6}}>Preluat: {ev.responsabilPrincipal||(ev.responsabili||[])[0]?.nume||"—"}</div>}
                    <button onClick={()=>{setCalSidebarDate(null);om("detail",ev);}} style={{...sty.b,marginTop:10,width:"100%",fontSize:12}}>Deschide oferta</button>
                  </div>
                ))}
              </div>;
            })()}
          </div>}

          {/* FINANȚE */}
          {tab==="finances"&&<div style={{animation:"su .3s ease"}}>
            <h1 style={{fontSize:22,fontWeight:700,marginBottom:16}}>Finanțe</h1>
            <div style={{display:"grid",gridTemplateColumns:mob?"1fr 1fr":"repeat(4,1fr)",gap:10,marginBottom:16}}>
              {[{l:"Venituri confirmate",v:f$(stats.rev),ac:"#22c55e"},{l:"Profit net",v:f$(stats.net),ac:stats.net>=0?"#22c55e":"#ef4444"},{l:"Pipeline",v:f$(stats.pipe)},{l:"Avansuri restante",v:f$(stats.pd),ac:stats.pd>0?"#ef4444":"#22c55e"}].map((c,i)=>
                <div key={i} style={sty.cd}><div style={sty.l}>{c.l}</div><div style={{fontSize:mob?16:20,fontWeight:700,marginTop:5,color:c.ac||th.t}}>{c.v}</div></div>
              )}
            </div>
            <div style={{...sty.cd,marginBottom:16}}>
              <div style={{fontSize:13,fontWeight:600,marginBottom:12}}>Split per membru</div>
              <div style={{display:"grid",gridTemplateColumns:mob?"repeat(2,1fr)":"repeat(5,1fr)",gap:8}}>
                {MEMBERS.map(m=>{
                  const tot=evs.filter(e=>e.st==="confirmat").reduce((s,e)=>s+(e.sp?.[m.id]||0),0);
                  return <div key={m.id} style={{padding:12,borderRadius:7,background:th.h,textAlign:"center"}}>
                    <div style={{width:32,height:32,borderRadius:"50%",background:th.a,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:13,color:th.bg,margin:"0 auto 6px"}}>{m.n[0]}</div>
                    <div style={{fontSize:12,fontWeight:500}}>{m.n}</div><div style={{fontSize:10,color:th.tm}}>{m.r}</div>
                    <div style={{fontSize:15,fontWeight:700,marginTop:4}}>{f$(tot)}</div>
                  </div>;
                })}
              </div>
            </div>
            <div style={sty.cd}>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:12}}>
                <div style={{fontSize:13,fontWeight:600}}>Cheltuieli generale</div>
                <button onClick={()=>{const d=prompt("Perioadă (YYYY-MM):");const desc=prompt("Descriere:");const a=Number(prompt("Sumă €:"));if(d&&a)setGE(p=>[...p,{id:uid(),d,desc:desc||"",a}])}} style={{...sty.bg,fontSize:11,padding:"5px 10px"}}><IcPlus s={12}/> Adaugă</button>
              </div>
              {genExp.length===0&&<div style={{padding:20,textAlign:"center",color:th.tm,fontSize:11}}>Nicio cheltuială generală</div>}
              {genExp.length>0&&<table style={{width:"100%"}}><thead><tr style={{borderBottom:`1px solid ${th.b}`}}>
                {["Perioadă","Descriere","Sumă"].map(h=><th key={h} style={{padding:"7px 10px",textAlign:"left",fontSize:9,color:th.tm,textTransform:"uppercase",letterSpacing:1}}>{h}</th>)}
              </tr></thead><tbody>{genExp.map(g=>
                <tr key={g.id} style={{borderBottom:`1px solid ${th.bl}`}}>
                  <td style={{padding:"7px 10px",fontSize:11}}>{g.d}</td>
                  <td style={{padding:"7px 10px",fontSize:11}}>{g.desc}</td>
                  <td style={{padding:"7px 10px",fontSize:11,fontWeight:600,color:"#ef4444"}}>{f$(g.a)}</td>
                </tr>
              )}</tbody></table>}
            </div>
          </div>}

        </div>
      </div>

      {/* PICK MODAL */}
      {modal==="pick"&&<div style={{position:"fixed",inset:0,background:th.ov,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1000}} onClick={cm}>
        <div style={{background:th.c,border:`1px solid ${th.b}`,borderRadius:14,width:mob?"90%":360,padding:28}} onClick={e=>e.stopPropagation()}>
          <div style={{textAlign:"center",marginBottom:20}}>
            <h2 style={{fontSize:17,fontWeight:700,color:th.t}}>Ofertă nouă</h2>
            <p style={{color:th.tm,fontSize:12,marginTop:3}}>Ce tip de eveniment?</p>
          </div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>
            <button onClick={()=>{cm();setTimeout(()=>om("form",{cat:"private",...(mData?.date&&{date:mData.date})}),80);}} style={{background:"#fff",border:"2px solid #333",cursor:"pointer",textAlign:"center",padding:22,borderRadius:10,color:"#111",boxShadow:"0 2px 8px rgba(0,0,0,.2)"}}>
              <div style={{fontSize:28,marginBottom:8}}>🎉</div><div style={{fontWeight:700,fontSize:14}}>Privat</div><div style={{fontSize:10,color:"#666",marginTop:4}}>ZăGoodVibes</div>
            </button>
            <button onClick={()=>{cm();setTimeout(()=>om("form",{cat:"public",...(mData?.date&&{date:mData.date})}),80);}} style={{background:"#fff",border:"2px solid #333",cursor:"pointer",textAlign:"center",padding:22,borderRadius:10,color:"#111",boxShadow:"0 2px 8px rgba(0,0,0,.2)"}}>
              <div style={{fontSize:28,marginBottom:8}}>🎸</div><div style={{fontWeight:700,fontSize:14}}>Public</div><div style={{fontSize:10,color:"#666",marginTop:4}}>PHASER</div>
            </button>
          </div>
          <button onClick={cm} style={{...sty.bg,width:"100%",justifyContent:"center",marginTop:12}}>Anulează</button>
        </div>
      </div>}

      {/* EVENT FORM */}
      {modal==="form"&&(()=>{
        const isE=!!mData?.id; const isP=mData?.cat==="private"||!mData?.cat;
        return <EventForm th={th} sty={sty} isE={isE} isP={isP} mData={mData} onSave={saveEv} onClose={cm} mob={mob} templates={templates}/>;
      })()}

      {/* EVENT DETAIL — Fișa apare DOAR când e confirmat */}
      {modal==="detail"&&(()=>{
        const ev=mData; const svc=getSvcTotal(ev); const exp=getExpTotal(ev); const isP=ev.cat==="private"; const dk=th.bg==="#09090b";
        const isConfirmed = ev.st==="confirmat";
        return <div style={{position:"fixed",inset:0,background:th.ov,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1000}} onClick={cm}>
          <div style={{background:th.c,border:`1px solid ${th.b}`,borderRadius:mob?0:14,width:mob?"100%":600,maxHeight:mob?"100vh":"88vh",height:mob?"100vh":"auto",overflow:"auto"}} onClick={e=>e.stopPropagation()}>
            <div style={{padding:"18px 22px",borderBottom:`1px solid ${th.b}`}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
                <div>
                  <div style={{display:"flex",alignItems:"center",gap:7,marginBottom:6,flexWrap:"wrap"}}>
                    <Badge s={ev.st} th={th}/>
                    <span style={{fontSize:10,padding:"2px 8px",borderRadius:10,background:th.ab,color:th.tm,fontWeight:600}}>{isP?"Privat (ZGV)":"Public (PHASER)"}</span>
                    {ev.type&&<span style={{fontSize:10,padding:"2px 8px",borderRadius:10,background:th.ab,color:th.tm}}>{ev.type}</span>}
                  </div>
                  <div style={{fontSize:18,fontWeight:700,marginBottom:2}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div>
                  <div style={{fontSize:11,color:th.tm}}>{fD(ev.date)} · {ev.venue}{ev.city?", "+ev.city:""}</div>
                  {(ev.responsabilPrincipal||(ev.responsabili||[]).length>0)&&<div style={{fontSize:10,color:th.tm,marginTop:4}}>Preluat: {ev.responsabilPrincipal||"—"} {(ev.responsabili||[]).length>0&&` · ${(ev.responsabili||[]).filter(r=>r.nume||r.rol).map(r=>r.nume+(r.rol?" ("+r.rol+")":"")).join(", ")}`}</div>}
                </div>
                <button onClick={cm} style={{padding:3,border:"none",background:"transparent",color:th.tm,cursor:"pointer"}}><IcX s={16}/></button>
              </div>
            </div>
            <div style={{padding:"16px 22px"}}>

              {/* FIȘA EVENIMENTULUI — doar dacă e confirmat */}
              {isConfirmed&&<div style={{marginBottom:16,padding:16,borderRadius:10,background:th.h,border:`2px solid #22c55e`}}>
                <div style={{fontSize:11,fontWeight:700,textTransform:"uppercase",letterSpacing:1,marginBottom:12,color:"#22c55e",display:"flex",alignItems:"center",gap:6}}>
                  <IcDoc s={14}/> Fișa evenimentului
                </div>
                {/* Program pe ore */}
                <div style={{marginBottom:12}}>
                  <div style={{fontSize:9,color:th.tm,fontWeight:600,textTransform:"uppercase",letterSpacing:1,marginBottom:6}}>Program pe ore</div>
                  <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:6}}>
                    {[{l:"Load In",v:ev.li,i:"📦"},{l:"Soundcheck",v:ev.sc,i:"🎛"},{l:"Show Start",v:ev.ss,i:"🎤"},{l:"Load Out",v:ev.lo,i:"🚐"}].map((x,i)=>
                      <div key={i} style={{padding:10,borderRadius:8,background:th.c,textAlign:"center",border:`1px solid ${th.b}`}}>
                        <div style={{fontSize:14,marginBottom:3}}>{x.i}</div>
                        <div style={{fontSize:9,color:th.tm,textTransform:"uppercase",letterSpacing:.5,marginBottom:3}}>{x.l}</div>
                        <div style={{fontSize:15,fontWeight:800,color:x.v?th.t:th.tm}}>{x.v||"—"}</div>
                      </div>
                    )}
                  </div>
                </div>
                {/* Client + Financiar */}
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                  <div style={{padding:10,borderRadius:7,background:th.c,border:`1px solid ${th.b}`}}>
                    <div style={{fontSize:9,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:5}}>Client</div>
                    <div style={{fontSize:12,fontWeight:700}}>{ev.cn||"—"}</div>
                    {ev.cp&&<div style={{fontSize:11,color:th.ts,marginTop:2}}>{ev.cp}</div>}
                    {ev.ce&&<div style={{fontSize:11,color:th.ts}}>{ev.ce}</div>}
                    {ev.platform&&<div style={{fontSize:11,color:th.tm,marginTop:4,display:"flex",alignItems:"center",gap:4}}>
                      <span style={{fontSize:9,padding:"1px 6px",borderRadius:8,background:th.ab,fontWeight:600,textTransform:"uppercase"}}>{ev.platform}</span>
                      <span style={{color:th.ts}}>{ev.platformId||""}</span>
                    </div>}
                  </div>
                  <div style={{padding:10,borderRadius:7,background:th.c,border:`1px solid ${th.b}`}}>
                    <div style={{fontSize:9,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:5}}>Financiar</div>
                    <div style={{fontSize:16,fontWeight:800}}>{f$(ev.fee+svc)}</div>
                    <div style={{fontSize:10,color:ev.dp?"#22c55e":"#ef4444",marginTop:2}}>Avans {f$(ev.dep)} {ev.dp?"✓":"✗"}</div>
                    <div style={{fontSize:10,color:th.tm}}>Profit: {f$(ev.fee+svc-exp)}</div>
                  </div>
                </div>
                {!isP&&<div style={{marginTop:10,padding:10,borderRadius:7,background:th.c,border:`1px solid ${th.b}`}}>
                  <div style={{fontSize:9,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:6}}>Rider Tehnic</div>
                  <div style={{display:"flex",flexWrap:"wrap",gap:4}}>
                    {RIDER_TEHNIC.backstage.slice(0,5).map((item,i)=><span key={i} style={{padding:"2px 8px",borderRadius:10,background:th.ab,fontSize:10,color:th.ts}}>{item}</span>)}
                    <span style={{fontSize:10,color:th.tm}}>+{RIDER_TEHNIC.backstage.length-5} mai mult</span>
                  </div>
                </div>}
                {ev.notes&&<div style={{marginTop:10,padding:10,borderRadius:7,background:th.c,border:`1px solid ${th.b}`}}>
                  <div style={{fontSize:9,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:4}}>Note interne</div>
                  <div style={{fontSize:11,color:th.ts}}>{ev.notes}</div>
                </div>}
              </div>}

              {/* Dacă NU e confirmat — arată info basic */}
              {!isConfirmed&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:14}}>
                <div style={{padding:12,borderRadius:7,background:th.h}}>
                  <div style={{fontSize:10,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:5}}>Client</div>
                  <div style={{fontSize:13,fontWeight:600}}>{ev.cn||"—"}</div>
                  {ev.cp&&<div style={{fontSize:11,color:th.ts,marginTop:2}}>{ev.cp}</div>}
                </div>
                <div style={{padding:12,borderRadius:7,background:th.h}}>
                  <div style={{fontSize:10,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:5}}>Onorariu</div>
                  <div style={{fontSize:18,fontWeight:700}}>{f$(ev.fee)}</div>
                  <div style={{fontSize:10,color:th.tm,marginTop:2}}>Avans: {f$(ev.dep)}</div>
                </div>
              </div>}

              <div style={{display:"flex",gap:5,justifyContent:mob?"center":"flex-end",flexWrap:"wrap",marginTop:8}}>
                <button onClick={()=>{cm();setTimeout(()=>om("oferta",ev),80);}} style={sty.b}><IcFile s={13}/> Ofertă</button>
                {isConfirmed&&<button onClick={()=>{cm();setTimeout(()=>om("finance",ev),80);}} style={sty.bg}><IcMoney s={13}/> Finanțe</button>}
                {p.e&&<button onClick={()=>{cm();setTimeout(()=>om("form",ev),80);}} style={sty.bg}><IcEdit s={13}/> Editează</button>}
                {p.d&&<button onClick={()=>{if(window.confirm("Ștergi?"))delEv(ev.id)}} style={{...sty.bg,color:"#ef4444",borderColor:"#ef4444"}}><IcTrash s={13}/> Șterge</button>}
              </div>
            </div>
          </div>
        </div>;
      })()}

      {/* FINANCE POPUP */}
      {modal==="finance"&&(()=>{
        const ev=mData; const svc=getSvcTotal(ev); const exp=getExpTotal(ev); const tot=ev.fee+svc;
        return <div style={{position:"fixed",inset:0,background:th.ov,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1100}} onClick={cm}>
          <div style={{background:th.c,border:`1px solid ${th.b}`,borderRadius:14,width:mob?"90%":400}} onClick={e=>e.stopPropagation()}>
            <div style={{padding:"16px 20px",borderBottom:`1px solid ${th.b}`,display:"flex",justifyContent:"space-between"}}>
              <h3 style={{fontSize:15,fontWeight:700}}>Fișa financiară</h3>
              <button onClick={cm} style={{padding:3,border:"none",background:"transparent",color:th.tm,cursor:"pointer"}}><IcX s={14}/></button>
            </div>
            <div style={{padding:"16px 20px"}}>
              <div style={{textAlign:"center",marginBottom:14}}>
                <div style={{fontSize:12,color:th.tm}}>{ev.offerNr?"O"+ev.offerNr:"???"} · {ev.type}</div>
                <div style={{fontSize:26,fontWeight:800,marginTop:3}}>{f$(tot)}</div>
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:10}}>
                <div style={{padding:10,borderRadius:6,background:th.h,textAlign:"center"}}>
                  <div style={{fontSize:9,color:th.tm,textTransform:"uppercase"}}>Avans</div>
                  <div style={{fontSize:15,fontWeight:700,color:ev.dp?"#22c55e":"#ef4444"}}>{f$(ev.dep)}</div>
                  <div style={{fontSize:9,color:ev.dp?"#22c55e":"#ef4444"}}>{ev.dp?"✓ Încasat":"✗ Neîncasat"}</div>
                </div>
                <div style={{padding:10,borderRadius:6,background:th.h,textAlign:"center"}}>
                  <div style={{fontSize:9,color:th.tm,textTransform:"uppercase"}}>Rest</div>
                  <div style={{fontSize:15,fontWeight:700}}>{f$(tot-(ev.dp?ev.dep:0))}</div>
                </div>
              </div>
              {ev.ex?.length>0&&<div style={{padding:10,borderRadius:6,background:th.h,marginBottom:10}}>
                {ev.ex.map(x=><div key={x.id} style={{display:"flex",justifyContent:"space-between",fontSize:11,padding:"2px 0"}}><span>{x.n}</span><span style={{fontWeight:600,color:"#ef4444"}}>{f$(x.a)}</span></div>)}
              </div>}
              <div style={{padding:10,borderRadius:6,background:th.ab,textAlign:"center"}}>
                <div style={{fontSize:9,color:th.tm,textTransform:"uppercase"}}>Profit net</div>
                <div style={{fontSize:20,fontWeight:800,color:tot-exp>=0?"#22c55e":"#ef4444"}}>{f$(tot-exp)}</div>
              </div>
            </div>
          </div>
        </div>;
      })()}

            {/* OFFER PREVIEW */}
      {modal==="oferta"&&mData&&<OfferPreview
        ev={mData}
        evStatus={mData.st}
        onStatusChange={updSt}
        onOfferUpdate={(id,up)=>{setEvs(p=>p.map(e=>e.id===id?{...e,...up}:e));if(mData?.id===id)setMD(prev=>prev?{...prev,...up}:prev);}}
        th={th}
        mob={mob}
        onClose={cm}
        onEdit={p.e?()=>{cm();setTimeout(()=>om("form",mData),80);}:undefined}
        sty={sty}
        templates={templates}
      />}

      {/* Swipe indicator dots — mobile only */}
      {mob&&(()=>{
        const allNav=["acasa","events","offers","docs","tasks","calendar",...(p.f?["finances"]:[])];
        return <div style={{position:"fixed",bottom:10,left:"50%",transform:"translateX(-50%)",display:"flex",gap:5,zIndex:500,pointerEvents:"none"}}>
          {allNav.map(id=><div key={id} style={{width:id===tab?20:5,height:5,borderRadius:3,background:id===tab?"rgba(255,255,255,.9)":"rgba(255,255,255,.2)",transition:"all .25s"}}/>)}
        </div>;
      })()}

      <Toast message={toast.message} visible={toast.visible}/>
    </div>
  );
}

// Mount the app — cu handler de erori pentru debug
try {
  if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
    document.getElementById('root').innerHTML = '<div style="padding:24px;max-width:480px;margin:40px auto;font-family:system-ui;background:#1a1a1a;color:#fff;border-radius:12px"><h2 style="color:#ef4444">Scripturile nu s-au încărcat</h2><p style="margin:12px 0;line-height:1.6">Deschizi fișierul direct (file://). Unele browsere blochează încărcarea de pe CDN.</p><p style="margin:12px 0"><strong>Rezolvare:</strong> Rulează un server local în folderul proiectului:</p><pre style="background:#222;padding:12px;border-radius:6px;font-size:12px;overflow:auto">cd "/Users/raczradu/Downloads/Phaser Manager"\npython3 -m http.server 8080</pre><p style="margin:12px 0">Apoi deschide <a href="http://localhost:8080" style="color:#60a5fa">http://localhost:8080</a></p></div>';
  } else {
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  }
} catch (e) {
  document.getElementById('root').innerHTML = '<div style="padding:24px;font-family:monospace;color:#ef4444;white-space:pre-wrap;font-size:12px">Eroare: ' + (e.message||e) + '\n\n' + (e.stack||'') + '</div>';
}

  </script>
</body>
</html>