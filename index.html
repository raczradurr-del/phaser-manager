<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Phaser Manager</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect fill='%231a1510' width='32' height='32' rx='6'/><text x='16' y='22' font-size='18' font-weight='bold' fill='%23fbbf24' text-anchor='middle'>P</text></svg>"/>
  <script>
    window.onerror = function(msg, url, line, col, err) {
      var r = document.getElementById('root');
      if (r && r.querySelector && r.querySelector('.loading')) {
        var txt = (err && err.message) ? String(err.message) : String(msg);
        r.innerHTML = '<div style="padding:24px;max-width:480px;margin:40px auto;font-family:system-ui;background:#1a1a1a;color:#fff;border-radius:12px"><h2 style="color:#ef4444">Eroare</h2><pre style="margin:12px 0;font-size:12px;white-space:pre-wrap;color:#fca5a5">' + txt.replace(/</g,'&lt;') + '</pre><p style="margin-top:12px;color:#a1a1aa;font-size:12px">Deschide Consola (F12) pentru detalii.</p></div>';
      }
      return false;
    };
  </script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
      var r = document.getElementById('root');
      if (r) r.innerHTML = '<div style="padding:24px;max-width:480px;margin:40px auto;font-family:system-ui;background:#1a1a1a;color:#fff;border-radius:12px"><h2 style="color:#ef4444">Scripturile nu s-au √ÆncƒÉrcat</h2><p style="margin:12px 0;line-height:1.6">Deschizi fi»ôierul direct (file://). Unele browsere blocheazƒÉ √ÆncƒÉrcarea de pe CDN.</p><p style="margin:12px 0"><strong>Rezolvare:</strong> RuleazƒÉ un server local √Æn folderul proiectului:</p><pre style="background:#222;padding:12px;border-radius:6px;font-size:12px;overflow:auto">cd "/Users/raczradu/Downloads/Phaser Manager"\npython3 -m http.server 8080</pre><p style="margin:12px 0">Apoi deschide <a href="http://localhost:8080" style="color:#60a5fa">http://localhost:8080</a></p></div>';
    }
  </script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', system-ui, sans-serif; }
    #root { height: 100vh; }
    .tasks-cal-scroll::-webkit-scrollbar { display: none; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel" data-presets="env,react">
const { useState, useEffect, useMemo, useRef } = React;

/* StructurƒÉ: HOOKS | CONSTANTS | STORAGE | ICONS | COMPONENTS | FEATURES | MAIN APP */

// ‚îÄ‚îÄ‚îÄ HOOKS ‚îÄ‚îÄ‚îÄ
const LOGO_URL = "assets/logo.svg";

function useIsMobile() {
  const [mob, setMob] = useState(typeof window !== "undefined" ? window.innerWidth < 768 : false);
  useEffect(() => {
    const h = () => setMob(window.innerWidth < 768);
    window.addEventListener("resize", h);
    return () => window.removeEventListener("resize", h);
  }, []);
  return mob;
}

function useLocalStorageState(key, initial, opts = {}) {
  const { version, migrate } = opts;
  const [state, setState] = useState(() => {
    try {
      const s = localStorage.getItem(key);
      if (!s) return typeof initial === "function" ? initial() : initial;
      let d = JSON.parse(s);
      if (migrate && typeof migrate === "function") d = migrate(d, version);
      return d;
    } catch (e) { return typeof initial === "function" ? initial() : initial; }
  });
  useEffect(() => { try { localStorage.setItem(key, JSON.stringify(state)); } catch (e) {} }, [key, state]);
  return [state, setState];
}

function useToasts(duration = 2500) {
  const [toast, setToast] = useState({ visible: false, message: "" });
  const showToast = msg => { setToast({ visible: true, message: msg }); setTimeout(() => setToast({ visible: false, message: "" }), duration); };
  return { toast, showToast };
}

function useModal() {
  const [modal, setModal] = useState(null);
  const [payload, setPayload] = useState(null);
  const openModal = (type, data) => { setModal(type); setPayload(data ?? null); };
  const closeModal = () => { setModal(null); setPayload(null); };
  return { modal, payload, openModal, closeModal };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONSTANTS & CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const gTheme = () => {
  if (typeof window !== "undefined" && window.matchMedia)
    return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
  return "dark";
};

const TH = {
  light: { bg:"#f5f5f5",c:"#ffffff",h:"#f0f0f0",i:"#ffffff",b:"#e0e0e0",bl:"#ebebeb",t:"#111111",ts:"#444444",tm:"#888888",sb:"#111111",sbb:"#222222",sbt:"#888888",sba:"#ffffff",a:"#111111",ab:"rgba(0,0,0,.07)",ov:"rgba(0,0,0,.55)" },
  dark:  { bg:"#09090b",c:"#141414",h:"#1c1c1c",i:"#1a1a1a",b:"#27272a",bl:"#1f1f1f",t:"#fafafa",ts:"#a1a1aa",tm:"#52525b",sb:"#0a0a0c",sbb:"#1a1a1a",sbt:"#a1a1aa",sba:"#fafafa",a:"#fafafa",ab:"rgba(255,255,255,.06)",ov:"rgba(0,0,0,.75)" }
};

const ST = {
  oferta:      { l:"OfertƒÉ",        c:"#f59e0b", bg:"#fef9c3", bd:"#422006" },
  asteptare:   { l:"A»ôt. contract", c:"#a78bfa", bg:"#ede9fe", bd:"#2e1065" },
  plata_avans: { l:"PlatƒÉ avans",   c:"#3b82f6", bg:"#dbeafe", bd:"#1e3a8a" },
  confirmat:   { l:"Confirmat",     c:"#22c55e", bg:"#dcfce7", bd:"#052e16" },
  respins:     { l:"Respins",       c:"#ef4444", bg:"#fee2e2", bd:"#450a0a" }
};

const PRIVATE_TYPES = ["NuntƒÉ","Botez","Private Party","Corporate","Altele"];
const PUBLIC_TYPES  = ["Festival","Concert","Club","Altele"];

const uid = () => Math.random().toString(36).substr(2,9);
const f$  = n => new Intl.NumberFormat("ro",{maximumFractionDigits:0}).format(n||0)+" ‚Ç¨";
const fD  = d => { if(!d) return "‚Äî"; return new Date(d+"T00:00:00").toLocaleDateString("ro",{day:"numeric",month:"short",year:"numeric"}); };

// ‚îÄ‚îÄ‚îÄ GOOGLE CALENDAR CONFIG ‚îÄ‚îÄ‚îÄ
const GCAL_CLIENT_ID = "166600809896-bkch0s9678ahv7l9fofe0ti47btc4pum.apps.googleusercontent.com";
const GCAL_SCOPE     = "https://www.googleapis.com/auth/calendar.events";
const GCAL_LS_TOKEN  = "gcal_token";
const GCAL_LS_EXPIRY = "gcal_expiry";
const dU  = d => { if(!d) return 999; return Math.ceil((new Date(d+"T00:00:00")-new Date())/864e5); };

const MEMBERS = [
  {id:"m1",n:"Carina Dumitru",r:"Vocal"},
  {id:"m2",n:"Radu Racz",r:"Bass"},
  {id:"m3",n:"Lucian Opri»ôan",r:"Clape"},
  {id:"m4",n:"Arnold Birta",r:"Tobe"},
  {id:"m5",n:"Sebastian B√¢rzeianu",r:"ChitarƒÉ"}
];

const USERS = [
  {id:"u3",n:"Membru",rl:"membru"},
  {id:"u4",n:"Furnizor",rl:"furnizor"}
];

const PM = {
  admin:    {c:1,e:1,d:1,f:1,co:1,pk:1},
  manager:  {c:1,e:1,d:0,f:1,co:1,pk:1},
  membru:   {c:1,e:1,d:1,f:1,co:1,pk:1},
  furnizor: {c:0,e:0,d:0,f:0,co:0,pk:0}
};

const PX = { r:{3:4100,2:3100,1:2350}, sunet:350, lumini:500, ecran:600, scena:300, dj:600, pub:2000 };

const DEFAULT_VIDEOS = [
  { id:"v1", title:"PHASER ‚Äî Show Reel (Live)", url:"https://www.youtube.com/embed/dQw4w9WgXcQ", checked:true, caption:"PHASER Live ‚Äî energie »ôi emo»õie pe scenƒÉ" },
  { id:"v2", title:"PHASER ‚Äî Live la nuntƒÉ", url:"https://www.youtube.com/embed/dQw4w9WgXcQ", checked:true, caption:"Good vibes are here ‚Äî atmosferƒÉ de nuntƒÉ" },
  { id:"v3", title:"PHASER ‚Äî Carina Dumitru la X Factor", url:"https://www.youtube.com/embed/dQw4w9WgXcQ", checked:true, caption:"Vocea PHASER ‚Äî Carina la X Factor" },
  { id:"v4", title:"PHASER ‚Äî Live DJ set", url:"https://www.youtube.com/embed/dQw4w9WgXcQ", checked:false, caption:"DJ set ‚Äî de la live la party" },
];

// Playlist complet ‚Äî 56 cover-uri din oferta oficialƒÉ
const DEFAULT_COVERS = [
  {id:"p1",  title:"APT.",                                  artist:"ROS√â & Bruno Mars",              checked:true},
  {id:"p2",  title:"Angels",                                artist:"Robbie Williams",                 checked:true},
  {id:"p3",  title:"Basul si cu toba mare",                 artist:"Vita de Vie",                    checked:true},
  {id:"p4",  title:"California Love",                       artist:"Tupac",                          checked:true},
  {id:"p5",  title:"Could you be loved",                    artist:"Bob Marley",                     checked:true},
  {id:"p6",  title:"Constantine, Constantine",              artist:"Liviu Vasilica",                 checked:true},
  {id:"p7",  title:"Crazy little thing called love",        artist:"Queen",                          checked:true},
  {id:"p8",  title:"Feel so close",                         artist:"Calvin Harris",                  checked:true},
  {id:"p9",  title:"Follow rivers",                         artist:"Lickke Li (The Magician Remix)", checked:true},
  {id:"p10", title:"Four, five seconds",                    artist:"Rihanna",                        checked:true},
  {id:"p11", title:"Flowers",                               artist:"Miley Cyrus",                    checked:true},
  {id:"p12", title:"Happy",                                 artist:"Pharell",                        checked:true},
  {id:"p13", title:"Hey Ya!",                               artist:"OutKast",                        checked:true},
  {id:"p14", title:"Hotstepper",                            artist:"Imi Kamoze",                     checked:true},
  {id:"p15", title:"I gotta feelin\'",                     artist:"Black Eyed Peas",                checked:true},
  {id:"p16", title:"I feel good",                           artist:"James Brown",                    checked:true},
  {id:"p17", title:"I will survive",                        artist:"Aretha Franklin",                checked:true},
  {id:"p18", title:"I wanna dance with somebody",           artist:"Whitney Houston",                checked:true},
  {id:"p19", title:"It\'s my life",                        artist:"Jon Bon Jovi",                   checked:true},
  {id:"p20", title:"Jailhouse rock",                        artist:"Elvis Presley",                  checked:true},
  {id:"p21", title:"Jump around",                           artist:"House of Pain",                  checked:true},
  {id:"p22", title:"Je Veux",                               artist:"Zaz",                            checked:true},
  {id:"p23", title:"Like a virgin",                         artist:"Madonna",                        checked:true},
  {id:"p24", title:"La carciuma de la drum",                artist:"Electric Fence",                 checked:true},
  {id:"p25", title:"Ne place",                              artist:"ROA",                            checked:true},
  {id:"p26", title:"Robot Armasar Attack",                  artist:"Gojira VS Liviu Vasilica",       checked:true},
  {id:"p27", title:"Rock this party",                       artist:"Bob Sinclar",                    checked:true},
  {id:"p28", title:"Mercy",                                 artist:"Duffy",                         checked:true},
  {id:"p29", title:"Moves like jagger",                     artist:"Maroon 5",                       checked:true},
  {id:"p30", title:"Mundian to Bach Ke",                    artist:"Panjabi MC",                     checked:true},
  {id:"p31", title:"Niggas In Paris",                       artist:"JAY-Z, Kanye West",              checked:true},
  {id:"p32", title:"Nah neh nah",                           artist:"Vaya con dios",                  checked:true},
  {id:"p33", title:"No woman, no cry",                      artist:"Bob Marley",                     checked:true},
  {id:"p34", title:"Pentru inimi",                          artist:"Suie Paparude",                  checked:true},
  {id:"p35", title:"Purple rain",                           artist:"Prince",                         checked:true},
  {id:"p36", title:"Sex on fire",                           artist:"Kings of Leon",                  checked:true},
  {id:"p37", title:"Shake It Off",                          artist:"Taylor Swift",                   checked:true},
  {id:"p38", title:"Shook me all night long",               artist:"AC/DC",                          checked:true},
  {id:"p39", title:"Sweet child o\'mine",                  artist:"Guns \'n\' roses",             checked:true},
  {id:"p40", title:"Simply the best",                       artist:"Tina Turner",                    checked:true},
  {id:"p41", title:"Soulstorm",                             artist:"Patrice",                        checked:true},
  {id:"p42", title:"Smells like teen spirit",               artist:"Nirvana",                        checked:true},
  {id:"p43", title:"Still D.R.E.",                          artist:"Dr. Dre",                        checked:true},
  {id:"p44", title:"That\'s Not My Name",                  artist:"The Ting Tings",                 checked:true},
  {id:"p45", title:"That\'s the way (I like it)",          artist:"KC & The Sunshine Band",         checked:true},
  {id:"p46", title:"Time of my life",                       artist:"Dirty Dancing Soundtrack",       checked:true},
  {id:"p47", title:"Ti-am dat un inel",                     artist:"Holograf",                       checked:true},
  {id:"p48", title:"Uptown funk",                           artist:"Mark Ronson feat. Bruno Mars",   checked:true},
  {id:"p49", title:"Valerie",                               artist:"Amy Whinehouse",                 checked:true},
  {id:"p50", title:"Vino la mine",                          artist:"N&D",                            checked:true},
  {id:"p51", title:"Waiting all night",                     artist:"Rudimental",                     checked:true},
  {id:"p52", title:"Wake me up",                            artist:"Avicii feat. Aloe Blacc",        checked:true},
  {id:"p53", title:"Walk this way",                         artist:"Run DMC VS Aerosmith",           checked:true},
  {id:"p54", title:"What\'s up",                           artist:"4 Non Blondes",                  checked:true},
  {id:"p55", title:"We will rock you",                      artist:"Queen",                          checked:true},
  {id:"p56", title:"You\'re the one that I want",          artist:"Olivia Newton John & J. Travolta",checked:true},
];

// Rider tehnic complet ‚Äî din documentul oficial Phaser
const RIDER_TEHNIC = {
  sunet:       { titlu:"Sistem de Sunet",    text:"Sistemul de sunet trebuie sƒÉ fie configurat »ôi dimensionat corespunzƒÉtor pentru a acoperi nevoile spa»õiului. MƒÉrci agreate: Meyer Sound, D&B, L-Acoustics.", req:"Inginer de sistem obligatoriu." },
  scena:       { titlu:"ScenƒÉ",              text:"Podium cu dimensiunea minimƒÉ de 8m √Æn deschidere »ôi 6m ad√¢ncime. Aer liber: acoperi»ô + laturi acoperite + scƒÉri acces.", req:"Temperaturi extreme: √ÆncƒÉlzitoare mobile / ventilatoare." },
  probe:       { titlu:"Probe de Sunet",     text:"60 minute amplasare echipamente pe scenƒÉ + 60 minute probe de sunet." },
  lumini:      { titlu:"Sistem de Lumini",   text:"Sistem profesional de bunƒÉ calitate, potrivit pentru spa»õiu. Tehnician de lumini obligatoriu." },
  video:       { titlu:"Video",              text:"DacƒÉ existƒÉ ecran LED / videoproiector la scenƒÉ, avem nevoie de un cablu HDMI conectat la sistemul video, ajung√¢nd √Æn dreptul riser-ului de tobe." },
  risere:      ["Riser Tobe ‚Äî 2 √ó 3 √ó 0,4m", "Riser Clape ‚Äî 2 √ó 2 √ó 0,4m"],
  monitoare:   ["4 monitoare conform plan de amplasament"],
  stative:     ["2 stative de microfon tip girafa"],
  cabluri:     ["1 cablu CAT5 de la scenƒÉ la FOH", "20 cabluri XLR", "Surse 220V cu minim 4 prize (conform plan)"],
  conectica:   ["Left/Right mix (AES/EBU sau Analog - XLR)", "Mon 1 Mono mix (Analog - XLR)"],
  instalare:   "Necesare 2 persoane ajutor pentru descƒÉrcat/√ÆncƒÉrcat echipamente.",
  parcare:     "2 locuri de parcare l√¢ngƒÉ scenƒÉ, de la soundcheck p√¢nƒÉ dupƒÉ concert.",
  securitate:  "Organizatorul asigurƒÉ securitatea arti»ôtilor »ôi echipamentelor pe toatƒÉ durata evenimentului. Spa»õiu depozitare case-uri »ôi huse l√¢ngƒÉ scenƒÉ.",
  backstage:   [
    "Iluminare puternicƒÉ",
    "Aer condi»õionat / √ÆncƒÉlzire controlabile independent",
    "Minimum 4 prize electrice 220V AC",
    "O masƒÉ + co»ô de gunoi curat",
    "8 scaune sau 3 canapele",
    "Acces facil la toaletƒÉ",
    "24 sticle apƒÉ platƒÉ (temperatura camerei)",
    "12 sticle bere 0,5L",
    "8 doze Cola Zero",
    "2 √ó 1L suc portocale (fƒÉrƒÉ concentrat)",
    "2 sticle vin alb/ros√© sec (gama Fautor sau echivalent)",
    "8 meniuri de m√¢ncare"
  ],
  onStage:    ["15 sticle apƒÉ platƒÉ la temperatura camerei"],
  contact:    "Racz Radu ‚Äî +40 744 771 488"
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STORAGE & SCHEMA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PHASER_V = 3;
const LS_KEYS = { evs: "phaser_evs", tasks: "phaser_tasks", genExp: "phaser_genExp", templates: "phaser_templates", riderVersions: "phaser_rider_versions", creative: "phaser_creative" };
const migrate = (data, key) => { if (!data) return data; if (Array.isArray(data)) return data; if (data._v === PHASER_V) return data; if (typeof data._v !== "number") data._v = 1; while (data._v < PHASER_V) { data._v++; } return data; };
const loadEvs = () => { try { const s = localStorage.getItem(LS_KEYS.evs); if (s) { const d = JSON.parse(s); return Array.isArray(d) ? d : []; } } catch(e){} return []; };
const loadTasks = () => { try { const s = localStorage.getItem(LS_KEYS.tasks); if (s) { const d = JSON.parse(s); return Array.isArray(d) ? d : []; } } catch(e){} return []; };
const loadGenExp = () => { try { const s = localStorage.getItem(LS_KEYS.genExp); if (s) { const d = JSON.parse(s); return Array.isArray(d) ? d : []; } } catch(e){} return []; };
const loadCreative = () => { try { const s=localStorage.getItem(LS_KEYS.creative); if(s) { const d=JSON.parse(s); return d&&typeof d==="object"?d:{}; } } catch(e){} return {ideas:[],songs:[],setlists:[]}; };
// Templates ‚Äî stocate √Æn localStorage, folosite ca bazƒÉ pentru oferte
const loadTemplates = () => {
  try {
    const s = localStorage.getItem(LS_KEYS.templates);
    if (s) return JSON.parse(s);
  } catch(e) {}
  return {
    playlist: JSON.parse(JSON.stringify(DEFAULT_COVERS)),
    riderContent: {},
    riderCustom: [],
    riderStagePlot: { image: null, notes: "" },
    pressKitPrivat: "",
    pressKitPublic: "",
    poveste: "Phaser √ÆnseamnƒÉ atitudine, dinamicƒÉ »ôi multƒÉ energie. Un show Phaser este un tour de force √ÆncƒÉrcat cu intensitate dar »ôi cu momente de sensibilitate simplƒÉ. Printre cuvinte, imagini »ôi muzicƒÉ spunem povestea tuturor ‚Äî a celor ce iubesc sau a celor √ÆndrƒÉgosti»õi de via»õƒÉ."
  };
};
// Versiuni rider ‚Äî phaser_rider_versions: [{ id, ts, label, data }]
const loadRiderVersions = () => {
  try {
    const s = localStorage.getItem(LS_KEYS.riderVersions);
    if (s) return JSON.parse(s);
  } catch(e) {}
  return [];
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ICONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const sp = {fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"};
const Ic = (d,extra={}) => ({s=18})=><svg width={s} height={s} viewBox="0 0 24 24" {...sp} {...extra}>{d}</svg>;
const IcMenu  = Ic(<><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></>);
const IcX     = Ic(<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>);
const IcDash  = Ic(<><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></>);
const IcCal   = Ic(<><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></>);
const IcMusic = Ic(<><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></>);
const IcMoney = Ic(<><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></>);
const IcPlus  = Ic(<><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></>);
const IcFile  = Ic(<><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></>);
const IcEdit  = Ic(<><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.12 2.12 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></>);
const IcTrash = Ic(<><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></>);
const IcSearch= Ic(<><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></>);
const IcChevL = Ic(<polyline points="15 18 9 12 15 6"/>);
const IcChevR = Ic(<polyline points="9 18 15 12 9 6"/>);
const IcOut   = Ic(<><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></>);
const IcCheck = Ic(<polyline points="20 6 9 17 4 12"/>);
const IcSend  = Ic(<><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></>);
const IcPlay  = Ic(<polygon points="5 3 19 12 5 21 5 3"/>);
const IcDisc  = Ic(<><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></>);
const IcTask  = Ic(<><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></>);
const IcImg   = Ic(<><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></>);
const IcDoc   = Ic(<><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></>);
const IcClock = Ic(<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMPONENTS ‚Äî UI building blocks
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function Logo({ height=28, dark=false }) {
  // Logo-ul original e alb => pe fundal √Æntunecat merge direct
  // Pe fundal alb, √Æl facem negru cu invert
  return (
    <img
      src={LOGO_URL}
      alt="PHASER"
      style={{
        height,
        objectFit:"contain",
        display:"block",
        filter: dark ? "invert(1) brightness(0)" : "none",
      }}
    />
  );
}

function Badge({s, th}) {
  const c = ST[s]; if(!c) return null;
  const dk = th.bg==="#09090b";
  return <span style={{display:"inline-block",padding:"2px 10px",borderRadius:20,fontSize:10,fontWeight:700,background:dk?c.bd:c.bg,color:c.c,whiteSpace:"nowrap"}}>{c.l}</span>;
}
function BadgeStatusSelect({s, th, evId, onStatusChange}) {
  const [open, setOpen] = useState(false);
  const c = ST[s]; if(!c) return null;
  const dk = th.bg==="#09090b";
  if(!onStatusChange) return <Badge s={s} th={th}/>;
  const opts = Object.entries(ST).map(([k,v])=><div key={k} onClick={()=>{onStatusChange(evId,k);setOpen(false);}} style={{padding:"6px 12px",fontSize:11,cursor:"pointer",borderRadius:6,background:k===s?th.ab:"transparent",color:th.t}} onMouseOver={e=>{e.currentTarget.style.background=th.ab;}} onMouseOut={e=>{e.currentTarget.style.background=k===s?th.ab:"transparent";}}>{v.l}</div>);
  const dropdown = open ? <div style={{position:"absolute",top:"100%",left:0,marginTop:4,zIndex:999,background:th.c,border:`1px solid ${th.b}`,borderRadius:8,boxShadow:"0 8px 24px rgba(0,0,0,.2)",minWidth:140,padding:4}} onClick={e=>e.stopPropagation()}>{opts}</div> : null;
  const overlay = open ? <div style={{position:"fixed",inset:0,zIndex:998}} onClick={()=>setOpen(false)}/> : null;
  return <div style={{position:"relative",display:"inline-block"}}>
    <span onClick={e=>{e.stopPropagation();setOpen(o=>!o);}} style={{display:"inline-block",padding:"2px 10px",borderRadius:20,fontSize:10,fontWeight:700,background:dk?c.bd:c.bg,color:c.c,whiteSpace:"nowrap",cursor:"pointer",border:"1px solid transparent"}}>{c.l}</span>
    {dropdown}
    {overlay}
  </div>;
}

function Toast({message, visible}) {
  if(!visible) return null;
  return <div style={{position:"fixed",bottom:24,left:"50%",transform:"translateX(-50%)",padding:"12px 24px",borderRadius:10,background:"#111",border:"1px solid #22c55e",boxShadow:"0 8px 32px rgba(0,0,0,.4)",zIndex:9999,display:"flex",alignItems:"center",gap:10,fontSize:13,fontWeight:600,color:"#22c55e"}}><IcCheck s={16}/> {message}</div>;
}

// ‚îÄ‚îÄ‚îÄ Tasks (Notion-style) ‚îÄ‚îÄ‚îÄ
const fullTask = (text, prio="medium") => ({id:uid(),text,done:false,taskStatus:"in_proces",priority:prio,cr:new Date().toISOString().split("T")[0],due:"",subtasks:[],notes:"",tags:[],chats:[],uploads:[]});
const toggleInTree = (tasks, id) => tasks.map(t=>t.id===id?{...t,done:!t.done,taskStatus:!t.done?"done":"in_proces"}:{...t,subtasks:toggleInTree(t.subtasks||[],id)});
const delInTree = (tasks, id) => tasks.filter(t=>t.id!==id).map(t=>({...t,subtasks:delInTree(t.subtasks||[],id)}));
const addSubInTree = (tasks, parentId, sub) => tasks.map(t=>t.id===parentId?{...t,subtasks:[...(t.subtasks||[]),sub]}:{...t,subtasks:addSubInTree(t.subtasks||[],parentId,sub)});
const updInTree = (tasks, id, upd) => tasks.map(t=>t.id===id?(typeof upd==="function"?upd(t):{...t,...upd}):{...t,subtasks:updInTree(t.subtasks||[],id,upd)});

function TasksView({ tasks, setTasks, th, sty, mob, compact=false }) {
  const [newText, setNewText] = useState("");
  const [newPrio, setNewPrio] = useState("medium");
  const [expandedIds, setExpandedIds] = useState(new Set());
  const [viewMode, setViewMode] = useState("list"); // list | calendar | kanban
  const [kanbanDragCol, setKanbanDragCol] = useState(null);
  const [calendarDate, setCalendarDate] = useState(()=>{const n=new Date(); return {y:n.getFullYear(),m:n.getMonth()};});
  const calendarScrollRef = useRef(null);
  const calendarScrolling = useRef(false);
  const MONTHS_RO_CAL = ["ianuarie","februarie","martie","aprilie","mai","iunie","iulie","august","septembrie","octombrie","noiembrie","decembrie"];
  const PC = {high:"#ef4444", medium:"#f59e0b", low:"#22c55e"};
  const PL = {high:"Urgent", medium:"Normal", low:"Low"};
  const TSL = {in_proces:"√én proces",in_lucru:"√én lucru",done:"Done"};
  const TSC = {in_proces:"#6366f1",in_lucru:"#f59e0b",done:"#22c55e"};

  const add = () => {
    if(!newText.trim()) return;
    setTasks(p=>[...p,fullTask(newText.trim(),newPrio)]);
    setNewText("");
  };
  const toggle = id => setTasks(p=>toggleInTree(p,id));
  const del = id => setTasks(p=>delInTree(p,id));
  const addSub = (parentId, txt) => { if(!txt.trim()) return; setTasks(p=>addSubInTree(p,parentId,fullTask(txt.trim(),"medium"))); };
  const updTask = (id, upd) => setTasks(p=>updInTree(p,id,upd));
  const addTag = (tid, tag) => { if(!tag.trim()) return; updTask(tid,t=>({...t,tags:[...(t.tags||[]),tag.trim()]})); };
  const remTag = (tid, tag) => updTask(tid,t=>({...t,tags:(t.tags||[]).filter(x=>x!==tag)}));
  const addChat = (tid, txt, replyToId) => { if(!txt.trim()) return; updTask(tid,t=>{const nc={id:uid(),text:txt.trim(),date:new Date().toISOString(),author:"Eu",replyTo:replyToId,replies:[]}; return {...t,chats:[...(t.chats||[]),nc]};}); setReplyingTo(null); };
  const addReply = (tid, chatId, txt) => { if(!txt.trim()) return; updTask(tid,t=>({...t,chats:(t.chats||[]).map(c=>c.id===chatId?{...c,replies:[...(c.replies||[]),{id:uid(),text:txt.trim(),date:new Date().toISOString(),author:"Eu"}]}:c)})); setReplyingTo(null); };
  const toggleExpanded = (id) => setExpandedIds(s=>{const n=new Set(s);if(n.has(id))n.delete(id);else n.add(id);return n;});

  const [replyingTo, setReplyingTo] = useState(null); // {tid, chatId}

  const taskStatus = t => (t.taskStatus==="done"||t.done)?"done":(t.taskStatus||"in_proces");
  const active = tasks.filter(t=>taskStatus(t)!=="done").sort((a,b)=>({high:0,medium:1,low:2})[a.priority||"medium"]-({high:0,medium:1,low:2})[b.priority||"medium"]);
  const done = tasks.filter(t=>taskStatus(t)==="done");

  useEffect(()=>{
    const el=calendarScrollRef.current; if(!el||viewMode!=="calendar"||compact) return;
    calendarScrolling.current=true; el.scrollTop=el.clientHeight; setTimeout(()=>{calendarScrolling.current=false;},100);
  },[calendarDate,viewMode,compact]);

  const handleCalendarScroll = () => {
    if (calendarScrolling.current) return;
    const el = calendarScrollRef.current;
    if (!el) return;
    const idx = Math.round(el.scrollTop / el.clientHeight);
    if (idx === 0) {
      setCalendarDate(p => { let m = p.m - 1, y = p.y; if (m < 0) { m = 11; y--; } return { m, y }; });
    } else if (idx === 2) {
      setCalendarDate(p => { let m = p.m + 1, y = p.y; if (m > 11) { m = 0; y++; } return { m, y }; });
    }
  };

  const renderMonth = (y,m) => {
    const first=new Date(y,m,1);
    const startOffset=(first.getDay()+6)%7;
    const start=new Date(y,m,1-startOffset);
    return Array.from({length:42}).map((_,i)=>{
      const d=new Date(start); d.setDate(start.getDate()+i);
      const ds=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
      const isCurMonth=d.getMonth()===m;
      const dayTasks=active.filter(t=>t.due===ds);
      const today=new Date(); const isToday=d.getDate()===today.getDate()&&d.getMonth()===today.getMonth()&&d.getFullYear()===today.getFullYear();
      return <div key={i} style={{minHeight:72,padding:6,borderRadius:8,border:`1px solid ${th.bl}`,background:dayTasks.length>0?th.ab:"transparent",opacity:isCurMonth?1:0.5}}>
        <div style={{fontSize:11,color:isToday?th.a:th.tm,marginBottom:2,fontWeight:isToday?700:600}}>{d.getDate()}</div>
        {dayTasks.map(t=><div key={t.id} onClick={()=>toggleExpanded(t.id)} style={{fontSize:9,padding:"2px 4px",borderRadius:4,background:PC[t.priority||"medium"]+"33",marginBottom:2,cursor:"pointer",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",borderLeft:`2px solid ${PC[t.priority||"medium"]}`}}>{t.text}</div>)}
      </div>;
    });
  };

  const TaskCard = ({ t, isDone, depth=0 }) => {
    const ex = expandedIds.has(t.id);
    const subs = t.subtasks||[];
    const doneSubs = subs.filter(s=>s.done).length;
    const isReplying = replyingTo&&replyingTo.tid===t.id;
    return (
      <div key={t.id} style={{borderRadius:12,background:th.c,border:`1px solid ${th.b}`,borderLeft:`5px solid ${PC[t.priority||"medium"]}`,overflow:"hidden",marginBottom:12,boxShadow:"0 2px 8px rgba(0,0,0,.06)",marginLeft:depth*16}}>
        <div onClick={()=>toggleExpanded(t.id)} style={{display:"flex",alignItems:"center",gap:12,padding:"16px 20px",cursor:"pointer",flexWrap:"wrap"}}>
          <div onClick={e=>{e.stopPropagation();toggle(t.id);}} style={{width:20,height:20,borderRadius:5,border:`2px solid ${PC[t.priority||"medium"]}`,cursor:"pointer",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",background:isDone?th.b:"transparent"}}>{isDone&&<IcCheck s={12}/>}</div>
          <div style={{flex:1,minWidth:120,fontSize:16,fontWeight:500,textDecoration:isDone?"line-through":undefined,color:isDone?th.tm:th.t,lineHeight:1.4}}>{t.text}</div>
          <select value={t.priority||"medium"} onChange={e=>{e.stopPropagation();updTask(t.id,{priority:e.target.value});}} onClick={e=>e.stopPropagation()} className="modernSel" style={{...sty.i,padding:"6px 24px 6px 10px",fontSize:12,borderRadius:8,border:`1px solid ${PC[t.priority||"medium"]}`,background:PC[t.priority||"medium"]+"15",color:PC[t.priority||"medium"],fontWeight:600,width:"auto",minWidth:90,cursor:"pointer"}}>
            <option value="high">Urgent</option><option value="medium">Normal</option><option value="low">Low</option>
          </select>
          <input type="date" value={t.due||""} onChange={e=>{e.stopPropagation();updTask(t.id,{due:e.target.value});}} onClick={e=>e.stopPropagation()} style={{...sty.i,padding:"6px 10px",fontSize:12,borderRadius:8,border:`1px solid ${th.b}`,width:"auto",minWidth:130,cursor:"pointer"}} title="Deadline"/>
          {(t.tags||[]).length>0&&<span style={{fontSize:11,color:th.tm}}>{(t.tags||[]).slice(0,2).map(tg=><span key={tg}>#{tg} </span>)}</span>}
          {subs.length>0&&<span style={{fontSize:12,color:th.tm,fontWeight:500}}>{doneSubs}/{subs.length}</span>}
          <span style={{fontSize:14,color:th.tm,fontWeight:400,transition:"transform .2s",transform:ex?"rotate(90deg)":"rotate(0)"}}>‚ñ∂</span>
          <button onClick={e=>{e.stopPropagation();del(t.id);}} style={{padding:4,border:"none",background:"transparent",color:th.tm,cursor:"pointer",opacity:.7}}><IcTrash s={12}/></button>
        </div>
        {ex&&<div style={{padding:"20px 24px 24px 60px",borderTop:`1px solid ${th.bl}`,background:th.bg==="#09090b"?"rgba(255,255,255,.02)":"rgba(0,0,0,.02)"}}>
          <div style={{display:"flex",gap:10,marginTop:12,marginBottom:12,flexWrap:"wrap"}}>
            <div style={{display:"flex",alignItems:"center",gap:8}}>
              <input type="date" value={t.due||""} onChange={e=>updTask(t.id,{due:e.target.value})} style={{...sty.i,padding:"12px 14px",fontSize:14,borderRadius:10}}/>
              <span style={{fontSize:13,color:th.tm}}>üìÖ Deadline</span>
            </div>
            <div style={{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"}}>
              {(t.tags||[]).map(tag=><span key={tag} style={{fontSize:12,padding:"6px 12px",borderRadius:10,background:th.ab,color:th.t,display:"flex",alignItems:"center",gap:6}}>{tag}<button onClick={()=>remTag(t.id,tag)} style={{padding:0,border:"none",background:"transparent",cursor:"pointer",fontSize:12,color:th.tm}}>√ó</button></span>)}
              <input placeholder="+ Tag (Enter)" onKeyDown={e=>{if(e.key==="Enter"){addTag(t.id,e.target.value);e.target.value="";}}} style={{...sty.i,width:140,padding:"12px 14px",fontSize:14,borderRadius:10}}/>
            </div>
          </div>
          <div style={{marginBottom:16}}>
            <div style={{fontSize:13,color:th.tm,fontWeight:600,marginBottom:8}}>Subtasks</div>
            {subs.map(s=><TaskCard key={s.id} t={{...s,subtasks:s.subtasks||[],tags:s.tags||[],chats:s.chats||[],uploads:s.uploads||[]}} isDone={s.done} depth={depth+1}/>)}
            <input placeholder="+ AdaugƒÉ subtask (Enter)" onKeyDown={e=>{if(e.key==="Enter"){addSub(t.id,e.target.value);e.target.value="";}}} style={{...sty.i,width:"100%",padding:"14px 16px",fontSize:15,marginTop:8,borderRadius:10}}/>
          </div>
          <div style={{marginBottom:16}}>
            <div style={{fontSize:13,color:th.tm,fontWeight:600,marginBottom:8}}>Conversa»õii</div>
            {(t.chats||[]).map(c=><div key={c.id} style={{padding:"14px 16px",background:th.c,borderRadius:10,marginBottom:8,fontSize:14,borderLeft:`4px solid ${th.b}`}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <span style={{fontSize:12,color:th.tm}}>{c.author} ¬∑ {new Date(c.date).toLocaleString("ro")}</span>
                <button onClick={()=>setReplyingTo({tid:t.id,chatId:c.id})} style={{padding:"6px 12px",border:"none",background:"transparent",color:th.tm,cursor:"pointer",fontSize:12}}>RƒÉspunde</button>
              </div>
              <div style={{marginTop:6,marginBottom:4}}>{c.text}</div>
              {(c.replies||[]).map(r=><div key={r.id} style={{marginTop:6,marginLeft:16,padding:"10px 12px",background:th.h,borderRadius:8,borderLeft:`3px solid ${th.b}`}}><span style={{fontSize:11,color:th.tm}}>‚Ü≥ {r.author} ¬∑ {new Date(r.date).toLocaleString("ro")}</span><div style={{marginTop:4,fontSize:13}}>{r.text}</div></div>)}
              {isReplying&&replyingTo.chatId===c.id&&<div style={{marginTop:8,marginLeft:16}}><input placeholder="RƒÉspunde... (Enter)" autoFocus onKeyDown={e=>{if(e.key==="Enter"){addReply(t.id,c.id,e.target.value);e.target.value="";}if(e.key==="Escape")setReplyingTo(null);}} style={{...sty.i,width:"100%",padding:"12px 14px",fontSize:14,borderRadius:10}}/><button onClick={()=>setReplyingTo(null)} style={{fontSize:12,marginTop:6,color:th.tm,cursor:"pointer",background:"transparent",border:"none"}}>AnuleazƒÉ</button></div>}
            </div>)}
            <input placeholder="+ Mesaj nou (Enter)" onKeyDown={e=>{if(e.key==="Enter"){addChat(t.id,e.target.value);e.target.value="";}}} style={{...sty.i,width:"100%",padding:"14px 16px",fontSize:15,marginTop:8,borderRadius:10}}/>
          </div>
          <div style={{marginBottom:16}}>
            <div style={{fontSize:13,color:th.tm,fontWeight:600,marginBottom:8}}>Link / Fi»ôier</div>
            <input placeholder="Link sau nume fi»ôier (Enter)" onKeyDown={e=>{if(e.key==="Enter"){const v=e.target.value.trim();if(v){updTask(t.id,{uploads:[...(t.uploads||[]),{id:uid(),name:v,url:v}]});e.target.value="";}}}} style={{...sty.i,width:"100%",padding:"14px 16px",fontSize:15,borderRadius:10}}/>
            {(t.uploads||[]).map(u=>u&&<div key={u.id} style={{fontSize:13,padding:"10px 14px",marginTop:8,background:th.h,borderRadius:8}}>üìé {u.name}</div>)}
          </div>
          <div>
            <div style={{fontSize:13,color:th.tm,fontWeight:600,marginBottom:8}}>Note</div>
            <textarea value={t.notes||""} onChange={e=>updTask(t.id,{notes:e.target.value})} placeholder="Scrie note aici..." style={{...sty.i,minHeight:80,fontSize:15,resize:"vertical",width:"100%",padding:"14px 16px",borderRadius:10}}/>
          </div>
        </div>}
      </div>
    );
  };

  return (
    <div>
      {compact && <div style={{fontSize:15,fontWeight:700,marginBottom:14,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
        <span>üìã Tasks</span><span style={{fontSize:13,color:th.tm,fontWeight:400}}>{active.length} active</span>
      </div>}

      {!compact&&<div style={{display:"flex",gap:6,padding:8,background:th.bg==="#09090b"?th.h:"#f8f7f5",borderRadius:12,border:`1px solid ${th.bl}`,marginBottom:20}}>
        <button onClick={()=>setViewMode("list")} style={{padding:"12px 20px",borderRadius:10,border:"none",fontSize:15,fontWeight:viewMode==="list"?600:500,cursor:"pointer",background:viewMode==="list"?th.c:"transparent",color:viewMode==="list"?th.t:th.tm,boxShadow:viewMode==="list"?"0 1px 3px rgba(0,0,0,.06)":"none",transition:"all .15s"}}>ListƒÉ</button>
        <button onClick={()=>setViewMode("kanban")} style={{padding:"12px 20px",borderRadius:10,border:"none",fontSize:15,fontWeight:viewMode==="kanban"?600:500,cursor:"pointer",background:viewMode==="kanban"?th.c:"transparent",color:viewMode==="kanban"?th.t:th.tm,boxShadow:viewMode==="kanban"?"0 1px 3px rgba(0,0,0,.06)":"none",transition:"all .15s"}}>Kanban</button>
        <button onClick={()=>setViewMode("calendar")} style={{padding:"12px 20px",borderRadius:10,border:"none",fontSize:15,fontWeight:viewMode==="calendar"?600:500,cursor:"pointer",background:viewMode==="calendar"?th.c:"transparent",color:viewMode==="calendar"?th.t:th.tm,boxShadow:viewMode==="calendar"?"0 1px 3px rgba(0,0,0,.06)":"none",transition:"all .15s"}}>Calendar</button>
      </div>}

      <div style={{display:"flex",gap:12,marginBottom:24}}>
        <input value={newText} onChange={e=>setNewText(e.target.value)} onKeyDown={e=>e.key==="Enter"&&add()}
          style={{...sty.i,flex:1,padding:"18px 22px",fontSize:17,borderRadius:12,border:`2px solid ${th.bl}`}} placeholder="Ce ai de fƒÉcut? Scrie aici »ôi apasƒÉ Enter..."/>
        {!compact && <select value={newPrio} onChange={e=>setNewPrio(e.target.value)} className="modernSel" style={{...sty.i,width:150,padding:"18px 36px 18px 18px",fontSize:15,borderRadius:12,border:`2px solid ${th.bl}`}}>
          <option value="high">Urgent</option><option value="medium">Normal</option><option value="low">Low</option>
        </select>}
        <button onClick={add} style={{...sty.b,padding:"18px 24px",flexShrink:0,borderRadius:12,fontWeight:600,fontSize:15}}><IcPlus s={18}/></button>
      </div>

      <div style={{display:"flex",flexDirection:"column",gap:0}}>
        {active.length===0 && <div style={{padding:56,textAlign:"center",color:th.tm,fontSize:17,lineHeight:1.6,background:th.bg==="#09090b"?th.h:"#faf9f7",borderRadius:16,border:`2px dashed ${th.bl}`}}>Niciun task activ ‚Äî scrie mai sus ce ai de fƒÉcut »ôi apasƒÉ Enter üéâ</div>}
        {viewMode==="kanban"&&!compact ? (
          <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"repeat(3,1fr)",gap:16,minHeight:400}}>
            {(["in_proces","in_lucru","done"]).map(col=>{
              const colTasks = col==="done" ? done : active.filter(t=>taskStatus(t)===col);
              return <div key={col} onDragOver={e=>{e.preventDefault();setKanbanDragCol(col);}} onDragLeave={()=>setKanbanDragCol(null)} onDrop={e=>{e.preventDefault();setKanbanDragCol(null);const id=e.dataTransfer.getData("taskId");if(id){updTask(id,{taskStatus:col,done:col==="done"});}}}
                style={{background:th.bg==="#09090b"?th.h:"#faf9f7",borderRadius:14,padding:18,border:`2px dashed ${kanbanDragCol===col?TSC[col]:th.bl}`,minHeight:220,transition:"all .2s"}}>
                <div style={{fontSize:14,fontWeight:700,color:TSC[col],marginBottom:14,display:"flex",alignItems:"center",gap:10}}><span style={{width:12,height:12,borderRadius:"50%",background:TSC[col]}}/> {TSL[col]} ({colTasks.length})</div>
                <div style={{display:"flex",flexDirection:"column",gap:10}}>
                  {colTasks.map(t=>(
                    <div key={t.id} draggable onDragStart={e=>e.dataTransfer.setData("taskId",t.id)} onClick={()=>toggleExpanded(t.id)}
                      style={{background:th.c,borderRadius:12,padding:18,cursor:"grab",border:`1px solid ${th.bl}`,boxShadow:"0 1px 4px rgba(0,0,0,.05)",transition:"all .15s"}}
                      onMouseOver={e=>{e.currentTarget.style.transform="translateY(-1px)";e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,.08)";}}
                      onMouseOut={e=>{e.currentTarget.style.transform="translateY(0)";e.currentTarget.style.boxShadow="0 1px 4px rgba(0,0,0,.05)";}}>
                      <div style={{display:"flex",alignItems:"flex-start",gap:10}}>
                        <div onClick={e=>{e.stopPropagation();toggle(t.id);}} style={{width:20,height:20,borderRadius:5,border:`2px solid ${TSC[taskStatus(t)]}`,cursor:"pointer",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",background:taskStatus(t)==="done"?th.b:"transparent",marginTop:2}}>{taskStatus(t)==="done"&&<IcCheck s={12}/>}</div>
                        <div style={{flex:1,minWidth:0}}>
                          <div style={{fontSize:16,fontWeight:600,textDecoration:taskStatus(t)==="done"?"line-through":undefined,color:taskStatus(t)==="done"?th.tm:th.t,lineHeight:1.4}}>{t.text}</div>
                          <div style={{display:"flex",alignItems:"center",gap:6,marginTop:6,flexWrap:"wrap"}}>
                            <select value={t.priority||"medium"} onChange={e=>{e.stopPropagation();updTask(t.id,{priority:e.target.value});}} onClick={e=>e.stopPropagation()} className="modernSel" style={{...sty.i,padding:"8px 28px 8px 12px",fontSize:13,borderRadius:8,border:`1px solid ${th.b}`}}>
                              <option value="high">Urgent</option><option value="medium">Normal</option><option value="low">Low</option>
                            </select>
                            {t.due&&<span style={{fontSize:10,color:th.tm}}><IcClock s={10}/> {fD(t.due)}</span>}
                            {(t.subtasks||[]).length>0&&<span style={{fontSize:10,color:th.tm}}>{(t.subtasks||[]).filter(s=>s.done).length}/{(t.subtasks||[]).length}</span>}
                          </div>
                        </div>
                        <button onClick={e=>{e.stopPropagation();del(t.id);}} style={{padding:4,border:"none",background:"transparent",color:th.tm,cursor:"pointer",opacity:.6}}><IcTrash s={14}/></button>
                      </div>
                      {expandedIds.has(t.id)&&<div style={{marginTop:12,paddingTop:12,borderTop:`1px solid ${th.b}`}}>
                        <div style={{fontSize:13,color:th.tm,fontWeight:600,marginBottom:8}}>Subtasks</div>
                        {(t.subtasks||[]).map(s=><TaskCard key={s.id} t={{...s,subtasks:s.subtasks||[],tags:s.tags||[],chats:s.chats||[],uploads:s.uploads||[]}} isDone={s.done} depth={1}/>)}
                        <input placeholder="+ AdaugƒÉ subtask (Enter)" onKeyDown={e=>{if(e.key==="Enter"){addSub(t.id,e.target.value);e.target.value="";}}} style={{...sty.i,padding:"14px 16px",fontSize:15,marginTop:10,borderRadius:10}}/>
                      </div>}
                    </div>
                  ))}
                </div>
              </div>;
            })}
          </div>
        ) : viewMode==="calendar"&&!compact ? (
          <div style={{overflow:"hidden"}}>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12}}>
              <button onClick={()=>setCalendarDate(p=>{let m=p.m-1;let y=p.y;if(m<0){m=11;y--;}return{m:m,y:y};})} style={{...sty.bg,padding:"8px 14px",fontSize:13}}>‚Üê</button>
              <div style={{fontSize:17,fontWeight:700,color:th.t,textTransform:"capitalize",display:"flex",flexDirection:"column",alignItems:"center",gap:2}}><span>{MONTHS_RO_CAL[calendarDate.m]} {calendarDate.y}</span><span style={{fontSize:10,color:th.tm,fontWeight:400}}>scroll ‚Üë‚Üì</span></div>
              <button onClick={()=>setCalendarDate(p=>{let m=p.m+1;let y=p.y;if(m>11){m=0;y++;}return{m:m,y:y};})} style={{...sty.bg,padding:"8px 14px",fontSize:13}}>‚Üí</button>
              <button onClick={()=>{const n=new Date();setCalendarDate({m:n.getMonth(),y:n.getFullYear()});}} style={{...sty.bg,padding:"6px 12px",fontSize:12}}>Azi</button>
            </div>
            <div ref={calendarScrollRef} onScroll={handleCalendarScroll} style={{height:420,overflowY:"auto",scrollSnapType:"y mandatory",scrollBehavior:"smooth",WebkitOverflowScrolling:"touch"}}>
              {[-1,0,1].map(offset=>{
                let m=calendarDate.m+offset; let y=calendarDate.y;
                if(m<0){m+=12;y--;} if(m>11){m-=12;y++;}
                return <div key={`${y}-${m}`} style={{minHeight:420,scrollSnapAlign:"start",scrollSnapStop:"always"}}>
                  <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:4}}>
                    {["Lu","Ma","Mi","Jo","Vi","S√¢","Du"].map(d=><div key={d} style={{fontSize:10,color:th.tm,textAlign:"center",fontWeight:600,padding:"4px 0"}}>{d}</div>)}
                    {renderMonth(y,m)}
                  </div>
                </div>;
              })}
            </div>
          </div>
        ) : (
          active.map(t=><TaskCard key={t.id} t={t} isDone={false}/>)
        )}
      </div>

      {done.length>0 && <>
        <div style={{fontSize:13,color:th.tm,fontWeight:600,textTransform:"uppercase",letterSpacing:1.2,marginTop:32,marginBottom:14}}>Finalizate ({done.length})</div>
        {(compact?done.slice(0,2):done).map(t=><TaskCard key={t.id} t={t} isDone={true}/>)}
      </>}
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ Offers board, contract, offer preview ‚îÄ‚îÄ‚îÄ
function OffersBoard({ evs, th, sty, mob, onSelect, onAddOffer, onStatusChange }) {
  const [sortBy, setSortBy] = useState("date");
  const [filterSt, setFilterSt] = useState("");
  const [filterCat, setFilterCat] = useState("");
  const [viewMode, setViewMode] = useState("list"); // list | grid | kanban
  const [dragOverCol, setDragOverCol] = useState(null);
  let base = evs.filter(e=>{
    if(filterSt) { if(e.st!==filterSt) return false; }
    else { if(!["oferta","asteptare","plata_avans","confirmat"].includes(e.st)) return false; }
    if(filterCat&&e.cat!==filterCat) return false;
    return true;
  });
  const active = [...base].sort((a,b)=>{
    if(sortBy==="date") return new Date(a.date||0)-new Date(b.date||0);
    if(sortBy==="dateDesc") return new Date(b.date||0)-new Date(a.date||0);
    if(sortBy==="fee") return (b.fee||0)-(a.fee||0);
    if(sortBy==="feeAsc") return (a.fee||0)-(b.fee||0);
    if(sortBy==="client") return (a.cn||"").localeCompare(b.cn||"");
    if(sortBy==="status") return (a.st||"").localeCompare(b.st||"");
    return 0;
  });
  return (
    <div style={{animation:"su .3s ease"}}>
      <div style={{marginBottom:20,display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:12}}>
        <div>
          <h1 style={{fontSize:22,fontWeight:700,letterSpacing:"-0.5px"}}>Oferte</h1>
          <p style={{color:th.tm,fontSize:12,marginTop:2}}>{active.length} oferte</p>
        </div>
        <div style={{display:"flex",gap:6,alignItems:"center"}}>
          <div style={{display:"flex",gap:2,padding:4,background:th.h,borderRadius:8,border:`1px solid ${th.b}`}}>
            <button onClick={()=>setViewMode("list")} style={{padding:"6px 12px",borderRadius:6,border:"none",fontSize:11,fontWeight:600,cursor:"pointer",background:viewMode==="list"?th.ab:"transparent",color:viewMode==="list"?th.t:th.tm}}>ListƒÉ</button>
            <button onClick={()=>setViewMode("grid")} style={{padding:"6px 12px",borderRadius:6,border:"none",fontSize:11,fontWeight:600,cursor:"pointer",background:viewMode==="grid"?th.ab:"transparent",color:viewMode==="grid"?th.t:th.tm}}>Grid</button>
            <button onClick={()=>setViewMode("kanban")} style={{padding:"6px 12px",borderRadius:6,border:"none",fontSize:11,fontWeight:600,cursor:"pointer",background:viewMode==="kanban"?th.ab:"transparent",color:viewMode==="kanban"?th.t:th.tm}}>Kanban</button>
          </div>
          {onAddOffer&&<button onClick={onAddOffer} style={sty.b}><IcPlus s={14}/> OfertƒÉ nouƒÉ</button>}
        </div>
      </div>
      <div style={{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap",alignItems:"center"}}>
        <select value={filterSt} onChange={e=>setFilterSt(e.target.value)} className="modernSel" style={{padding:"8px 32px 8px 12px",minWidth:160,borderRadius:8,border:`1px solid ${th.b}`,background:th.i,color:th.t,fontSize:13,cursor:"pointer"}}>
          <option value="">Oferte active (ofertƒÉ + a»ôt. + confirmate)</option>
          {Object.entries(ST).map(([k,v])=><option key={k} value={k}>{v.l}</option>)}
        </select>
        <select value={filterCat} onChange={e=>setFilterCat(e.target.value)} className="modernSel" style={{padding:"8px 32px 8px 12px",minWidth:100,borderRadius:8,border:`1px solid ${th.b}`,background:th.i,color:th.t,fontSize:13,cursor:"pointer"}}>
          <option value="">Toate</option>
          <option value="private">Privat</option>
          <option value="public">Public</option>
        </select>
        <select value={sortBy} onChange={e=>setSortBy(e.target.value)} className="modernSel" style={{padding:"8px 32px 8px 12px",minWidth:140,borderRadius:8,border:`1px solid ${th.b}`,background:th.i,color:th.t,fontSize:13,cursor:"pointer"}}>
          <option value="date">Sort: Data ‚Üë</option>
          <option value="dateDesc">Sort: Data ‚Üì</option>
          <option value="fee">Sort: Onorariu ‚Üì</option>
          <option value="feeAsc">Sort: Onorariu ‚Üë</option>
          <option value="client">Sort: Client</option>
          <option value="status">Sort: Status</option>
        </select>
      </div>
      {viewMode==="kanban" ? (
        <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"repeat(4,1fr)",gap:12,minHeight:400}}>
          {["oferta","asteptare","plata_avans","confirmat","respins"].map(col=>{
            const colEvs = evs.filter(e=>e.st===col&&(!filterCat||e.cat===filterCat));
            return <div key={col} onDragOver={e=>{e.preventDefault();setDragOverCol(col);}} onDragLeave={()=>setDragOverCol(null)} onDrop={e=>{e.preventDefault();setDragOverCol(null);const id=e.dataTransfer.getData("evId");if(id&&onStatusChange){const ev=evs.find(x=>x.id===id);if(ev)onStatusChange(ev.id,col);}}}
              style={{background:th.h,borderRadius:12,padding:12,border:`2px dashed ${dragOverCol===col?ST[col]?.c:th.b}`,minHeight:200,transition:"border-color .2s"}}>
              <div style={{fontSize:11,fontWeight:700,color:ST[col]?.c,marginBottom:10,display:"flex",alignItems:"center",gap:6}}><span style={{width:8,height:8,borderRadius:"50%",background:ST[col]?.c}}/> {ST[col]?.l||col} ({colEvs.length})</div>
              <div style={{display:"flex",flexDirection:"column",gap:8}}>
                {colEvs.map(ev=>{
                  const d=dU(ev.date); const urgent=d<=14;
                  return <div key={ev.id} draggable onDragStart={e=>e.dataTransfer.setData("evId",ev.id)} onClick={()=>onSelect(ev)}
                    style={{background:th.c,borderRadius:8,padding:12,cursor:"grab",border:`1px solid ${th.b}`,boxShadow:"0 1px 3px rgba(0,0,0,.1)",transition:"transform .15s"}}
                    onMouseOver={e=>{e.currentTarget.style.transform="translateY(-1px)";e.currentTarget.style.cursor="grab";}}
                    onMouseOut={e=>{e.currentTarget.style.transform="translateY(0)";}}>
                    <div style={{fontSize:10,color:th.tm,marginBottom:2}}>{ev.type} {ev.cat==="private"?"¬∑ ZGV":"¬∑ PHASER"}</div>
                    <div style={{fontSize:13,fontWeight:700,marginBottom:4}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div>
                    <div style={{fontSize:10,color:th.tm}}>{fD(ev.date)} ¬∑ {f$(ev.fee)}</div>
                  </div>;
                })}
              </div>
            </div>;
          })}
        </div>
      ) : viewMode==="list" ? (
        <>
      {active.length===0 && <div style={{...sty.cd,padding:40,textAlign:"center",color:th.tm}}><div style={{fontSize:32,marginBottom:8}}>üì≠</div><div style={{fontSize:13}}>Nicio ofertƒÉ</div></div>}
      <div style={{...sty.cd,padding:0,overflow:"hidden"}}>
        <table style={{width:"100%",borderCollapse:"collapse"}}>
          <thead><tr style={{borderBottom:`2px solid ${th.b}`}}>
            {["Nr","OfertƒÉ","Tip","Loca»õie","Data","Onorariu","Status"].map(h=><th key={h} style={{padding:"10px 12px",textAlign:"left",fontSize:10,color:th.tm,textTransform:"uppercase",letterSpacing:1,fontWeight:600}}>{h}</th>)}
          </tr></thead>
          <tbody>{active.map((ev,i)=>(
            <tr key={ev.id} onClick={()=>onSelect(ev)} style={{borderBottom:`1px solid ${th.bl}`,cursor:"pointer"}} onMouseOver={e=>e.currentTarget.style.background=th.ab} onMouseOut={e=>e.currentTarget.style.background="transparent"}>
              <td style={{padding:"10px 12px",fontSize:11,color:th.tm}}>{(ev.offerNr?"O"+ev.offerNr:"‚Äî")}</td>
              <td style={{padding:"10px 12px",fontSize:13,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</td>
              <td style={{padding:"10px 12px",fontSize:11}}>{ev.type} ¬∑ {ev.cat==="private"?"Privat":"Public"}</td>
              <td style={{padding:"10px 12px",fontSize:11,color:th.tm}}>{ev.venue}{ev.city?", "+ev.city:""}</td>
              <td style={{padding:"10px 12px",fontSize:11}}>{fD(ev.date)}</td>
              <td style={{padding:"10px 12px",fontSize:13,fontWeight:700}}>{f$(ev.fee)}</td>
              <td style={{padding:"10px 12px"}} onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={onStatusChange}/></td>
            </tr>
          ))}</tbody>
        </table>
      </div>
        </>
      ) : (
        <>
      {active.length===0 && <div style={{...sty.cd,padding:40,textAlign:"center",color:th.tm}}><div style={{fontSize:32,marginBottom:8}}>üì≠</div><div style={{fontSize:13}}>Nicio ofertƒÉ</div></div>}
      <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"repeat(auto-fill,minmax(280px,1fr))",gap:10}}>
        {active.map(ev=>{
          const d=dU(ev.date); const urgent=d<=14;
          return <div key={ev.id} onClick={()=>onSelect(ev)}
            style={{...sty.cd,cursor:"pointer",borderColor:urgent?ST[ev.st].c:th.b,padding:16,transition:"all .15s"}}
            onMouseOver={e=>e.currentTarget.style.transform="translateY(-2px)"}
            onMouseOut={e=>e.currentTarget.style.transform="translateY(0)"}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8}}>
              <div>
                <span style={{fontSize:10,fontWeight:600,color:th.tm,textTransform:"uppercase",display:"block",marginBottom:2}}>{ev.cat==="private"?"Privat":"Public"} ¬∑ {ev.type}</span>
                <span style={{fontSize:14,fontWeight:700}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</span>
              </div>
              <div onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={onStatusChange}/></div>
            </div>
            <div style={{fontSize:11,color:th.tm,marginBottom:2}}>{ev.venue}{ev.city?", "+ev.city:""}</div>
            <div style={{fontSize:11,color:th.tm,marginBottom:10}}>{fD(ev.date)}</div>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
              <span style={{fontSize:17,fontWeight:800}}>{f$(ev.fee)}</span>
              <span style={{fontSize:10,color:urgent?"#ef4444":th.tm,fontWeight:urgent?700:400}}>{d>0?`√Æn ${d} zile`:d===0?"Azi!":"Trecut"}</span>
            </div>
          </div>;
        })}
      </div>
        </>
      )}
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ CONTRACT ‚îÄ‚îÄ‚îÄ
function ContractView({ ev, th, contractFields, onContractChange }) {
  const isP = ev.cat==="private";
  const svcTot = isP ? Object.entries(ev.svcp||{}).reduce((s,[k,v])=>s+(ev.svc?.[k]?v:0),0) : 0;
  const tot = (ev.fee||0)+svcTot;
  const avans = ev.dep||0;
  const rest = tot - avans;
  const cf = contractFields||{};
  const setF = (k,v) => onContractChange && onContractChange({...cf,[k]:v});
  const today = new Date().toLocaleDateString("ro",{day:"numeric",month:"long",year:"numeric"});
  const nrSeturi = cf.nrSeturi || (ev.rep||1);
  const durataSeturi = cf.durataSeturi || 45;
  const zileRest = cf.zileRest ?? 5;
  
  // Inline editable input styled like contract blanks
  const iS = {border:"none",borderBottom:"1.5px solid #999",borderRadius:0,padding:"1px 4px",fontSize:13,fontFamily:"Georgia,serif",background:"rgba(255,249,196,.6)",outline:"none",color:"#111",minWidth:40,textAlign:"center"};
  const Fi = ({k,placeholder,w=100,type="text",align="center"})=>(
    <input type={type} value={cf[k]||""} onChange={e=>setF(k,e.target.value)} placeholder={placeholder||"___"} style={{...iS,width:w,textAlign:align}}/>
  );

  return (
    <div style={{background:"#fff",color:"#111",padding:"32px 40px",fontFamily:"Georgia,serif",fontSize:13,lineHeight:1.85,maxWidth:720,margin:"0 auto"}}>
      {/* Header */}
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24,paddingBottom:12,borderBottom:"1px solid #ccc"}}>
        <div style={{background:"#111",borderRadius:8,padding:"10px 24px"}}><Logo height={36}/></div>
        <div style={{textAlign:"right",fontSize:11,color:"#666"}}>
          <div>T: 0744 771 488</div>
          <div style={{color:"#333",textDecoration:"underline"}}>contact@phaser.ro</div>
          <div style={{color:"#333",textDecoration:"underline"}}>www.phaser.ro</div>
        </div>
      </div>

      {/* Titlu */}
      <div style={{textAlign:"center",marginBottom:28}}>
        <div style={{fontSize:17,fontWeight:700,textTransform:"uppercase",letterSpacing:2,marginBottom:4}}>CONTRACT DE PRESTƒÇRI SERVICII</div>
        <div style={{fontSize:13,color:"#555"}}>
          NR. <Fi k="nr" w={50} placeholder="____"/> / <Fi k="dataSemnare" w={120} placeholder={today} type="text"/>
        </div>
      </div>

      {/* CAP 1 */}
      <div style={{marginBottom:20}}>
        <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:10}}>CAP. 1. PƒÇR»öILE CONTRACTANTE</div>
        <p style={{marginBottom:8,fontStyle:"italic"}}>Art.1.1 Prestatorul</p>
        <p><strong>Societatea comercialƒÉ:</strong> PHASER MUSIC SRL</p>
        <p><strong>Sediul:</strong> Timi»ôoara, Str. RƒÉsƒÉritului 17, Bl. 24, Sc. A, Et. 4, Ap. 9</p>
        <p><strong>Oficiul Na»õional al Registrului Comer»õului:</strong> Nr: J35/750/14.03.2017</p>
        <p><strong>Cod unic de √Ænregistrare:</strong> 37199434</p>
        <p><strong>Contul bancar numƒÉrul:</strong> RO79INGB00009999906674059</p>
        <p><strong>Banca:</strong> ING Bank N.V.</p>
        <p><strong>AdresƒÉ mail:</strong> contact@phaser.ro &nbsp;|&nbsp; <strong>Telefon:</strong> 0744 771 488</p>
        <p style={{marginTop:6}}>reprezentatƒÉ legal de <strong>RACZ ANDREI RADU</strong>, √Æn calitate de asociat, denumitƒÉ √Æn continuare √Æn prezentul contract <strong>Prestator</strong>.</p>

        <p style={{margin:"14px 0 8px",fontStyle:"italic"}}>Art.1.2 Beneficiarul</p>
        <p><strong>PersoanƒÉ fizicƒÉ:</strong> <Fi k="clientNume" w={200} placeholder={ev.cn||"Numele beneficiarului"} align="left"/></p>
        <p style={{marginTop:4}}>cu urmƒÉtoarele date de identificare:</p>
        <p><strong>Locul de domiciliu:</strong> Jud. <Fi k="jud" w={100} placeholder="Jude»õ"/> , Mun./Or. <Fi k="mun" w={120} placeholder="Municipiu"/> , Str. <Fi k="str" w={150} placeholder="Strada" align="left"/> , nr. <Fi k="nr2" w={50} placeholder="nr"/> , ap. <Fi k="ap" w={50} placeholder="ap"/></p>
        <p><strong>Cartea de identitate:</strong> seria <Fi k="ciSeria" w={50} placeholder="XX"/> , nr. <Fi k="ciNr" w={80} placeholder="000000"/> , CNP: <Fi k="cnp" w={140} placeholder="0000000000000"/></p>
        <p><strong>AdresƒÉ mail:</strong> <Fi k="clientEmail" w={200} placeholder={ev.ce||"email@..."} align="left"/></p>
        <p><strong>Telefon:</strong> <Fi k="clientTel" w={150} placeholder={ev.cp||"+40..."} align="left"/></p>
        <p style={{marginTop:6}}>√Æn calitate de BENEFICIAR, denumit √Æn continuare √Æn prezentul contract <strong>Beneficiar</strong>.</p>
      </div>

      {/* CAP 2 */}
      <div style={{marginBottom:20}}>
        <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:10}}>CAP. 2. OBIECTUL CONTRACTULUI</div>
        <p style={{marginBottom:6,fontStyle:"italic"}}>Art.2.1 Obiectul prezentului contract constƒÉ √Æn √Ændeplinirea activitƒÉ»õii de interpretare artisticƒÉ de cƒÉtre Prestator prin actul artistic ‚ÄûPHASER" √Æn cadrul unui eveniment {isP?"privat":"public"} organizat de Beneficiar.</p>
        <p style={{marginBottom:6,fontStyle:"italic"}}>
          Art.2.2 Evenimentul care face obiectul prezentului contract se desfƒÉ»ôoarƒÉ √Æn data de{" "}
          <Fi k="dataEv" w={120} placeholder={ev.date||"____-__-__"}/>, √Æn loca»õia <Fi k="locatie" w={160} placeholder={ev.venue||"loca»õia"} align="left"/> cu adresa: <Fi k="adresaEv" w={180} placeholder={ev.city||"adresa"} align="left"/>.
        </p>
        <p style={{fontStyle:"italic"}}>
          Art.2.3 Durata recitalului artistic este de aproximativ{" "}
          <Fi k="durataTotal" w={60} placeholder={String(nrSeturi*durataSeturi)}/> minute, √ÆmpƒÉr»õit √Æn{" "}
          <Fi k="nrSeturiInput" w={40} placeholder={String(nrSeturi)}/> seturi de aproximativ{" "}
          <Fi k="durataSeturiInput" w={50} placeholder={String(durataSeturi)}/> minute. Intervalul orar √Æn care va avea loc presta»õia nu va fi mai mare de 5 ore »ôi nu se va desfƒÉ»ôura mai t√¢rziu de ora 02:00.
        </p>
      </div>

      {/* CAP 3 */}
      <div style={{marginBottom:20}}>
        <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:10}}>CAP. 3. DURATA CONTRACTULUI</div>
        <p style={{fontStyle:"italic"}}>Art.3.1 Prezentul contract este valabil √Æncep√¢nd cu data semnƒÉrii lui »ôi √ÆnceteazƒÉ la data la care toate obliga»õiile ce decurg √Æn prezentul contract vor fi onorate.</p>
      </div>

      {/* CAP 4 */}
      <div style={{marginBottom:20}}>
        <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:10}}>CAP. 4. VALOAREA CONTRACTULUI, MODALITƒÇ»öI DE PLATƒÇ</div>
        <p style={{fontStyle:"italic",marginBottom:6}}>Art.4.1 Valoarea prezentului contract este de <strong><Fi k="valoare" w={80} placeholder={String(tot)}/> Euro</strong>.</p>
        <p style={{fontStyle:"italic",marginBottom:6}}>Art.4.2 Suma prevƒÉzutƒÉ la art.4.1 va fi plƒÉtitƒÉ √Æn contul Prestatorului √Æn RON, la cursul BNR valabil la data facturƒÉrii, prin virament bancar astfel:</p>
        <div style={{paddingLeft:24,marginBottom:6}}>
          <p>a) <strong><Fi k="avansContract" w={80} placeholder={String(avans)}/> Euro</strong> √Æn termen de 10 zile de la semnarea contractului.</p>
          <p>b) <strong><Fi k="restContract" w={80} placeholder={String(rest)}/> Euro</strong> √Æn termen de <Fi k="zileRest" w={40} placeholder="5"/> zile de la data √Æncheierii evenimentului.</p>
        </div>
        <p style={{fontStyle:"italic",marginBottom:4}}>Art.4.3 Plata de cƒÉtre Beneficiar a facturii emise de Prestator este condi»õionatƒÉ de emiterea facturii √Æntr-una din cele 2 variante:</p>
        <div style={{paddingLeft:24,marginBottom:6}}>
          <p>a) √Æn format electronic la adresa mail men»õionatƒÉ √Æn art. 1.2.</p>
          <p>b) √Æn format fizic, factura √Æn original cu semnƒÉtura »ôi »ôtampila.</p>
        </div>
        <p style={{fontStyle:"italic"}}>Art.4.4 Eventualele √Ænt√¢rzieri de platƒÉ din partea Beneficiarului vor atrage dupƒÉ sine o penalizare de 1% pentru fiecare zi de √Ænt√¢rziere, fƒÉrƒÉ a fi necesarƒÉ o notificare din partea Prestatorului »ôi fƒÉrƒÉ a fi necesarƒÉ √Ændeplinirea vreunei proceduri prealabile, penalitƒÉ»õile devenind scadente de drept din prima zi de √Ænt√¢rziere.</p>
      </div>

      {/* CAP 5 */}
      <div style={{marginBottom:20}}>
        <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:10}}>CAP. 5. DREPTURILE »òI OBLIGA»öIILE PƒÇR»öILOR</div>
        <p style={{fontStyle:"italic",marginBottom:4}}>Art.5.1 Drepturile »ôi obliga»õiile Prestatorului:</p>
        <div style={{paddingLeft:24,marginBottom:8}}>
          <p>a) se obligƒÉ sƒÉ respecte obiectul contractului de la Cap.1.</p>
          <p>b) se obligƒÉ sƒÉ respecte necesarul tehnic din anexa 1 a contractului.</p>
          <p>c) se obligƒÉ sƒÉ pƒÉstreze confiden»õialitatea acestui contract.</p>
          <p>d) Prestatorul are dreptul exclusiv de a alege repertoriul artistic ce va fi interpretat √Æn cadrul evenimentului.</p>
          <p>e) Prestatorul are dreptul sƒÉ √ÆntrerupƒÉ √Æn orice moment recitalul artistic, dacƒÉ √Æi este perturbatƒÉ interpretarea artisticƒÉ de cƒÉtre oricare participant la eveniment. Prestatorul va notifica Beneficiarul √Æn cel mai scurt timp posibil pentru remedierea situa»õiei.</p>
        </div>
        <p style={{fontStyle:"italic",marginBottom:4}}>Art.5.2 Drepturile »ôi obliga»õiile Beneficiarului:</p>
        <div style={{paddingLeft:24}}>
          <p>a) se obligƒÉ sƒÉ pƒÉstreze confiden»õialitatea acestui contract.</p>
          <p>b) se obligƒÉ sƒÉ respecte termenele de platƒÉ men»õionate la art. 4.2.</p>
          <p>c) se obligƒÉ sƒÉ respecte necesarul tehnic »ôi de ospitalitate din anexa 1 a contractului.</p>
          <p>d) se obligƒÉ sƒÉ organizeze evenimentul √Æn condi»õii de legalitate, siguran»õƒÉ, protec»õie »ôi securitate, la data, loca»õia »ôi ora men»õionatƒÉ √Æn art.1.2.</p>
          <p>e) se obligƒÉ sƒÉ se consulte cu Prestatorul √Æn vederea disponibilitƒÉ»õii loca»õiei pentru efectuarea probelor de sunet necesare bunei desfƒÉ»ôurƒÉri a serviciilor sus»õinute de Prestator (indicat ~6 ore √Ænainte de eveniment).</p>
          <p>f) se obligƒÉ sƒÉ se consulte cu Prestatorul cu cel pu»õin 14 zile √Ænainte de eveniment √Æn vederea stabilirii programului pe ore, urm√¢nd a fi stabilitƒÉ ora exactƒÉ de √Æncepere a fiecƒÉrui set de interpretare artisticƒÉ »ôi sƒÉ trimitƒÉ pe adresa de mail a Prestatorului programul pe ore cu cel pu»õin 7 zile √Ænainte.</p>
          <p>g) sƒÉ asigure spa»õiul necesar, acoperit, asigurat √Æn cazul vremii nefavorabile, cu suprafa»õa de minim 6√ó4 metri.</p>
          <p>h) Beneficiarul va ac»õiona cu diligen»õƒÉ √Æn asigurarea bunei desfƒÉ»ôurƒÉri a evenimentului »ôi solu»õionarea eventualelor diferen»õe dintre participan»õi la eveniment.</p>
          <p>i) √én situa»õia √Æn care echipamentul Prestatorului va suferi daune √Æn cadrul evenimentului din vina exclusivƒÉ a Beneficiarului sau a participan»õilor, Beneficiarul va intermedia recuperarea/√Ænlocuirea echipamentului deteriorat.</p>
        </div>
      </div>

      {/* CAP 6-12 ‚Äî condensate */}
      {[
        { nr:6, titlu:"ALTE MEN»öIUNI", text:"√énregistrarea audio sau video a recitalului artistic de cƒÉtre furnizorii foto/video ai Beneficiarului nu va fi folositƒÉ √Æn scop public, comercial sau politic. Prestatorul √Æn»õelege cƒÉ Beneficiarul nu poate controla ac»õiunile participan»õilor la eveniment »ôi este de acord cu situa»õiile √Æn care invita»õii ar putea publica √Æn scop personal imagini/√ÆnregistrƒÉri ale Prestatorului √Æn spa»õiu media." },
        { nr:7, titlu:"NOTIFICƒÇRI, COMUNICARE", text:"Orice adresƒÉ, notificare fƒÉcutƒÉ de una dintre pƒÉr»õi celeilalte va fi valabil √ÆndeplinitƒÉ doar dacƒÉ va fi transmisƒÉ prin e-mail, whatsapp sau mesaj text la adresele specificate √Æn Capitolul 1. NotificƒÉrile verbale nu se iau √Æn considerare dacƒÉ nu au fost confirmate prin modalitatea indicatƒÉ la art.7.1." },
        { nr:8, titlu:"CLAUZE SPECIALE", text:"Prestatorul √Æ»ôi rezervƒÉ dreptul de a anula presta»õia artisticƒÉ dacƒÉ Beneficiarul nu achitƒÉ avansul √Æn cel mult 30 de zile de la data scadentƒÉ. √én cazul √Æn care evenimentul se anuleazƒÉ din orice motiv care nu »õine de voin»õa Prestatorului, obliga»õiile de platƒÉ ale Beneficiarului rƒÉm√¢n neschimbate, except√¢nd situa»õiile speciale: imposibilitatea medicalƒÉ de participare a Beneficiarului respectiv a so»õiei acestuia." },
        { nr:9, titlu:"FOR»öƒÇ MAJORƒÇ", text:"PƒÉr»õile semnatare ale prezentului contract sunt exonerate de rƒÉspundere √Æn caz de for»õƒÉ majorƒÉ. Sunt considerate cazuri de for»õƒÉ majorƒÉ acele evenimente imprevizibile, insurmontabile care nu pot fi controlate de niciuna din pƒÉr»õi (urgen»õe medicale, accidente, incendii, inunda»õii, revolte, interven»õii guvernamentale, conflicte militare »ôi embargouri, calamitƒÉ»õi naturale)." },
        { nr:10, titlu:"RƒÇSPUNDERE CONTRACTUALƒÇ", text:"Rezilierea contractului poate fi cerutƒÉ de oricare parte, atunci c√¢nd cealaltƒÉ nu »ôi-a √Ændeplinit par»õial sau total obliga»õiile la care s-a angajat. √éncetarea contractului nu are efect asupra obliga»õiilor deja scadente √Æntre pƒÉr»õi la data √ÆncetƒÉrii." },
        { nr:11, titlu:"CONFIDEN»öIALITATE", text:"PƒÉr»õile convin cƒÉ toate prevederile prezentului contract, precum »ôi toate negocierile anterioare purtate √Æn vederea √Æncheierii acestuia, sunt confiden»õiale »ôi se angajeazƒÉ sƒÉ nu le divulge, cu excep»õiile legale. √éncƒÉlcarea clauzei de confiden»õialitate dƒÉ dreptul celeilalte la solicitarea unei penalitƒÉ»õi √Æn valoare de 10.000 RON." },
        { nr:12, titlu:"CLAUZE FINALE", text:"Eventualele divergen»õe √Æntre pƒÉr»õi se vor solu»õiona pe cale amiabilƒÉ, √Æn caz contrar, pƒÉr»õile se vor adresa instan»õelor judecƒÉtore»ôti competente. Prezentul contract a fost semnat √Æn 2 (douƒÉ) exemplare, c√¢te unul pentru fiecare parte." }
      ].map(cap=>(
        <div key={cap.nr} style={{marginBottom:16}}>
          <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:1,borderBottom:"1px solid #ccc",paddingBottom:4,marginBottom:8}}>CAP. {cap.nr}. {cap.titlu}</div>
          <p style={{fontStyle:"italic",color:"#333"}}>{cap.text}</p>
        </div>
      ))}

      {/* Data »ôi semnƒÉturi */}
      <div style={{marginTop:20,paddingTop:12,borderTop:"1px solid #ccc",marginBottom:28,textAlign:"center",fontStyle:"italic"}}>
        Prezentul contract a fost semnat √Æn 2 (douƒÉ) exemplare, c√¢te unul pentru fiecare parte, la data de <Fi k="dataFinal" w={150} placeholder={today}/>.
      </div>

      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:48,marginTop:20}}>
        <div>
          <div style={{fontWeight:700,marginBottom:10}}>PRESTATOR</div>
          <div style={{fontSize:12,color:"#555"}}>PHASER MUSIC SRL</div>
          <div style={{fontSize:12,color:"#555",marginBottom:36}}>Racz Andrei Radu</div>
          <div style={{borderBottom:"1.5px solid #111",width:"80%",marginBottom:4}}/>
          <div style={{fontSize:11,color:"#888"}}>SemnƒÉturƒÉ »ôi »ôtampilƒÉ</div>
        </div>
        <div>
          <div style={{fontWeight:700,marginBottom:10}}>BENEFICIAR</div>
          <div style={{fontSize:12,color:"#555"}}>{cf.clientNume||ev.cn||"_______________"}</div>
          <div style={{fontSize:12,color:"#555",marginBottom:36}}>{cf.clientTel||ev.cp||""}</div>
          <div style={{borderBottom:"1.5px solid #111",width:"80%",marginBottom:4}}/>
          <div style={{fontSize:11,color:"#888"}}>SemnƒÉturƒÉ</div>
        </div>
      </div>

      {/* Footer */}
      <div style={{marginTop:24,paddingTop:12,borderTop:"1px solid #eee",textAlign:"center",fontSize:10,color:"#aaa",letterSpacing:1}}>
        PHASER MUSIC SRL ¬∑ CUI 37199434 ¬∑ Timi»ôoara, Str. RƒÉsƒÉritului 17 ¬∑ contact@phaser.ro ¬∑ www.phaser.ro
      </div>
    </div>
  );
}
// ‚îÄ‚îÄ‚îÄ OFFER PREVIEW ‚îÄ‚îÄ‚îÄ
function OfferPreview({ ev, evStatus, onStatusChange, onOfferUpdate, th, mob, onClose, onEdit, sty, templates }) {
  const [copied, setCopied] = useState(false);
  const [mediaTitle, setMediaTitle] = useState(ev.mediaTitle||"PHASER Live");
  const [videos, setVideos] = useState(ev.videos||DEFAULT_VIDEOS);
  const syncOffer = (up)=>{ onOfferUpdate&&onOfferUpdate(ev.id,up); };
  const [covers, setCovers] = useState(ev.covers||DEFAULT_COVERS);
  const [showPlaylist, setShowPlaylist] = useState(true);
  const [configVisible, setConfigVisible] = useState(false);
  const [tab, setTab] = useState("oferta");
  const [localSt, setLocalSt] = useState(evStatus);
  const [playlistSearch, setPlaylistSearch] = useState("");
  const [contractFields, setContractFields] = useState({
    nr:"", dataSemnare:"", clientNume:ev.cn||"", clientEmail:ev.ce||"", clientTel:ev.cp||"",
    jud:"", mun:"", str:"", nr2:"", ap:"", ciSeria:"", ciNr:"", cnp:"",
    dataEv:ev.date||"", locatie:ev.venue||"", adresaEv:ev.city||"",
    durataTotal:String((ev.rep||1)*45), nrSeturiInput:String(ev.rep||1), durataSeturiInput:"45",
    valoare:String((ev.fee||0)+Object.entries(ev.svcp||{}).reduce((s,[k,v])=>s+(ev.svc?.[k]?v:0),0)),
    avansContract:String(ev.dep||0),
    restContract:String(((ev.fee||0)+Object.entries(ev.svcp||{}).reduce((s,[k,v])=>s+(ev.svc?.[k]?v:0),0))-(ev.dep||0)),
    zileRest:String(ev.zileRest??5),
    dataFinal:""
  });
  const isPriv = ev.cat==="private";
  const svcTot = isPriv ? Object.entries(ev.svcp||{}).reduce((s,[k,v])=>s+(ev.svc?.[k]?v:0),0) : 0;
  const tot = (ev.fee||0)+svcTot;
  const dk = th.bg==="#09090b";

  const handleStatus = (k) => {
    setLocalSt(k);
    onStatusChange(ev.id, k);
  };

  const copyOffer = async () => {
    const lines = ["PHASER MUSIC SRL","‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê","","OFERTƒÇ",""];
    if(ev.desc) lines.push(ev.desc,"");
    lines.push("Tip: "+(isPriv?"Privat":"Public"));
    lines.push("Loca»õie: "+(ev.venue||"‚Äî")+(ev.city?", "+ev.city:""));
    lines.push("Data: "+fD(ev.date),"");
    const repStr = ev.repDurs&&ev.repDurs.length>0 ? ev.repDurs.map((d,i)=>`R${i+1}:${d}min`).join(" ") : `${ev.rep||1} reprize √ó ${ev.repDur||45} min`;
    lines.push("PHASER ‚Äî "+repStr+" ‚Üí "+f$(ev.fee),"");
    lines.push("TOTAL: "+f$(tot),"");
    lines.push("Avans "+f$(ev.dep||0)+" √Æn 10 zile de la semnare");
    lines.push("Rest "+f$(tot-(ev.dep||0))+" √Æn "+(ev.zileRest??5)+" zile de la eveniment ‚Äî virament bancar");
    lines.push("Oferta valabilƒÉ 30 de zile.");
    try { await navigator.clipboard.writeText(lines.join("\n")); } catch(e) {
      const ta=document.createElement("textarea"); ta.value=lines.join("\n"); ta.style.cssText="position:fixed;opacity:0";
      document.body.appendChild(ta); ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
    }
    setCopied(true); setTimeout(()=>setCopied(false),2000);
  };

  const showRiderTab = !isPriv || ["Corporate","Private Party","Altele"].includes(ev.type);
  const baseTabs = isPriv
    ? (showRiderTab ? [{id:"oferta",l:"üìÑ OfertƒÉ"},{id:"rider",l:"üìã Rider"}]
                    : [{id:"oferta",l:"üìÑ OfertƒÉ"}])
    : [{id:"oferta",l:"üìÑ OfertƒÉ"},{id:"rider",l:"üìã Rider"}];
  const allTabs = ["asteptare","plata_avans","confirmat"].includes(localSt)
    ? [...baseTabs,{id:"contract",l:"üìù Contract"}]
    : baseTabs;

  return (
    <div style={{position:"fixed",inset:0,background:"rgba(0,0,0,.75)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1200}} onClick={onClose}>
      <div style={{background:"#fff",borderRadius:mob?0:16,width:mob?"100%":720,maxHeight:mob?"100vh":"93vh",height:mob?"100vh":"auto",display:"flex",flexDirection:"column",color:"#111",boxShadow:"0 32px 80px rgba(0,0,0,.5)"}} onClick={e=>e.stopPropagation()}>
        
        {/* Header cu logo »ôi status live ‚Äî culori calde */}
        <div style={{padding:"14px 20px",borderBottom:"1px solid rgba(251,191,36,.2)",display:"flex",justifyContent:"space-between",alignItems:"center",background:"linear-gradient(135deg,#1a1510 0%,#2d2419 100%)",borderRadius:mob?"0":"16px 16px 0 0",flexShrink:0}}>
          <Logo height={42}/>
          <div style={{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}}>
            {/* STATUS LIVE ‚Äî se schimbƒÉ imediat vizibil */}
            <div style={{display:"flex",gap:3,background:"rgba(255,255,255,.1)",borderRadius:8,padding:3}}>
              {Object.entries(ST).map(([k,v])=>(
                <button key={k} onClick={()=>handleStatus(k)} style={{
                  padding:"3px 8px",borderRadius:6,border:"none",fontSize:10,fontWeight:700,cursor:"pointer",
                  background:localSt===k?v.c:"transparent",
                  color:localSt===k?"#fff":v.c,
                  transition:"all .15s"
                }}>{v.l}</button>
              ))}
            </div>
            {onEdit&&<button onClick={()=>{onClose();setTimeout(()=>onEdit(ev),80);}} style={{padding:"6px 12px",borderRadius:6,border:"none",background:"rgba(255,255,255,.15)",color:"#fff",fontWeight:600,fontSize:11,cursor:"pointer",display:"flex",alignItems:"center",gap:4}}>‚úèÔ∏è EditeazƒÉ</button>}
            <button onClick={()=>{
              // GenereazƒÉ link Google Calendar pre-completat
              const title = `PHASER ¬∑ ${ev.type||"Eveniment"}${ev.venue?" @ "+ev.venue:""}`;
              const dateStr = (ev.date||"").replace(/-/g,"");
              // Ora de start ‚Äî Show Start dacƒÉ existƒÉ, altfel 20:00 implicit
              const startTime = (ev.ss||ev.li||"20:00").replace(":","");
              // Durata: numƒÉr de reprize √ó durata reprize + pauze (estimare)
              const totalMin = (ev.rep||1)*(ev.repDur||45) + Math.max(0,((ev.rep||1)-1)*20);
              const startMinutes = parseInt(startTime.slice(0,2))*60 + parseInt(startTime.slice(2,4)||"0");
              const endMinutes = startMinutes + totalMin;
              const endH = String(Math.floor(endMinutes/60)%24).padStart(2,"0");
              const endM = String(endMinutes%60).padStart(2,"0");
              const dates = dateStr
                ? `${dateStr}T${startTime}00/${dateStr}T${endH}${endM}00`
                : "";
              const desc = [
                ev.cn?"Client: "+ev.cn:"",
                ev.cp?"Tel: "+ev.cp:"",
                ev.ce?"Email: "+ev.ce:"",
                "Onorariu: "+f$(ev.fee||0),
                ev.dep?"Avans: "+f$(ev.dep):"",
                ev.desc?"\n"+ev.desc:""
              ].filter(Boolean).join("\n");
              const loc = [ev.venue, ev.city].filter(Boolean).join(", ");
              const url = `https://calendar.google.com/calendar/r/eventedit?text=${encodeURIComponent(title)}&dates=${dates}&details=${encodeURIComponent(desc)}&location=${encodeURIComponent(loc)}`;
              window.open(url,"_blank");
            }} style={{padding:"6px 12px",borderRadius:6,border:"none",background:"rgba(255,255,255,.15)",color:"#fff",fontWeight:600,fontSize:11,cursor:"pointer",display:"flex",alignItems:"center",gap:4}}>
              üìÖ Calendar
            </button>
            <button onClick={copyOffer} style={{padding:"6px 12px",borderRadius:6,border:"none",background:copied?"#22c55e":"rgba(255,255,255,.15)",color:"#fff",fontWeight:600,fontSize:11,cursor:"pointer"}}>{copied?"‚úì Copiat!":"CopiazƒÉ"}</button>
            <button onClick={()=>{
              // Open print dialog ‚Äî browser saves as PDF
              const printWin = window.open("","_blank","width=800,height=900");
              const offerEl = document.getElementById("offer-print-content");
              if(offerEl && printWin) {
                printWin.document.write(`<!DOCTYPE html><html><head><meta charset="utf-8"><title>Oferta PHASER</title><style>*{box-sizing:border-box;margin:0;padding:0;font-family:'Helvetica Neue',Arial,sans-serif}body{background:#f4f4f4;padding:20px}@media print{body{padding:0;background:#fff}.no-print{display:none!important}}</style></head><body>${offerEl.innerHTML}</body></html>`);
                printWin.document.close();
                setTimeout(()=>printWin.print(), 500);
              }
            }} style={{padding:"6px 12px",borderRadius:6,border:"none",background:"rgba(255,255,255,.15)",color:"#fff",fontWeight:600,fontSize:11,cursor:"pointer",display:"flex",alignItems:"center",gap:4}}>
              <IcFile s={12}/> PDF
            </button>
            <button onClick={onClose} style={{padding:4,border:"none",background:"transparent",color:"rgba(255,255,255,.6)",cursor:"pointer"}}><IcX s={16}/></button>
          </div>
        </div>

        {/* Tabs */}
        <div style={{display:"flex",gap:1,padding:"8px 16px",borderBottom:"1px solid #e5e5e5",background:"#fafafa",flexShrink:0,overflowX:"auto"}}>
          {allTabs.map(t=><button key={t.id} onClick={()=>setTab(t.id)} style={{padding:"6px 14px",borderRadius:7,border:"none",fontSize:12,fontWeight:tab===t.id?700:400,cursor:"pointer",background:tab===t.id?"#111":"transparent",color:tab===t.id?"#fff":"#555",whiteSpace:"nowrap"}}>{t.l}</button>)}
        </div>

        {/* OFERTƒÇ */}
                {tab==="oferta"&&<div style={{flex:1,overflow:"auto",background:"#f4f4f4"}}>
          {/* Configurare ‚Äî collapsibilƒÉ, ascunsƒÉ implicit dupƒÉ creare */}
          {isPriv&&<div style={{maxWidth:560,margin:"0 auto",padding:mob?"16px":"24px 16px",marginBottom:20}}>
            {!configVisible?<button onClick={()=>setConfigVisible(true)} style={{padding:"8px 14px",borderRadius:8,border:"1px dashed #ccc",background:"#fff",fontSize:11,color:"#888",cursor:"pointer",display:"flex",alignItems:"center",gap:6}}>+ Afi»ôeazƒÉ configurare (media, playlist)</button>:<>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
              <div style={{fontSize:11,fontWeight:700,color:"#666",textTransform:"uppercase",letterSpacing:1}}>Configurare ofertƒÉ</div>
              <button onClick={()=>setConfigVisible(false)} style={{fontSize:10,color:"#888",background:"transparent",border:"none",cursor:"pointer"}}>Ascunde</button>
            </div>
            <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:12}}>
              <div style={{background:"#fff",borderRadius:12,padding:"16px 20px",border:"1px solid #e5e5e5"}}>
                <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:12}}>Media ‚Äî video-uri √Æn ofertƒÉ</div>
                <input value={mediaTitle} onChange={e=>{setMediaTitle(e.target.value);syncOffer({mediaTitle:e.target.value});}} placeholder="Titlu sec»õiune (ex: PHASER Live)" style={{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid #e5e5e5",fontSize:12,marginBottom:12}}/>
                {videos.map(v=>(
                  <div key={v.id} style={{display:"flex",alignItems:"center",gap:10,padding:"8px 0",borderBottom:"1px solid #eee"}}>
                    <input type="checkbox" checked={v.checked} onChange={()=>{const nv=videos.map(x=>x.id===v.id?{...x,checked:!x.checked}:x);setVideos(nv);syncOffer({videos:nv});}} style={{accentColor:"#111",width:14,height:14,cursor:"pointer"}}/>
                    <span style={{fontSize:11,flex:1,color:"#333"}}>{v.title||"Video"}</span>
                    <input value={v.caption||""} onChange={e=>{const nv=videos.map(x=>x.id===v.id?{...x,caption:e.target.value}:x);setVideos(nv);syncOffer({videos:nv});}} placeholder="Caption" style={{flex:1,padding:"4px 8px",fontSize:11,borderRadius:6,border:"1px solid #e5e5e5"}}/>
                  </div>
                ))}
              </div>
              <div style={{background:"#fff",borderRadius:12,padding:"16px 20px",border:"1px solid #e5e5e5"}}>
                <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:12}}>Playlist ‚Äî selecteazƒÉ piese</div>
                <div style={{position:"relative",marginBottom:10}}>
                  <IcSearch s={13} style={{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:"#aaa",pointerEvents:"none"}}/>
                  <input value={playlistSearch} onChange={e=>setPlaylistSearch(e.target.value)} placeholder="CautƒÉ c√¢ntec sau artist..." style={{width:"100%",padding:"7px 12px 7px 32px",borderRadius:8,border:"1px solid #e5e5e5",fontSize:12}}/>
                </div>
                <div style={{display:"flex",gap:6,marginBottom:10}}>
                  <button onClick={()=>{const nv=covers.map(c=>({...c,checked:true}));setCovers(nv);syncOffer({covers:nv});}} style={{padding:"3px 10px",borderRadius:6,border:"1px solid #e5e5e5",background:"#fff",fontSize:11,cursor:"pointer",color:"#333"}}>SelecteazƒÉ tot</button>
                  <button onClick={()=>{const nv=covers.map(c=>({...c,checked:false}));setCovers(nv);syncOffer({covers:nv});}} style={{padding:"3px 10px",borderRadius:6,border:"1px solid #e5e5e5",background:"#fff",fontSize:11,cursor:"pointer",color:"#333"}}>DeselecteazƒÉ tot</button>
                </div>
                <div style={{maxHeight:180,overflow:"auto",display:"flex",flexDirection:"column",gap:2}}>
                  {covers.filter(c=>!playlistSearch||c.title.toLowerCase().includes(playlistSearch.toLowerCase())||(c.artist||'').toLowerCase().includes(playlistSearch.toLowerCase())).map((c)=>(
                    <div key={c.id} onClick={()=>{const nv=covers.map(x=>x.id===c.id?{...x,checked:!x.checked}:x);setCovers(nv);syncOffer({covers:nv});}}
                      style={{display:"flex",alignItems:"center",gap:10,padding:"6px 10px",borderRadius:7,border:`1px solid ${c.checked?"#111":"#ebebeb"}`,background:c.checked?"#f0f0f0":"#fff",cursor:"pointer",fontSize:12}}>
                      <div style={{width:14,height:14,borderRadius:4,border:`2px solid ${c.checked?"#111":"#ccc"}`,background:c.checked?"#111":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>{c.checked&&<IcCheck s={8} style={{color:"#fff"}}/>}</div>
                      <span style={{flex:1,fontWeight:600,color:"#222"}}>{c.title}</span>
                      <span style={{fontSize:11,color:"#888"}}>‚Äî {c.artist}</span>
                    </div>
                  ))}
                </div>
              </div>
            </div>
            </>}
          </div>}
          {/* OfertƒÉ stilizatƒÉ ‚Äî de trimis la client / PDF */}
          <div id="offer-print-content" style={{maxWidth:560,margin:"0 auto",padding:mob?"16px":"24px 16px"}}>

            {/* Header card ‚Äî culori calde, logo mare */}
            <div style={{background:"linear-gradient(135deg,#1a1510 0%,#2d2419 50%,#1a1510 100%)",borderRadius:16,padding:"28px 28px 24px",marginBottom:12,position:"relative",overflow:"hidden",border:"1px solid rgba(245,158,11,.15)"}}>
              <div style={{position:"absolute",top:0,right:0,width:240,height:240,background:"radial-gradient(circle,rgba(245,158,11,.08) 0%,transparent 70%)",pointerEvents:"none"}}/>
              <img src={LOGO_URL} alt="PHASER" style={{height:64,display:"block",marginBottom:24,objectFit:"contain",objectPosition:"left",filter:"brightness(1.1)"}}/>
              <div style={{fontSize:10,color:"rgba(251,191,36,.6)",letterSpacing:3,textTransform:"uppercase",marginBottom:8}}>OfertƒÉ de colaborare</div>
              <div style={{fontSize:22,fontWeight:700,color:"#fff",marginBottom:4}}>{ev.offerNr?"O"+ev.offerNr+" ¬∑ ":""}{ev.type}</div>
              <div style={{fontSize:13,color:"rgba(251,191,36,.5)"}}>{ev.venue||""}{ev.city?", "+ev.city:""}</div>
              <div style={{marginTop:16,paddingTop:16,borderTop:"1px solid rgba(251,191,36,.12)",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div>
                  <div style={{fontSize:10,color:"rgba(251,191,36,.5)",letterSpacing:1,textTransform:"uppercase"}}>Data</div>
                  <div style={{fontSize:14,fontWeight:600,color:"#fff",marginTop:2}}>{fD(ev.date)}</div>
                </div>
                <div style={{textAlign:"right"}}>
                  <div style={{fontSize:10,color:"rgba(251,191,36,.5)",letterSpacing:1,textTransform:"uppercase"}}>Total</div>
                  <div style={{fontSize:22,fontWeight:800,color:"#fbbf24",marginTop:2}}>{f$(tot)}</div>
                </div>
              </div>
            </div>

            {/* Despre noi + Video ‚Äî la √Ænceput, √Ænainte de ofertƒÉ */}
            {isPriv&&(ev.poveste||templates?.poveste)&&<div style={{background:"#fff",borderRadius:12,padding:"20px 24px",marginBottom:8,borderLeft:"4px solid #111"}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:12}}>Despre noi</div>
              <div style={{fontSize:14,color:"#333",lineHeight:1.8,fontStyle:"italic"}}>{ev.poveste||templates?.poveste}</div>
            </div>}
            {/* Presta»õie */}
            <div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:14}}>Presta»õie artisticƒÉ</div>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div>
                  <div style={{fontWeight:700,fontSize:15,color:"#111"}}>PHASER ‚Äî live</div>
                  <div style={{fontSize:12,color:"#888",marginTop:3}}>
                    {isPriv
                      ? ((ev.repDurs&&ev.repDurs.length>0)
                          ? ev.repDurs.map((d,i)=>`R${i+1}: ${d}min`).join(" ¬∑ ")
                          : `${ev.rep||1} ${(ev.rep||1)===1?"reprizƒÉ":"reprize"} √ó ${ev.repDur||45} min`)
                      : (ev.durataRecital||`${ev.rep||1}√ó45 min`)
                    } ¬∑ muzicƒÉ live
                  </div>
                </div>
                <div style={{fontSize:18,fontWeight:800,color:"#111"}}>{f$(ev.fee)}</div>
              </div>
            </div>

            {/* Servicii extra */}
            {isPriv&&Object.values(ev.svc||{}).some(v=>v)&&<div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:14}}>Echipamente & Extra</div>
              {ev.svc?.sunet&&<div style={{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:"1px solid #f5f5f5"}}><span style={{fontSize:13,color:"#444"}}>Sistem sunet</span><span style={{fontWeight:600,fontSize:13}}>{f$(ev.svcp?.sunet)}</span></div>}
              {ev.svc?.lumini&&<div style={{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:"1px solid #f5f5f5"}}><span style={{fontSize:13,color:"#444"}}>Sistem lumini</span><span style={{fontWeight:600,fontSize:13}}>{f$(ev.svcp?.lumini)}</span></div>}
              {ev.svc?.ecran&&<div style={{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:"1px solid #f5f5f5"}}><span style={{fontSize:13,color:"#444"}}>Ecran LED (3√ó2)</span><span style={{fontWeight:600,fontSize:13}}>{f$(ev.svcp?.ecran)} + 1 meniu + 1 camerƒÉ twin</span></div>}
              {ev.svc?.scena&&<div style={{display:"flex",justifyContent:"space-between",padding:"5px 0",borderBottom:"1px solid #f5f5f5"}}><span style={{fontSize:13,color:"#444"}}>ScenƒÉ / Podium</span><span style={{fontWeight:600,fontSize:13}}>{f$(ev.svcp?.scena)}</span></div>}
              {ev.svc?.dj&&<div style={{display:"flex",justifyContent:"space-between",padding:"5px 0"}}><span style={{fontSize:13,color:"#444"}}>DJ</span><span style={{fontWeight:600,fontSize:13}}>{f$(ev.svcp?.dj)} + 1 meniu</span></div>}
              {(ev.svc?.sunet||ev.svc?.lumini||ev.svc?.ecran||ev.svc?.scena)&&<div style={{fontSize:11,color:"#888",marginTop:10,paddingTop:10,borderTop:"1px solid #f5f5f5"}}>Echipamentele tehnice vin cu operatori tehnici disponibili pe tot parcursul evenimentului.</div>}
            </div>}

            {/* Cazare, Transport, Protocol ‚Äî conform model PDF */}
            {isPriv&&ev.hosp&&<div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:14}}>Cazare »ôi Transport</div>
              {[
                `Cazare ‚Äî ${ev.hosp.camere??4} camere twin la loca»õie sau √Æn apropierea ei`,
                `Transport ‚Äî 3 RON/KM (din Timi»ôoara)`,
              ].map((item,i)=>(
                <div key={i} style={{display:"flex",alignItems:"center",gap:10,padding:"6px 0",borderBottom:"1px solid #f5f5f5"}}>
                  <div style={{width:6,height:6,borderRadius:"50%",background:"#22c55e",flexShrink:0}}/>
                  <span style={{fontSize:13,color:"#444"}}>{item}</span>
                </div>
              ))}
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginTop:14,marginBottom:10}}>Protocol</div>
              {(ev.hosp.protocolOverride||"").trim() ? (
                <div style={{fontSize:13,color:"#444",lineHeight:1.7,whiteSpace:"pre-line"}}>{(ev.hosp.protocolOverride||"").trim()}</div>
              ) : [
                `${ev.hosp.meniuri??6} meniuri de m√¢ncare »ôi bƒÉuturƒÉ identice cu cele ale invita»õilor pentru seara evenimentului`,
                ...(ev.hosp.pranz?[`O masƒÉ de pr√¢nz pentru ${ev.hosp.meniuri??6} persoane dupƒÉ instalare`]:[]),
                ...(ev.hosp.micDejun?[`Mic dejun pentru ${ev.hosp.meniuri??6} persoane a doua zi dupƒÉ eveniment`]:[]),
                ...(ev.hosp.extra||[]).filter(e=>e.l).map(e=>e.l),
              ].map((item,i,arr)=>(
                <div key={"p-"+i} style={{display:"flex",alignItems:"center",gap:10,padding:"6px 0",borderBottom:i<arr.length-1?"1px solid #f5f5f5":"none"}}>
                  <div style={{width:6,height:6,borderRadius:"50%",background:"#22c55e",flexShrink:0}}/>
                  <span style={{fontSize:13,color:"#444"}}>{item}</span>
                </div>
              ))}
            </div>}
            {isPriv&&ev.includeTehnicAnnex&&ev.tehnic&&ev.tehnic.filter(t=>t.checked).length>0&&<div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:14}}>Necesar tehnic</div>
              {ev.tehnic.filter(t=>t.checked).map((t,i,arr)=>(
                <div key={t.id} style={{display:"flex",alignItems:"center",gap:10,padding:"6px 0",borderBottom:i<arr.length-1?"1px solid #f5f5f5":"none"}}>
                  <div style={{width:6,height:6,borderRadius:"50%",background:"#f59e0b",flexShrink:0}}/>
                  <span style={{fontSize:13,color:"#444"}}>{t.l}</span>
                </div>
              ))}
            </div>}

            {/* PlatƒÉ */}
            <div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999",marginBottom:14}}>Modalitate platƒÉ</div>
              <div style={{textAlign:"center",padding:"12px 0",marginBottom:12,borderBottom:"1px solid #f0f0f0"}}>
                <div style={{fontSize:10,color:"#999",textTransform:"uppercase",letterSpacing:1}}>Total</div>
                <div style={{fontSize:24,fontWeight:800,color:"#111",marginTop:4}}>{f$(tot)}</div>
              </div>
              <div style={{display:"flex",gap:10,marginBottom:10}}>
                <div style={{flex:1,background:"#f9f9f9",borderRadius:8,padding:"12px 14px",border:"1px solid #f0f0f0"}}>
                  <div style={{fontSize:10,color:"#999",textTransform:"uppercase",letterSpacing:1}}>Avans</div>
                  <div style={{fontSize:18,fontWeight:800,color:"#111",marginTop:4}}>{f$(ev.dep||0)}</div>
                  <div style={{fontSize:10,color:"#bbb",marginTop:2}}>√Æn 10 zile de la √Æncheierea contractului</div>
                </div>
                <div style={{flex:1,background:"#f9f9f9",borderRadius:8,padding:"12px 14px",border:"1px solid #f0f0f0"}}>
                  <div style={{fontSize:10,color:"#999",textTransform:"uppercase",letterSpacing:1}}>Rest</div>
                  <div style={{fontSize:18,fontWeight:800,color:"#111",marginTop:4}}>{f$(tot-(ev.dep||0))}</div>
                  <div style={{fontSize:10,color:"#bbb",marginTop:2}}>√Æn {(ev.zileRest??5)} zile de la eveniment</div>
                </div>
              </div>
              <div style={{fontSize:11,color:"#bbb",textAlign:"center"}}>Oferta este valabilƒÉ 30 de zile ¬∑ Pre»õurile vor fi calculate √Æn RON la data facturƒÉrii »ôi includ toate taxele aferente</div>
            </div>

            {/* Media / PHASER Live ‚Äî dupƒÉ platƒÉ, cu video-uri selectate (doar afi»ôare, fƒÉrƒÉ input √Æn PDF) */}
            {isPriv&&videos.filter(v=>v.checked).length>0&&<div style={{background:"#fff",borderRadius:12,padding:"20px 24px",marginBottom:8,borderLeft:"4px solid #111"}}>
              <div style={{fontSize:14,fontWeight:700,color:"#111",marginBottom:16}}>{mediaTitle||"PHASER Live"}</div>
              {videos.filter(v=>v.checked).map((v,i)=>(
                <div key={v.id} style={{marginBottom:i<videos.filter(x=>x.checked).length-1?20:0}}>
                  <div style={{position:"relative",paddingBottom:"56.25%",height:0,marginBottom:8}}>
                    <iframe src={v.url} title={v.title} style={{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}} allowFullScreen/>
                  </div>
                  {(v.caption||"").trim()&&<div style={{fontSize:12,color:"#555",fontStyle:"italic",padding:"4px 0"}}>{v.caption}</div>}
                </div>
              ))}
            </div>}

            {/* Descriere */}
            {ev.desc&&<div style={{background:"#fff",borderRadius:12,padding:"16px 20px",marginBottom:8,borderLeft:"3px solid #111"}}>
              <div style={{fontSize:13,color:"#555",lineHeight:1.7,fontStyle:"italic"}}>{ev.desc}</div>
            </div>}

            {/* Playlist ‚Äî la final */}
            {isPriv&&covers.filter(c=>c.checked).length>0&&showPlaylist&&<div style={{background:"#fff",borderRadius:12,padding:"18px 20px",marginBottom:8}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
                <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"#999"}}>Playlist</div>
                <button onClick={()=>setShowPlaylist(false)} style={{fontSize:10,color:"#bbb",background:"transparent",border:"none",cursor:"pointer"}}>Ascunde</button>
              </div>
              <div style={{columns:mob?1:2,columnGap:24}}>
                {covers.filter(c=>c.checked).map((c,i)=>(
                  <div key={c.id} style={{display:"flex",alignItems:"baseline",gap:6,padding:"3px 0",breakInside:"avoid",borderBottom:"1px solid #f5f5f5"}}>
                    <span style={{fontSize:10,color:"#bbb",minWidth:20,textAlign:"right",flexShrink:0}}>{i+1}.</span>
                    <span style={{fontSize:11,fontWeight:600,color:"#333",flex:1}}>{c.title}</span>
                    <span style={{fontSize:10,color:"#999",flexShrink:0}}>‚Äî {c.artist}</span>
                  </div>
                ))}
              </div>
            </div>}
            {isPriv&&!showPlaylist&&<button onClick={()=>setShowPlaylist(true)} style={{width:"100%",padding:"10px",borderRadius:12,border:"1px dashed #ddd",background:"transparent",fontSize:11,color:"#bbb",cursor:"pointer",marginBottom:8}}>+ Afi»ôeazƒÉ playlist</button>}

            {/* Footer */}
            <div style={{textAlign:"center",padding:"16px 0 8px",fontSize:10,color:"#bbb",letterSpacing:1}}>
              PHASER MUSIC SRL ¬∑ CUI 37199434 ¬∑ contact@phaser.ro ¬∑ 0744 771 488
            </div>
          </div>
        </div>}

{/* RIDER */}
        {tab==="rider"&&!isPriv&&<div style={{flex:1,overflow:"auto",background:"#fff"}}>
          {/* Header Rider */}
          <div style={{padding:"20px 28px",background:"#111",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0}}>
            <Logo height={40}/>
            <div style={{textAlign:"right"}}>
              <div style={{fontSize:9,color:"rgba(255,255,255,.3)",letterSpacing:2,textTransform:"uppercase"}}>Document oficial</div>
              <div style={{fontSize:13,fontWeight:700,color:"#fff",letterSpacing:1}}>RIDER TEHNIC »òI DE OSPITALITATE</div>
            </div>
          </div>

          <div style={{padding:mob?"16px":"24px 32px",fontFamily:"Georgia,serif",color:"#222"}}>
            {/* Trupa / FOH */}
            <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:12,marginBottom:24,padding:16,background:"#f8f8f8",borderRadius:10,border:"1px solid #e5e5e5"}}>
              <div>
                <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1,color:"#666",marginBottom:8}}>TRUPA</div>
                {["Radu Racz  +40 744 771 488","Carina Dumitru","Arnold Birta","Sebastian B√¢rzeianu","Lucian Opri»ôan","contact@phaser.ro"].map((m,i)=>
                  <div key={i} style={{fontSize:12,color:i===5?"#0066cc":"#333",marginBottom:2}}>{m}</div>
                )}
              </div>
              <div>
                <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1,color:"#666",marginBottom:8}}>FOH</div>
                <div style={{fontSize:12,color:"#333"}}>Bogdan Racz  +40 745 602 161</div>
                <div style={{fontSize:12,color:"#0066cc"}}>contact@aiciprezent.ro</div>
              </div>
            </div>

            {/* RIDER TEHNIC */}
            <div style={{textAlign:"center",fontSize:16,fontWeight:700,textTransform:"uppercase",letterSpacing:2,marginBottom:20,borderBottom:"2px solid #111",paddingBottom:12}}>RIDER TEHNIC</div>

            {/* Sectiuni principale */}
            {[RIDER_TEHNIC.sunet, RIDER_TEHNIC.scena, RIDER_TEHNIC.probe, RIDER_TEHNIC.lumini, RIDER_TEHNIC.video].map((sec,i)=>(
              <div key={i} style={{marginBottom:16}}>
                <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5,marginBottom:6}}>{sec.titlu}</div>
                <p style={{fontSize:12,color:"#444",lineHeight:1.7,marginBottom:4}}>{sec.text}</p>
                {sec.req&&<p style={{fontSize:12,color:"#333",fontWeight:600}}>{sec.req}</p>}
              </div>
            ))}

            {/* Necesar scenƒÉ */}
            <div style={{marginBottom:20}}>
              <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5,marginBottom:10}}>NECESAR SCENƒÇ / ECHIPAMENTE / CONECTICƒÇ</div>
              <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:10}}>
                {[
                  {titlu:"Risere", items:RIDER_TEHNIC.risere},
                  {titlu:"Monitoare", items:RIDER_TEHNIC.monitoare},
                  {titlu:"Stative", items:RIDER_TEHNIC.stative},
                  {titlu:"Cabluri / Curent", items:RIDER_TEHNIC.cabluri},
                  {titlu:"ConecticƒÉ", items:RIDER_TEHNIC.conectica},
                ].map((gr,i)=>(
                  <div key={i} style={{padding:12,borderRadius:8,border:"1px solid #e8e8e8",background:"#fafafa"}}>
                    <div style={{fontWeight:700,fontSize:11,marginBottom:6}}>{gr.titlu}</div>
                    {gr.items.map((item,j)=><div key={j} style={{fontSize:11,color:"#555",paddingLeft:8,marginBottom:2}}>‚Äì {item}</div>)}
                  </div>
                ))}
              </div>
            </div>

            {/* Plan amplasament / Stage plot ‚Äî imagine din document */}
            <div style={{marginBottom:20,padding:14,borderRadius:10,border:"1px solid #e5e5e5",background:"#fafafa"}}>
              <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5,marginBottom:12}}>PLAN AMPLASAMENT / STAGE PLOT</div>
              <img src="StagePlot.png" alt="Stage plot PHASER" style={{width:"100%",maxWidth:600,height:"auto",borderRadius:8,display:"block"}} />
            </div>

            {/* Instalare, Parcare, Securitate */}
            <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr 1fr",gap:10,marginBottom:24}}>
              {[
                {titlu:"INSTALARE", text:RIDER_TEHNIC.instalare},
                {titlu:"PARCARE", text:RIDER_TEHNIC.parcare},
                {titlu:"SECURITATE", text:RIDER_TEHNIC.securitate},
              ].map((x,i)=>(
                <div key={i} style={{padding:12,borderRadius:8,border:"1px solid #e8e8e8",background:"#fafafa"}}>
                  <div style={{fontWeight:700,fontSize:11,textTransform:"uppercase",letterSpacing:.5,marginBottom:6}}>{x.titlu}</div>
                  <div style={{fontSize:11,color:"#555",lineHeight:1.6}}>{x.text}</div>
                </div>
              ))}
            </div>

            {/* Contact tehnic */}
            <div style={{textAlign:"center",marginBottom:20,fontSize:12,color:"#555",fontStyle:"italic"}}>
              Pentru a confirma aspectele tehnice necesare vƒÉ rugƒÉm sƒÉ ne contacta»õi:<br/>
              <strong style={{color:"#111"}}>{RIDER_TEHNIC.contact}</strong>
            </div>

            {/* RIDER OSPITALITATE */}
            <div style={{textAlign:"center",fontSize:16,fontWeight:700,textTransform:"uppercase",letterSpacing:2,marginBottom:20,borderBottom:"2px solid #111",paddingBottom:12}}>RIDER DE OSPITALITATE</div>

            <div style={{marginBottom:16}}>
              <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5,marginBottom:10}}>BACKSTAGE ROOM</div>
              <div style={{display:"grid",gridTemplateColumns:mob?"1fr 1fr":"1fr 1fr 1fr",gap:6}}>
                {RIDER_TEHNIC.backstage.map((item,i)=>(
                  <div key={i} style={{display:"flex",alignItems:"flex-start",gap:6,padding:"6px 10px",borderRadius:6,background:"#f5f5f5",border:"1px solid #ebebeb"}}>
                    <span style={{color:"#22c55e",flexShrink:0,marginTop:1}}>‚óè</span>
                    <span style={{fontSize:11,color:"#444",lineHeight:1.4}}>{item}</span>
                  </div>
                ))}
              </div>
              <div style={{marginTop:10,padding:10,borderRadius:6,background:"#fffef0",border:"1px solid #f0e68c",fontSize:11,color:"#555",fontStyle:"italic"}}>
                *√én cazul evenimentelor corporate unde servirea se face pe baza unor cartele sau bonuri, dorim servirea directƒÉ √Æn backstage pentru a evita eventualele √Ænt√¢rzieri care pot afecta programul.
              </div>
            </div>

            <div style={{marginBottom:20}}>
              <div style={{fontWeight:700,fontSize:12,textTransform:"uppercase",letterSpacing:.5,marginBottom:10}}>ON STAGE</div>
              {RIDER_TEHNIC.onStage.map((item,i)=>(
                <div key={i} style={{display:"flex",alignItems:"center",gap:6,padding:"6px 10px",borderRadius:6,background:"#f5f5f5",border:"1px solid #ebebeb",marginBottom:4}}>
                  <span style={{color:"#22c55e"}}>‚óè</span>
                  <span style={{fontSize:11,color:"#444"}}>{item}</span>
                </div>
              ))}
            </div>

            <div style={{textAlign:"center",fontWeight:700,fontSize:14,letterSpacing:1,marginBottom:16}}>VƒÇ MUL»öUMIM!</div>
            <div style={{textAlign:"center",fontSize:11,color:"#aaa"}}>www.phaser.ro</div>
          </div>
        </div>}

        {/* CONTRACT */}
        {tab==="contract"&&<div style={{flex:1,overflow:"auto"}}>
          <ContractView ev={ev} th={th} contractFields={contractFields} onContractChange={setContractFields}/>
        </div>}
      </div>
    </div>
  );
}

function SectO({ title, children }) {
  return <div style={{marginBottom:20}}>
    <div style={{fontSize:11,fontWeight:800,textTransform:"uppercase",letterSpacing:2,borderBottom:"2px solid #111",paddingBottom:5,marginBottom:10,color:"#111"}}>{title}</div>
    {children}
  </div>;
}
function Row({ l, v }) {
  return <div style={{display:"grid",gridTemplateColumns:"130px 1fr",gap:"4px 10px",padding:"3px 0"}}>
    <span style={{color:"#666",fontSize:12}}>{l}:</span><span style={{fontWeight:700,fontSize:13}}>{v}</span>
  </div>;
}


// ‚îÄ‚îÄ‚îÄ LOCATION SEARCH (OpenStreetMap Nominatim ‚Äî gratuit, fƒÉrƒÉ API key) ‚îÄ‚îÄ‚îÄ
const RO_CITIES = [
  {n:"Timi»ôoara",km:0},{n:"Arad",km:54},{n:"Lugoj",km:60},{n:"Re»ôi»õa",km:80},
  {n:"Deva",km:120},{n:"OrƒÉ»ôtie",km:150},{n:"Cluj-Napoca",km:140},{n:"Oradea",km:160},
  {n:"Alba Iulia",km:180},{n:"Sibiu",km:210},{n:"Hunedoara",km:130},{n:"Caransebe»ô",km:85},
  {n:"Lipova",km:65},{n:"Ineu",km:80},{n:"S√¢nnicolau Mare",km:45},{n:"Jimbolia",km:50},
  {n:"Buzia»ô",km:35},{n:"Reca»ô",km:20},{n:"DumbrƒÉvi»õa",km:8},{n:"Giroc",km:5},
  {n:"Ghiroda",km:6},{n:"Mo»ôni»õa",km:12},{n:"BucovƒÉ»õ",km:15},{n:"SƒÉcƒÉlaz",km:15},
  {n:"Bucharest",km:550},{n:"Bucure»ôti",km:550},{n:"Bra»ôov",km:350},{n:"Constan»õa",km:680},
  {n:"Ia»ôi",km:600},{n:"Craiova",km:350},{n:"Gala»õi",km:620},{n:"Ploie»ôti",km:500},
  {n:"BrƒÉila",km:600},{n:"BacƒÉu",km:520},{n:"Pite»ôti",km:450},{n:"R√¢mnicu V√¢lcea",km:380},
  {n:"Suceava",km:650},{n:"Baia Mare",km:280},{n:"Satu Mare",km:220},{n:"Bistri»õa",km:310},
  {n:"Sf√¢ntu Gheorghe",km:400},{n:"Miercurea Ciuc",km:440},{n:"T√¢rgu Mure»ô",km:290},
  {n:"Foc»ôani",km:560},{n:"Tulcea",km:710},{n:"Alexandria",km:520},{n:"Giurgiu",km:570},
  {n:"Drobeta-Turnu Severin",km:260},{n:"Slobozia",km:600},{n:"ZalƒÉu",km:190},
  {n:"Bihor",km:160},{n:"T√¢rgovi»ôte",km:480},{n:"BuzƒÉu",km:530},{n:"Slatina",km:400},
  {n:"Turda",km:160},{n:"C√¢mpia Turzii",km:155},{n:"Media»ô",km:240},{n:"Sebe»ô",km:190},
];

function LocationSearch({ venue, city, dist, onUpdate, sty, th, mob }) {
  const [venueVal, setVenueVal] = useState(venue||"");
  const [cityQuery, setCityQuery] = useState(city||"");
  const [showCityDrop, setShowCityDrop] = useState(false);
  const [venueResults, setVenueResults] = useState([]);
  const [showVenueDrop, setShowVenueDrop] = useState(false);
  const [venueAddress, setVenueAddress] = useState("");
  const [venueMapUrl, setVenueMapUrl] = useState("");
  const [searching, setSearching] = useState(false);
  const debounceRef = useRef(null);
  const iStyle = {...sty.i, fontSize: mob?"16px":"14px"};

  // CautƒÉ pe OpenStreetMap Nominatim dupƒÉ ce userul terminƒÉ de scris (debounce 600ms)
  const searchNominatim = (query) => {
    if (debounceRef.current) clearTimeout(debounceRef.current);
    if (!query || query.length < 3) { setVenueResults([]); setShowVenueDrop(false); return; }
    debounceRef.current = setTimeout(async () => {
      setSearching(true);
      try {
        // AdaugƒÉ ora»ôul √Æn query dacƒÉ e completat ‚Äî rezultate mai precise
        const q = cityQuery ? `${query}, ${cityQuery}` : `${query}, Romania`;
        const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(q)}&format=json&limit=6&addressdetails=1&accept-language=ro&countrycodes=ro`;
        const res = await fetch(url);
        const data = await res.json();
        setVenueResults(data);
        setShowVenueDrop(data.length > 0);
      } catch(e) {
        setVenueResults([]);
      }
      setSearching(false);
    }, 600);
  };

  const pickVenue = (place) => {
    // Numele venue-ului ‚Äî prima parte din display_name (√Ænainte de prima virgulƒÉ)
    const nameParts = (place.display_name || "").split(",");
    const name = nameParts[0].trim();
    const addr = place.display_name || "";
    const a = place.address || {};
    const cityName = a.city || a.town || a.village || a.municipality || a.county || "";
    const mapUrl = `https://www.openstreetmap.org/?mlat=${place.lat}&mlon=${place.lon}&zoom=17`;

    // Distan»õƒÉ fa»õƒÉ de TM
    const cityMatch = RO_CITIES.find(c =>
      cityName.toLowerCase().includes(c.n.toLowerCase()) ||
      c.n.toLowerCase().includes(cityName.toLowerCase())
    );
    const distKm = cityMatch ? cityMatch.km : 0;

    setVenueVal(name);
    setCityQuery(cityName);
    setVenueAddress(addr);
    setVenueMapUrl(mapUrl);
    setShowVenueDrop(false);
    setVenueResults([]);
    onUpdate({ venue: name, city: cityName, dist: distKm });
  };

  const handleVenueChange = (v) => {
    setVenueVal(v);
    setVenueAddress("");
    setVenueMapUrl("");
    onUpdate({ venue: v, city: cityQuery, dist: dist||0 });
    searchNominatim(v);
  };

  const filteredCities = cityQuery.length>0
    ? RO_CITIES.filter(c=>c.n.toLowerCase().includes(cityQuery.toLowerCase())).slice(0,6)
    : [];

  const pickCity = (c) => {
    setCityQuery(c.n);
    setShowCityDrop(false);
    onUpdate({ venue: venueVal, city: c.n, dist: c.km });
  };

  // Formatare adresƒÉ scurtƒÉ pentru dropdown (scoate Rom√¢nia »ôi codul po»ôtal)
  const shortAddr = (displayName) => {
    return displayName.split(",").slice(1,4).join(",").replace(/\d{6}/g,"").replace("Rom√¢nia","").replace("Romania","").trim().replace(/,\s*$/,"");
  };

  return (
    <div style={{gridColumn:"1/-1", display:"flex", flexDirection:"column", gap:10}}>
      <div style={{display:"grid", gridTemplateColumns:mob?"1fr":"1fr 1fr", gap:10}}>

        {/* Venue cu Nominatim autocomplete */}
        <div style={{position:"relative"}}>
          <label style={sty.l}>
            Loca»õie / Venue
            {searching && <span style={{color:"#fbbf24",fontSize:10,marginLeft:6}}>‚óè cautƒÉ...</span>}
          </label>
          <input
            value={venueVal}
            onChange={e=>handleVenueChange(e.target.value)}
            onBlur={()=>setTimeout(()=>setShowVenueDrop(false),200)}
            onFocus={()=>venueResults.length>0 && setShowVenueDrop(true)}
            style={iStyle}
            placeholder="üîç  Scrie numele loca»õiei..."
            autoComplete="off"
          />
          {showVenueDrop && venueResults.length>0 && (
            <div style={{position:"absolute",top:"100%",left:0,right:0,zIndex:1000,background:th.c,border:`1px solid ${th.b}`,borderRadius:10,boxShadow:"0 8px 28px rgba(0,0,0,.3)",marginTop:3,overflow:"hidden"}}>
              {venueResults.map((place,i)=>{
                const name = place.display_name.split(",")[0].trim();
                const sub = shortAddr(place.display_name);
                return (
                  <div key={place.place_id} onClick={()=>pickVenue(place)}
                    style={{padding:"10px 14px",cursor:"pointer",borderBottom:i<venueResults.length-1?`1px solid ${th.bl}`:"none"}}
                    onMouseOver={e=>e.currentTarget.style.background=th.h}
                    onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                    <div style={{fontWeight:600,fontSize:13,color:th.t}}>{name}</div>
                    {sub && <div style={{fontSize:11,color:th.tm,marginTop:2}}>{sub}</div>}
                  </div>
                );
              })}
            </div>
          )}
        </div>

        {/* Ora»ô cu autocomplete offline */}
        <div style={{position:"relative"}}>
          <label style={sty.l}>
            Ora»ô {dist>0 && <span style={{color:"#22c55e",fontWeight:700,marginLeft:6}}>üöó {dist} km de TM</span>}
          </label>
          <input
            value={cityQuery}
            onChange={e=>{setCityQuery(e.target.value);setShowCityDrop(true);onUpdate({venue:venueVal,city:e.target.value,dist:0});}}
            onFocus={()=>setShowCityDrop(true)}
            onBlur={()=>setTimeout(()=>setShowCityDrop(false),150)}
            style={iStyle}
            placeholder="CautƒÉ ora»ô..."
          />
          {showCityDrop && filteredCities.length>0 && (
            <div style={{position:"absolute",top:"100%",left:0,right:0,zIndex:999,background:th.c,border:`1px solid ${th.b}`,borderRadius:8,boxShadow:"0 8px 24px rgba(0,0,0,.2)",marginTop:2,overflow:"hidden"}}>
              {filteredCities.map((c,i)=>(
                <div key={c.n} onClick={()=>pickCity(c)}
                  style={{padding:"9px 14px",cursor:"pointer",borderBottom:i<filteredCities.length-1?`1px solid ${th.bl}`:"none",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:13}}
                  onMouseOver={e=>e.currentTarget.style.background=th.h}
                  onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                  <span style={{fontWeight:500,color:th.t}}>{c.n}</span>
                  <span style={{fontSize:10,color:c.km===0?"#22c55e":th.tm,fontWeight:c.km<50?600:400}}>{c.km===0?"local":c.km+" km"}</span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* AdresƒÉ completƒÉ + link hartƒÉ (apare dupƒÉ selec»õie) */}
      {venueAddress && (
        <div style={{display:"flex",alignItems:"center",gap:8,padding:"8px 12px",background:th.ab||"rgba(251,191,36,.06)",borderRadius:8,border:`1px solid ${th.bl}`}}>
          <span style={{fontSize:11,color:th.tm,flex:1,lineHeight:1.5}}>üìç {venueAddress}</span>
          <a href={venueMapUrl} target="_blank" rel="noopener noreferrer"
            style={{fontSize:11,color:"#60a5fa",whiteSpace:"nowrap",fontWeight:600,textDecoration:"none",padding:"4px 10px",borderRadius:6,background:"rgba(96,165,250,.12)"}}>
            ‚Üó HartƒÉ
          </a>
        </div>
      )}
    </div>
  );
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FEATURES ‚Äî Event form, offer preview, contract, location search
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function EventForm({ th, sty, isE, isP, mData, onSave, onClose, mob, templates }) {
  const tplCovers = (templates?.playlist&&templates.playlist.length>0) ? templates.playlist : DEFAULT_COVERS;
  const [fm, setFm] = useState({
    cat: mData?.cat||"private",
    type: mData?.type||(isP?"NuntƒÉ":"Festival"),
    st: mData?.st||"oferta",
    date: mData?.date||"",
    li: mData?.li||"", sc: mData?.sc||"", ss: mData?.ss||"", lo: mData?.lo||"",
    venue: mData?.venue||"", city: mData?.city||"", dist: mData?.dist||0,
    cn: mData?.cn||"", cp: mData?.cp||"", ce: mData?.ce||"",
    rep: mData?.rep||(isP?1:1),
    repDurs: mData?.repDurs||[],
    durataRecital: mData?.durataRecital||"",
    responsabilPrincipal: mData?.responsabilPrincipal||"",
    responsabili: mData?.responsabili||[],
    fee: mData?.fee||(isP?PX.r[1]:PX.pub),
    dep: mData?.dep||Math.round((mData?.fee||PX.r[1])*0.1/10)*10, dp: mData?.dp||false, zileRest: mData?.zileRest??5,
    sp: mData?.sp||{}, svc: mData?.svc||{}, svcp: mData?.svcp||{sunet:350,lumini:500,ecran:600,scena:300,dj:600},
    ex: mData?.ex||[], ven: mData?.ven||[], notes: mData?.notes||"",
    videos: mData?.videos||DEFAULT_VIDEOS, covers: mData?.covers||tplCovers,
    desc: mData?.desc||"",
    poveste: mData?.poveste||"",
    customSvc: mData?.customSvc||[],
    hosp: (mData?.hosp && !Array.isArray(mData.hosp)) ? {camere:4,meniuri:6,micDejun:true,pranz:true,extra:[],protocolOverride:"",...mData.hosp,extra:mData.hosp.extra||[],protocolOverride:mData.hosp.protocolOverride||""} : {
      camere: 4, meniuri: 6, micDejun: true, pranz: true, extra: [], protocolOverride: "",
    },
    includeTehnicAnnex: mData?.includeTehnicAnnex||false,
    tehnic: mData?.tehnic||[
      {id:"t1",l:"Sistem de sunet profesional dimensionat corespunzƒÉtor spa»õiului",checked:true},
      {id:"t2",l:"Inginer de sistem (sound engineer) la FOH",checked:true},
      {id:"t3",l:"5 monitoare pe scenƒÉ (conform plan amplasament)",checked:true},
      {id:"t4",l:"Sistem de lumini profesional + luminist",checked:true},
      {id:"t5",l:"1 cablu UTP (CAT5/CAT6) de la scenƒÉ la FOH",checked:true},
      {id:"t6",l:"1 riser mobil 3√ó2√ó0.40m (pentru tobe)",checked:true},
      {id:"t7",l:"2 stative microfon tip boom",checked:true},
      {id:"t8",l:"Probe de sunet: 60 min amplasare + 60 min soundcheck",checked:true},
      {id:"t9",l:"2 persoane ajutor la descƒÉrcat/√ÆncƒÉrcat echipamente",checked:true},
      {id:"t10",l:"Loc parcare microbuz √Æn apropierea scenei (de la soundcheck p√¢nƒÉ dupƒÉ concert)",checked:true},
      {id:"t11",l:"Securitate echipamente pe toatƒÉ durata evenimentului",checked:true},
      {id:"t12",l:"Spa»õiu depozitare case-uri »ôi huse l√¢ngƒÉ scenƒÉ",checked:true},
      {id:"t13",l:"Sistem video (ecran LED / videoproiector) ‚Äî logo disponibil pe phaser.ro",checked:false},
    ],
  });
  const [secTab, setSecTab] = useState("detalii");
  const [playlistSearch, setPlaylistSearch] = useState("");
  const u = (k,v) => setFm(p=>({...p,[k]:v}));
  const svcT = isP ? Object.entries(fm.svcp).reduce((s,[k,v])=>s+(fm.svc[k]?v:0),0) : 0;
  const iStyle = {...sty.i, fontSize: mob?"16px":"14px"};

  const showTehnicTab = !isP || ["Corporate","Private Party","Altele"].includes(fm.type);
  const baseTabs = isP ? (showTehnicTab ? ["detalii","client","servicii","ospitalitate","tehnic","media","playlist","note"] : ["detalii","client","servicii","ospitalitate","media","playlist","note"]) : ["detalii","client","tehnic","media","note"];
  const editTabs = isP ? ["detalii","client","servicii","ospitalitate","tehnic","timing","cheltuieli","membri","furnizori","media","playlist","note"]
                       : ["detalii","client","tehnic","timing","cheltuieli","membri","furnizori","media","note"];
  const tabs = isE ? editTabs : baseTabs;

  return (
    <div style={{position:"fixed",inset:0,background:th.ov,zIndex:1000}} onClick={onClose}>
      <div style={{position:"absolute",inset:0,display:"flex",flexDirection:"column",background:mob?th.c:"transparent",alignItems:mob?"stretch":"center",justifyContent:mob?"stretch":"center"}} onClick={e=>e.stopPropagation()}>
        <div style={{background:th.c,border:mob?"none":`1px solid ${th.b}`,borderRadius:mob?0:14,width:mob?"100%":660,maxHeight:mob?"none":"88vh",flex:mob?1:"none",display:"flex",flexDirection:"column",margin:mob?0:"auto",overflow:"hidden"}}>
          
          {/* Header */}
          <div style={{padding:"14px 20px",borderBottom:`1px solid ${th.b}`,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0,background:th.sb}}>
            <div style={{display:"flex",alignItems:"center",gap:12}}>
              <Logo height={22}/>
              <span style={{fontSize:12,color:"rgba(255,255,255,.5)",fontWeight:500}}>‚Äî {isE?"EditeazƒÉ":"OfertƒÉ nouƒÉ"} {isP?"(Privat / ZGV)":"(Public / PHASER)"}</span>
            </div>
            <button onClick={onClose} style={{padding:3,border:"none",background:"transparent",color:"rgba(255,255,255,.5)",cursor:"pointer"}}><IcX s={16}/></button>
          </div>

          {/* Tab bar */}
          <div style={{display:"flex",gap:1,padding:"8px 20px",borderBottom:`1px solid ${th.b}`,overflowX:"auto",flexShrink:0}}>
            {tabs.map(t=><button key={t} onClick={()=>setSecTab(t)} style={{padding:"4px 10px",borderRadius:5,border:"none",fontSize:11,fontWeight:secTab===t?700:400,cursor:"pointer",background:secTab===t?th.ab:"transparent",color:secTab===t?th.t:th.tm,textTransform:"capitalize",whiteSpace:"nowrap"}}>{t}</button>)}
          </div>

          <div style={{flex:1,overflowY:"auto",padding:"16px 20px"}}>

            {secTab==="detalii"&&<div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:12}}>
              <div style={{gridColumn:"1/-1"}}><label style={sty.l}>Persoana care a preluat oferta</label><input value={fm.responsabilPrincipal||""} onChange={e=>u("responsabilPrincipal",e.target.value)} style={iStyle} placeholder="Numele persoanei care gestioneazƒÉ oferta"/></div>
              <div style={{gridColumn:"1/-1"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                  <label style={sty.l}>EchipƒÉ / Persoane implicate (nume + rol)</label>
                  <button onClick={()=>u("responsabili",[...(fm.responsabili||[]),{id:uid(),nume:"",rol:""}])} style={{...sty.bg,fontSize:10,padding:"3px 8px"}}><IcPlus s={11}/> AdaugƒÉ</button>
                </div>
                {(fm.responsabili||[]).map((r,i)=>(
                  <div key={r.id} style={{display:"flex",gap:6,marginBottom:5,alignItems:"center"}}>
                    <input value={r.nume} onChange={e=>{const arr=[...(fm.responsabili||[])];arr[i]={...arr[i],nume:e.target.value};u("responsabili",arr);}} style={{...iStyle,flex:1}} placeholder="Nume"/>
                    <input value={r.rol} onChange={e=>{const arr=[...(fm.responsabili||[])];arr[i]={...arr[i],rol:e.target.value};u("responsabili",arr);}} style={{...iStyle,width:120}} placeholder="Rol"/>
                    <button onClick={()=>u("responsabili",(fm.responsabili||[]).filter((_,j)=>j!==i))} style={{padding:3,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>‚úï</button>
                  </div>
                ))}
              </div>
              <div><label style={sty.l}>Tip eveniment</label>
                <select value={fm.type} onChange={e=>u("type",e.target.value)} className="modernSel" style={iStyle}>
                  {(isP?PRIVATE_TYPES:PUBLIC_TYPES).map(t=><option key={t}>{t}</option>)}
                </select>
              </div>
              {isE&&<div><label style={sty.l}>Status</label>
                <select value={fm.st} onChange={e=>u("st",e.target.value)} className="modernSel" style={iStyle}>
                  {Object.entries(ST).map(([k,v])=><option key={k} value={k}>{v.l}</option>)}
                </select>
              </div>}
              <div><label style={sty.l}>Data eveniment *</label><input type="date" value={fm.date} onChange={e=>u("date",e.target.value)} style={iStyle}/></div>
              <div><label style={sty.l}>Onorariu trupƒÉ (‚Ç¨)</label><input type="number" value={fm.fee} onChange={e=>{const f=Number(e.target.value);u("fee",f);if(!mData?.dep)u("dep",Math.round(f*0.1/10)*10);}} style={iStyle}/></div>
              <div>
                <label style={sty.l}>Avans</label>
                <div style={{display:"flex",gap:6}}>
                  <input type="number" value={fm.dep} onChange={e=>u("dep",Number(e.target.value))} style={{...iStyle,flex:2}}/>
                  <div style={{display:"flex",alignItems:"center",gap:4,flex:1,background:th.h,borderRadius:7,border:`1px solid ${th.b}`,padding:"0 8px"}}>
                    <input type="number" value={fm.fee>0?Math.round(fm.dep/fm.fee*100):10}
                      onChange={e=>{const pct=Number(e.target.value);u("dep",Math.round(fm.fee*pct/100/10)*10);}}
                      style={{background:"transparent",border:"none",color:th.t,width:30,fontSize:13,fontWeight:600,textAlign:"center",fontFamily:"inherit"}}
                      min={0} max={100}
                    />
                    <span style={{fontSize:12,color:th.tm}}>%</span>
                  </div>
                </div>
              </div>
              <div>
                <label style={sty.l}>Rest ‚Äî zile dupƒÉ eveniment</label>
                <input type="number" value={fm.zileRest} onChange={e=>u("zileRest",Number(e.target.value)||5)} style={iStyle} placeholder="5" min={1} max={90}/>
                <div style={{fontSize:10,color:th.tm,marginTop:2}}>Restul sumei se plƒÉte»ôte prin virament bancar</div>
              </div>
              {isP&&<div style={{gridColumn:"1/-1"}}>
                <label style={sty.l}>Reprize</label>
                <div style={{display:"flex",gap:6,margin:"4px 0",flexWrap:"wrap"}}>
                  {[1,2,3].map(r=><button key={r} onClick={()=>{u("rep",r);u("repCustom",false);const durs=Array(r).fill(fm.repDur||45);u("repDurs",durs);u("fee",PX.r[r]);u("dep",Math.round(PX.r[r]*0.1/10)*10);}} style={{flex:1,minWidth:70,padding:10,borderRadius:7,border:`2px solid ${!fm.repCustom&&fm.rep===r?th.t:th.b}`,background:!fm.repCustom&&fm.rep===r?th.ab:"transparent",cursor:"pointer",textAlign:"center",color:th.t}}>
                    <div style={{fontWeight:700,fontSize:14}}>{r}</div>
                    <div style={{fontSize:10,color:th.tm}}>{r===1?"reprizƒÉ":"reprize"}</div>
                  </button>)}
                  <button onClick={()=>{u("repCustom",true);u("rep",1);u("repDurs",[45]);}} style={{flex:1,minWidth:70,padding:10,borderRadius:7,border:`2px solid ${fm.repCustom?th.t:th.b}`,background:fm.repCustom?th.ab:"transparent",cursor:"pointer",textAlign:"center",color:th.t}}>
                    <div style={{fontWeight:700,fontSize:14}}>Custom</div>
                  </button>
                </div>
                {fm.repCustom&&<div style={{display:"flex",gap:8,marginTop:8}}>
                  <div><label style={{...sty.l,fontSize:10}}>Nr. reprize</label><input type="number" value={fm.rep} onChange={e=>{const r=Number(e.target.value)||1;u("rep",r);u("repDurs",(fm.repDurs||[45]).slice(0,r).concat(Array(Math.max(0,r-(fm.repDurs||[]).length)).fill(45)));}} style={iStyle} min={1} max={10}/></div>
                </div>}
                <div style={{display:"flex",gap:6,marginTop:8,flexWrap:"wrap",alignItems:"center"}}>
                  <span style={{fontSize:11,color:th.tm}}>DuratƒÉ per reprizƒÉ:</span>
                  {(fm.repDurs||Array(fm.rep||1).fill(45)).slice(0,fm.rep||1).map((d,i)=>(
                    <div key={i} style={{display:"flex",alignItems:"center",gap:4}}>
                      {(fm.rep||1)>1&&<span style={{fontSize:11,color:th.tm}}>R{i+1}:</span>}
                      <input type="number" value={d} onChange={e=>{const arr=[...(fm.repDurs||Array(fm.rep||1).fill(45))];arr[i]=Number(e.target.value)||45;u("repDurs",arr);}} style={{...iStyle,width:60}} min={5} max={120}/>
                      <span style={{fontSize:11,color:th.tm}}>min</span>
                    </div>
                  ))}
                </div>
              </div>}
              <LocationSearch
                venue={fm.venue} city={fm.city} dist={fm.dist}
                onUpdate={({venue,city,dist})=>{u("venue",venue);u("city",city);u("dist",dist);}}
                sty={sty} th={th} mob={mob}
              />
              {!isP&&<div><label style={sty.l}>DuratƒÉ recital / presta»õie</label>
                <input value={fm.durataRecital} onChange={e=>u("durataRecital",e.target.value)} style={iStyle} placeholder="ex: 90 min, 2√ó45 min"/>
              </div>}
              <div style={{gridColumn:"1/-1"}}><label style={sty.l}>Descriere ofertƒÉ (op»õional)</label>
                <textarea value={fm.desc} onChange={e=>u("desc",e.target.value)} style={{...iStyle,minHeight:60,resize:"vertical"}} placeholder="Text introductiv √Æn ofertƒÉ..."/>
              </div>
              {isP&&<div style={{gridColumn:"1/-1"}}><label style={sty.l}>Poveste / Media (override pentru acest eveniment)</label>
                <textarea value={fm.poveste||""} onChange={e=>u("poveste",e.target.value)} style={{...iStyle,minHeight:80,resize:"vertical"}} placeholder="LasƒÉ gol pentru a folosi template-ul din Sec»õiuni"/>
                <div style={{fontSize:10,color:th.tm,marginTop:2}}>Text care apare √Æn ofertƒÉ ca ‚ÄûDespre noi‚Äù. DacƒÉ e gol, se folose»ôte template-ul.</div>
              </div>}
            </div>}

            {secTab==="client"&&<div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:12}}>
              <div style={{gridColumn:"1/-1"}}><label style={sty.l}>Nume client</label><input value={fm.cn} onChange={e=>u("cn",e.target.value)} style={iStyle} placeholder="Numele clientului"/></div>
              <div><label style={sty.l}>Telefon</label><input value={fm.cp} onChange={e=>u("cp",e.target.value)} style={iStyle} placeholder="+40..."/></div>
              <div><label style={sty.l}>Email</label><input value={fm.ce} onChange={e=>u("ce",e.target.value)} style={iStyle} placeholder="email@..."/></div>
              <div><label style={sty.l}>PlatformƒÉ contact</label>
                <select value={fm.platform||""} onChange={e=>u("platform",e.target.value)} className="modernSel" style={iStyle}>
                  <option value="">‚Äî niciuna ‚Äî</option>
                  <option value="Instagram">Instagram</option>
                  <option value="Facebook">Facebook</option>
                  <option value="WhatsApp">WhatsApp</option>
                  <option value="TikTok">TikTok</option>
                  <option value="Telefon">Telefon</option>
                  <option value="Email">Email</option>
                  <option value="Altele">Altele</option>
                </select>
              </div>
              <div><label style={sty.l}>ID / Handle / Username</label><input value={fm.platformId||""} onChange={e=>u("platformId",e.target.value)} style={iStyle} placeholder="@username sau link..."/></div>
              <div style={{gridColumn:"1/-1",padding:10,borderRadius:7,background:th.h,fontSize:11,color:th.tm}}>
                ‚ÑπÔ∏è Datele clientului sunt <strong style={{color:th.t}}>interne</strong> ‚Äî nu apar √Æn oferta trimisƒÉ.
              </div>
            </div>}

            {secTab==="servicii"&&isP&&<div>
              <label style={sty.l}>NumƒÉr reprize</label>
              <div style={{display:"flex",gap:6,margin:"4px 0 12px",flexWrap:"wrap"}}>
                {[1,2,3].map(r=><button key={r} onClick={()=>{u("rep",r);u("repCustom",false);const durs=Array(r).fill(fm.repDur||45);u("repDurs",durs);u("fee",PX.r[r]);u("dep",Math.round(PX.r[r]*0.1/10)*10);}} style={{flex:1,minWidth:70,padding:12,borderRadius:7,border:`2px solid ${!fm.repCustom&&fm.rep===r?th.t:th.b}`,background:!fm.repCustom&&fm.rep===r?th.ab:"transparent",cursor:"pointer",textAlign:"center",color:th.t}}>
                  <div style={{fontWeight:700,fontSize:16}}>{r}</div>
                  <div style={{fontSize:10,color:th.tm}}>{r===1?"reprizƒÉ":"reprize"}</div>
                  <div style={{fontSize:12,fontWeight:600,marginTop:2}}>{f$(PX.r[r])}</div>
                </button>)}
                <button onClick={()=>{u("repCustom",true);u("rep",1);u("repDurs",[45]);}} style={{flex:1,minWidth:70,padding:12,borderRadius:7,border:`2px solid ${fm.repCustom?th.t:th.b}`,background:fm.repCustom?th.ab:"transparent",cursor:"pointer",textAlign:"center",color:th.t}}>
                  <div style={{fontWeight:700,fontSize:16}}>Custom</div>
                  <div style={{fontSize:10,color:th.tm}}>introduci tu</div>
                </button>
              </div>
              {fm.repCustom&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:12}}>
                <div><label style={sty.l}>Reprize</label><input type="number" value={fm.rep} onChange={e=>{const r=Number(e.target.value)||1;u("rep",r);u("repDurs",(fm.repDurs||[45]).slice(0,r).concat(Array(Math.max(0,r-(fm.repDurs||[]).length)).fill(45)));}} style={iStyle} min={1} max={10}/></div>
                <div><label style={sty.l}>Onorariu (‚Ç¨)</label><input type="number" value={fm.fee} onChange={e=>{const f=Number(e.target.value);u("fee",f);u("dep",Math.round(f*0.1/10)*10);}} style={iStyle}/></div>
              </div>}
              <label style={sty.l}>DuratƒÉ per reprizƒÉ (min)</label>
              <div style={{display:"flex",gap:6,marginBottom:12,flexWrap:"wrap"}}>
                {(fm.repDurs||Array(fm.rep||1).fill(45)).slice(0,fm.rep||1).map((d,i)=>(
                  <div key={i} style={{display:"flex",alignItems:"center",gap:4}}>
                    <span style={{fontSize:11,color:th.tm}}>R{i+1}:</span>
                    <input type="number" value={d} onChange={e=>{const arr=[...(fm.repDurs||Array(fm.rep||1).fill(45))];arr[i]=Number(e.target.value);u("repDurs",arr);}} style={{...iStyle,width:60,padding:"6px 8px"}} min={15} max={120}/>
                  </div>
                ))}
              </div>
              {!fm.repCustom&&<div style={{marginBottom:16}}><label style={sty.l}>Onorariu (‚Ç¨)</label><input type="number" value={fm.fee} onChange={e=>{const f=Number(e.target.value);u("fee",f);u("dep",Math.round(f*0.1/10)*10);}} style={iStyle}/></div>}
              <label style={sty.l}>Servicii extra</label>
              {[{k:"sunet",l:"Sistem sunet"},{k:"lumini",l:"Sistem lumini"},{k:"ecran",l:"Ecran LED"},{k:"scena",l:"ScenƒÉ/Podium"},{k:"dj",l:"DJ"}].map(sv=>
                <div key={sv.k} onClick={()=>u("svc",{...fm.svc,[sv.k]:fm.svc[sv.k]?0:1})}
                  style={{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",borderRadius:6,background:fm.svc[sv.k]?th.ab:th.h,marginBottom:4,cursor:"pointer",border:`1px solid ${fm.svc[sv.k]?th.a:th.b}`}}>
                  <div style={{width:18,height:18,borderRadius:4,border:`2px solid ${fm.svc[sv.k]?th.a:th.b}`,background:fm.svc[sv.k]?th.a:"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                    {fm.svc[sv.k]?<IcCheck s={10}/>:null}
                  </div>
                  <span style={{flex:1,fontSize:12,fontWeight:500}}>{sv.l}</span>
                  <input type="number" value={fm.svcp[sv.k]||0} onChange={e=>{e.stopPropagation();u("svcp",{...fm.svcp,[sv.k]:Number(e.target.value)})}} style={{...iStyle,width:80,textAlign:"right"}} onClick={e=>e.stopPropagation()}/>
                  <span style={{fontSize:11,color:th.tm}}>‚Ç¨</span>
                </div>
              )}
              <div style={{marginTop:12}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                  <label style={sty.l}>Extra personalizat</label>
                  <button onClick={()=>u("customSvc",[...fm.customSvc,{id:uid(),l:"",v:0,checked:true}])} style={{...sty.bg,fontSize:10,padding:"3px 8px",gap:3}}><IcPlus s={11}/> AdaugƒÉ</button>
                </div>
                {fm.customSvc.map((cs,i)=>(
                  <div key={cs.id} style={{display:"flex",gap:6,marginBottom:5,alignItems:"center"}}>
                    <input type="checkbox" checked={cs.checked} onChange={e=>{const c=[...fm.customSvc];c[i]={...c[i],checked:e.target.checked};u("customSvc",c);}} style={{accentColor:th.t,width:15,height:15,flexShrink:0}}/>
                    <input value={cs.l} onChange={e=>{const c=[...fm.customSvc];c[i]={...c[i],l:e.target.value};u("customSvc",c);}} style={{...iStyle,flex:1}} placeholder="Serviciu..."/>
                    <input type="number" value={cs.v} onChange={e=>{const c=[...fm.customSvc];c[i]={...c[i],v:Number(e.target.value)};u("customSvc",c);}} style={{...iStyle,width:70,textAlign:"right"}} placeholder="‚Ç¨"/>
                    <button onClick={()=>u("customSvc",fm.customSvc.filter((_,j)=>j!==i))} style={{padding:3,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>‚úï</button>
                  </div>
                ))}
              </div>
              <div style={{marginTop:10,padding:10,borderRadius:6,background:th.h,display:"flex",justifyContent:"space-between",fontSize:12,fontWeight:600}}><span>Total servicii:</span><span>{f$(svcT)}</span></div>

            </div>}

            {secTab==="timing"&&<div>
              <div style={{padding:10,borderRadius:6,background:th.h,marginBottom:14,fontSize:11,color:th.ts}}>üìç Intern ‚Äî program pe ore al evenimentului.</div>
              <div style={{display:"grid",gridTemplateColumns:mob?"1fr 1fr":"1fr 1fr 1fr 1fr",gap:10}}>
                <div><label style={sty.l}>Load In</label><input type="time" value={fm.li} onChange={e=>u("li",e.target.value)} style={iStyle}/></div>
                <div><label style={sty.l}>Soundcheck</label><input type="time" value={fm.sc} onChange={e=>u("sc",e.target.value)} style={iStyle}/></div>
                <div><label style={sty.l}>Show Start</label><input type="time" value={fm.ss} onChange={e=>u("ss",e.target.value)} style={iStyle}/></div>
                <div><label style={sty.l}>Load Out</label><input type="time" value={fm.lo} onChange={e=>u("lo",e.target.value)} style={iStyle}/></div>
              </div>
            </div>}

            {secTab==="cheltuieli"&&<div>
              <button onClick={()=>u("ex",[...fm.ex,{id:uid(),n:"",a:0,v:""}])} style={{...sty.bg,fontSize:11,padding:"5px 10px",marginBottom:10}}>+ AdaugƒÉ cheltuialƒÉ</button>
              {fm.ex.map((x,i)=><div key={x.id} style={{display:"grid",gridTemplateColumns:mob?"1fr 1fr":"2fr 1fr 2fr auto",gap:6,marginBottom:6}}>
                <input value={x.n} onChange={e=>{const ex=[...fm.ex];ex[i]={...ex[i],n:e.target.value};u("ex",ex);}} style={iStyle} placeholder="Serviciu"/>
                <input type="number" value={x.a} onChange={e=>{const ex=[...fm.ex];ex[i]={...ex[i],a:Number(e.target.value)};u("ex",ex);}} style={iStyle} placeholder="‚Ç¨"/>
                {!mob&&<input value={x.v||""} onChange={e=>{const ex=[...fm.ex];ex[i]={...ex[i],v:e.target.value};u("ex",ex);}} style={iStyle} placeholder="Furnizor"/>}
                <button onClick={()=>u("ex",fm.ex.filter((_,j)=>j!==i))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>‚úï</button>
              </div>)}
              {fm.ex.length>0&&<div style={{padding:10,borderRadius:6,background:th.h,fontSize:12,fontWeight:600,textAlign:"right"}}>Total: {f$(fm.ex.reduce((s,x)=>s+x.a,0))}</div>}
            </div>}

            {secTab==="membri"&&<div>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:10}}>
                <span style={{fontSize:12,color:th.ts}}>Disponibil: {f$(fm.fee-fm.ex.reduce((s,x)=>s+x.a,0))}</span>
                <button onClick={()=>{const av=fm.fee-fm.ex.reduce((s,x)=>s+x.a,0);const per=Math.floor(av/MEMBERS.length);const nsp={};MEMBERS.forEach(m=>{nsp[m.id]=per});u("sp",nsp);}} style={{...sty.bg,fontSize:11,padding:"4px 10px"}}>Split egal</button>
              </div>
              {MEMBERS.map(m=><div key={m.id} style={{display:"flex",alignItems:"center",gap:10,padding:"7px 10px",borderRadius:6,marginBottom:4,background:th.h}}>
                <div style={{width:28,height:28,borderRadius:"50%",background:th.a,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:11,color:th.bg,flexShrink:0}}>{m.n[0]}</div>
                <div style={{flex:1,fontSize:12}}>{m.n} <span style={{color:th.tm}}>‚Äî {m.r}</span></div>
                <input type="number" value={fm.sp[m.id]||""} onChange={e=>u("sp",{...fm.sp,[m.id]:Number(e.target.value)})} style={{...iStyle,width:80,textAlign:"right"}} placeholder="0"/>
                <span style={{fontSize:10,color:th.tm}}>‚Ç¨</span>
              </div>)}
            </div>}

            {secTab==="furnizori"&&<div>
              <button onClick={()=>u("ven",[...fm.ven,{id:uid(),n:"",role:"",fee:0}])} style={{...sty.bg,fontSize:11,padding:"5px 10px",marginBottom:10}}>+ Furnizor</button>
              {fm.ven.map((v,i)=><div key={v.id} style={{padding:10,borderRadius:6,background:th.h,marginBottom:6}}>
                <div style={{display:"grid",gridTemplateColumns:mob?"1fr 1fr":"1fr 1fr 1fr auto",gap:6}}>
                  <input value={v.n} onChange={e=>{const ve=[...fm.ven];ve[i]={...ve[i],n:e.target.value};u("ven",ve);}} style={iStyle} placeholder="Nume"/>
                  <input value={v.role} onChange={e=>{const ve=[...fm.ven];ve[i]={...ve[i],role:e.target.value};u("ven",ve);}} style={iStyle} placeholder="Rol"/>
                  {!mob&&<input type="number" value={v.fee} onChange={e=>{const ve=[...fm.ven];ve[i]={...ve[i],fee:Number(e.target.value)};u("ven",ve);}} style={iStyle} placeholder="‚Ç¨"/>}
                  <button onClick={()=>u("ven",fm.ven.filter((_,j)=>j!==i))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>‚úï</button>
                </div>
              </div>)}
            </div>}

            {secTab==="ospitalitate"&&isP&&<div>
              <div style={{fontSize:11,color:th.tm,marginBottom:16,padding:"8px 12px",background:th.h,borderRadius:7}}>üè® Ce solicitƒÉm organizatorului pentru membrii trupei</div>
              
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:16}}>
                <div>
                  <label style={sty.l}>Camere twin / cazare</label>
                  <div style={{display:"flex",alignItems:"center",gap:8}}>
                    <button onClick={()=>u("hosp",{...fm.hosp,camere:Math.max(0,(fm.hosp.camere||0)-1)})} style={{...sty.bg,padding:"8px 12px",fontSize:16,fontWeight:700}}>‚àí</button>
                    <span style={{fontSize:20,fontWeight:700,minWidth:30,textAlign:"center"}}>{fm.hosp.camere??0}</span>
                    <button onClick={()=>u("hosp",{...fm.hosp,camere:(fm.hosp.camere||0)+1})} style={{...sty.bg,padding:"8px 12px",fontSize:16,fontWeight:700}}>+</button>
                  </div>
                </div>
                <div>
                  <label style={sty.l}>Meniuri complete pentru seara evenimentului</label>
                  <div style={{display:"flex",alignItems:"center",gap:8}}>
                    <button onClick={()=>u("hosp",{...fm.hosp,meniuri:Math.max(0,(fm.hosp.meniuri||0)-1)})} style={{...sty.bg,padding:"8px 12px",fontSize:16,fontWeight:700}}>‚àí</button>
                    <span style={{fontSize:20,fontWeight:700,minWidth:30,textAlign:"center"}}>{fm.hosp.meniuri??0}</span>
                    <button onClick={()=>u("hosp",{...fm.hosp,meniuri:(fm.hosp.meniuri||0)+1})} style={{...sty.bg,padding:"8px 12px",fontSize:16,fontWeight:700}}>+</button>
                  </div>
                </div>
              </div>

              <div style={{marginBottom:16}}>
                <label style={sty.l}>Protocol custom (op»õional ‚Äî √Ænlocuie»ôte textul standard)</label>
                <textarea value={fm.hosp.protocolOverride||""} onChange={e=>u("hosp",{...fm.hosp,protocolOverride:e.target.value})} style={{...iStyle,minHeight:80,resize:"vertical",fontSize:12}} placeholder="LasƒÉ gol pentru formatul standard din model. DacƒÉ completezi, acest text √Ænlocuie»ôte meniurile, pr√¢nzul »ôi micul dejun."/>
              </div>
              <div style={{display:"flex",flexDirection:"column",gap:6,marginBottom:16}}>
                {[
                  {k:"micDejun",l:"Mic dejun inclus"},
                  {k:"pranz",l:"MasƒÉ de pr√¢nz dupƒÉ instalare"},
                ].map(item=>(
                  <div key={item.k} onClick={()=>u("hosp",{...fm.hosp,[item.k]:!fm.hosp[item.k]})}
                    style={{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",borderRadius:8,background:fm.hosp[item.k]?th.ab:th.h,cursor:"pointer",border:`1px solid ${fm.hosp[item.k]?th.a:th.b}`}}>
                    <div style={{width:18,height:18,borderRadius:4,border:`2px solid ${fm.hosp[item.k]?th.a:th.b}`,background:fm.hosp[item.k]?th.a:"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                      {fm.hosp[item.k]&&<IcCheck s={10}/>}
                    </div>
                    <span style={{fontSize:13,fontWeight:500}}>{item.l}</span>
                  </div>
                ))}
              </div>

              <div>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                  <label style={sty.l}>Extra ospitalitate</label>
                  <button onClick={()=>u("hosp",{...fm.hosp,extra:[...fm.hosp.extra,{id:uid(),l:""}]})} style={{...sty.bg,fontSize:10,padding:"3px 8px"}}><IcPlus s={11}/> AdaugƒÉ</button>
                </div>
                {fm.hosp.extra.map((e,i)=>(
                  <div key={e.id} style={{display:"flex",gap:6,marginBottom:6,alignItems:"center"}}>
                    <input value={e.l} onChange={ev=>{const ex=[...(fm.hosp.extra||[])];ex[i]={...ex[i],l:ev.target.value};u("hosp",{...fm.hosp,extra:ex});}} style={{...iStyle,flex:1,fontSize:12}} placeholder="Ex: ApƒÉ mineralƒÉ pe scenƒÉ..."/>
                    <button onClick={()=>u("hosp",{...fm.hosp,extra:(fm.hosp.extra||[]).filter((_,j)=>j!==i)})} style={{padding:3,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>‚úï</button>
                  </div>
                ))}
              </div>
            </div>}

            {secTab==="tehnic"&&<div style={{background:"#fff",borderRadius:12,padding:"20px",fontSize:13,lineHeight:1.8,color:"#222"}}>
              {isP&&["Corporate","Private Party","Altele"].includes(fm.type)&&<div onClick={()=>u("includeTehnicAnnex",!fm.includeTehnicAnnex)} style={{display:"flex",alignItems:"center",gap:10,padding:"12px 14px",marginBottom:16,background:fm.includeTehnicAnnex?"#fef9c3":"#f5f5f5",borderRadius:8,border:`2px solid ${fm.includeTehnicAnnex?"#f59e0b":"#e0e0e0"}`,cursor:"pointer"}}>
                <div style={{width:18,height:18,borderRadius:4,border:"2px solid #f59e0b",background:fm.includeTehnicAnnex?"#f59e0b":"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,color:"#fff",fontSize:12,fontWeight:700}}>{fm.includeTehnicAnnex?"‚úì":""}</div>
                <span style={{fontWeight:600,fontSize:12}}>Include necesar tehnic ca anexƒÉ √Æn ofertƒÉ</span>
              </div>}
              <div style={{textAlign:"center",marginBottom:24}}>
                <img src={LOGO_URL} alt="PHASER" style={{height:32,display:"block",margin:"0 auto 12px",filter:"invert(1)"}}/>
                <div style={{fontWeight:700,fontSize:15,letterSpacing:2,textTransform:"uppercase"}}>Rider Tehnic</div>
                <div style={{fontSize:11,color:"#888",marginTop:6}}>
                  Radu Racz +40 744 771 488 ¬∑ Carina Dumitru ¬∑ Arnold Birta ¬∑ Sebastian B√¢rzeianu ¬∑ Lucian Opri»ôan<br/>
                  FOH: Bogdan Racz +40 745 602 161
                </div>
              </div>

              {[
                {title:"SISTEM DE SUNET", content:`Sistemul de sunet trebuie sƒÉ fie dimensionat corespunzƒÉtor pentru a acoperi necesitƒÉ»õile spa»õiului √Æn care se desfƒÉ»ôoarƒÉ concertul astfel √Ænc√¢t calitatea sunetului sƒÉ nu fie compromisƒÉ.

Organizatorul are obliga»õia de a furniza un sistem de sunet de √ÆnaltƒÉ calitate »ôi un inginer de sistem care sƒÉ cunoascƒÉ detaliile tehnice »ôi de operare ale acestuia.`},
                {title:"MONITORIZARE", content:"5 monitoare conform planului de amplasament specificat."},
                {title:"PROBE DE SUNET", content:"Trupa are nevoie de 60 de minute pentru amplasarea echipamentelor pe scenƒÉ »ôi de 60 de minute pentru probele de sunet."},
                {title:"SISTEM DE LUMINI", content:"Sistemul de lumini trebuie sƒÉ fie unul profesional, de bunƒÉ calitate, potrivit pentru spa»õiul √Æn care se desfƒÉ»ôoarƒÉ evenimentul. Trupa nu are propriul luminist, astfel √Ænc√¢t este necesarƒÉ prezen»õa unui luminist care sƒÉ cunoascƒÉ detaliile tehnice »ôi de operare ale sistemului."},
                {title:"VIDEO", content:`√én cazul √Æn care existƒÉ un sistem video la scenƒÉ (ecran LED, videoproiector, etc.), pentru partea de visuals vƒÉ rugƒÉm sƒÉ descƒÉrca»õi logo-ul trupei de pe:
https://www.phaser.ro/wp-content/uploads/2022/07/LOGO-Phaser-white.png`},
                {title:"BACKLINE / FOH", content:`Trupa are propriul backline »ôi propriul mixer. Toate echipamentele trupei vor fi folosite exclusiv de membrii trupei.

Necesar:
‚Ä¢ 1 cablu UTP (CAT5/CAT6) de la scenƒÉ la FOH
‚Ä¢ 1 riser mobil cu dimensiunea 3√ó2√ó0.40m (pentru setul de tobe)
‚Ä¢ 2 stative de microfon tip boom

Vom furniza 3 mix-uri separate din Stage Box-ul pozi»õionat pe scenƒÉ:
‚Äì Left/Right mix (AES/EBU sau Analog - XLR)
‚Äì Sub mix (AES/EBU sau Analog - XLR)
‚Äì Monitor mix (Analog - XLR)`},
                {title:"ECHIPAMENTE", content:"Pentru descƒÉrcarea echipamentelor la sosirea trupei, respectiv eliberarea scenei »ôi √ÆncƒÉrcarea echipamentelor dupƒÉ concert, este necesarƒÉ prezen»õa a douƒÉ persoane care sƒÉ ajute membrii trupei pentru o desfƒÉ»ôurare eficientƒÉ »ôi rapidƒÉ a acestor ac»õiuni."},
                {title:"PARCARE", content:"VƒÉ rugƒÉm sƒÉ oferi»õi un loc de parcare pentru microbuzul trupei √Æn imediatƒÉ apropiere a scenei. Locul de parcare ar trebui sƒÉ fie disponibil de la sosirea pentru probele de sunet »ôi p√¢nƒÉ dupƒÉ √Æncheierea concertului."},
                {title:"SECURITATE", content:"Organizatorul are obliga»õia de a asigura securitatea arti»ôtilor »ôi a echipamentelor pe toatƒÉ durata evenimentului. VƒÉ rugƒÉm sƒÉ oferi»õi un spa»õiu √Æn imediatƒÉ apropiere a scenei destinat depozitƒÉrii √Æn siguran»õƒÉ a case-urilor »ôi huselor."},
              ].map((s,i)=>(
                <div key={i} style={{marginBottom:20,paddingBottom:20,borderBottom:i<8?"1px solid #eee":"none"}}>
                  <div style={{fontWeight:700,fontSize:11,letterSpacing:2,textTransform:"uppercase",marginBottom:8,color:"#111"}}>{s.title}</div>
                  <div style={{whiteSpace:"pre-line",color:"#444",fontSize:13}}>{s.content}</div>
                </div>
              ))}

              <div style={{textAlign:"center",paddingTop:8,fontSize:11,color:"#bbb",letterSpacing:1}}>
                www.phaser.ro ¬∑ contact@phaser.ro
              </div>
            </div>}

{secTab==="media"&&<div>
              <div style={{fontSize:11,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:th.tm,marginBottom:12}}>Videoclipuri ({fm.videos.filter(v=>v.checked).length} active)</div>
              <button onClick={()=>u("videos",[...fm.videos,{id:uid(),title:"",url:"",checked:true}])} style={{...sty.bg,fontSize:11,padding:"5px 10px",marginBottom:10}}><IcPlus s={11}/> AdaugƒÉ videoclip</button>
              {fm.videos.map(v=>(
                <div key={v.id} style={{borderRadius:10,overflow:"hidden",border:`1px solid ${th.b}`,opacity:v.checked?1:0.5,marginBottom:8}}>
                  <div style={{display:"flex",alignItems:"center",gap:8,padding:"8px 12px",background:th.h,flexWrap:"wrap"}}>
                    <input type="checkbox" checked={v.checked} onChange={()=>u("videos",fm.videos.map(x=>x.id===v.id?{...x,checked:!x.checked}:x))} style={{accentColor:th.t,width:14,height:14,cursor:"pointer",flexShrink:0}}/>
                    <input value={v.title} onChange={e=>u("videos",fm.videos.map(x=>x.id===v.id?{...x,title:e.target.value}:x))} style={{...iStyle,flex:1,minWidth:0,padding:"4px 8px",fontSize:12}} placeholder="Titlu"/>
                    <input value={v.url} onChange={e=>u("videos",fm.videos.map(x=>x.id===v.id?{...x,url:e.target.value}:x))} style={{...iStyle,flex:1,minWidth:0,padding:"4px 8px",fontSize:11}} placeholder="URL YouTube embed"/>
                    <button onClick={()=>u("videos",fm.videos.filter(x=>x.id!==v.id))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}>‚úï</button>
                  </div>
                  {v.checked&&v.url&&<div style={{position:"relative",paddingBottom:"56.25%",height:0}}>
                    <iframe src={v.url} title={v.title} style={{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}} allowFullScreen/>
                  </div>}
                </div>
              ))}
            </div>}

{secTab==="playlist"&&<div>
              <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}}>
                <IcDisc s={14}/>
                <span style={{fontSize:11,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:th.tm}}>Playlist</span>
                <span style={{fontSize:11,color:th.tm}}>{fm.covers.filter(c=>c.checked).length} / {fm.covers.length} piese</span>
              </div>
              <div style={{position:"relative",marginBottom:8}}>
                <input value={playlistSearch} onChange={e=>setPlaylistSearch(e.target.value)} placeholder="CautƒÉ piesƒÉ sau artist..." style={{width:"100%",padding:"8px 10px 8px 32px",borderRadius:7,border:`1px solid ${th.b}`,background:th.h,color:th.t,fontSize:12,outline:"none",boxSizing:"border-box"}}/>
                <span style={{position:"absolute",left:10,top:"50%",transform:"translateY(-50%)",color:th.tm,pointerEvents:"none"}}><IcSearch s={12}/></span>
              </div>
              <div style={{display:"flex",gap:5,marginBottom:10}}>
                <button onClick={()=>u("covers",fm.covers.map(c=>({...c,checked:true})))} style={{...sty.bg,fontSize:10,padding:"4px 10px"}}>Tot</button>
                <button onClick={()=>u("covers",fm.covers.map(c=>({...c,checked:false})))} style={{...sty.bg,fontSize:10,padding:"4px 10px"}}>Nimic</button>
                <button onClick={()=>u("covers",[...fm.covers,{id:uid(),title:"",artist:"",checked:true}])} style={{...sty.bg,fontSize:10,padding:"4px 10px"}}><IcPlus s={10}/> AdaugƒÉ</button>
              </div>
              <div style={{display:"flex",flexDirection:"column",gap:2,maxHeight:320,overflow:"auto"}}>
                {fm.covers.filter(c=>!playlistSearch||c.title.toLowerCase().includes(playlistSearch.toLowerCase())||(c.artist||"").toLowerCase().includes(playlistSearch.toLowerCase())).map(c=>(
                  <div key={c.id} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:6,border:`1px solid ${c.checked?th.a:th.b}`,background:c.checked?th.ab:th.h}}>
                    <input type="checkbox" checked={c.checked} onChange={()=>u("covers",fm.covers.map(x=>x.id===c.id?{...x,checked:!x.checked}:x))} style={{accentColor:th.t,width:14,height:14,cursor:"pointer",flexShrink:0}}/>
                    <input value={c.title} onChange={e=>u("covers",fm.covers.map(x=>x.id===c.id?{...x,title:e.target.value}:x))} style={{...iStyle,flex:1,minWidth:0,padding:"4px 8px",fontSize:11}} placeholder="PiesƒÉ"/>
                    <input value={c.artist||""} onChange={e=>u("covers",fm.covers.map(x=>x.id===c.id?{...x,artist:e.target.value}:x))} style={{...iStyle,width:120,padding:"4px 8px",fontSize:11}} placeholder="Artist"/>
                    <button onClick={()=>u("covers",fm.covers.filter(x=>x.id!==c.id))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer",flexShrink:0}}>‚úï</button>
                  </div>
                ))}
              </div>
            </div>}

{secTab==="note"&&<div>
              <label style={sty.l}>Note interne / Cerin»õe speciale</label>
              <textarea value={fm.notes} onChange={e=>u("notes",e.target.value)} style={{...iStyle,minHeight:120,resize:"vertical"}} placeholder="Obs. interne, repertoriu, cerin»õe speciale..."/>
            </div>}

          </div>

          <div style={{padding:"12px 20px",borderTop:`1px solid ${th.b}`,display:"flex",justifyContent:"space-between",alignItems:"center",gap:6,flexShrink:0,flexWrap:"wrap"}}>
            <button onClick={onClose} style={sty.bg}>AnuleazƒÉ</button>
            <button onClick={()=>{
              const title = fm.cn ? (isP?`${fm.type} ${fm.cn}`:`${fm.type} - ${fm.cn}`) : "Eveniment nou";
              onSave({...fm, title, date: fm.date||"2026-06-15"});
            }} style={sty.b}>{isE?"SalveazƒÉ":"CreeazƒÉ ofertƒÉ"}</button>
          </div>
        </div>
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAIN APP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function App() {
  const [theme, setTheme] = useState(gTheme());
  const [user, setUser]   = useState(null);
  const [sbMode, setSbMode] = useState("full");
  const [tab, setTab]     = useState("acasa");
  const [evs, setEvs]     = useLocalStorageState(LS_KEYS.evs, loadEvs);
  const [genExp, setGE]   = useLocalStorageState(LS_KEYS.genExp, loadGenExp);
  const [tasks, setTasks] = useLocalStorageState(LS_KEYS.tasks, loadTasks);
  const [templates, setTemplates] = useState(loadTemplates);
  const { modal, payload, openModal, closeModal } = useModal();
  const mData = useMemo(() => {
    if (!modal || payload == null) return null;
    if (modal === "detail" || modal === "finance" || modal === "oferta") return typeof payload === "string" ? evs.find(e => e.id === payload) : payload;
    if (modal === "form") return typeof payload === "string" ? evs.find(e => e.id === payload) : payload;
    if (modal === "pick") return payload;
    return null;
  }, [modal, payload, evs]);
  const [search, setSearch] = useState("");
  const [calM, setCalM]   = useState(new Date());
  const [calSidebarDate, setCalSidebarDate] = useState(null);
  const [calDragEvId, setCalDragEvId] = useState(null);
  const [calDropDate, setCalDropDate] = useState(null);
  const [dashboardDateSearch, setDashboardDateSearch] = useState("");
  const [globalSearch, setGlobalSearch] = useState("");
  const [sectTab, setSectTab] = useState("playlist");
  const [riderVersions, setRiderVersions] = useState(loadRiderVersions);
  const { toast, showToast } = useToasts();

  // ‚îÄ‚îÄ‚îÄ GOOGLE CALENDAR STATE ‚îÄ‚îÄ‚îÄ
  const [gcalToken, setGcalToken] = useState(() => {
    const t = localStorage.getItem(GCAL_LS_TOKEN);
    const exp = parseInt(localStorage.getItem(GCAL_LS_EXPIRY)||"0");
    return (t && exp > Date.now()) ? t : null;
  });
  const tokenClientRef = useRef(null);

  useEffect(() => {
    const tryInit = () => {
      if (typeof google === "undefined" || !google.accounts?.oauth2) { setTimeout(tryInit, 600); return; }
      tokenClientRef.current = google.accounts.oauth2.initTokenClient({
        client_id: GCAL_CLIENT_ID,
        scope: GCAL_SCOPE,
        callback: (resp) => {
          if (resp.access_token) {
            const exp = Date.now() + (resp.expires_in - 60) * 1000;
            localStorage.setItem(GCAL_LS_TOKEN, resp.access_token);
            localStorage.setItem(GCAL_LS_EXPIRY, String(exp));
            setGcalToken(resp.access_token);
            showToast("üìÖ Google Calendar conectat!");
          }
        }
      });
    };
    setTimeout(tryInit, 800);
  }, []);

  const connectGCal = () => {
    if (tokenClientRef.current) tokenClientRef.current.requestAccessToken({ prompt: gcalToken ? "" : "consent" });
    else showToast("Deschide aplica»õia cu http://localhost:8080");
  };

  const disconnectGCal = () => {
    localStorage.removeItem(GCAL_LS_TOKEN);
    localStorage.removeItem(GCAL_LS_EXPIRY);
    setGcalToken(null);
    showToast("Calendar deconectat");
  };

  const syncToGCal = async (ev) => {
    const token = localStorage.getItem(GCAL_LS_TOKEN);
    const exp   = parseInt(localStorage.getItem(GCAL_LS_EXPIRY)||"0");
    if (!token || exp < Date.now() || !ev.date) return null;
    const startTime = ev.ss || ev.li || "20:00";
    const [sh, sm] = startTime.split(":").map(Number);
    const totalMin = (ev.rep||1)*(ev.repDur||45) + Math.max(0,((ev.rep||1)-1)*20);
    const endTotal = sh*60 + sm + totalMin;
    const endH = String(Math.floor(endTotal/60)%24).padStart(2,"0");
    const endM = String(endTotal%60).padStart(2,"0");
    const body = {
      summary: `PHASER ¬∑ ${ev.type||"Eveniment"}${ev.venue?" @ "+ev.venue:""}`,
      location: [ev.venue,ev.city].filter(Boolean).join(", "),
      description: [
        ev.cn?"Client: "+ev.cn:"", ev.cp?"Tel: "+ev.cp:"",
        ev.ce?"Email: "+ev.ce:"", "Onorariu: "+f$(ev.fee||0),
        ev.dep?"Avans: "+f$(ev.dep):"", ev.desc?"\n"+ev.desc:""
      ].filter(Boolean).join("\n"),
      start: { dateTime:`${ev.date}T${startTime}:00`, timeZone:"Europe/Bucharest" },
      end:   { dateTime:`${ev.date}T${endH}:${endM}:00`, timeZone:"Europe/Bucharest" }
    };
    try {
      const url = ev.gcalId
        ? `https://www.googleapis.com/calendar/v3/calendars/primary/events/${ev.gcalId}`
        : "https://www.googleapis.com/calendar/v3/calendars/primary/events";
      const res = await fetch(url, {
        method: ev.gcalId ? "PUT" : "POST",
        headers: { "Authorization":`Bearer ${token}`, "Content-Type":"application/json" },
        body: JSON.stringify(body)
      });
      if (res.status === 401) { disconnectGCal(); showToast("Sesiune Calendar expiratƒÉ. ReconecteazƒÉ!"); return null; }
      const r = await res.json();
      return r.id || null;
    } catch(e) { return null; }
  };
  const mob = useIsMobile();
  const th  = TH[theme];
  const p   = user ? PM[user.rl] : {};

  useEffect(()=>{ if(mob && sbMode==="full") setSbMode("mini"); },[mob]);
  useEffect(()=>{
    const mq=window.matchMedia("(prefers-color-scheme: dark)");
    const h=e=>setTheme(e.matches?"dark":"light");
    mq.addEventListener("change",h); return ()=>mq.removeEventListener("change",h);
  },[]);

  const stats = useMemo(()=>{
    const sg = evs.filter(e=>e.st==="confirmat");
    const rev = sg.reduce((s,e)=>s+(e.fee||0)+Object.entries(e.svcp||{}).reduce((a,[k,v])=>a+(e.svc?.[k]?v:0),0),0);
    const exp = sg.reduce((s,e)=>s+(e.ex||[]).reduce((a,x)=>a+x.a,0),0);
    const ge  = genExp.reduce((s,e)=>s+e.a,0);
    const pipe= evs.filter(e=>["oferta","asteptare"].includes(e.st)).reduce((s,e)=>s+(e.fee||0),0);
    const pd  = sg.filter(e=>!e.dp).reduce((s,e)=>s+(e.dep||0),0);
    return {rev,exp,ge,net:rev-exp-ge,pipe,pd,sc:sg.length,tc:evs.length};
  },[evs,genExp]);

  const repStr = (d) => {
    if (!d) return "";
    const rd = d.repDurs&&d.repDurs.length>0 ? d.repDurs : Array(d.rep||1).fill(d.repDur||45);
    const n = rd.length;
    const same = rd.every(x=>x===rd[0]);
    return same ? `${n} ${n===1?"reprizƒÉ":"reprize"} √ó ${rd[0]} min` : rd.map((x,i)=>`R${i+1}: ${x}min`).join(" ¬∑ ");
  };
  const saveEv = data => {
    const isEdit = !!(mData&&mData.id);
    const tplPlaylist = (templates.playlist&&templates.playlist.length>0) ? templates.playlist : DEFAULT_COVERS;
    const merged = {...(isEdit?mData:{}),...data};
    const rs = repStr(merged);
    if(isEdit) {
      const updated = {...mData,...data,offerNr:mData.offerNr};
      setEvs(p=>p.map(e=>e.id===mData.id?updated:e));
      closeModal();
      showToast(rs ? `Actualizat! ${rs}` : "Eveniment actualizat!");
      // Sync √Æn background cu Google Calendar
      if(gcalToken) syncToGCal({...updated,gcalId:mData.gcalId}).then(gcalId=>{
        if(gcalId) { setEvs(p=>p.map(e=>e.id===mData.id?{...e,gcalId}:e)); showToast("üìÖ Actualizat √Æn Google Calendar!"); }
      });
    } else {
      const nextNr = Math.max(0, ...evs.map(e=>e.offerNr||0)) + 1;
      const nev = {...data, id:uid(), cr:new Date().toISOString().split("T")[0], videos:data.videos||DEFAULT_VIDEOS, covers:data.covers||tplPlaylist, offerNr:nextNr};
      setEvs(p=>[...p,nev]); openModal("oferta",nev.id);
      showToast(rs ? `OfertƒÉ creatƒÉ! ${rs}` : "OfertƒÉ creatƒÉ!");
      // Sync √Æn background cu Google Calendar
      if(gcalToken) syncToGCal(nev).then(gcalId=>{
        if(gcalId) { setEvs(p=>p.map(e=>e.id===nev.id?{...e,gcalId}:e)); showToast("üìÖ AdƒÉugat √Æn Google Calendar!"); }
      });
    }
  };

  const delEv = id => { setEvs(p=>p.filter(e=>e.id!==id)); closeModal(); };
  const moveEvToDate = (evId, newDate) => { setEvs(p=>p.map(e=>e.id===evId?{...e,date:newDate}:e)); showToast("Data actualizatƒÉ"); };
  const updSt = (id, st) => { setEvs(p=>p.map(e=>e.id===id?{...e,st}:e)); showToast(`Status: ${ST[st]?.l}`); };
  
  const saveTemplates = (upd) => {
    const next = typeof upd==="function" ? upd(templates) : {...templates,...upd};
    setTemplates(next);
    try { localStorage.setItem(LS_KEYS.templates, JSON.stringify(next)); } catch(e) {}
  };
  const addRiderCustomField = () => {
    const t = prompt("Titlu c√¢mp nou:");
    if (t) {
      saveTemplates(tpl=>({...tpl,riderCustom:[...(tpl.riderCustom||[]),{id:uid(),titlu:t,text:""}]}));
      showToast("C√¢mp adƒÉugat »ôi salvat");
    }
  };
  const saveRiderToStorage = (asNewVersion) => {
    try {
      const label = asNewVersion ? (prompt("Nume versiune (ex: Festival 2025):") || "Versiune " + new Date().toLocaleDateString("ro")) : null;
      const riderData = { riderContent: templates.riderContent, riderCustom: templates.riderCustom, riderStagePlot: templates.riderStagePlot || { image: null, notes: "" } };
      if (asNewVersion) {
        const versions = loadRiderVersions();
        const newVer = { id: uid(), ts: Date.now(), label, data: riderData };
        const updated = [newVer, ...versions].slice(0, 20);
        localStorage.setItem(LS_KEYS.riderVersions, JSON.stringify(updated));
        setRiderVersions(updated);
      }
      localStorage.setItem(LS_KEYS.templates, JSON.stringify(templates));
      showToast(asNewVersion ? `Versiune "${label}" salvatƒÉ` : "Rider salvat");
    } catch(e) {}
  };
  const restoreRiderVersion = (ver) => {
    if (!ver?.data) return;
    setTemplates(t => ({ ...t, riderContent: ver.data.riderContent || {}, riderCustom: ver.data.riderCustom || [], riderStagePlot: ver.data.riderStagePlot || { image: null, notes: "" } }));
    showToast(`Restaurat: ${ver.label}`);
  };

  const sty = {
    i:  {width:"100%",padding:"10px 12px",borderRadius:7,border:`1px solid ${th.b}`,background:th.i,color:th.t,fontSize:14,fontFamily:"inherit"},
    l:  {fontSize:10,color:th.tm,marginBottom:3,display:"block",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px"},
    b:  {padding:"8px 16px",borderRadius:7,border:"none",background:th.a,color:th.bg,fontWeight:600,fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",gap:6},
    bg: {padding:"8px 16px",borderRadius:7,border:`1px solid ${th.b}`,background:"transparent",color:th.ts,fontWeight:500,fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",gap:6},
    cd: {background:th.c,border:`1px solid ${th.b}`,borderRadius:10,padding:16}
  };

  const getSvcTotal = ev => Object.entries(ev.svcp||{}).reduce((s,[k,v])=>s+(ev.svc?.[k]?v:0),0);
  const getExpTotal = ev => (ev.ex||[]).reduce((s,x)=>s+x.a,0);
  const pendingCount = evs.filter(e=>["oferta","asteptare"].includes(e.st)).length;
  const activeTaskCount = tasks.filter(t=>!t.done).length;

  const MONTHS_RO = {ianuarie:1,februarie:2,martie:3,aprilie:4,mai:5,iunie:6,iulie:7,august:8,septembrie:9,octombrie:10,noiembrie:11,decembrie:12};
  const globalSearchResults = useMemo(()=>{
    const q = (globalSearch||"").trim().toLowerCase();
    if(!q) return {evs:[],tasks:[]};
    let qDate = q.replace(/\./g,"-").replace(/(\d{1,2})-(\d{1,2})-(\d{4})/,(_,d,m,y)=>`${y}-${m.padStart(2,"0")}-${d.padStart(2,"0")}`);
    const now = new Date();
    const y = now.getFullYear();
    for (const [name, num] of Object.entries(MONTHS_RO)) {
      if (q.includes(name)) {
        const dMatch = q.match(/\b(\d{1,2})\b/);
        const day = dMatch ? parseInt(dMatch[1],10) : null;
        if (day!=null&&day>=1&&day<=31) qDate = `${y}-${String(num).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
        else qDate = `${y}-${String(num).padStart(2,"0")}`;
        break;
      }
    }
    const evMatches = evs.filter(e=>{
      if([e.cn,e.type,e.venue,e.city,e.notes,e.desc,e.title].some(f=>String(f||"").toLowerCase().includes(q))) return true;
      if(e.date&&(e.date.includes(q)||e.date.includes(qDate)||fD(e.date).toLowerCase().includes(q))) return true;
      if(e.date) for (const [name, num] of Object.entries(MONTHS_RO)) if (q.includes(name) && e.date.startsWith(`${y}-${String(num).padStart(2,"0")}`)) return true;
      return false;
    });
    const taskMatchesSearch = t=>{ if((t.text||"").toLowerCase().includes(q)) return true; if((t.notes||"").toLowerCase().includes(q)) return true; if((t.tags||[]).some(tag=>tag.toLowerCase().includes(q))) return true; if((t.subtasks||[]).some(s=>taskMatchesSearch(s))) return true; return false; };
    const taskMatches = tasks.filter(taskMatchesSearch);
    return {evs:evMatches.slice(0,8),tasks:taskMatches.slice(0,6)};
  },[globalSearch,evs,tasks]);

  const navItems = [
    {id:"acasa",    Ic:IcDash,  l:"AcasƒÉ"},
    {id:"events",   Ic:IcMusic, l:"Evenimente"},
    {id:"offers",   Ic:IcSend,  l:"Oferte",  badge:pendingCount},
    {id:"docs", Ic:IcFile, l:"Docs"},
    {id:"tasks",    Ic:IcTask,  l:"Tasks",    badge:activeTaskCount},
    {id:"calendar", Ic:IcCal,   l:"Calendar"},
    ...(p.f?[{id:"finances", Ic:IcMoney, l:"Finan»õe"}]:[]),
  ];

  const sbW = sbMode==="full"?220:56;

  // Swipe refs ‚Äî must be before any early return
  const appTouchStart = useRef(null);
  const appTouchStartY = useRef(null);

  const handleAppTouchStart = (e) => {
    appTouchStart.current = e.touches[0].clientX;
    appTouchStartY.current = e.touches[0].clientY;
  };

  const handleAppTouchEnd = (e) => {
    if(appTouchStart.current === null) return;
    const startX = appTouchStart.current;
    const dx = e.changedTouches[0].clientX - startX;
    const dy = Math.abs(e.changedTouches[0].clientY - appTouchStartY.current);
    appTouchStart.current = null;
    if(Math.abs(dx) < 50 || Math.abs(dx) < dy * 1.5) return;
    if(dx > 0 && startX < 80 && sbMode === "mini") { setSbMode("full"); return; }
    if(dx < 0 && sbMode === "full") { setSbMode("mini"); return; }
    if(modal || sbMode === "full") return;
    const allNav = ["acasa","events","offers","docs","tasks","calendar",
      ...(p.f?["finances"]:[])
    ];
    const i = allNav.indexOf(tab);
    if(dx < 0 && i < allNav.length - 1) setTab(allNav[i + 1]);
    if(dx > 0 && i > 0) setTab(allNav[i - 1]);
  };

  if(!user) return (
    <div style={{minHeight:"100vh",fontFamily:"'Inter',system-ui,sans-serif",background:"#0c0c0c",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 28px",gap:24}}>
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0;padding:0}@keyframes up{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}`}</style>

      {/* Logo ‚Äî direct, fara card */}
      <div style={{animation:"up .5s ease",textAlign:"center"}}>
        <img src={LOGO_URL} alt="PHASER" style={{width:220,display:"block",margin:"0 auto"}}/>
        <div style={{fontSize:9,color:"#3a3a3a",letterSpacing:4,textTransform:"uppercase",marginTop:16,fontWeight:400}}>Band Manager</div>
      </div>

      {/* Separator */}
      <div style={{width:40,height:1,background:"#222"}}/>

      {/* Selector profil */}
      <div style={{animation:"up .5s ease .1s both",width:"100%",maxWidth:320}}>
        <div style={{fontSize:9,color:"#3a3a3a",letterSpacing:3,textTransform:"uppercase",textAlign:"center",marginBottom:16}}>Alege profilul</div>
        <div style={{display:"flex",flexDirection:"column",gap:8}}>
          {USERS.map(u=>(
            <button key={u.id} onClick={()=>setUser(u)} style={{
              width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center",
              padding:"14px 20px",
              background:"#161616",
              color:"#fff",cursor:"pointer",fontFamily:"inherit",
              border:"1px solid #222",
              borderRadius:12,
              transition:"background .15s, border-color .15s"
            }}
            onMouseOver={e=>{e.currentTarget.style.background="#1e1e1e";e.currentTarget.style.borderColor="#333"}}
            onMouseOut={e=>{e.currentTarget.style.background="#161616";e.currentTarget.style.borderColor="#222"}}
            >
              <span style={{fontWeight:600,fontSize:15}}>{u.n}</span>
              <span style={{fontSize:9,color:"#404040",textTransform:"uppercase",letterSpacing:2}}>{u.rl}</span>
            </button>
          ))}
        </div>
      </div>
    </div>
  );

  // Evenimentele √ÆmpƒÉr»õite pt. tab "events" ‚Äî Viitoare / Trecute
  const now = new Date();
  const viitoare = evs.filter(e=>e.st==="confirmat"&&new Date(e.date+"T00:00:00")>=now).sort((a,b)=>new Date(a.date)-new Date(b.date));
  const trecute  = evs.filter(e=>e.st==="confirmat"&&new Date(e.date+"T00:00:00")<now).sort((a,b)=>new Date(b.date)-new Date(a.date));
  // Toate evenimentele (inclusiv oferte) pentru search
  const allEvsSorted = [...evs].sort((a,b)=>new Date(a.date)-new Date(b.date));
  const fEvs = search ? allEvsSorted.filter(e=>[e.title,e.cn,e.venue,e.city].some(f=>f?.toLowerCase().includes(search.toLowerCase()))) : allEvsSorted;

  return (
    <div
      style={{display:"flex",height:"100vh",fontFamily:"'Inter',system-ui,sans-serif",background:th.bg,color:th.t,overflow:"hidden"}}
      onTouchStart={handleAppTouchStart}
      onTouchEnd={handleAppTouchEnd}
    >
      <style>{`@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');*{box-sizing:border-box;margin:0;padding:0}::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:${th.b};border-radius:3px}input,select,textarea{font-family:inherit}input:focus,select:focus,textarea:focus{outline:none;border-color:${th.tm}!important}select.modernSel{appearance:none;-webkit-appearance:none;-moz-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23888' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;padding-right:28px;cursor:pointer;border-radius:8px;border:1px solid ${th.b};background-color:${th.i};color:${th.t};font-size:13px;transition:border-color .15s,box-shadow .15s}select.modernSel:hover{border-color:${th.tm}}select.modernSel:focus{box-shadow:0 0 0 2px ${th.ab}}@keyframes su{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}button:hover{opacity:.85}table{border-collapse:collapse}`}</style>

      {/* SIDEBAR ‚Äî fundal √Æntunecat mereu, logo alb */}
      <div style={{width:sbW,background:"#0a0a0c",borderRight:"1px solid #1a1a1a",display:"flex",flexDirection:"column",flexShrink:0,transition:"width .25s ease",overflow:"hidden"}}>
        <div style={{padding:sbMode==="full"?"16px 16px":"8px",borderBottom:"1px solid #1a1a1a",display:"flex",alignItems:"center",justifyContent:sbMode==="mini"?"center":"space-between",minHeight:62}}>
          {sbMode==="full"&&<Logo height={28}/>}
          <button onClick={()=>setSbMode(sbMode==="full"?"mini":"full")} style={{padding:8,border:"none",background:sbMode==="mini"?"rgba(255,255,255,.08)":"transparent",color:"#888",cursor:"pointer",flexShrink:0,borderRadius:8}} title={sbMode==="mini"?"Deschide meniu":"√énchide meniu"}>
            {sbMode==="full"?<IcChevL s={14}/>:<IcChevR s={14}/>}
          </button>
        </div>



        <nav style={{flex:1,padding:"8px 6px",display:"flex",flexDirection:"column",gap:1}}>
          {navItems.map(it=><button key={it.id} onClick={()=>{ setTab(it.id); if(mob) setSbMode("mini"); }} title={sbMode==="mini"?it.l:undefined}
            style={{display:"flex",alignItems:"center",gap:9,padding:sbMode==="full"?"8px 10px":"8px 0",justifyContent:sbMode==="mini"?"center":"flex-start",borderRadius:7,border:"none",cursor:"pointer",fontSize:12,fontWeight:tab===it.id?700:400,background:tab===it.id?"rgba(255,255,255,.1)":"transparent",color:tab===it.id?"#fff":"#888",transition:"all .15s",whiteSpace:"nowrap",position:"relative"}}>
            <it.Ic s={16}/>
            {sbMode==="full"&&<><span style={{flex:1,textAlign:"left"}}>{it.l}</span>{it.badge>0&&<span style={{background:"#f59e0b",color:"#000",borderRadius:10,fontSize:9,fontWeight:700,padding:"1px 6px"}}>{it.badge}</span>}</>}
            {sbMode==="mini"&&it.badge>0&&<span style={{position:"absolute",top:4,right:4,width:7,height:7,borderRadius:"50%",background:"#f59e0b"}}/>}
          </button>)}
        </nav>

        {/* Google Calendar connect */}
        <div style={{padding:"6px 6px 0",borderTop:"1px solid #1a1a1a"}}>
          <button onClick={gcalToken ? disconnectGCal : connectGCal}
            title={sbMode==="mini"?(gcalToken?"Calendar conectat ‚úì":"ConecteazƒÉ Calendar Google"):undefined}
            style={{display:"flex",alignItems:"center",gap:6,padding:sbMode==="full"?"6px 10px":"6px 0",justifyContent:sbMode==="mini"?"center":"flex-start",borderRadius:6,border:"none",background:gcalToken?"rgba(34,197,94,.12)":"transparent",color:gcalToken?"#22c55e":"#555",fontSize:11,cursor:"pointer",width:"100%",transition:"all .2s"}}>
            <span style={{fontSize:13}}>üìÖ</span>
            {sbMode==="full"&&<span>{gcalToken?"Calendar conectat ‚úì":"ConecteazƒÉ Calendar"}</span>}
          </button>
        </div>
        <div style={{padding:"4px 6px 10px"}}>
          <button onClick={()=>setUser(null)} style={{display:"flex",alignItems:"center",gap:6,padding:sbMode==="full"?"6px 10px":"6px 0",justifyContent:sbMode==="mini"?"center":"flex-start",borderRadius:6,border:"none",background:"transparent",color:"#555",fontSize:11,cursor:"pointer",width:"100%"}}>
            <IcOut s={14}/>{sbMode==="full"&&<span>{user.n} ¬∑ <span style={{textTransform:"uppercase",fontSize:9,letterSpacing:1}}>{user.rl}</span></span>}
          </button>
        </div>
      </div>

      {/* MAIN */}
      <div style={{flex:1,overflow:"auto",display:"flex",flexDirection:"column",position:"relative"}}>
        {sbMode==="mini"&&<button onClick={()=>setSbMode("full")} style={{position:"absolute",left:12,top:16,zIndex:100,padding:10,borderRadius:10,border:`1px solid ${th.b}`,background:th.c,color:th.t,cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,.15)"}} title="Deschide meniu"><IcChevR s={18}/></button>}
        <div style={{flex:1,minHeight:0,overflow:"auto",padding:mob?"14px 12px":"22px 26px",paddingLeft:sbMode==="mini"?52:undefined}}>

          {/* GLOBAL SEARCH ‚Äî mereu vizibil */}
          <div style={{position:"relative",marginBottom:16,maxWidth:400}}>
            <span style={{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:th.tm,pointerEvents:"none"}}><IcSearch s={16}/></span>
            <input value={globalSearch} onChange={e=>setGlobalSearch(e.target.value)} placeholder="CautƒÉ √Æn toatƒÉ aplica»õia..." style={{...sty.i,width:"100%",paddingLeft:38,paddingRight:12,paddingTop:10,paddingBottom:10,fontSize:14,borderRadius:10}}/>
            {globalSearch.trim()&&<button onClick={()=>setGlobalSearch("")} style={{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",padding:4,border:"none",background:"transparent",color:th.tm,cursor:"pointer",fontSize:18}}>√ó</button>}
            {globalSearch.trim()&&(globalSearchResults.evs.length>0||globalSearchResults.tasks.length>0)&&<div style={{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:th.c,borderRadius:10,border:`1px solid ${th.b}`,boxShadow:"0 8px 24px rgba(0,0,0,.15)",zIndex:200,maxHeight:360,overflow:"auto"}}>
              {globalSearchResults.evs.length>0&&<div style={{padding:"8px 12px",fontSize:10,color:th.tm,fontWeight:700,textTransform:"uppercase",letterSpacing:1}}>Oferte / Evenimente</div>}
              {globalSearchResults.evs.map(ev=><div key={ev.id} onClick={()=>{setGlobalSearch("");openModal("detail",ev.id);}} style={{padding:"10px 14px",cursor:"pointer",borderBottom:`1px solid ${th.bl}`,display:"flex",justifyContent:"space-between",alignItems:"center"}} onMouseOver={e=>e.currentTarget.style.background=th.h} onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                <div><div style={{fontSize:13,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div><div style={{fontSize:11,color:th.tm}}>{fD(ev.date)} ¬∑ {ev.venue}</div></div>
                <div onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={updSt}/></div>
              </div>)}
              {globalSearchResults.tasks.length>0&&<div style={{padding:"8px 12px",fontSize:10,color:th.tm,fontWeight:700,textTransform:"uppercase",letterSpacing:1}}>Tasks</div>}
              {globalSearchResults.tasks.map(t=><div key={t.id} onClick={()=>{setGlobalSearch("");setTab("tasks");}} style={{padding:"10px 14px",cursor:"pointer",borderBottom:`1px solid ${th.bl}`}} onMouseOver={e=>e.currentTarget.style.background=th.h} onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                <div style={{fontSize:13,fontWeight:600}}>{t.text}</div>
                <div style={{fontSize:11,color:th.tm}}>{(t.tags||[]).slice(0,3).map(tg=>"#"+tg).join(" ")}{t.due?" ¬∑ "+fD(t.due):""}</div>
              </div>)}
            </div>}
            {globalSearch.trim()&&globalSearchResults.evs.length===0&&globalSearchResults.tasks.length===0&&<div style={{position:"absolute",top:"100%",left:0,right:0,marginTop:4,padding:16,background:th.c,borderRadius:10,border:`1px solid ${th.b}`,boxShadow:"0 8px 24px rgba(0,0,0,.15)",zIndex:200,fontSize:13,color:th.tm}}>Niciun rezultat</div>}
          </div>

          {/* ACASƒÇ */}
          {tab==="acasa"&&<div style={{animation:"su .3s ease"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:20,flexWrap:"wrap",gap:12}}>
              <div>
                <h1 style={{fontSize:22,fontWeight:700,letterSpacing:"-0.5px"}}>AcasƒÉ</h1>
                <p style={{color:th.tm,fontSize:12,marginTop:2}}>Bun venit, {user.n}!</p>
              </div>
              <div style={{display:"flex",alignItems:"center",gap:8}}>
                <div style={{display:"flex",alignItems:"center",gap:6}}>
                  <IcCal s={16} style={{color:th.tm}}/>
                  <input type="date" value={dashboardDateSearch} onChange={e=>setDashboardDateSearch(e.target.value)} style={{...sty.i,padding:"6px 10px",fontSize:12,maxWidth:150}} placeholder="CautƒÉ dupƒÉ datƒÉ"/>
                </div>
                {p.c&&<button onClick={()=>openModal("pick",null)} style={sty.b}><IcPlus s={14}/> OfertƒÉ nouƒÉ</button>}
              </div>
            </div>

            {dashboardDateSearch&&<div style={{...sty.cd,marginBottom:16}}>
              <div style={{fontSize:13,fontWeight:700,marginBottom:10,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <span>üìÖ √én data {fD(dashboardDateSearch)}</span>
                <button onClick={()=>setDashboardDateSearch("")} style={{fontSize:10,color:th.tm,background:"transparent",border:"none",cursor:"pointer"}}>»ôterge</button>
              </div>
              {evs.filter(e=>e.date===dashboardDateSearch).length===0&&<div style={{padding:16,textAlign:"center",color:th.tm,fontSize:12}}>Nicio ofertƒÉ sau eveniment √Æn aceastƒÉ zi</div>}
              {evs.filter(e=>e.date===dashboardDateSearch).map(ev=><div key={ev.id} onClick={()=>openModal("detail",ev.id)} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 12px",borderRadius:7,marginBottom:4,cursor:"pointer",borderLeft:"3px solid "+(ST[ev.st]?.c||th.a)}} onMouseOver={e=>e.currentTarget.style.background=th.h} onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                <div><div style={{fontSize:13,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div><div style={{fontSize:11,color:th.tm}}>{ev.venue}{ev.city?", "+ev.city:""}</div></div>
                <Badge s={ev.st} th={th}/>
              </div>)}
              {evs.filter(e=>e.date===dashboardDateSearch).length>0&&<button onClick={()=>{setTab("calendar");setCalM(new Date(dashboardDateSearch));}} style={{...sty.bg,fontSize:11,marginTop:8,width:"100%"}}>Deschide √Æn calendar</button>}
            </div>}

            <div style={{display:"grid",gridTemplateColumns:mob?"1fr":"1fr 1fr",gap:12,marginBottom:14}}>
              {/* Evenimente viitoare */}
              <div style={sty.cd}>
                <div style={{fontSize:13,fontWeight:700,marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                  <span>üóì UrmeazƒÉ</span>
                  <button onClick={()=>setTab("events")} style={{fontSize:10,color:th.tm,background:"transparent",border:"none",cursor:"pointer"}}>toate ‚Üí</button>
                </div>
                {viitoare.slice(0,5).map(ev=>
                  <div key={ev.id} onClick={()=>openModal("detail",ev.id)} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:7,marginBottom:3,cursor:"pointer",borderLeft:"3px solid #22c55e"}}
                    onMouseOver={e=>e.currentTarget.style.background=th.h}
                    onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                    <div><div style={{fontSize:12,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div><div style={{fontSize:10,color:th.tm}}>{ev.venue}{ev.city?", "+ev.city:""}</div></div>
                    <div style={{textAlign:"right",flexShrink:0,marginLeft:8}}><div style={{fontSize:11,fontWeight:600}}>{fD(ev.date)}</div><div style={{fontSize:10,color:th.tm}}>√Æn {dU(ev.date)}z</div></div>
                  </div>
                )}
                {viitoare.length===0&&<div style={{padding:20,textAlign:"center",color:th.tm,fontSize:11}}>Niciun eveniment confirmat viitor</div>}
              </div>

              {/* Oferte active */}
              <div style={sty.cd}>
                <div style={{fontSize:13,fontWeight:700,marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                  <span>üì§ Oferte active</span>
                  <button onClick={()=>setTab("offers")} style={{fontSize:10,color:th.tm,background:"transparent",border:"none",cursor:"pointer"}}>toate ({pendingCount}) ‚Üí</button>
                </div>
                {evs.filter(e=>["oferta","asteptare"].includes(e.st)).sort((a,b)=>new Date(a.date)-new Date(b.date)).slice(0,5).map(ev=>
                  <div key={ev.id} onClick={()=>openModal("detail",ev.id)} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",borderRadius:7,marginBottom:3,cursor:"pointer"}}
                    onMouseOver={e=>e.currentTarget.style.background=th.h}
                    onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                    <div><div style={{fontSize:12,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div><div style={{fontSize:10,color:th.tm}}>{fD(ev.date)}</div></div>
                    <div onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={(id,st)=>{updSt(id,st);}}/></div>
                  </div>
                )}
                {pendingCount===0&&<div style={{padding:20,textAlign:"center",color:th.tm,fontSize:11}}>Nicio ofertƒÉ activƒÉ</div>}
              </div>
            </div>

            <div style={{...sty.cd,padding:20}}>
              <TasksView tasks={tasks} setTasks={setTasks} th={th} sty={sty} mob={mob} compact={true}/>
            </div>
          </div>}

          {/* EVENIMENTE ‚Äî Viitoare + Trecute, fƒÉrƒÉ filtre status */}
          {tab==="events"&&<div style={{animation:"su .3s ease"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
              <h1 style={{fontSize:22,fontWeight:700,letterSpacing:"-0.5px"}}>Evenimente</h1>
              {p.c&&<button onClick={()=>openModal("pick",null)} style={sty.b}><IcPlus s={14}/> OfertƒÉ nouƒÉ</button>}
            </div>
            {/* Search */}
            <div style={{position:"relative",maxWidth:320,marginBottom:16}}>
              <span style={{position:"absolute",left:9,top:"50%",transform:"translateY(-50%)",color:th.tm}}><IcSearch s={14}/></span>
              <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="CautƒÉ eveniment..." style={{...sty.i,paddingLeft:30,fontSize:mob?"16px":"14px"}}/>
            </div>
            {search ? (
              <div style={{...sty.cd,padding:0,overflow:"hidden"}}>
                <table style={{width:"100%"}}>
                  <thead><tr style={{borderBottom:`1px solid ${th.b}`}}>
                    {["Client","DatƒÉ","Loca»õie","SumƒÉ","Status"].map(h=><th key={h} style={{padding:"9px 12px",textAlign:"left",fontSize:9,color:th.tm,textTransform:"uppercase",letterSpacing:1,fontWeight:600}}>{h}</th>)}
                  </tr></thead>
                  <tbody>{fEvs.map(ev=>
                    <tr key={ev.id} onClick={()=>openModal("detail",ev.id)} style={{borderBottom:`1px solid ${th.bl}`,cursor:"pointer"}}
                      onMouseOver={e=>e.currentTarget.style.background=th.h}
                      onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                      <td style={{padding:"9px 12px"}}><div style={{fontSize:12,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div></td>
                      <td style={{padding:"9px 12px",fontSize:11}}>{fD(ev.date)}</td>
                      <td style={{padding:"9px 12px",fontSize:11}}>{ev.venue}{ev.city?", "+ev.city:""}</td>
                      <td style={{padding:"9px 12px",fontSize:12,fontWeight:600}}>{ev.fee?f$(ev.fee):"‚Äî"}</td>
                      <td style={{padding:"9px 12px"}} onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={(id,st)=>{updSt(id,st);}}/></td>
                    </tr>
                  )}</tbody>
                </table>
                {fEvs.length===0&&<div style={{padding:30,textAlign:"center",color:th.tm,fontSize:12}}>Niciun rezultat</div>}
              </div>
            ) : <>
              {/* Viitoare */}
              <div style={{fontSize:11,fontWeight:700,color:th.tm,textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Viitoare confirmate ({viitoare.length})</div>
              <div style={{...sty.cd,padding:0,overflow:"hidden",marginBottom:20}}>
                {viitoare.length===0&&<div style={{padding:30,textAlign:"center",color:th.tm,fontSize:12}}>Niciun eveniment confirmat viitor</div>}
                {viitoare.length>0&&<table style={{width:"100%"}}>
                  <tbody>{viitoare.map((ev,i)=>
                    <tr key={ev.id} onClick={()=>openModal("detail",ev.id)} style={{borderBottom:i<viitoare.length-1?`1px solid ${th.bl}`:"none",cursor:"pointer"}}
                      onMouseOver={e=>e.currentTarget.style.background=th.h}
                      onMouseOut={e=>e.currentTarget.style.background="transparent"}>
                      <td style={{padding:"10px 14px"}}><div style={{fontSize:13,fontWeight:700}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div><div style={{fontSize:10,color:th.tm}}>{ev.cat==="private"?"ZGV":"PHASER"}</div></td>
                      <td style={{padding:"10px 14px",fontSize:11}}>{fD(ev.date)}<div style={{fontSize:10,color:"#22c55e",fontWeight:600}}>√Æn {dU(ev.date)} zile</div></td>
                      <td style={{padding:"10px 14px",fontSize:11,color:th.tm}}>{ev.venue}{ev.city?", "+ev.city:""}</td>
                      <td style={{padding:"10px 14px",fontSize:13,fontWeight:700}}>{f$(ev.fee)}</td>
                      <td style={{padding:"10px 14px"}} onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={(id,st)=>{updSt(id,st);}}/></td>
                      {p.e&&<td style={{padding:"10px 14px"}} onClick={e=>e.stopPropagation()}><button onClick={()=>openModal("form",ev.id)} style={{padding:4,borderRadius:4,border:`1px solid ${th.b}`,background:"transparent",color:th.tm,cursor:"pointer"}}><IcEdit s={13}/></button></td>}
                    </tr>
                  )}</tbody>
                </table>}
              </div>
              {/* Trecute */}
              <div style={{fontSize:11,fontWeight:700,color:th.tm,textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Trecute ({trecute.length})</div>
              <div style={{...sty.cd,padding:0,overflow:"hidden"}}>
                {trecute.length===0&&<div style={{padding:30,textAlign:"center",color:th.tm,fontSize:12}}>Niciun eveniment trecut</div>}
                {trecute.length>0&&<table style={{width:"100%"}}>
                  <tbody>{trecute.map((ev,i)=>
                    <tr key={ev.id} onClick={()=>openModal("detail",ev.id)} style={{borderBottom:i<trecute.length-1?`1px solid ${th.bl}`:"none",cursor:"pointer",opacity:.7}}
                      onMouseOver={e=>{e.currentTarget.style.background=th.h;e.currentTarget.style.opacity="1"}}
                      onMouseOut={e=>{e.currentTarget.style.background="transparent";e.currentTarget.style.opacity=".7"}}>
                      <td style={{padding:"10px 14px"}}><div style={{fontSize:13,fontWeight:600}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div></td>
                      <td style={{padding:"10px 14px",fontSize:11}}>{fD(ev.date)}</td>
                      <td style={{padding:"10px 14px",fontSize:11,color:th.tm}}>{ev.venue}{ev.city?", "+ev.city:""}</td>
                      <td style={{padding:"10px 14px",fontSize:13,fontWeight:700}}>{f$(ev.fee)}</td>
                      <td style={{padding:"10px 14px"}} onClick={e=>e.stopPropagation()}><BadgeStatusSelect s={ev.st} th={th} evId={ev.id} onStatusChange={(id,st)=>{updSt(id,st);}}/></td>
                    </tr>
                  )}</tbody>
                </table>}
              </div>
            </>}
          </div>}

          {/* OFERTE */}
          {tab==="offers"&&<OffersBoard evs={evs} th={th} sty={sty} mob={mob} onSelect={ev=>openModal("detail",ev.id)} onAddOffer={p.c?()=>openModal("pick",null):undefined} onStatusChange={updSt}/>}

          {/* DOCS ‚Äî Documente, rider, playlist, press kit ‚Äî template pentru oferte */}
          {tab==="docs"&&<div style={{animation:"su .3s ease"}}>
            <div style={{marginBottom:20}}>
              <h1 style={{fontSize:22,fontWeight:700,letterSpacing:"-0.5px"}}>Docs</h1>
              <p style={{color:th.tm,fontSize:12,marginTop:2}}>Documente, rider, playlist »ôi press kit ‚Äî template-uri editabile pentru oferte.</p>
              <div style={{display:"flex",gap:8,marginTop:12,flexWrap:"wrap"}}>
                <button onClick={()=>{const blob=new Blob([JSON.stringify({_v:PHASER_V,evs,tasks,genExp,templates,riderVersions,creative:loadCreative()},null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download=`phaser-backup-${new Date().toISOString().slice(0,10)}.json`;a.click();URL.revokeObjectURL(a.href);showToast("Backup exportat");}} style={sty.bg}><IcFile s={14}/> Export JSON</button>
                <label style={{...sty.bg,cursor:"pointer",margin:0,display:"inline-flex",alignItems:"center",gap:6}}><IcFile s={14}/> Import JSON<input type="file" accept=".json,application/json" style={{display:"none"}} onChange={e=>{const f=e.target.files?.[0];if(!f)return;const r=new FileReader();r.onload=()=>{try{const d=JSON.parse(r.result);if(!d||typeof d!=="object")throw new Error("JSON invalid");if(Array.isArray(d.evs)){setEvs(d.evs);}if(Array.isArray(d.tasks)){setTasks(d.tasks);}if(Array.isArray(d.genExp)){setGE(d.genExp);}if(d.templates){setTemplates(d.templates);try{localStorage.setItem(LS_KEYS.templates,JSON.stringify(d.templates));}catch(x){}}if(Array.isArray(d.riderVersions)){setRiderVersions(d.riderVersions);try{localStorage.setItem(LS_KEYS.riderVersions,JSON.stringify(d.riderVersions));}catch(x){}}if(d.creative){try{localStorage.setItem(LS_KEYS.creative,JSON.stringify(d.creative));}catch(x){}}showToast("Date importate");}catch(err){showToast("Eroare: "+(err?.message||String(err)));}e.target.value="";};r.readAsText(f);}}/></label>
              </div>
            </div>
            <div style={{display:"flex",gap:6,marginBottom:16,flexWrap:"wrap"}}>
              {["rider","playlist","pressKitPrivat","pressKitPublic","poveste"].map(s=>(
                <button key={s} onClick={()=>setSectTab(s)} style={{padding:"6px 14px",borderRadius:7,border:"none",fontSize:12,fontWeight:sectTab===s?700:400,cursor:"pointer",background:sectTab===s?th.ab:"transparent",color:sectTab===s?th.t:th.tm}}>
                  {{rider:"Rider",playlist:"Playlist",pressKitPrivat:"Press Kit Privat",pressKitPublic:"Press Kit Public",poveste:"Poveste"}[s]}
                </button>
              ))}
            </div>
            <div style={sty.cd}>
              {sectTab==="rider"&&<div>
                <label style={sty.l}>Rider Tehnic »ôi Ospitalitate ‚Äî con»õinut editabil</label>
                <p style={{fontSize:11,color:th.tm,marginBottom:10}}>Acest con»õinut este preluat √Æn oferte c√¢nd rider-ul e inclus.</p>
                {/* Subsec»õiune Stage Plot */}
                <div style={{marginBottom:20,padding:16,borderRadius:10,border:`1px solid ${th.b}`,background:th.h}}>
                  <div style={{fontSize:12,fontWeight:700,color:th.t,marginBottom:10,display:"flex",alignItems:"center",gap:8}}>
                    <IcImg s={16}/> Stage Plot
                  </div>
                  <p style={{fontSize:11,color:th.tm,marginBottom:10}}>Plan de amplasament pe scenƒÉ ‚Äî imagine »ôi note. √én ofertƒÉ se afi»ôeazƒÉ StagePlot.png sau imaginea √ÆncƒÉrcatƒÉ.</p>
                  <div style={{marginBottom:12}}>
                    <label style={{...sty.l,fontSize:10}}>Imagine Stage Plot (op»õional)</label>
                    <input type="file" accept="image/*" onChange={e=>{const f=e.target.files?.[0];if(f){const r=new FileReader();r.onload=()=>saveTemplates(tpl=>({...tpl,riderStagePlot:{...tpl.riderStagePlot,image:r.result}}));r.readAsDataURL(f);}}} style={{fontSize:11}}/>
                    {(templates.riderStagePlot?.image||"StagePlot.png")&&<div style={{marginTop:8}}>
                      <img src={templates.riderStagePlot?.image||"StagePlot.png"} alt="Stage Plot" style={{maxWidth:"100%",maxHeight:200,objectFit:"contain",borderRadius:8,border:`1px solid ${th.b}`}} onError={e=>{e.target.style.display="none";}}/>
                    </div>}
                  </div>
                  <div>
                    <label style={{...sty.l,fontSize:10}}>Note Stage Plot</label>
                    <textarea value={templates.riderStagePlot?.notes||""} onChange={e=>saveTemplates(tpl=>({...tpl,riderStagePlot:{...tpl.riderStagePlot,notes:e.target.value}}))} placeholder="Ex: Riser tobe 2√ó3m, monitoare conform plan..." style={{...sty.i,minHeight:60,resize:"vertical",fontSize:12}}/>
                  </div>
                </div>
                <div style={{display:"flex",flexDirection:"column",gap:12}}>
                  {["sunet","scena","probe","lumini","video","instalare","parcare","securitate","backstage","onStage","contact"].map(k=>{
                    const r=RIDER_TEHNIC[k];
                    const val=!r?"":(typeof r==="string"?r:(Array.isArray(r)?r.join("\n"):((r?.text||"")+(r?.req?"\n"+r.req:""))));
                    const cur=templates.riderContent?.[k]??val;
                    return <div key={k}>
                      <label style={{...sty.l,textTransform:"capitalize"}}>{k}</label>
                      <textarea value={cur} onChange={e=>saveTemplates(tpl=>({...tpl,riderContent:{...tpl.riderContent,[k]:e.target.value}}))} style={{...sty.i,minHeight:["backstage","sunet","scena"].includes(k)?100:50,resize:"vertical",fontSize:12}}/>
                    </div>;
                  })}
                  {(templates.riderCustom||[]).map(cf=>(
                    <div key={cf.id} style={{marginTop:12,paddingTop:12,borderTop:`1px solid ${th.b}`}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,marginBottom:4}}>
                        <input value={cf.titlu||""} onChange={e=>saveTemplates(tpl=>({...tpl,riderCustom:(tpl.riderCustom||[]).map(x=>x.id===cf.id?{...x,titlu:e.target.value}:x)}))} placeholder="Titlu c√¢mp" style={{...sty.i,flex:1,padding:"6px 10px",fontSize:12}}/>
                        <button onClick={()=>saveTemplates(tpl=>({...tpl,riderCustom:(tpl.riderCustom||[]).filter(x=>x.id!==cf.id)}))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}><IcTrash s={12}/></button>
                      </div>
                      <textarea value={cf.text||""} onChange={e=>saveTemplates(tpl=>({...tpl,riderCustom:(tpl.riderCustom||[]).map(x=>x.id===cf.id?{...x,text:e.target.value}:x)}))} placeholder="Con»õinut..." style={{...sty.i,minHeight:50,resize:"vertical",fontSize:12}}/>
                    </div>
                  ))}
                  <div style={{marginTop:12}}>
                    <div style={{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"}}>
                      <button onClick={addRiderCustomField} style={sty.bg}><IcPlus s={12}/> AdaugƒÉ c√¢mp custom</button>
                      <button onClick={()=>saveRiderToStorage(false)} style={{...sty.b,padding:"6px 12px",fontSize:12}}>SalveazƒÉ rider</button>
                      <button onClick={()=>saveRiderToStorage(true)} style={{...sty.bg,padding:"6px 12px",fontSize:12}}>SalveazƒÉ ca versiune nouƒÉ</button>
                      {riderVersions.length>0&&<select onChange={e=>{const v=riderVersions.find(x=>x.id===e.target.value);if(v)restoreRiderVersion(v);e.target.value="";}} style={{...sty.i,padding:"6px 12px",fontSize:12,maxWidth:200}} className="modernSel">
                        <option value="">Versiuni anterioare...</option>
                        {riderVersions.map(v=><option key={v.id} value={v.id}>{v.label} ‚Äî {new Date(v.ts).toLocaleDateString("ro")}</option>)}
                      </select>}
                    </div>
                  </div>
                </div>
              </div>}
              {sectTab==="playlist"&&<div>
                <label style={sty.l}>Playlist ‚Äî {((templates.playlist&&templates.playlist.length>0)?templates.playlist:DEFAULT_COVERS).length} piese</label>
                <p style={{fontSize:11,color:th.tm,marginBottom:10}}>Lista pentru oferte private. Download / Share.</p>
                <div style={{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"}}>
                  <button onClick={()=>{const t=prompt("Titlu piesƒÉ:");const a=prompt("Artist:");if(t)saveTemplates(tpl=>({...tpl,playlist:[...(tpl.playlist||DEFAULT_COVERS),{id:uid(),title:t,artist:a||"",checked:true}]}));}} style={sty.bg}><IcPlus s={12}/> AdaugƒÉ</button>
                  <button onClick={()=>{const pl=(templates.playlist&&templates.playlist.length>0)?templates.playlist:DEFAULT_COVERS; const txt=pl.map((c,i)=>`${i+1}. ${c.title} ‚Äî ${c.artist}`).join("\n"); const blob=new Blob([txt],{type:"text/plain"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="phaser-playlist.txt"; a.click(); URL.revokeObjectURL(a.href);}} style={sty.bg}>‚¨á Download</button>
                  <button onClick={async ()=>{const pl=(templates.playlist&&templates.playlist.length>0)?templates.playlist:DEFAULT_COVERS; const txt=pl.map((c,i)=>`${i+1}. ${c.title} ‚Äî ${c.artist}`).join("\n"); try{await navigator.clipboard.writeText(txt); if(navigator.share){await navigator.share({title:"PHASER Playlist",text:txt});}}catch(e){try{const ta=document.createElement("textarea");ta.value=txt;ta.style.cssText="position:fixed;opacity:0";document.body.appendChild(ta);ta.select();document.execCommand("copy");document.body.removeChild(ta);}catch(x){}} alert("Playlist copiat! Po»õi lipi unde vrei.");}} style={sty.bg}>üì§ Share / CopiazƒÉ</button>
                </div>
                <div style={{maxHeight:320,overflow:"auto",display:"flex",flexDirection:"column",gap:2}}>
                  {((templates.playlist&&templates.playlist.length>0)?templates.playlist:DEFAULT_COVERS).map((c,i)=>(
                    <div key={c.id} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",borderRadius:6,border:`1px solid ${th.b}`,background:th.h}}>
                      <span style={{fontSize:10,color:th.tm,minWidth:20}}>{i+1}.</span>
                      <input value={c.title} onChange={e=>saveTemplates(tpl=>({...tpl,playlist:(tpl.playlist||DEFAULT_COVERS).map(x=>x.id===c.id?{...x,title:e.target.value}:x)}))} style={{...sty.i,flex:1,padding:"4px 8px",fontSize:12}}/>
                      <input value={c.artist||""} onChange={e=>saveTemplates(tpl=>({...tpl,playlist:(tpl.playlist||DEFAULT_COVERS).map(x=>x.id===c.id?{...x,artist:e.target.value}:x)}))} style={{...sty.i,width:140,padding:"4px 8px",fontSize:11}} placeholder="Artist"/>
                      <button onClick={()=>saveTemplates(tpl=>({...tpl,playlist:(tpl.playlist||DEFAULT_COVERS).filter(x=>x.id!==c.id)}))} style={{padding:4,border:"none",background:"transparent",color:"#ef4444",cursor:"pointer"}}><IcTrash s={12}/></button>
                    </div>
                  ))}
                </div>
              </div>}
              {sectTab==="pressKitPrivat"&&<div>
                <label style={sty.l}>Press Kit Privat ‚Äî con»õinut pentru nun»õi, botezuri</label>
                <textarea value={templates.pressKitPrivat||""} onChange={e=>saveTemplates({pressKitPrivat:e.target.value})} style={{...sty.i,minHeight:150,resize:"vertical"}} placeholder="Text, link-uri, descriere..."/>
              </div>}
              {sectTab==="pressKitPublic"&&<div>
                <label style={sty.l}>Press Kit Public ‚Äî con»õinut pentru festivaluri, concerte</label>
                <textarea value={templates.pressKitPublic||""} onChange={e=>saveTemplates({pressKitPublic:e.target.value})} style={{...sty.i,minHeight:150,resize:"vertical"}} placeholder="Text, link-uri, descriere..."/>
              </div>}
              {sectTab==="poveste"&&<div>
                <label style={sty.l}>Poveste ‚Äî text √Æn oferta privatƒÉ</label>
                <textarea value={templates.poveste||""} onChange={e=>saveTemplates({poveste:e.target.value})} style={{...sty.i,minHeight:120,resize:"vertical"}} placeholder="Povestea PHASER..."/>
              </div>}
            </div>
          </div>}

          {/* TASKS */}
          {tab==="tasks"&&<div style={{animation:"su .3s ease"}}>
            <div style={{marginBottom:32}}>
              <h1 style={{fontSize:28,fontWeight:700,letterSpacing:"-0.5px",color:th.t}}>Tasks</h1>
              <p style={{color:th.tm,fontSize:15,marginTop:8}}>{tasks.filter(t=>!t.done).length} active ¬∑ {tasks.filter(t=>t.done).length} finalizate</p>
            </div>
            <div style={{...sty.cd,maxWidth:720,padding:32,borderRadius:16,border:`1px solid ${th.bl}`}}>
              <TasksView tasks={tasks} setTasks={setTasks} th={th} sty={sty} mob={mob} compact={false}/>
            </div>
          </div>}

          {/* CALENDAR */}
          {tab==="calendar"&&<div style={{animation:"su .3s ease",display:"flex",flexDirection:"column",gap:0,position:"relative",flex:1,minHeight:0,overflow:"hidden"}}>
            <div style={{flex:1,minWidth:0,minHeight:0,display:"flex",flexDirection:"column",overflow:"hidden"}}>
            <h1 style={{fontSize:22,fontWeight:700,marginBottom:16,flexShrink:0}}>Calendar</h1>
            <div style={{fontSize:11,color:th.tm,marginBottom:8,flexShrink:0}}>Toate ofertele »ôi evenimentele ‚Äî click pe eveniment pentru rezumat</div>
            {(()=>{
              const y=calM.getFullYear(),m=calM.getMonth();
              const f=new Date(y,m,1).getDay(); const dn=new Date(y,m+1,0).getDate();
              const off=f===0?6:f-1;
              const mn=["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"];
              const dk=th.bg==="#09090b";
              return <div style={{...sty.cd,flex:1,minHeight:0,display:"flex",flexDirection:"column",overflow:"hidden"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexShrink:0}}>
                  <button onClick={()=>setCalM(new Date(y,m-1))} style={{...sty.bg,padding:"6px 12px"}}><IcChevL s={14}/> √énapoi</button>
                  <h2 style={{fontSize:18,fontWeight:700}}>{mn[m]} {y}</h2>
                  <button onClick={()=>setCalM(new Date(y,m+1))} style={{...sty.bg,padding:"6px 12px"}}>√énainte <IcChevR s={14}/></button>
                </div>
                <div style={{flex:1,minHeight:0,overflowY:"auto",overflowX:"auto",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain"}}>
                <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:3,minWidth:400}}>
                  {["Lu","Ma","Mi","Jo","Vi","S√¢","Du"].map(d=><div key={d} style={{padding:"6px 4px",textAlign:"center",fontSize:11,color:th.tm,fontWeight:600,borderBottom:`1px solid ${th.b}`}}>{d}</div>)}
                  {Array.from({length:off}).map((_,i)=><div key={`e${i}`} style={{minHeight:70}}/>)}
                  {Array.from({length:dn}).map((_,i)=>{
                    const d=i+1;
                    const ds=`${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
                    const de=evs.filter(e=>e.date===ds);
                    const td=new Date().getDate()===d&&new Date().getMonth()===m&&new Date().getFullYear()===y;
                    const resp=(e)=>e.responsabilPrincipal||(e.responsabili&&e.responsabili[0]?.nume)||e.cn||"‚Äî";
                    return <div key={d} onClick={()=>setCalSidebarDate(ds)} onDragOver={e=>{e.preventDefault();setCalDropDate(ds);}} onDragLeave={()=>setCalDropDate(null)} onDrop={e=>{e.preventDefault();setCalDropDate(null);if(calDragEvId){moveEvToDate(calDragEvId,ds);setCalDragEvId(null);}}}
                      style={{minHeight:80,padding:4,borderRadius:6,border:td?`2px solid ${th.a}`:calDropDate===ds?`2px solid ${th.a}`:de.length>0?`1px solid ${th.b}`:`1px solid ${th.bl}`,background:calDropDate===ds?th.ab:td?th.ab:"transparent",display:"flex",flexDirection:"column",cursor:"pointer"}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2}}>
                        <span style={{fontSize:12,fontWeight:td?800:de.length>0?600:400,color:td?th.t:de.length>0?th.t:th.tm}}>{d}</span>
                        {p.c&&<button onClick={e=>{e.stopPropagation();openModal("pick",{date:ds});}} style={{width:20,height:20,padding:0,borderRadius:6,border:"none",background:th.a,color:th.bg,fontSize:14,fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",lineHeight:1}} title="AdaugƒÉ ofertƒÉ">+</button>}
                      </div>
                      <div style={{flex:1,overflow:"auto",maxHeight:120}}>
                        {de.map(ev=><div key={ev.id} draggable onDragStart={e=>{e.stopPropagation();setCalDragEvId(ev.id);}} onDragEnd={()=>setCalDragEvId(null)} onClick={e=>{e.stopPropagation();setCalSidebarDate(ds);}} style={{padding:"3px 5px",borderRadius:4,marginBottom:2,fontSize:9,fontWeight:600,cursor:"grab",background:dk?ST[ev.st]?.bd:ST[ev.st]?.bg,color:ST[ev.st]?.c,lineHeight:1.25,borderLeft:`3px solid ${ST[ev.st]?.c}`}} title={`${ev.type} ‚Äî ${resp(ev)} ¬∑ ${ST[ev.st]?.l||ev.st} (trage pentru a muta)`}>{ev.type} ({resp(ev)}) ¬∑ {ST[ev.st]?.l||ev.st}</div>)}
                      </div>
                    </div>;
                  })}
                </div>
                </div>
              </div>;
            })()}
            </div>
            {calSidebarDate&&(()=>{
              const dayEvs=evs.filter(e=>e.date===calSidebarDate);
              return <div style={{position:mob?"fixed":"sticky",top:0,right:0,width:mob?"100%":360,maxWidth:"100%",height:mob?"70vh":"auto",maxHeight:"85vh",background:th.c,borderLeft:`1px solid ${th.b}`,boxShadow:"-4px 0 20px rgba(0,0,0,.15)",zIndex:100,overflow:"auto",padding:16}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12}}>
                  <h3 style={{fontSize:14,fontWeight:700}}>{fD(calSidebarDate)} ‚Äî {dayEvs.length} eveniment{dayEvs.length!==1?"e":""}</h3>
                  <button onClick={()=>setCalSidebarDate(null)} style={{padding:4,border:"none",background:"transparent",color:th.tm,cursor:"pointer"}}><IcX s={14}/></button>
                </div>
                {dayEvs.length===0?<div style={{fontSize:12,color:th.tm}}>Niciun eveniment √Æn aceastƒÉ zi</div>:dayEvs.map(ev=>(
                  <div key={ev.id} style={{padding:14,borderRadius:10,border:`1px solid ${th.b}`,background:th.h,marginBottom:10}}>
                    <Badge s={ev.st} th={th}/>
                    <div style={{fontSize:14,fontWeight:700,marginTop:8}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div>
                    <div style={{fontSize:11,color:th.tm,marginTop:2}}>{ev.cat==="private"?"Privat":"Public"} ¬∑ {ev.type}</div>
                    <div style={{fontSize:12,marginTop:6}}>{ev.venue}{ev.city?", "+ev.city:""}</div>
                    <div style={{fontSize:15,fontWeight:700,marginTop:6}}>{f$(ev.fee)}</div>
                    {(ev.responsabilPrincipal||(ev.responsabili||[]).length>0)&&<div style={{fontSize:11,color:th.tm,marginTop:6}}>Preluat: {ev.responsabilPrincipal||(ev.responsabili||[])[0]?.nume||"‚Äî"}</div>}
                    <button onClick={()=>{setCalSidebarDate(null);openModal("detail",ev.id);}} style={{...sty.b,marginTop:10,width:"100%",fontSize:12}}>Deschide oferta</button>
                  </div>
                ))}
              </div>;
            })()}
          </div>}

          {/* FINAN»öE */}
          {tab==="finances"&&<div style={{animation:"su .3s ease"}}>
            <h1 style={{fontSize:22,fontWeight:700,marginBottom:16}}>Finan»õe</h1>
            <div style={{display:"grid",gridTemplateColumns:mob?"1fr 1fr":"repeat(4,1fr)",gap:10,marginBottom:16}}>
              {[{l:"Venituri confirmate",v:f$(stats.rev),ac:"#22c55e"},{l:"Profit net",v:f$(stats.net),ac:stats.net>=0?"#22c55e":"#ef4444"},{l:"Pipeline",v:f$(stats.pipe)},{l:"Avansuri restante",v:f$(stats.pd),ac:stats.pd>0?"#ef4444":"#22c55e"}].map((c,i)=>
                <div key={i} style={sty.cd}><div style={sty.l}>{c.l}</div><div style={{fontSize:mob?16:20,fontWeight:700,marginTop:5,color:c.ac||th.t}}>{c.v}</div></div>
              )}
            </div>
            <div style={{...sty.cd,marginBottom:16}}>
              <div style={{fontSize:13,fontWeight:600,marginBottom:12}}>Split per membru</div>
              <div style={{display:"grid",gridTemplateColumns:mob?"repeat(2,1fr)":"repeat(5,1fr)",gap:8}}>
                {MEMBERS.map(m=>{
                  const tot=evs.filter(e=>e.st==="confirmat").reduce((s,e)=>s+(e.sp?.[m.id]||0),0);
                  return <div key={m.id} style={{padding:12,borderRadius:7,background:th.h,textAlign:"center"}}>
                    <div style={{width:32,height:32,borderRadius:"50%",background:th.a,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:13,color:th.bg,margin:"0 auto 6px"}}>{m.n[0]}</div>
                    <div style={{fontSize:12,fontWeight:500}}>{m.n}</div><div style={{fontSize:10,color:th.tm}}>{m.r}</div>
                    <div style={{fontSize:15,fontWeight:700,marginTop:4}}>{f$(tot)}</div>
                  </div>;
                })}
              </div>
            </div>
            <div style={sty.cd}>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:12}}>
                <div style={{fontSize:13,fontWeight:600}}>Cheltuieli generale</div>
                <button onClick={()=>{const d=prompt("PerioadƒÉ (YYYY-MM):");const desc=prompt("Descriere:");const a=Number(prompt("SumƒÉ ‚Ç¨:"));if(d&&a)setGE(p=>[...p,{id:uid(),d,desc:desc||"",a}])}} style={{...sty.bg,fontSize:11,padding:"5px 10px"}}><IcPlus s={12}/> AdaugƒÉ</button>
              </div>
              {genExp.length===0&&<div style={{padding:20,textAlign:"center",color:th.tm,fontSize:11}}>Nicio cheltuialƒÉ generalƒÉ</div>}
              {genExp.length>0&&<table style={{width:"100%"}}><thead><tr style={{borderBottom:`1px solid ${th.b}`}}>
                {["PerioadƒÉ","Descriere","SumƒÉ"].map(h=><th key={h} style={{padding:"7px 10px",textAlign:"left",fontSize:9,color:th.tm,textTransform:"uppercase",letterSpacing:1}}>{h}</th>)}
              </tr></thead><tbody>{genExp.map(g=>
                <tr key={g.id} style={{borderBottom:`1px solid ${th.bl}`}}>
                  <td style={{padding:"7px 10px",fontSize:11}}>{g.d}</td>
                  <td style={{padding:"7px 10px",fontSize:11}}>{g.desc}</td>
                  <td style={{padding:"7px 10px",fontSize:11,fontWeight:600,color:"#ef4444"}}>{f$(g.a)}</td>
                </tr>
              )}</tbody></table>}
            </div>
          </div>}

        </div>
      </div>

      {/* PICK MODAL */}
      {modal==="pick"&&<div style={{position:"fixed",inset:0,background:th.ov,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1000}} onClick={closeModal}>
        <div style={{background:th.c,border:`1px solid ${th.b}`,borderRadius:14,width:mob?"90%":360,padding:28}} onClick={e=>e.stopPropagation()}>
          <div style={{textAlign:"center",marginBottom:20}}>
            <h2 style={{fontSize:17,fontWeight:700,color:th.t}}>OfertƒÉ nouƒÉ</h2>
            <p style={{color:th.tm,fontSize:12,marginTop:3}}>Ce tip de eveniment?</p>
          </div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>
            <button onClick={()=>{closeModal();setTimeout(()=>openModal("form",{cat:"private",...(mData?.date&&{date:mData.date})}),80);}} style={{background:"#fff",border:"2px solid #333",cursor:"pointer",textAlign:"center",padding:22,borderRadius:10,color:"#111",boxShadow:"0 2px 8px rgba(0,0,0,.2)"}}>
              <div style={{fontSize:28,marginBottom:8}}>üéâ</div><div style={{fontWeight:700,fontSize:14}}>Privat</div><div style={{fontSize:10,color:"#666",marginTop:4}}>ZƒÉGoodVibes</div>
            </button>
            <button onClick={()=>{closeModal();setTimeout(()=>openModal("form",{cat:"public",...(mData?.date&&{date:mData.date})}),80);}} style={{background:"#fff",border:"2px solid #333",cursor:"pointer",textAlign:"center",padding:22,borderRadius:10,color:"#111",boxShadow:"0 2px 8px rgba(0,0,0,.2)"}}>
              <div style={{fontSize:28,marginBottom:8}}>üé∏</div><div style={{fontWeight:700,fontSize:14}}>Public</div><div style={{fontSize:10,color:"#666",marginTop:4}}>PHASER</div>
            </button>
          </div>
          <button onClick={closeModal} style={{...sty.bg,width:"100%",justifyContent:"center",marginTop:12}}>AnuleazƒÉ</button>
        </div>
      </div>}

      {/* EVENT FORM */}
      {modal==="form"&&(()=>{
        const isE=!!mData?.id; const isP=mData?.cat==="private"||!mData?.cat;
        return <EventForm th={th} sty={sty} isE={isE} isP={isP} mData={mData} onSave={saveEv} onClose={closeModal} mob={mob} templates={templates}/>;
      })()}

      {/* EVENT DETAIL ‚Äî Fi»ôa apare DOAR c√¢nd e confirmat */}
      {modal==="detail"&&(()=>{
        if(!mData) return null;
        const ev=mData; const svc=getSvcTotal(ev); const exp=getExpTotal(ev); const isP=ev.cat==="private"; const dk=th.bg==="#09090b";
        const isConfirmed = ev.st==="confirmat";
        return <div style={{position:"fixed",inset:0,background:th.ov,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1000}} onClick={closeModal}>
          <div style={{background:th.c,border:`1px solid ${th.b}`,borderRadius:mob?0:14,width:mob?"100%":600,maxHeight:mob?"100vh":"88vh",height:mob?"100vh":"auto",overflow:"auto"}} onClick={e=>e.stopPropagation()}>
            <div style={{padding:"18px 22px",borderBottom:`1px solid ${th.b}`}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
                <div>
                  <div style={{display:"flex",alignItems:"center",gap:7,marginBottom:6,flexWrap:"wrap"}}>
                    <Badge s={ev.st} th={th}/>
                    <span style={{fontSize:10,padding:"2px 8px",borderRadius:10,background:th.ab,color:th.tm,fontWeight:600}}>{isP?"Privat (ZGV)":"Public (PHASER)"}</span>
                    {ev.type&&<span style={{fontSize:10,padding:"2px 8px",borderRadius:10,background:th.ab,color:th.tm}}>{ev.type}</span>}
                  </div>
                  <div style={{fontSize:18,fontWeight:700,marginBottom:2}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div>
                  <div style={{fontSize:11,color:th.tm}}>{fD(ev.date)} ¬∑ {ev.venue}{ev.city?", "+ev.city:""}</div>
                  {(ev.responsabilPrincipal||(ev.responsabili||[]).length>0)&&<div style={{fontSize:10,color:th.tm,marginTop:4}}>Preluat: {ev.responsabilPrincipal||"‚Äî"} {(ev.responsabili||[]).length>0&&` ¬∑ ${(ev.responsabili||[]).filter(r=>r.nume||r.rol).map(r=>r.nume+(r.rol?" ("+r.rol+")":"")).join(", ")}`}</div>}
                </div>
                <button onClick={closeModal} style={{padding:3,border:"none",background:"transparent",color:th.tm,cursor:"pointer"}}><IcX s={16}/></button>
              </div>
            </div>
            <div style={{padding:"16px 22px"}}>

              {/* FI»òA EVENIMENTULUI ‚Äî doar dacƒÉ e confirmat */}
              {isConfirmed&&<div style={{marginBottom:16,padding:16,borderRadius:10,background:th.h,border:`2px solid #22c55e`}}>
                <div style={{fontSize:11,fontWeight:700,textTransform:"uppercase",letterSpacing:1,marginBottom:12,color:"#22c55e",display:"flex",alignItems:"center",gap:6}}>
                  <IcDoc s={14}/> Fi»ôa evenimentului
                </div>
                {/* Program pe ore */}
                <div style={{marginBottom:12}}>
                  <div style={{fontSize:9,color:th.tm,fontWeight:600,textTransform:"uppercase",letterSpacing:1,marginBottom:6}}>Program pe ore</div>
                  <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:6}}>
                    {[{l:"Load In",v:ev.li,i:"üì¶"},{l:"Soundcheck",v:ev.sc,i:"üéõ"},{l:"Show Start",v:ev.ss,i:"üé§"},{l:"Load Out",v:ev.lo,i:"üöê"}].map((x,i)=>
                      <div key={i} style={{padding:10,borderRadius:8,background:th.c,textAlign:"center",border:`1px solid ${th.b}`}}>
                        <div style={{fontSize:14,marginBottom:3}}>{x.i}</div>
                        <div style={{fontSize:9,color:th.tm,textTransform:"uppercase",letterSpacing:.5,marginBottom:3}}>{x.l}</div>
                        <div style={{fontSize:15,fontWeight:800,color:x.v?th.t:th.tm}}>{x.v||"‚Äî"}</div>
                      </div>
                    )}
                  </div>
                </div>
                {/* Client + Financiar */}
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                  <div style={{padding:10,borderRadius:7,background:th.c,border:`1px solid ${th.b}`}}>
                    <div style={{fontSize:9,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:5}}>Client</div>
                    <div style={{fontSize:12,fontWeight:700}}>{ev.cn||"‚Äî"}</div>
                    {ev.cp&&<div style={{fontSize:11,color:th.ts,marginTop:2}}>{ev.cp}</div>}
                    {ev.ce&&<div style={{fontSize:11,color:th.ts}}>{ev.ce}</div>}
                    {ev.platform&&<div style={{fontSize:11,color:th.tm,marginTop:4,display:"flex",alignItems:"center",gap:4}}>
                      <span style={{fontSize:9,padding:"1px 6px",borderRadius:8,background:th.ab,fontWeight:600,textTransform:"uppercase"}}>{ev.platform}</span>
                      <span style={{color:th.ts}}>{ev.platformId||""}</span>
                    </div>}
                  </div>
                  <div style={{padding:10,borderRadius:7,background:th.c,border:`1px solid ${th.b}`}}>
                    <div style={{fontSize:9,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:5}}>Financiar</div>
                    <div style={{fontSize:16,fontWeight:800}}>{f$(ev.fee+svc)}</div>
                    <div style={{fontSize:10,color:ev.dp?"#22c55e":"#ef4444",marginTop:2}}>Avans {f$(ev.dep)} {ev.dp?"‚úì":"‚úó"}</div>
                    <div style={{fontSize:10,color:th.tm}}>Profit: {f$(ev.fee+svc-exp)}</div>
                  </div>
                </div>
                {!isP&&<div style={{marginTop:10,padding:10,borderRadius:7,background:th.c,border:`1px solid ${th.b}`}}>
                  <div style={{fontSize:9,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:6}}>Rider Tehnic</div>
                  <div style={{display:"flex",flexWrap:"wrap",gap:4}}>
                    {RIDER_TEHNIC.backstage.slice(0,5).map((item,i)=><span key={i} style={{padding:"2px 8px",borderRadius:10,background:th.ab,fontSize:10,color:th.ts}}>{item}</span>)}
                    <span style={{fontSize:10,color:th.tm}}>+{RIDER_TEHNIC.backstage.length-5} mai mult</span>
                  </div>
                </div>}
                {ev.notes&&<div style={{marginTop:10,padding:10,borderRadius:7,background:th.c,border:`1px solid ${th.b}`}}>
                  <div style={{fontSize:9,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:4}}>Note interne</div>
                  <div style={{fontSize:11,color:th.ts}}>{ev.notes}</div>
                </div>}
              </div>}

              {/* DacƒÉ NU e confirmat ‚Äî aratƒÉ info basic */}
              {!isConfirmed&&<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:14}}>
                <div style={{padding:12,borderRadius:7,background:th.h}}>
                  <div style={{fontSize:10,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:5}}>Client</div>
                  <div style={{fontSize:13,fontWeight:600}}>{ev.cn||"‚Äî"}</div>
                  {ev.cp&&<div style={{fontSize:11,color:th.ts,marginTop:2}}>{ev.cp}</div>}
                </div>
                <div style={{padding:12,borderRadius:7,background:th.h}}>
                  <div style={{fontSize:10,color:th.tm,fontWeight:600,textTransform:"uppercase",marginBottom:5}}>Onorariu</div>
                  <div style={{fontSize:18,fontWeight:700}}>{f$(ev.fee)}</div>
                  <div style={{fontSize:10,color:th.tm,marginTop:2}}>Avans: {f$(ev.dep)}</div>
                </div>
              </div>}

              <div style={{display:"flex",gap:5,justifyContent:mob?"center":"flex-end",flexWrap:"wrap",marginTop:8}}>
                <button onClick={()=>{closeModal();setTimeout(()=>openModal("oferta",ev.id),80);}} style={sty.b}><IcFile s={13}/> OfertƒÉ</button>
                {isConfirmed&&<button onClick={()=>{closeModal();setTimeout(()=>openModal("finance",ev.id),80);}} style={sty.bg}><IcMoney s={13}/> Finan»õe</button>}
                {p.e&&<button onClick={()=>{closeModal();setTimeout(()=>openModal("form",ev.id),80);}} style={sty.bg}><IcEdit s={13}/> EditeazƒÉ</button>}
                {p.d&&<button onClick={()=>{if(window.confirm("»òtergi?"))delEv(ev.id)}} style={{...sty.bg,color:"#ef4444",borderColor:"#ef4444"}}><IcTrash s={13}/> »òterge</button>}
              </div>
            </div>
          </div>
        </div>;
      })()}

      {/* FINANCE POPUP */}
      {modal==="finance"&&(()=>{
        if(!mData) return null;
        const ev=mData; const svc=getSvcTotal(ev); const exp=getExpTotal(ev); const tot=ev.fee+svc;
        return <div style={{position:"fixed",inset:0,background:th.ov,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1100}} onClick={closeModal}>
          <div style={{background:th.c,border:`1px solid ${th.b}`,borderRadius:14,width:mob?"90%":400}} onClick={e=>e.stopPropagation()}>
            <div style={{padding:"16px 20px",borderBottom:`1px solid ${th.b}`,display:"flex",justifyContent:"space-between"}}>
              <h3 style={{fontSize:15,fontWeight:700}}>Fi»ôa financiarƒÉ</h3>
              <button onClick={closeModal} style={{padding:3,border:"none",background:"transparent",color:th.tm,cursor:"pointer"}}><IcX s={14}/></button>
            </div>
            <div style={{padding:"16px 20px"}}>
              <div style={{textAlign:"center",marginBottom:14}}>
                <div style={{fontSize:12,color:th.tm}}>{ev.offerNr?"O"+ev.offerNr:"???"} ¬∑ {ev.type}</div>
                <div style={{fontSize:26,fontWeight:800,marginTop:3}}>{f$(tot)}</div>
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,marginBottom:10}}>
                <div style={{padding:10,borderRadius:6,background:th.h,textAlign:"center"}}>
                  <div style={{fontSize:9,color:th.tm,textTransform:"uppercase"}}>Avans</div>
                  <div style={{fontSize:15,fontWeight:700,color:ev.dp?"#22c55e":"#ef4444"}}>{f$(ev.dep)}</div>
                  <div style={{fontSize:9,color:ev.dp?"#22c55e":"#ef4444"}}>{ev.dp?"‚úì √éncasat":"‚úó Ne√Æncasat"}</div>
                </div>
                <div style={{padding:10,borderRadius:6,background:th.h,textAlign:"center"}}>
                  <div style={{fontSize:9,color:th.tm,textTransform:"uppercase"}}>Rest</div>
                  <div style={{fontSize:15,fontWeight:700}}>{f$(tot-(ev.dp?ev.dep:0))}</div>
                </div>
              </div>
              {ev.ex?.length>0&&<div style={{padding:10,borderRadius:6,background:th.h,marginBottom:10}}>
                {ev.ex.map(x=><div key={x.id} style={{display:"flex",justifyContent:"space-between",fontSize:11,padding:"2px 0"}}><span>{x.n}</span><span style={{fontWeight:600,color:"#ef4444"}}>{f$(x.a)}</span></div>)}
              </div>}
              <div style={{padding:10,borderRadius:6,background:th.ab,textAlign:"center"}}>
                <div style={{fontSize:9,color:th.tm,textTransform:"uppercase"}}>Profit net</div>
                <div style={{fontSize:20,fontWeight:800,color:tot-exp>=0?"#22c55e":"#ef4444"}}>{f$(tot-exp)}</div>
              </div>
            </div>
          </div>
        </div>;
      })()}

            {/* OFFER PREVIEW */}
      {modal==="oferta"&&mData&&<OfferPreview
        ev={mData}
        evStatus={mData.st}
        onStatusChange={updSt}
        onOfferUpdate={(id,up)=>{setEvs(p=>p.map(e=>e.id===id?{...e,...up}:e));}}
        th={th}
        mob={mob}
        onClose={closeModal}
        onEdit={p.e?()=>{closeModal();setTimeout(()=>openModal("form",mData.id),80);}:undefined}
        sty={sty}
        templates={templates}
      />}

      {/* Swipe indicator dots ‚Äî mobile only */}
      {mob&&(()=>{
        const allNav=["acasa","events","offers","docs","tasks","calendar",...(p.f?["finances"]:[])];
        return <div style={{position:"fixed",bottom:10,left:"50%",transform:"translateX(-50%)",display:"flex",gap:5,zIndex:500,pointerEvents:"none"}}>
          {allNav.map(id=><div key={id} style={{width:id===tab?20:5,height:5,borderRadius:3,background:id===tab?"rgba(255,255,255,.9)":"rgba(255,255,255,.2)",transition:"all .25s"}}/>)}
        </div>;
      })()}

      <Toast message={toast.message} visible={toast.visible}/>
    </div>
  );
}

// Mount the app ‚Äî cu handler de erori pentru debug
try {
  if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
    document.getElementById('root').innerHTML = '<div style="padding:24px;max-width:480px;margin:40px auto;font-family:system-ui;background:#1a1a1a;color:#fff;border-radius:12px"><h2 style="color:#ef4444">Scripturile nu s-au √ÆncƒÉrcat</h2><p style="margin:12px 0;line-height:1.6">Deschizi fi»ôierul direct (file://). Unele browsere blocheazƒÉ √ÆncƒÉrcarea de pe CDN.</p><p style="margin:12px 0"><strong>Rezolvare:</strong> RuleazƒÉ un server local √Æn folderul proiectului:</p><pre style="background:#222;padding:12px;border-radius:6px;font-size:12px;overflow:auto">cd "/Users/raczradu/Downloads/Phaser Manager"\npython3 -m http.server 8080</pre><p style="margin:12px 0">Apoi deschide <a href="http://localhost:8080" style="color:#60a5fa">http://localhost:8080</a></p></div>';
  } else {
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  }
} catch (e) {
  document.getElementById('root').innerHTML = '<div style="padding:24px;font-family:monospace;color:#ef4444;white-space:pre-wrap;font-size:12px">Eroare: ' + (e.message||e) + '\n\n' + (e.stack||'') + '</div>';
}

  </script>
</body>
</html>